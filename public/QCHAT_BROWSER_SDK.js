!function(t,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a():"function"==typeof define&&define.amd?define(a):(t="undefined"!=typeof globalThis?globalThis:t||self).QChat=a()}(this,(function(){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function createCommonjsModule(t){var a={exports:{}};return t(a,a.exports),a.exports}var a,check=function(t){return t&&t.Math==Math&&t},o=check("object"==typeof globalThis&&globalThis)||check("object"==typeof window&&window)||check("object"==typeof self&&self)||check("object"==typeof t&&t)||function(){return this}()||Function("return this")(),fails=function(t){try{return!!t()}catch(t){return!0}},c=!fails((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),l={}.propertyIsEnumerable,p=Object.getOwnPropertyDescriptor,d={f:p&&!l.call({1:2},1)?function propertyIsEnumerable(t){var a=p(this,t);return!!a&&a.enumerable}:l},createPropertyDescriptor=function(t,a){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:a}},h={}.toString,classofRaw=function(t){return h.call(t).slice(8,-1)},m="".split,v=fails((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==classofRaw(t)?m.call(t,""):Object(t)}:Object,requireObjectCoercible=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},toIndexedObject=function(t){return v(requireObjectCoercible(t))},isObject$1=function(t){return"object"==typeof t?null!==t:"function"==typeof t},toPrimitive=function(t,a){if(!isObject$1(t))return t;var o,c;if(a&&"function"==typeof(o=t.toString)&&!isObject$1(c=o.call(t)))return c;if("function"==typeof(o=t.valueOf)&&!isObject$1(c=o.call(t)))return c;if(!a&&"function"==typeof(o=t.toString)&&!isObject$1(c=o.call(t)))return c;throw TypeError("Can't convert object to primitive value")},y={}.hasOwnProperty,has$1=function(t,a){return y.call(t,a)},g=o.document,b=isObject$1(g)&&isObject$1(g.createElement),documentCreateElement=function(t){return b?g.createElement(t):{}},C=!c&&!fails((function(){return 7!=Object.defineProperty(documentCreateElement("div"),"a",{get:function(){return 7}}).a})),S=Object.getOwnPropertyDescriptor,_={f:c?S:function getOwnPropertyDescriptor(t,a){if(t=toIndexedObject(t),a=toPrimitive(a,!0),C)try{return S(t,a)}catch(t){}if(has$1(t,a))return createPropertyDescriptor(!d.f.call(t,a),t[a])}},M=/#|\.prototype\./,isForced=function(t,a){var o=k[w(t)];return o==I||o!=x&&("function"==typeof a?fails(a):!!a)},w=isForced.normalize=function(t){return String(t).replace(M,".").toLowerCase()},k=isForced.data={},x=isForced.NATIVE="N",I=isForced.POLYFILL="P",T=isForced,R={},aFunction$1=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},functionBindContext=function(t,a,o){if(aFunction$1(t),void 0===a)return t;switch(o){case 0:return function(){return t.call(a)};case 1:return function(o){return t.call(a,o)};case 2:return function(o,c){return t.call(a,o,c)};case 3:return function(o,c,l){return t.call(a,o,c,l)}}return function(){return t.apply(a,arguments)}},anObject=function(t){if(!isObject$1(t))throw TypeError(String(t)+" is not an object");return t},q=Object.defineProperty,E={f:c?q:function defineProperty(t,a,o){if(anObject(t),a=toPrimitive(a,!0),anObject(o),C)try{return q(t,a,o)}catch(t){}if("get"in o||"set"in o)throw TypeError("Accessors not supported");return"value"in o&&(t[a]=o.value),t}},P=c?function(t,a,o){return E.f(t,a,createPropertyDescriptor(1,o))}:function(t,a,o){return t[a]=o,t},A=_.f,wrapConstructor=function(t){var Wrapper=function(a,o,c){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(a);case 2:return new t(a,o)}return new t(a,o,c)}return t.apply(this,arguments)};return Wrapper.prototype=t.prototype,Wrapper},_export=function(t,a){var c,l,p,d,h,m,v,y,g=t.target,b=t.global,C=t.stat,S=t.proto,_=b?o:C?o[g]:(o[g]||{}).prototype,M=b?R:R[g]||(R[g]={}),w=M.prototype;for(p in a)c=!T(b?p:g+(C?".":"#")+p,t.forced)&&_&&has$1(_,p),h=M[p],c&&(m=t.noTargetGet?(y=A(_,p))&&y.value:_[p]),d=c&&m?m:a[p],c&&typeof h==typeof d||(v=t.bind&&c?functionBindContext(d,o):t.wrap&&c?wrapConstructor(d):S&&"function"==typeof d?functionBindContext(Function.call,d):d,(t.sham||d&&d.sham||h&&h.sham)&&P(v,"sham",!0),M[p]=v,S&&(has$1(R,l=g+"Prototype")||P(R,l,{}),R[l][p]=d,t.real&&w&&!w[p]&&P(w,p,d)))},aFunction=function(t){return"function"==typeof t?t:void 0},getBuiltIn=function(t,a){return arguments.length<2?aFunction(R[t])||aFunction(o[t]):R[t]&&R[t][a]||o[t]&&o[t][a]},O=Math.ceil,j=Math.floor,toInteger$1=function(t){return isNaN(t=+t)?0:(t>0?j:O)(t)},U=Math.min,toLength=function(t){return t>0?U(toInteger$1(t),9007199254740991):0},B=Math.max,L=Math.min,toAbsoluteIndex=function(t,a){var o=toInteger$1(t);return o<0?B(o+a,0):L(o,a)},createMethod$4=function(t){return function(a,o,c){var l,p=toIndexedObject(a),d=toLength(p.length),h=toAbsoluteIndex(c,d);if(t&&o!=o){for(;d>h;)if((l=p[h++])!=l)return!0}else for(;d>h;h++)if((t||h in p)&&p[h]===o)return t||h||0;return!t&&-1}},N={includes:createMethod$4(!0),indexOf:createMethod$4(!1)},$={},G=N.indexOf,objectKeysInternal=function(t,a){var o,c=toIndexedObject(t),l=0,p=[];for(o in c)!has$1($,o)&&has$1(c,o)&&p.push(o);for(;a.length>l;)has$1(c,o=a[l++])&&(~G(p,o)||p.push(o));return p},Q=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],D=Object.keys||function keys(t){return objectKeysInternal(t,Q)},W=c?Object.defineProperties:function defineProperties(t,a){anObject(t);for(var o,c=D(a),l=c.length,p=0;l>p;)E.f(t,o=c[p++],a[o]);return t},K=getBuiltIn("document","documentElement"),V=!0,z="__core-js_shared__",H=o[z]||function(t,a){try{P(o,t,a)}catch(c){o[t]=a}return a}(z,{}),J=createCommonjsModule((function(t){(t.exports=function(t,a){return H[t]||(H[t]=void 0!==a?a:{})})("versions",[]).push({version:"3.10.1",mode:"pure",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"})})),Y=0,X=Math.random(),uid=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++Y+X).toString(36)},Z=J("keys"),sharedKey=function(t){return Z[t]||(Z[t]=uid(t))},ee=sharedKey("IE_PROTO"),EmptyConstructor=function(){},scriptTag=function(t){return"<script>"+t+"</"+"script>"},NullProtoObject=function(){try{a=document.domain&&new ActiveXObject("htmlfile")}catch(t){}var t,o;NullProtoObject=a?function(t){t.write(scriptTag("")),t.close();var a=t.parentWindow.Object;return t=null,a}(a):((o=documentCreateElement("iframe")).style.display="none",K.appendChild(o),o.src=String("javascript:"),(t=o.contentWindow.document).open(),t.write(scriptTag("document.F=Object")),t.close(),t.F);for(var c=Q.length;c--;)delete NullProtoObject.prototype[Q[c]];return NullProtoObject()};$[ee]=!0;var te=Object.create||function create(t,a){var o;return null!==t?(EmptyConstructor.prototype=anObject(t),o=new EmptyConstructor,EmptyConstructor.prototype=null,o[ee]=t):o=NullProtoObject(),void 0===a?o:W(o,a)},re=[].slice,ne={},construct$4=function(t,a,o){if(!(a in ne)){for(var c=[],l=0;l<a;l++)c[l]="a["+l+"]";ne[a]=Function("C,a","return new C("+c.join(",")+")")}return ne[a](t,o)},ae=Function.bind||function bind(t){var a=aFunction$1(this),o=re.call(arguments,1),c=function bound(){var l=o.concat(re.call(arguments));return this instanceof c?construct$4(a,l.length,l):a.apply(t,l)};return isObject$1(a.prototype)&&(c.prototype=a.prototype),c},oe=getBuiltIn("Reflect","construct"),ie=fails((function(){function F(){}return!(oe((function(){}),[],F)instanceof F)})),se=!fails((function(){oe((function(){}))})),ce=ie||se;_export({target:"Reflect",stat:!0,forced:ce,sham:ce},{construct:function construct(t,a){aFunction$1(t),anObject(a);var o=arguments.length<3?t:aFunction$1(arguments[2]);if(se&&!ie)return oe(t,a,o);if(t==o){switch(a.length){case 0:return new t;case 1:return new t(a[0]);case 2:return new t(a[0],a[1]);case 3:return new t(a[0],a[1],a[2]);case 4:return new t(a[0],a[1],a[2],a[3])}var c=[null];return c.push.apply(c,a),new(ae.apply(t,c))}var l=o.prototype,p=te(isObject$1(l)?l:Object.prototype),d=Function.apply.call(t,p,a);return isObject$1(d)?d:p}});var le=R.Reflect.construct,ue=getDefaultExportFromCjs(createCommonjsModule((function(t){t.exports=function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")},t.exports.default=t.exports,t.exports.__esModule=!0})));_export({target:"Object",stat:!0,forced:!c,sham:!c},{defineProperty:E.f});var pe=createCommonjsModule((function(t){var a=R.Object,o=t.exports=function defineProperty(t,o,c){return a.defineProperty(t,o,c)};a.defineProperty.sham&&(o.sham=!0)})),de=pe,he=getDefaultExportFromCjs(createCommonjsModule((function(t){function _defineProperties(t,a){for(var o=0;o<a.length;o++){var c=a[o];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),de(t,c.key,c)}}t.exports=function _createClass(t,a,o){return a&&_defineProperties(t.prototype,a),o&&_defineProperties(t,o),t},t.exports.default=t.exports,t.exports.__esModule=!0}))),fe=createCommonjsModule((function(t){t.exports=function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.default=t.exports,t.exports.__esModule=!0})),me=getDefaultExportFromCjs(fe),toObject=function(t){return Object(requireObjectCoercible(t))},ve=!fails((function(){function F(){}return F.prototype.constructor=null,Object.getPrototypeOf(new F)!==F.prototype})),ye=sharedKey("IE_PROTO"),ge=Object.prototype,be=ve?Object.getPrototypeOf:function(t){return t=toObject(t),has$1(t,ye)?t[ye]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?ge:null};_export({target:"Reflect",stat:!0},{get:function get$6(t,a){var o,c,l=arguments.length<3?t:arguments[2];return anObject(t)===l?t[a]:(o=_.f(t,a))?has$1(o,"value")?o.value:void 0===o.get?void 0:o.get.call(l):isObject$1(c=be(t))?get$6(c,a,l):void 0}});var Ce=R.Reflect.get,Se=_.f,_e=fails((function(){Se(1)}));_export({target:"Object",stat:!0,forced:!c||_e,sham:!c},{getOwnPropertyDescriptor:function getOwnPropertyDescriptor(t,a){return Se(toIndexedObject(t),a)}});var Me=createCommonjsModule((function(t){var a=R.Object,o=t.exports=function getOwnPropertyDescriptor(t,o){return a.getOwnPropertyDescriptor(t,o)};a.getOwnPropertyDescriptor.sham&&(o.sham=!0)})),we=Me,ke=Object.setPrototypeOf||("__proto__"in{}?function(){var t,a=!1,o={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(o,[]),a=o instanceof Array}catch(t){}return function setPrototypeOf(o,c){return anObject(o),function(t){if(!isObject$1(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype")}(c),a?t.call(o,c):o.__proto__=c,o}}():void 0);_export({target:"Object",stat:!0},{setPrototypeOf:ke});var xe=R.Object.setPrototypeOf,Ie=fails((function(){be(1)}));_export({target:"Object",stat:!0,forced:Ie,sham:!ve},{getPrototypeOf:function getPrototypeOf(t){return be(toObject(t))}});var Te=R.Object.getPrototypeOf,Re=createCommonjsModule((function(t){function _getPrototypeOf(a){return t.exports=_getPrototypeOf=xe?Te:function _getPrototypeOf(t){return t.__proto__||Te(t)},t.exports.default=t.exports,t.exports.__esModule=!0,_getPrototypeOf(a)}t.exports=_getPrototypeOf,t.exports.default=t.exports,t.exports.__esModule=!0})),qe=getDefaultExportFromCjs(Re),Ee=createCommonjsModule((function(t){t.exports=function _superPropBase(t,a){for(;!Object.prototype.hasOwnProperty.call(t,a)&&null!==(t=Re(t)););return t},t.exports.default=t.exports,t.exports.__esModule=!0})),Pe=createCommonjsModule((function(t){function _get(a,o,c){return"undefined"!=typeof Reflect&&Ce?(t.exports=_get=Ce,t.exports.default=t.exports,t.exports.__esModule=!0):(t.exports=_get=function _get(t,a,o){var c=Ee(t,a);if(c){var l=we(c,a);return l.get?l.get.call(o):l.value}},t.exports.default=t.exports,t.exports.__esModule=!0),_get(a,o,c||a)}t.exports=_get,t.exports.default=t.exports,t.exports.__esModule=!0})),Ae=getDefaultExportFromCjs(Pe);_export({target:"Object",stat:!0,sham:!c},{create:te});var Oe,je,Ue=R.Object,Be=function create(t,a){return Ue.create(t,a)},Le=createCommonjsModule((function(t){function _setPrototypeOf(a,o){return t.exports=_setPrototypeOf=xe||function _setPrototypeOf(t,a){return t.__proto__=a,t},t.exports.default=t.exports,t.exports.__esModule=!0,_setPrototypeOf(a,o)}t.exports=_setPrototypeOf,t.exports.default=t.exports,t.exports.__esModule=!0})),Ne=getDefaultExportFromCjs(createCommonjsModule((function(t){t.exports=function _inherits(t,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function");t.prototype=Be(a&&a.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),a&&Le(t,a)},t.exports.default=t.exports,t.exports.__esModule=!0}))),Fe=Array.isArray||function isArray(t){return"Array"==classofRaw(t)},createProperty=function(t,a,o){var c=toPrimitive(a);c in t?E.f(t,c,createPropertyDescriptor(0,o)):t[c]=o},$e="process"==classofRaw(o.process),Ge=getBuiltIn("navigator","userAgent")||"",Qe=o.process,De=Qe&&Qe.versions,We=De&&De.v8;We?je=(Oe=We.split("."))[0]+Oe[1]:Ge&&(!(Oe=Ge.match(/Edge\/(\d+)/))||Oe[1]>=74)&&(Oe=Ge.match(/Chrome\/(\d+)/))&&(je=Oe[1]);var Ke=je&&+je,Ve=!!Object.getOwnPropertySymbols&&!fails((function(){return!Symbol.sham&&($e?38===Ke:Ke>37&&Ke<41)})),ze=Ve&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,He=J("wks"),Je=o.Symbol,Ye=ze?Je:Je&&Je.withoutSetter||uid,wellKnownSymbol=function(t){return has$1(He,t)&&(Ve||"string"==typeof He[t])||(Ve&&has$1(Je,t)?He[t]=Je[t]:He[t]=Ye("Symbol."+t)),He[t]},Xe=wellKnownSymbol("species"),arraySpeciesCreate=function(t,a){var o;return Fe(t)&&("function"!=typeof(o=t.constructor)||o!==Array&&!Fe(o.prototype)?isObject$1(o)&&null===(o=o[Xe])&&(o=void 0):o=void 0),new(void 0===o?Array:o)(0===a?0:a)},Ze=wellKnownSymbol("species"),arrayMethodHasSpeciesSupport=function(t){return Ke>=51||!fails((function(){var a=[];return(a.constructor={})[Ze]=function(){return{foo:1}},1!==a[t](Boolean).foo}))},et=wellKnownSymbol("isConcatSpreadable"),tt=9007199254740991,rt="Maximum allowed index exceeded",nt=Ke>=51||!fails((function(){var t=[];return t[et]=!1,t.concat()[0]!==t})),at=arrayMethodHasSpeciesSupport("concat"),isConcatSpreadable=function(t){if(!isObject$1(t))return!1;var a=t[et];return void 0!==a?!!a:Fe(t)};_export({target:"Array",proto:!0,forced:!nt||!at},{concat:function concat(t){var a,o,c,l,p,d=toObject(this),h=arraySpeciesCreate(d,0),m=0;for(a=-1,c=arguments.length;a<c;a++)if(isConcatSpreadable(p=-1===a?d:arguments[a])){if(m+(l=toLength(p.length))>tt)throw TypeError(rt);for(o=0;o<l;o++,m++)o in p&&createProperty(h,m,p[o])}else{if(m>=tt)throw TypeError(rt);createProperty(h,m++,p)}return h.length=m,h}});var ot=Q.concat("length","prototype"),it={f:Object.getOwnPropertyNames||function getOwnPropertyNames(t){return objectKeysInternal(t,ot)}},st=it.f,ct={}.toString,lt="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],ut={f:function getOwnPropertyNames(t){return lt&&"[object Window]"==ct.call(t)?function(t){try{return st(t)}catch(t){return lt.slice()}}(t):st(toIndexedObject(t))}},pt={f:Object.getOwnPropertySymbols},redefine=function(t,a,o,c){c&&c.enumerable?t[a]=o:P(t,a,o)},dt={f:wellKnownSymbol},ht=E.f,defineWellKnownSymbol=function(t){var a=R.Symbol||(R.Symbol={});has$1(a,t)||ht(a,t,{value:dt.f(t)})},ft={};ft[wellKnownSymbol("toStringTag")]="z";var mt="[object z]"===String(ft),vt=wellKnownSymbol("toStringTag"),yt="Arguments"==classofRaw(function(){return arguments}()),gt=mt?classofRaw:function(t){var a,o,c;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(o=function(t,a){try{return t[a]}catch(t){}}(a=Object(t),vt))?o:yt?classofRaw(a):"Object"==(c=classofRaw(a))&&"function"==typeof a.callee?"Arguments":c},bt=mt?{}.toString:function toString(){return"[object "+gt(this)+"]"},Ct=E.f,St=wellKnownSymbol("toStringTag"),setToStringTag=function(t,a,o,c){if(t){var l=o?t:t.prototype;has$1(l,St)||Ct(l,St,{configurable:!0,value:a}),c&&!mt&&P(l,"toString",bt)}},_t=Function.toString;"function"!=typeof H.inspectSource&&(H.inspectSource=function(t){return _t.call(t)});var Mt,wt,kt,xt=H.inspectSource,It=o.WeakMap,Tt="function"==typeof It&&/native code/.test(xt(It)),Rt=o.WeakMap;if(Tt){var qt=H.state||(H.state=new Rt),Et=qt.get,Pt=qt.has,At=qt.set;Mt=function(t,a){return a.facade=t,At.call(qt,t,a),a},wt=function(t){return Et.call(qt,t)||{}},kt=function(t){return Pt.call(qt,t)}}else{var Ot=sharedKey("state");$[Ot]=!0,Mt=function(t,a){return a.facade=t,P(t,Ot,a),a},wt=function(t){return has$1(t,Ot)?t[Ot]:{}},kt=function(t){return has$1(t,Ot)}}var jt={set:Mt,get:wt,has:kt,enforce:function(t){return kt(t)?wt(t):Mt(t,{})},getterFor:function(t){return function(a){var o;if(!isObject$1(a)||(o=wt(a)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return o}}},Ut=[].push,createMethod$3=function(t){var a=1==t,o=2==t,c=3==t,l=4==t,p=6==t,d=7==t,h=5==t||p;return function(m,y,g,b){for(var C,S,_=toObject(m),M=v(_),w=functionBindContext(y,g,3),k=toLength(M.length),x=0,I=b||arraySpeciesCreate,T=a?I(m,k):o||d?I(m,0):void 0;k>x;x++)if((h||x in M)&&(S=w(C=M[x],x,_),t))if(a)T[x]=S;else if(S)switch(t){case 3:return!0;case 5:return C;case 6:return x;case 2:Ut.call(T,C)}else switch(t){case 4:return!1;case 7:Ut.call(T,C)}return p?-1:c||l?l:T}},Bt={forEach:createMethod$3(0),map:createMethod$3(1),filter:createMethod$3(2),some:createMethod$3(3),every:createMethod$3(4),find:createMethod$3(5),findIndex:createMethod$3(6),filterOut:createMethod$3(7)},Lt=Bt.forEach,Nt=sharedKey("hidden"),Ft="Symbol",$t=wellKnownSymbol("toPrimitive"),Gt=jt.set,Qt=jt.getterFor(Ft),Dt=Object.prototype,Wt=o.Symbol,Kt=getBuiltIn("JSON","stringify"),Vt=_.f,zt=E.f,Ht=ut.f,Jt=d.f,Yt=J("symbols"),Xt=J("op-symbols"),Zt=J("string-to-symbol-registry"),er=J("symbol-to-string-registry"),tr=J("wks"),rr=o.QObject,nr=!rr||!rr.prototype||!rr.prototype.findChild,ar=c&&fails((function(){return 7!=te(zt({},"a",{get:function(){return zt(this,"a",{value:7}).a}})).a}))?function(t,a,o){var c=Vt(Dt,a);c&&delete Dt[a],zt(t,a,o),c&&t!==Dt&&zt(Dt,a,c)}:zt,wrap$1=function(t,a){var o=Yt[t]=te(Wt.prototype);return Gt(o,{type:Ft,tag:t,description:a}),c||(o.description=a),o},or=ze?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof Wt},ir=function defineProperty(t,a,o){t===Dt&&ir(Xt,a,o),anObject(t);var c=toPrimitive(a,!0);return anObject(o),has$1(Yt,c)?(o.enumerable?(has$1(t,Nt)&&t[Nt][c]&&(t[Nt][c]=!1),o=te(o,{enumerable:createPropertyDescriptor(0,!1)})):(has$1(t,Nt)||zt(t,Nt,createPropertyDescriptor(1,{})),t[Nt][c]=!0),ar(t,c,o)):zt(t,c,o)},sr=function defineProperties(t,a){anObject(t);var o=toIndexedObject(a),l=D(o).concat(pr(o));return Lt(l,(function(a){c&&!cr.call(o,a)||ir(t,a,o[a])})),t},cr=function propertyIsEnumerable(t){var a=toPrimitive(t,!0),o=Jt.call(this,a);return!(this===Dt&&has$1(Yt,a)&&!has$1(Xt,a))&&(!(o||!has$1(this,a)||!has$1(Yt,a)||has$1(this,Nt)&&this[Nt][a])||o)},lr=function getOwnPropertyDescriptor(t,a){var o=toIndexedObject(t),c=toPrimitive(a,!0);if(o!==Dt||!has$1(Yt,c)||has$1(Xt,c)){var l=Vt(o,c);return!l||!has$1(Yt,c)||has$1(o,Nt)&&o[Nt][c]||(l.enumerable=!0),l}},ur=function getOwnPropertyNames(t){var a=Ht(toIndexedObject(t)),o=[];return Lt(a,(function(t){has$1(Yt,t)||has$1($,t)||o.push(t)})),o},pr=function getOwnPropertySymbols(t){var a=t===Dt,o=Ht(a?Xt:toIndexedObject(t)),c=[];return Lt(o,(function(t){!has$1(Yt,t)||a&&!has$1(Dt,t)||c.push(Yt[t])})),c};if(Ve||(Wt=function Symbol(){if(this instanceof Wt)throw TypeError("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,a=uid(t),setter=function(t){this===Dt&&setter.call(Xt,t),has$1(this,Nt)&&has$1(this[Nt],a)&&(this[Nt][a]=!1),ar(this,a,createPropertyDescriptor(1,t))};return c&&nr&&ar(Dt,a,{configurable:!0,set:setter}),wrap$1(a,t)},redefine(Wt.prototype,"toString",(function toString(){return Qt(this).tag})),redefine(Wt,"withoutSetter",(function(t){return wrap$1(uid(t),t)})),d.f=cr,E.f=ir,_.f=lr,it.f=ut.f=ur,pt.f=pr,dt.f=function(t){return wrap$1(wellKnownSymbol(t),t)},c&&zt(Wt.prototype,"description",{configurable:!0,get:function description(){return Qt(this).description}})),_export({global:!0,wrap:!0,forced:!Ve,sham:!Ve},{Symbol:Wt}),Lt(D(tr),(function(t){defineWellKnownSymbol(t)})),_export({target:Ft,stat:!0,forced:!Ve},{for:function(t){var a=String(t);if(has$1(Zt,a))return Zt[a];var o=Wt(a);return Zt[a]=o,er[o]=a,o},keyFor:function keyFor(t){if(!or(t))throw TypeError(t+" is not a symbol");if(has$1(er,t))return er[t]},useSetter:function(){nr=!0},useSimple:function(){nr=!1}}),_export({target:"Object",stat:!0,forced:!Ve,sham:!c},{create:function create(t,a){return void 0===a?te(t):sr(te(t),a)},defineProperty:ir,defineProperties:sr,getOwnPropertyDescriptor:lr}),_export({target:"Object",stat:!0,forced:!Ve},{getOwnPropertyNames:ur,getOwnPropertySymbols:pr}),_export({target:"Object",stat:!0,forced:fails((function(){pt.f(1)}))},{getOwnPropertySymbols:function getOwnPropertySymbols(t){return pt.f(toObject(t))}}),Kt){var dr=!Ve||fails((function(){var t=Wt();return"[null]"!=Kt([t])||"{}"!=Kt({a:t})||"{}"!=Kt(Object(t))}));_export({target:"JSON",stat:!0,forced:dr},{stringify:function stringify(t,a,o){for(var c,l=[t],p=1;arguments.length>p;)l.push(arguments[p++]);if(c=a,(isObject$1(a)||void 0!==t)&&!or(t))return Fe(a)||(a=function(t,a){if("function"==typeof c&&(a=c.call(this,t,a)),!or(a))return a}),l[1]=a,Kt.apply(null,l)}})}Wt.prototype[$t]||P(Wt.prototype,$t,Wt.prototype.valueOf),setToStringTag(Wt,Ft),$[Nt]=!0,defineWellKnownSymbol("asyncIterator"),defineWellKnownSymbol("hasInstance"),defineWellKnownSymbol("isConcatSpreadable"),defineWellKnownSymbol("iterator"),defineWellKnownSymbol("match"),defineWellKnownSymbol("matchAll"),defineWellKnownSymbol("replace"),defineWellKnownSymbol("search"),defineWellKnownSymbol("species"),defineWellKnownSymbol("split"),defineWellKnownSymbol("toPrimitive"),defineWellKnownSymbol("toStringTag"),defineWellKnownSymbol("unscopables"),setToStringTag(o.JSON,"JSON",!0);var hr=R.Symbol;defineWellKnownSymbol("asyncDispose"),defineWellKnownSymbol("dispose"),defineWellKnownSymbol("observable"),defineWellKnownSymbol("patternMatch"),defineWellKnownSymbol("replaceAll");var fr,mr,vr,yr=hr,createMethod$2=function(t){return function(a,o){var c,l,p=String(requireObjectCoercible(a)),d=toInteger$1(o),h=p.length;return d<0||d>=h?t?"":void 0:(c=p.charCodeAt(d))<55296||c>56319||d+1===h||(l=p.charCodeAt(d+1))<56320||l>57343?t?p.charAt(d):c:t?p.slice(d,d+2):l-56320+(c-55296<<10)+65536}},gr={codeAt:createMethod$2(!1),charAt:createMethod$2(!0)},br=wellKnownSymbol("iterator"),Cr=!1;[].keys&&("next"in(vr=[].keys())?(mr=be(be(vr)))!==Object.prototype&&(fr=mr):Cr=!0);var Sr=null==fr||fails((function(){var t={};return fr[br].call(t)!==t}));Sr&&(fr={}),Sr&&!has$1(fr,br)&&P(fr,br,(function(){return this}));var _r={IteratorPrototype:fr,BUGGY_SAFARI_ITERATORS:Cr},Mr={},wr=_r.IteratorPrototype,returnThis$1=function(){return this},kr=_r.IteratorPrototype,xr=_r.BUGGY_SAFARI_ITERATORS,Ir=wellKnownSymbol("iterator"),Tr="keys",Rr="values",qr="entries",returnThis=function(){return this},defineIterator=function(t,a,o,c,l,p,d){!function(t,a,o){var c=a+" Iterator";t.prototype=te(wr,{next:createPropertyDescriptor(1,o)}),setToStringTag(t,c,!1,!0),Mr[c]=returnThis$1}(o,a,c);var h,m,v,getIterationMethod=function(t){if(t===l&&S)return S;if(!xr&&t in b)return b[t];switch(t){case Tr:return function keys(){return new o(this,t)};case Rr:return function values(){return new o(this,t)};case qr:return function entries(){return new o(this,t)}}return function(){return new o(this)}},y=a+" Iterator",g=!1,b=t.prototype,C=b[Ir]||b["@@iterator"]||l&&b[l],S=!xr&&C||getIterationMethod(l),_="Array"==a&&b.entries||C;if(_&&(h=be(_.call(new t)),kr!==Object.prototype&&h.next&&(setToStringTag(h,y,!0,!0),Mr[y]=returnThis)),l==Rr&&C&&C.name!==Rr&&(g=!0,S=function values(){return C.call(this)}),d&&b[Ir]!==S&&P(b,Ir,S),Mr[a]=S,l)if(m={values:getIterationMethod(Rr),keys:p?S:getIterationMethod(Tr),entries:getIterationMethod(qr)},d)for(v in m)(xr||g||!(v in b))&&redefine(b,v,m[v]);else _export({target:a,proto:!0,forced:xr||g},m);return m},Er=gr.charAt,Pr="String Iterator",Ar=jt.set,Or=jt.getterFor(Pr);defineIterator(String,"String",(function(t){Ar(this,{type:Pr,string:String(t),index:0})}),(function next(){var t,a=Or(this),o=a.string,c=a.index;return c>=o.length?{value:void 0,done:!0}:(t=Er(o,c),a.index+=t.length,{value:t,done:!1})}));var jr="Array Iterator",Ur=jt.set,Br=jt.getterFor(jr);defineIterator(Array,"Array",(function(t,a){Ur(this,{type:jr,target:toIndexedObject(t),index:0,kind:a})}),(function(){var t=Br(this),a=t.target,o=t.kind,c=t.index++;return!a||c>=a.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==o?{value:c,done:!1}:"values"==o?{value:a[c],done:!1}:{value:[c,a[c]],done:!1}}),"values"),Mr.Arguments=Mr.Array;var Lr=wellKnownSymbol("toStringTag");for(var Nr in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var Fr=o[Nr],$r=Fr&&Fr.prototype;$r&&gt($r)!==Lr&&P($r,Lr,Nr),Mr[Nr]=Mr.Array}var Gr=dt.f("iterator"),Qr=createCommonjsModule((function(t){function _typeof(a){return"function"==typeof yr&&"symbol"==typeof Gr?(t.exports=_typeof=function _typeof(t){return typeof t},t.exports.default=t.exports,t.exports.__esModule=!0):(t.exports=_typeof=function _typeof(t){return t&&"function"==typeof yr&&t.constructor===yr&&t!==yr.prototype?"symbol":typeof t},t.exports.default=t.exports,t.exports.__esModule=!0),_typeof(a)}t.exports=_typeof,t.exports.default=t.exports,t.exports.__esModule=!0})),Dr=getDefaultExportFromCjs(Qr),Wr=createCommonjsModule((function(t){var a=Qr.default;t.exports=function _possibleConstructorReturn(t,o){return!o||"object"!==a(o)&&"function"!=typeof o?fe(t):o},t.exports.default=t.exports,t.exports.__esModule=!0})),Kr=getDefaultExportFromCjs(Wr),Vr=createCommonjsModule((function(t){var a=function(t){var a,o=Object.prototype,c=o.hasOwnProperty,l="function"==typeof Symbol?Symbol:{},p=l.iterator||"@@iterator",d=l.asyncIterator||"@@asyncIterator",h=l.toStringTag||"@@toStringTag";function define(t,a,o){return Object.defineProperty(t,a,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[a]}try{define({},"")}catch(t){define=function(t,a,o){return t[a]=o}}function wrap(t,a,o,c){var l=a&&a.prototype instanceof Generator?a:Generator,p=Object.create(l.prototype),d=new Context(c||[]);return p._invoke=function makeInvokeMethod(t,a,o){var c=m;return function invoke(l,p){if(c===y)throw new Error("Generator is already running");if(c===g){if("throw"===l)throw p;return doneResult()}for(o.method=l,o.arg=p;;){var d=o.delegate;if(d){var h=maybeInvokeDelegate(d,o);if(h){if(h===b)continue;return h}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(c===m)throw c=g,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);c=y;var C=tryCatch(t,a,o);if("normal"===C.type){if(c=o.done?g:v,C.arg===b)continue;return{value:C.arg,done:o.done}}"throw"===C.type&&(c=g,o.method="throw",o.arg=C.arg)}}}(t,o,d),p}function tryCatch(t,a,o){try{return{type:"normal",arg:t.call(a,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var m="suspendedStart",v="suspendedYield",y="executing",g="completed",b={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var C={};C[p]=function(){return this};var S=Object.getPrototypeOf,_=S&&S(S(values([])));_&&_!==o&&c.call(_,p)&&(C=_);var M=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(C);function defineIteratorMethods(t){["next","throw","return"].forEach((function(a){define(t,a,(function(t){return this._invoke(a,t)}))}))}function AsyncIterator(t,a){function invoke(o,l,p,d){var h=tryCatch(t[o],t,l);if("throw"!==h.type){var m=h.arg,v=m.value;return v&&"object"==typeof v&&c.call(v,"__await")?a.resolve(v.__await).then((function(t){invoke("next",t,p,d)}),(function(t){invoke("throw",t,p,d)})):a.resolve(v).then((function(t){m.value=t,p(m)}),(function(t){return invoke("throw",t,p,d)}))}d(h.arg)}var o;this._invoke=function enqueue(t,c){function callInvokeWithMethodAndArg(){return new a((function(a,o){invoke(t,c,a,o)}))}return o=o?o.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(t,o){var c=t.iterator[o.method];if(c===a){if(o.delegate=null,"throw"===o.method){if(t.iterator.return&&(o.method="return",o.arg=a,maybeInvokeDelegate(t,o),"throw"===o.method))return b;o.method="throw",o.arg=new TypeError("The iterator does not provide a 'throw' method")}return b}var l=tryCatch(c,t.iterator,o.arg);if("throw"===l.type)return o.method="throw",o.arg=l.arg,o.delegate=null,b;var p=l.arg;return p?p.done?(o[t.resultName]=p.value,o.next=t.nextLoc,"return"!==o.method&&(o.method="next",o.arg=a),o.delegate=null,b):p:(o.method="throw",o.arg=new TypeError("iterator result is not an object"),o.delegate=null,b)}function pushTryEntry(t){var a={tryLoc:t[0]};1 in t&&(a.catchLoc=t[1]),2 in t&&(a.finallyLoc=t[2],a.afterLoc=t[3]),this.tryEntries.push(a)}function resetTryEntry(t){var a=t.completion||{};a.type="normal",delete a.arg,t.completion=a}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var o=t[p];if(o)return o.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var l=-1,d=function next(){for(;++l<t.length;)if(c.call(t,l))return next.value=t[l],next.done=!1,next;return next.value=a,next.done=!0,next};return d.next=d}}return{next:doneResult}}function doneResult(){return{value:a,done:!0}}return GeneratorFunction.prototype=M.constructor=GeneratorFunctionPrototype,GeneratorFunctionPrototype.constructor=GeneratorFunction,GeneratorFunction.displayName=define(GeneratorFunctionPrototype,h,"GeneratorFunction"),t.isGeneratorFunction=function(t){var a="function"==typeof t&&t.constructor;return!!a&&(a===GeneratorFunction||"GeneratorFunction"===(a.displayName||a.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,h,"GeneratorFunction")),t.prototype=Object.create(M),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),AsyncIterator.prototype[d]=function(){return this},t.AsyncIterator=AsyncIterator,t.async=function(a,o,c,l,p){void 0===p&&(p=Promise);var d=new AsyncIterator(wrap(a,o,c,l),p);return t.isGeneratorFunction(o)?d:d.next().then((function(t){return t.done?t.value:d.next()}))},defineIteratorMethods(M),define(M,h,"Generator"),M[p]=function(){return this},M.toString=function(){return"[object Generator]"},t.keys=function(t){var a=[];for(var o in t)a.push(o);return a.reverse(),function next(){for(;a.length;){var o=a.pop();if(o in t)return next.value=o,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=a,this.done=!1,this.delegate=null,this.method="next",this.arg=a,this.tryEntries.forEach(resetTryEntry),!t)for(var o in this)"t"===o.charAt(0)&&c.call(this,o)&&!isNaN(+o.slice(1))&&(this[o]=a)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var o=this;function handle(c,l){return d.type="throw",d.arg=t,o.next=c,l&&(o.method="next",o.arg=a),!!l}for(var l=this.tryEntries.length-1;l>=0;--l){var p=this.tryEntries[l],d=p.completion;if("root"===p.tryLoc)return handle("end");if(p.tryLoc<=this.prev){var h=c.call(p,"catchLoc"),m=c.call(p,"finallyLoc");if(h&&m){if(this.prev<p.catchLoc)return handle(p.catchLoc,!0);if(this.prev<p.finallyLoc)return handle(p.finallyLoc)}else if(h){if(this.prev<p.catchLoc)return handle(p.catchLoc,!0)}else{if(!m)throw new Error("try statement without catch or finally");if(this.prev<p.finallyLoc)return handle(p.finallyLoc)}}}},abrupt:function(t,a){for(var o=this.tryEntries.length-1;o>=0;--o){var l=this.tryEntries[o];if(l.tryLoc<=this.prev&&c.call(l,"finallyLoc")&&this.prev<l.finallyLoc){var p=l;break}}p&&("break"===t||"continue"===t)&&p.tryLoc<=a&&a<=p.finallyLoc&&(p=null);var d=p?p.completion:{};return d.type=t,d.arg=a,p?(this.method="next",this.next=p.finallyLoc,b):this.complete(d)},complete:function(t,a){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&a&&(this.next=a),b},finish:function(t){for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),b}},catch:function(t){for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a];if(o.tryLoc===t){var c=o.completion;if("throw"===c.type){var l=c.arg;resetTryEntry(o)}return l}}throw new Error("illegal catch attempt")},delegateYield:function(t,o,c){return this.delegate={iterator:values(t),resultName:o,nextLoc:c},"next"===this.method&&(this.arg=a),b}},t}(t.exports);try{regeneratorRuntime=a}catch(t){Function("r","regeneratorRuntime = r")(a)}})),zr=Vr;_export({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991});var Hr=9007199254740991,Jr=wellKnownSymbol("iterator"),Yr=Array.prototype,isArrayIteratorMethod=function(t){return void 0!==t&&(Mr.Array===t||Yr[Jr]===t)},Xr=wellKnownSymbol("iterator"),getIteratorMethod$1=function(t){if(null!=t)return t[Xr]||t["@@iterator"]||Mr[gt(t)]},iteratorClose=function(t){var a=t.return;if(void 0!==a)return anObject(a.call(t)).value},Result=function(t,a){this.stopped=t,this.result=a},iterate=function(t,a,o){var c,l,p,d,h,m,v,y=o&&o.that,g=!(!o||!o.AS_ENTRIES),b=!(!o||!o.IS_ITERATOR),C=!(!o||!o.INTERRUPTED),S=functionBindContext(a,y,1+g+C),stop=function(t){return c&&iteratorClose(c),new Result(!0,t)},callFn=function(t){return g?(anObject(t),C?S(t[0],t[1],stop):S(t[0],t[1])):C?S(t,stop):S(t)};if(b)c=t;else{if("function"!=typeof(l=getIteratorMethod$1(t)))throw TypeError("Target is not iterable");if(isArrayIteratorMethod(l)){for(p=0,d=toLength(t.length);d>p;p++)if((h=callFn(t[p]))&&h instanceof Result)return h;return new Result(!1)}c=l.call(t)}for(m=c.next;!(v=m.call(c)).done;){try{h=callFn(v.value)}catch(t){throw iteratorClose(c),t}if("object"==typeof h&&h&&h instanceof Result)return h}return new Result(!1)},Zr=function AggregateError(t,a){var o=this;if(!(o instanceof Zr))return new Zr(t,a);ke&&(o=ke(new Error(void 0),be(o))),void 0!==a&&P(o,"message",String(a));var c=[];return iterate(t,c.push,{that:c}),P(o,"errors",c),o};Zr.prototype=te(Error.prototype,{constructor:createPropertyDescriptor(5,Zr),message:createPropertyDescriptor(5,""),name:createPropertyDescriptor(5,"AggregateError")}),_export({global:!0},{AggregateError:Zr});var en=o.Promise,redefineAll=function(t,a,o){for(var c in a)o&&o.unsafe&&t[c]?t[c]=a[c]:redefine(t,c,a[c],o);return t},tn=wellKnownSymbol("species"),setSpecies=function(t){var a=getBuiltIn(t),o=E.f;c&&a&&!a[tn]&&o(a,tn,{configurable:!0,get:function(){return this}})},anInstance=function(t,a,o){if(!(t instanceof a))throw TypeError("Incorrect "+(o?o+" ":"")+"invocation");return t},rn=wellKnownSymbol("iterator"),nn=!1;try{var an=0,sn={next:function(){return{done:!!an++}},return:function(){nn=!0}};sn[rn]=function(){return this},Array.from(sn,(function(){throw 2}))}catch(t){}var cn,ln,un,checkCorrectnessOfIteration=function(t,a){if(!a&&!nn)return!1;var o=!1;try{var c={};c[rn]=function(){return{next:function(){return{done:o=!0}}}},t(c)}catch(t){}return o},pn=wellKnownSymbol("species"),speciesConstructor=function(t,a){var o,c=anObject(t).constructor;return void 0===c||null==(o=anObject(c)[pn])?a:aFunction$1(o)},dn=/(?:iphone|ipod|ipad).*applewebkit/i.test(Ge),hn=o.location,fn=o.setImmediate,mn=o.clearImmediate,vn=o.process,yn=o.MessageChannel,gn=o.Dispatch,bn=0,Cn={},Sn="onreadystatechange",run=function(t){if(Cn.hasOwnProperty(t)){var a=Cn[t];delete Cn[t],a()}},runner=function(t){return function(){run(t)}},listener=function(t){run(t.data)},post=function(t){o.postMessage(t+"",hn.protocol+"//"+hn.host)};fn&&mn||(fn=function setImmediate(t){for(var a=[],o=1;arguments.length>o;)a.push(arguments[o++]);return Cn[++bn]=function(){("function"==typeof t?t:Function(t)).apply(void 0,a)},cn(bn),bn},mn=function clearImmediate(t){delete Cn[t]},$e?cn=function(t){vn.nextTick(runner(t))}:gn&&gn.now?cn=function(t){gn.now(runner(t))}:yn&&!dn?(un=(ln=new yn).port2,ln.port1.onmessage=listener,cn=functionBindContext(un.postMessage,un,1)):o.addEventListener&&"function"==typeof postMessage&&!o.importScripts&&hn&&"file:"!==hn.protocol&&!fails(post)?(cn=post,o.addEventListener("message",listener,!1)):cn=Sn in documentCreateElement("script")?function(t){K.appendChild(documentCreateElement("script")).onreadystatechange=function(){K.removeChild(this),run(t)}}:function(t){setTimeout(runner(t),0)});var _n,Mn,wn,kn,xn,In,Tn,Rn,qn={set:fn,clear:mn},En=/web0s(?!.*chrome)/i.test(Ge),Pn=_.f,An=qn.set,On=o.MutationObserver||o.WebKitMutationObserver,jn=o.document,Un=o.process,Bn=o.Promise,Ln=Pn(o,"queueMicrotask"),Nn=Ln&&Ln.value;Nn||(_n=function(){var t,a;for($e&&(t=Un.domain)&&t.exit();Mn;){a=Mn.fn,Mn=Mn.next;try{a()}catch(t){throw Mn?kn():wn=void 0,t}}wn=void 0,t&&t.enter()},dn||$e||En||!On||!jn?Bn&&Bn.resolve?(Tn=Bn.resolve(void 0),Rn=Tn.then,kn=function(){Rn.call(Tn,_n)}):kn=$e?function(){Un.nextTick(_n)}:function(){An.call(o,_n)}:(xn=!0,In=jn.createTextNode(""),new On(_n).observe(In,{characterData:!0}),kn=function(){In.data=xn=!xn}));var Fn=Nn||function(t){var a={fn:t,next:void 0};wn&&(wn.next=a),Mn||(Mn=a,kn()),wn=a},PromiseCapability=function(t){var a,o;this.promise=new t((function(t,c){if(void 0!==a||void 0!==o)throw TypeError("Bad Promise constructor");a=t,o=c})),this.resolve=aFunction$1(a),this.reject=aFunction$1(o)},$n={f:function(t){return new PromiseCapability(t)}},promiseResolve=function(t,a){if(anObject(t),isObject$1(a)&&a.constructor===t)return a;var o=$n.f(t);return(0,o.resolve)(a),o.promise},perform=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},Gn=qn.set,Qn=wellKnownSymbol("species"),Dn="Promise",Wn=jt.get,Kn=jt.set,Vn=jt.getterFor(Dn),zn=en,Hn=o.TypeError,Jn=o.document,Yn=o.process;getBuiltIn("fetch");var Xn,Zn,ea,ta=$n.f,ra=ta,na=!!(Jn&&Jn.createEvent&&o.dispatchEvent),aa="function"==typeof PromiseRejectionEvent,oa="unhandledrejection",ia=T(Dn,(function(){if(!(xt(zn)!==String(zn))){if(66===Ke)return!0;if(!$e&&!aa)return!0}if(!zn.prototype.finally)return!0;if(Ke>=51&&/native code/.test(zn))return!1;var t=zn.resolve(1),FakePromise=function(t){t((function(){}),(function(){}))};return(t.constructor={})[Qn]=FakePromise,!(t.then((function(){}))instanceof FakePromise)})),sa=ia||!checkCorrectnessOfIteration((function(t){zn.all(t).catch((function(){}))})),isThenable=function(t){var a;return!(!isObject$1(t)||"function"!=typeof(a=t.then))&&a},notify=function(t,a){if(!t.notified){t.notified=!0;var o=t.reactions;Fn((function(){for(var c=t.value,l=1==t.state,p=0;o.length>p;){var d,h,m,v=o[p++],y=l?v.ok:v.fail,g=v.resolve,b=v.reject,C=v.domain;try{y?(l||(2===t.rejection&&onHandleUnhandled(t),t.rejection=1),!0===y?d=c:(C&&C.enter(),d=y(c),C&&(C.exit(),m=!0)),d===v.promise?b(Hn("Promise-chain cycle")):(h=isThenable(d))?h.call(d,g,b):g(d)):b(c)}catch(t){C&&!m&&C.exit(),b(t)}}t.reactions=[],t.notified=!1,a&&!t.rejection&&onUnhandled(t)}))}},dispatchEvent=function(t,a,c){var l,p;na?((l=Jn.createEvent("Event")).promise=a,l.reason=c,l.initEvent(t,!1,!0),o.dispatchEvent(l)):l={promise:a,reason:c},!aa&&(p=o["on"+t])?p(l):t===oa&&function(t,a){var c=o.console;c&&c.error&&(1===arguments.length?c.error(t):c.error(t,a))}("Unhandled promise rejection",c)},onUnhandled=function(t){Gn.call(o,(function(){var a,o=t.facade,c=t.value;if(isUnhandled(t)&&(a=perform((function(){$e?Yn.emit("unhandledRejection",c,o):dispatchEvent(oa,o,c)})),t.rejection=$e||isUnhandled(t)?2:1,a.error))throw a.value}))},isUnhandled=function(t){return 1!==t.rejection&&!t.parent},onHandleUnhandled=function(t){Gn.call(o,(function(){var a=t.facade;$e?Yn.emit("rejectionHandled",a):dispatchEvent("rejectionhandled",a,t.value)}))},bind$3=function(t,a,o){return function(c){t(a,c,o)}},internalReject=function(t,a,o){t.done||(t.done=!0,o&&(t=o),t.value=a,t.state=2,notify(t,!0))},internalResolve=function(t,a,o){if(!t.done){t.done=!0,o&&(t=o);try{if(t.facade===a)throw Hn("Promise can't be resolved itself");var c=isThenable(a);c?Fn((function(){var o={done:!1};try{c.call(a,bind$3(internalResolve,o,t),bind$3(internalReject,o,t))}catch(a){internalReject(o,a,t)}})):(t.value=a,t.state=1,notify(t,!1))}catch(a){internalReject({done:!1},a,t)}}};ia&&(zn=function Promise(t){anInstance(this,zn,Dn),aFunction$1(t),Xn.call(this);var a=Wn(this);try{t(bind$3(internalResolve,a),bind$3(internalReject,a))}catch(t){internalReject(a,t)}},(Xn=function Promise(t){Kn(this,{type:Dn,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=redefineAll(zn.prototype,{then:function then(t,a){var o=Vn(this),c=ta(speciesConstructor(this,zn));return c.ok="function"!=typeof t||t,c.fail="function"==typeof a&&a,c.domain=$e?Yn.domain:void 0,o.parent=!0,o.reactions.push(c),0!=o.state&&notify(o,!1),c.promise},catch:function(t){return this.then(void 0,t)}}),Zn=function(){var t=new Xn,a=Wn(t);this.promise=t,this.resolve=bind$3(internalResolve,a),this.reject=bind$3(internalReject,a)},$n.f=ta=function(t){return t===zn||t===ea?new Zn(t):ra(t)}),_export({global:!0,wrap:!0,forced:ia},{Promise:zn}),setToStringTag(zn,Dn,!1,!0),setSpecies(Dn),ea=getBuiltIn(Dn),_export({target:Dn,stat:!0,forced:ia},{reject:function reject(t){var a=ta(this);return a.reject.call(void 0,t),a.promise}}),_export({target:Dn,stat:!0,forced:V},{resolve:function resolve(t){return promiseResolve(this===ea?zn:this,t)}}),_export({target:Dn,stat:!0,forced:sa},{all:function all(t){var a=this,o=ta(a),c=o.resolve,l=o.reject,p=perform((function(){var o=aFunction$1(a.resolve),p=[],d=0,h=1;iterate(t,(function(t){var m=d++,v=!1;p.push(void 0),h++,o.call(a,t).then((function(t){v||(v=!0,p[m]=t,--h||c(p))}),l)})),--h||c(p)}));return p.error&&l(p.value),o.promise},race:function race(t){var a=this,o=ta(a),c=o.reject,l=perform((function(){var l=aFunction$1(a.resolve);iterate(t,(function(t){l.call(a,t).then(o.resolve,c)}))}));return l.error&&c(l.value),o.promise}}),_export({target:"Promise",stat:!0},{allSettled:function allSettled(t){var a=this,o=$n.f(a),c=o.resolve,l=o.reject,p=perform((function(){var o=aFunction$1(a.resolve),l=[],p=0,d=1;iterate(t,(function(t){var h=p++,m=!1;l.push(void 0),d++,o.call(a,t).then((function(t){m||(m=!0,l[h]={status:"fulfilled",value:t},--d||c(l))}),(function(t){m||(m=!0,l[h]={status:"rejected",reason:t},--d||c(l))}))})),--d||c(l)}));return p.error&&l(p.value),o.promise}});var ca="No one promise resolved";_export({target:"Promise",stat:!0},{any:function any(t){var a=this,o=$n.f(a),c=o.resolve,l=o.reject,p=perform((function(){var o=aFunction$1(a.resolve),p=[],d=0,h=1,m=!1;iterate(t,(function(t){var v=d++,y=!1;p.push(void 0),h++,o.call(a,t).then((function(t){y||m||(m=!0,c(t))}),(function(t){y||m||(y=!0,p[v]=t,--h||l(new(getBuiltIn("AggregateError"))(p,ca)))}))})),--h||l(new(getBuiltIn("AggregateError"))(p,ca))}));return p.error&&l(p.value),o.promise}});var la=!!en&&fails((function(){en.prototype.finally.call({then:function(){}},(function(){}))}));_export({target:"Promise",proto:!0,real:!0,forced:la},{finally:function(t){var a=speciesConstructor(this,getBuiltIn("Promise")),o="function"==typeof t;return this.then(o?function(o){return promiseResolve(a,t()).then((function(){return o}))}:t,o?function(o){return promiseResolve(a,t()).then((function(){throw o}))}:t)}});var ua=R.Promise;_export({target:"Promise",stat:!0},{try:function(t){var a=$n.f(this),o=perform(t);return(o.error?a.reject:a.resolve)(o.value),a.promise}});var pa=ua,da=Object.assign,ha=Object.defineProperty,fa=!da||fails((function(){if(c&&1!==da({b:1},da(ha({},"a",{enumerable:!0,get:function(){ha(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},a={},o=Symbol(),l="abcdefghijklmnopqrst";return t[o]=7,l.split("").forEach((function(t){a[t]=t})),7!=da({},t)[o]||D(da({},a)).join("")!=l}))?function assign(t,a){for(var o=toObject(t),l=arguments.length,p=1,h=pt.f,m=d.f;l>p;)for(var y,g=v(arguments[p++]),b=h?D(g).concat(h(g)):D(g),C=b.length,S=0;C>S;)y=b[S++],c&&!m.call(g,y)||(o[y]=g[y]);return o}:da;_export({target:"Object",stat:!0,forced:Object.assign!==fa},{assign:fa});var ma=R.Object.assign;function __rest(t,a){var o={};for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&a.indexOf(c)<0&&(o[c]=t[c]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(c=Object.getOwnPropertySymbols(t);l<c.length;l++)a.indexOf(c[l])<0&&Object.prototype.propertyIsEnumerable.call(t,c[l])&&(o[c[l]]=t[c[l]])}return o}function __awaiter(t,a,o,c){return new(o||(o=Promise))((function(l,p){function fulfilled(t){try{step(c.next(t))}catch(t){p(t)}}function rejected(t){try{step(c.throw(t))}catch(t){p(t)}}function step(t){t.done?l(t.value):function adopt(t){return t instanceof o?t:new o((function(a){a(t)}))}(t.value).then(fulfilled,rejected)}step((c=c.apply(t,a||[])).next())}))}var va=!fails((function(){return Object.isExtensible(Object.preventExtensions({}))})),ya=createCommonjsModule((function(t){var a=E.f,o=uid("meta"),c=0,l=Object.isExtensible||function(){return!0},setMetadata=function(t){a(t,o,{value:{objectID:"O"+ ++c,weakData:{}}})},p=t.exports={REQUIRED:!1,fastKey:function(t,a){if(!isObject$1(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!has$1(t,o)){if(!l(t))return"F";if(!a)return"E";setMetadata(t)}return t[o].objectID},getWeakData:function(t,a){if(!has$1(t,o)){if(!l(t))return!0;if(!a)return!1;setMetadata(t)}return t[o].weakData},onFreeze:function(t){return va&&p.REQUIRED&&l(t)&&!has$1(t,o)&&setMetadata(t),t}};$[o]=!0})),ga=E.f,ba=Bt.forEach,Ca=jt.set,Sa=jt.getterFor,_a=E.f,Ma=ya.fastKey,wa=jt.set,ka=jt.getterFor,xa={getConstructor:function(t,a,o,l){var p=t((function(t,d){anInstance(t,p,a),wa(t,{type:a,index:te(null),first:void 0,last:void 0,size:0}),c||(t.size=0),null!=d&&iterate(d,t[l],{that:t,AS_ENTRIES:o})})),d=ka(a),define=function(t,a,o){var l,p,h=d(t),m=getEntry(t,a);return m?m.value=o:(h.last=m={index:p=Ma(a,!0),key:a,value:o,previous:l=h.last,next:void 0,removed:!1},h.first||(h.first=m),l&&(l.next=m),c?h.size++:t.size++,"F"!==p&&(h.index[p]=m)),t},getEntry=function(t,a){var o,c=d(t),l=Ma(a);if("F"!==l)return c.index[l];for(o=c.first;o;o=o.next)if(o.key==a)return o};return redefineAll(p.prototype,{clear:function clear(){for(var t=d(this),a=t.index,o=t.first;o;)o.removed=!0,o.previous&&(o.previous=o.previous.next=void 0),delete a[o.index],o=o.next;t.first=t.last=void 0,c?t.size=0:this.size=0},delete:function(t){var a=this,o=d(a),l=getEntry(a,t);if(l){var p=l.next,h=l.previous;delete o.index[l.index],l.removed=!0,h&&(h.next=p),p&&(p.previous=h),o.first==l&&(o.first=p),o.last==l&&(o.last=h),c?o.size--:a.size--}return!!l},forEach:function forEach(t){for(var a,o=d(this),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0,3);a=a?a.next:o.first;)for(c(a.value,a.key,this);a&&a.removed;)a=a.previous},has:function has(t){return!!getEntry(this,t)}}),redefineAll(p.prototype,o?{get:function get(t){var a=getEntry(this,t);return a&&a.value},set:function set(t,a){return define(this,0===t?0:t,a)}}:{add:function add(t){return define(this,t=0===t?0:t,t)}}),c&&_a(p.prototype,"size",{get:function(){return d(this).size}}),p},setStrong:function(t,a,o){var c=a+" Iterator",l=ka(a),p=ka(c);defineIterator(t,a,(function(t,a){wa(this,{type:c,target:t,state:l(t),kind:a,last:void 0})}),(function(){for(var t=p(this),a=t.kind,o=t.last;o&&o.removed;)o=o.previous;return t.target&&(t.last=o=o?o.next:t.state.first)?"keys"==a?{value:o.key,done:!1}:"values"==a?{value:o.value,done:!1}:{value:[o.key,o.value],done:!1}:(t.target=void 0,{value:void 0,done:!0})}),o?"entries":"values",!o,!0),setSpecies(a)}};!function(t,a,l){var p,d=-1!==t.indexOf("Map"),h=-1!==t.indexOf("Weak"),m=d?"set":"add",v=o[t],y=v&&v.prototype,g={};if(c&&"function"==typeof v&&(h||y.forEach&&!fails((function(){(new v).entries().next()})))){p=a((function(a,o){Ca(anInstance(a,p,t),{type:t,collection:new v}),null!=o&&iterate(o,a[m],{that:a,AS_ENTRIES:d})}));var b=Sa(t);ba(["add","clear","delete","forEach","get","has","set","keys","values","entries"],(function(t){var a="add"==t||"set"==t;!(t in y)||h&&"clear"==t||P(p.prototype,t,(function(o,c){var l=b(this).collection;if(!a&&h&&!isObject$1(o))return"get"==t&&void 0;var p=l[t](0===o?0:o,c);return a?this:p}))})),h||ga(p.prototype,"size",{configurable:!0,get:function(){return b(this).collection.size}})}else p=l.getConstructor(a,t,d,m),ya.REQUIRED=!0;setToStringTag(p,t,!1,!0),g[t]=p,_export({global:!0,forced:!0},g),h||l.setStrong(p,t,d)}("Map",(function(t){return function Map(){return t(this,arguments.length?arguments[0]:void 0)}}),xa);var Ia=R.Map;_export({target:"Map",stat:!0},{from:function from(t){var a,o,c,l,p=arguments.length,d=p>1?arguments[1]:void 0;return aFunction$1(this),(a=void 0!==d)&&aFunction$1(d),null==t?new this:(o=[],a?(c=0,l=functionBindContext(d,p>2?arguments[2]:void 0,2),iterate(t,(function(t){o.push(l(t,c++))}))):iterate(t,o.push,{that:o}),new this(o))}});_export({target:"Map",stat:!0},{of:function of(){for(var t=arguments.length,a=new Array(t);t--;)a[t]=arguments[t];return new this(a)}});var collectionDeleteAll=function(){for(var t,a=anObject(this),o=aFunction$1(a.delete),c=!0,l=0,p=arguments.length;l<p;l++)t=o.call(a,arguments[l]),c=c&&t;return!!c};_export({target:"Map",proto:!0,real:!0,forced:V},{deleteAll:function deleteAll(){return collectionDeleteAll.apply(this,arguments)}});_export({target:"Map",proto:!0,real:!0,forced:V},{emplace:function emplace(t,a){var o=anObject(this),c=o.has(t)&&"update"in a?a.update(o.get(t),t,o):a.insert(t,o);return o.set(t,c),c}});var getIterator$1=function(t){var a=getIteratorMethod$1(t);if("function"!=typeof a)throw TypeError(String(t)+" is not iterable");return anObject(a.call(t))},Ta=getIterator$1;_export({target:"Map",proto:!0,real:!0,forced:V},{every:function every(t){var a=anObject(this),o=Ta(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0,3);return!iterate(o,(function(t,o,l){if(!c(o,t,a))return l()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Map",proto:!0,real:!0,forced:V},{filter:function filter(t){var a=anObject(this),o=Ta(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0,3),l=new(speciesConstructor(a,getBuiltIn("Map"))),p=aFunction$1(l.set);return iterate(o,(function(t,o){c(o,t,a)&&p.call(l,t,o)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),l}}),_export({target:"Map",proto:!0,real:!0,forced:V},{find:function find(t){var a=anObject(this),o=Ta(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0,3);return iterate(o,(function(t,o,l){if(c(o,t,a))return l(o)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Map",proto:!0,real:!0,forced:V},{findKey:function findKey(t){var a=anObject(this),o=Ta(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0,3);return iterate(o,(function(t,o,l){if(c(o,t,a))return l(t)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Map",stat:!0},{groupBy:function groupBy(t,a){var o=new this;aFunction$1(a);var c=aFunction$1(o.has),l=aFunction$1(o.get),p=aFunction$1(o.set);return iterate(t,(function(t){var d=a(t);c.call(o,d)?l.call(o,d).push(t):p.call(o,d,[t])})),o}});_export({target:"Map",proto:!0,real:!0,forced:V},{includes:function includes(t){return iterate(Ta(anObject(this)),(function(a,o,c){if((l=o)===(p=t)||l!=l&&p!=p)return c();var l,p}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Map",stat:!0},{keyBy:function keyBy(t,a){var o=new this;aFunction$1(a);var c=aFunction$1(o.set);return iterate(t,(function(t){c.call(o,a(t),t)})),o}}),_export({target:"Map",proto:!0,real:!0,forced:V},{keyOf:function keyOf(t){return iterate(Ta(anObject(this)),(function(a,o,c){if(o===t)return c(a)}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).result}}),_export({target:"Map",proto:!0,real:!0,forced:V},{mapKeys:function mapKeys(t){var a=anObject(this),o=Ta(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0,3),l=new(speciesConstructor(a,getBuiltIn("Map"))),p=aFunction$1(l.set);return iterate(o,(function(t,o){p.call(l,c(o,t,a),o)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),l}}),_export({target:"Map",proto:!0,real:!0,forced:V},{mapValues:function mapValues(t){var a=anObject(this),o=Ta(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0,3),l=new(speciesConstructor(a,getBuiltIn("Map"))),p=aFunction$1(l.set);return iterate(o,(function(t,o){p.call(l,t,c(o,t,a))}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),l}}),_export({target:"Map",proto:!0,real:!0,forced:V},{merge:function merge(t){for(var a=anObject(this),o=aFunction$1(a.set),c=0;c<arguments.length;)iterate(arguments[c++],o,{that:a,AS_ENTRIES:!0});return a}}),_export({target:"Map",proto:!0,real:!0,forced:V},{reduce:function reduce(t){var a=anObject(this),o=Ta(a),c=arguments.length<2,l=c?void 0:arguments[1];if(aFunction$1(t),iterate(o,(function(o,p){c?(c=!1,l=p):l=t(l,p,o,a)}),{AS_ENTRIES:!0,IS_ITERATOR:!0}),c)throw TypeError("Reduce of empty map with no initial value");return l}}),_export({target:"Map",proto:!0,real:!0,forced:V},{some:function some(t){var a=anObject(this),o=Ta(a),c=functionBindContext(t,arguments.length>1?arguments[1]:void 0,3);return iterate(o,(function(t,o,l){if(c(o,t,a))return l()}),{AS_ENTRIES:!0,IS_ITERATOR:!0,INTERRUPTED:!0}).stopped}}),_export({target:"Map",proto:!0,real:!0,forced:V},{update:function update(t,a){var o=anObject(this),c=arguments.length;aFunction$1(a);var l=o.has(t);if(!l&&c<3)throw TypeError("Updating absent value");var p=l?o.get(t):aFunction$1(c>2?arguments[2]:void 0)(t,o);return o.set(t,a(p,t,o)),o}});var Ra=function upsert(t,a){var o,c=anObject(this),l=arguments.length>2?arguments[2]:void 0;if("function"!=typeof a&&"function"!=typeof l)throw TypeError("At least one callback required");return c.has(t)?(o=c.get(t),"function"==typeof a&&(o=a(o),c.set(t,o))):"function"==typeof l&&(o=l(),c.set(t,o)),o};_export({target:"Map",proto:!0,real:!0,forced:V},{upsert:Ra}),_export({target:"Map",proto:!0,real:!0,forced:V},{updateOrInsert:Ra});var qa=Ia,entryVirtual=function(t){return R[t+"Prototype"]},Ea=entryVirtual("Array").concat,Pa=Array.prototype,concat=function(t){var a=t.concat;return t===Pa||t instanceof Array&&a===Pa.concat?Ea:a};_export({target:"Function",proto:!0},{bind:ae});var Aa=entryVirtual("Function").bind,Oa=Function.prototype,bind=function(t){var a=t.bind;return t===Oa||t instanceof Function&&a===Oa.bind?Aa:a},ja=[].slice,Ua=/MSIE .\./.test(Ge),wrap=function(t){return function(a,o){var c=arguments.length>2,l=c?ja.call(arguments,2):void 0;return t(c?function(){("function"==typeof a?a:Function(a)).apply(this,l)}:a,o)}};_export({global:!0,bind:!0,forced:Ua},{setTimeout:wrap(o.setTimeout),setInterval:wrap(o.setInterval)});var Ba=R.setTimeout,La=getBuiltIn("JSON","stringify"),Na=/[\uD800-\uDFFF]/g,Fa=/^[\uD800-\uDBFF]$/,$a=/^[\uDC00-\uDFFF]$/,fix=function(t,a,o){var c=o.charAt(a-1),l=o.charAt(a+1);return Fa.test(t)&&!$a.test(l)||$a.test(t)&&!Fa.test(c)?"\\u"+t.charCodeAt(0).toString(16):t},Ga=fails((function(){return'"\\udf06\\ud834"'!==La("\udf06\ud834")||'"\\udead"'!==La("\udead")}));La&&_export({target:"JSON",stat:!0,forced:Ga},{stringify:function stringify(t,a,o){var c=La.apply(null,arguments);return"string"==typeof c?c.replace(Na,fix):c}}),R.JSON||(R.JSON={stringify:JSON.stringify});var Qa=function stringify(t,a,o){return R.JSON.stringify.apply(null,arguments)},Da=Qa,arrayMethodIsStrict=function(t,a){var o=[][t];return!!o&&fails((function(){o.call(null,a||function(){throw 1},1)}))},Wa=Bt.forEach,Ka=arrayMethodIsStrict("forEach")?[].forEach:function forEach(t){return Wa(this,t,arguments.length>1?arguments[1]:void 0)};_export({target:"Array",proto:!0,forced:[].forEach!=Ka},{forEach:Ka});var Va=entryVirtual("Array").forEach,za=Array.prototype,Ha={DOMTokenList:!0,NodeList:!0},forEach=function(t){var a=t.forEach;return t===za||t instanceof Array&&a===za.forEach||Ha.hasOwnProperty(gt(t))?Va:a},Ja=createCommonjsModule((function(t){var a=Object.prototype.hasOwnProperty,o="~";function Events(){}function EE(t,a,o){this.fn=t,this.context=a,this.once=o||!1}function addListener(t,a,c,l,p){if("function"!=typeof c)throw new TypeError("The listener must be a function");var d=new EE(c,l||t,p),h=o?o+a:a;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],d]:t._events[h].push(d):(t._events[h]=d,t._eventsCount++),t}function clearEvent(t,a){0==--t._eventsCount?t._events=new Events:delete t._events[a]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(o=!1)),EventEmitter.prototype.eventNames=function eventNames(){var t,c,l=[];if(0===this._eventsCount)return l;for(c in t=this._events)a.call(t,c)&&l.push(o?c.slice(1):c);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(t)):l},EventEmitter.prototype.listeners=function listeners(t){var a=o?o+t:t,c=this._events[a];if(!c)return[];if(c.fn)return[c.fn];for(var l=0,p=c.length,d=new Array(p);l<p;l++)d[l]=c[l].fn;return d},EventEmitter.prototype.listenerCount=function listenerCount(t){var a=o?o+t:t,c=this._events[a];return c?c.fn?1:c.length:0},EventEmitter.prototype.emit=function emit(t,a,c,l,p,d){var h=o?o+t:t;if(!this._events[h])return!1;var m,v,y=this._events[h],g=arguments.length;if(y.fn){switch(y.once&&this.removeListener(t,y.fn,void 0,!0),g){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,a),!0;case 3:return y.fn.call(y.context,a,c),!0;case 4:return y.fn.call(y.context,a,c,l),!0;case 5:return y.fn.call(y.context,a,c,l,p),!0;case 6:return y.fn.call(y.context,a,c,l,p,d),!0}for(v=1,m=new Array(g-1);v<g;v++)m[v-1]=arguments[v];y.fn.apply(y.context,m)}else{var b,C=y.length;for(v=0;v<C;v++)switch(y[v].once&&this.removeListener(t,y[v].fn,void 0,!0),g){case 1:y[v].fn.call(y[v].context);break;case 2:y[v].fn.call(y[v].context,a);break;case 3:y[v].fn.call(y[v].context,a,c);break;case 4:y[v].fn.call(y[v].context,a,c,l);break;default:if(!m)for(b=1,m=new Array(g-1);b<g;b++)m[b-1]=arguments[b];y[v].fn.apply(y[v].context,m)}}return!0},EventEmitter.prototype.on=function on(t,a,o){return addListener(this,t,a,o,!1)},EventEmitter.prototype.once=function once(t,a,o){return addListener(this,t,a,o,!0)},EventEmitter.prototype.removeListener=function removeListener(t,a,c,l){var p=o?o+t:t;if(!this._events[p])return this;if(!a)return clearEvent(this,p),this;var d=this._events[p];if(d.fn)d.fn!==a||l&&!d.once||c&&d.context!==c||clearEvent(this,p);else{for(var h=0,m=[],v=d.length;h<v;h++)(d[h].fn!==a||l&&!d[h].once||c&&d[h].context!==c)&&m.push(d[h]);m.length?this._events[p]=1===m.length?m[0]:m:clearEvent(this,p)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(t){var a;return t?(a=o?o+t:t,this._events[a]&&clearEvent(this,a)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=o,EventEmitter.EventEmitter=EventEmitter,t.exports=EventEmitter})),Ya=Backoff;function Backoff(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}Backoff.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var a=Math.random(),o=Math.floor(a*this.jitter*t);t=0==(1&Math.floor(10*a))?t-o:t+o}return 0|Math.min(t,this.max)},Backoff.prototype.reset=function(){this.attempts=0},Backoff.prototype.setMin=function(t){this.ms=t},Backoff.prototype.setMax=function(t){this.max=t},Backoff.prototype.setJitter=function(t){this.jitter=t};var Xa="object"==typeof t&&t&&t.Object===Object&&t,Za="object"==typeof self&&self&&self.Object===Object&&self,eo=Xa||Za||Function("return this")(),to=eo.Symbol,ro=Object.prototype,no=ro.hasOwnProperty,ao=ro.toString,oo=to?to.toStringTag:void 0;var io=function getRawTag(t){var a=no.call(t,oo),o=t[oo];try{t[oo]=void 0;var c=!0}catch(t){}var l=ao.call(t);return c&&(a?t[oo]=o:delete t[oo]),l},so=Object.prototype.toString;var co=function objectToString(t){return so.call(t)},lo=to?to.toStringTag:void 0;var uo=function baseGetTag(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":lo&&lo in Object(t)?io(t):co(t)};var po=function isObject(t){var a=typeof t;return null!=t&&("object"==a||"function"==a)};var ho=function isFunction(t){if(!po(t))return!1;var a=uo(t);return"[object Function]"==a||"[object GeneratorFunction]"==a||"[object AsyncFunction]"==a||"[object Proxy]"==a},fo={deviceId:"",chunkUploadHost:"https://wanproxy-web.127.net",commonUploadHost:"https://nos.netease.com",chunkMaxSize:4194304e4,commonMaxSize:104857600,uploadReplaceFormat:"https://{host}/{object}",cdn:{defaultCdnDomain:"nim.nosdn.127.net",cdnDomain:"",bucket:"",objectNamePrefix:""},downloadUrl:"https://{bucket}-nosdn.netease.im/{object}",downloadHostList:["nos.netease.com"],nosCdnEnable:!0,timeout:8e3},mo={account:"",appkey:"",token:"",debugLevel:"off",needReconnect:!0,reconnectionAttempts:Hr},vo="imtest4.netease.im:443",yo=N.includes;_export({target:"Array",proto:!0},{includes:function includes(t){return yo(this,t,arguments.length>1?arguments[1]:void 0)}});var go=entryVirtual("Array").includes,bo=wellKnownSymbol("match"),notARegexp=function(t){if(function(t){var a;return isObject$1(t)&&(void 0!==(a=t[bo])?!!a:"RegExp"==classofRaw(t))}(t))throw TypeError("The method doesn't accept regular expressions");return t},Co=wellKnownSymbol("match");_export({target:"String",proto:!0,forced:!function(t){var a=/./;try{"/./"[t](a)}catch(o){try{return a[Co]=!1,"/./"[t](a)}catch(t){}}return!1}("includes")},{includes:function includes(t){return!!~String(requireObjectCoercible(this)).indexOf(notARegexp(t),arguments.length>1?arguments[1]:void 0)}});var So=entryVirtual("String").includes,_o=Array.prototype,Mo=String.prototype,includes=function(t){var a=t.includes;return t===_o||t instanceof Array&&a===_o.includes?go:"string"==typeof t||t===Mo||t instanceof String&&a===Mo.includes?So:a},wo=Bt.findIndex,ko="findIndex",xo=!0;ko in[]&&Array(1).findIndex((function(){xo=!1})),_export({target:"Array",proto:!0,forced:xo},{findIndex:function findIndex(t){return wo(this,t,arguments.length>1?arguments[1]:void 0)}});var Io=entryVirtual("Array").findIndex,To=Array.prototype,findIndex=function(t){var a=t.findIndex;return t===To||t instanceof Array&&a===To.findIndex?Io:a},Ro=arrayMethodHasSpeciesSupport("slice"),qo=wellKnownSymbol("species"),Eo=[].slice,Po=Math.max;_export({target:"Array",proto:!0,forced:!Ro},{slice:function slice(t,a){var o,c,l,p=toIndexedObject(this),d=toLength(p.length),h=toAbsoluteIndex(t,d),m=toAbsoluteIndex(void 0===a?d:a,d);if(Fe(p)&&("function"!=typeof(o=p.constructor)||o!==Array&&!Fe(o.prototype)?isObject$1(o)&&null===(o=o[qo])&&(o=void 0):o=void 0,o===Array||void 0===o))return Eo.call(p,h,m);for(c=new(void 0===o?Array:o)(Po(m-h,0)),l=0;h<m;h++,l++)h in p&&createProperty(c,l,p[h]);return c.length=l,c}});var Ao=entryVirtual("Array").slice,Oo=Array.prototype,slice=function(t){var a=t.slice;return t===Oo||t instanceof Array&&a===Oo.slice?Ao:a},jo=Bt.map,Uo=arrayMethodHasSpeciesSupport("map");_export({target:"Array",proto:!0,forced:!Uo},{map:function map(t){return jo(this,t,arguments.length>1?arguments[1]:void 0)}});var Bo=entryVirtual("Array").map,Lo=Array.prototype,map=function(t){var a=t.map;return t===Lo||t instanceof Array&&a===Lo.map?Bo:a},No=N.indexOf,Fo=[].indexOf,$o=!!Fo&&1/[1].indexOf(1,-0)<0,Go=arrayMethodIsStrict("indexOf");_export({target:"Array",proto:!0,forced:$o||!Go},{indexOf:function indexOf(t){return $o?Fo.apply(this,arguments)||0:No(this,t,arguments.length>1?arguments[1]:void 0)}});var Qo=entryVirtual("Array").indexOf,Do=Array.prototype,indexOf=function(t){var a=t.indexOf;return t===Do||t instanceof Array&&a===Do.indexOf?Qo:a},Wo=createCommonjsModule((function(t){t.exports=function _isNativeFunction(t){var a;return-1!==indexOf(a=Function.toString.call(t)).call(a,"[native code]")},t.exports.default=t.exports,t.exports.__esModule=!0})),Ko=createCommonjsModule((function(t){t.exports=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!le)return!1;if(le.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(le(Boolean,[],(function(){}))),!0}catch(t){return!1}},t.exports.default=t.exports,t.exports.__esModule=!0})),Vo=createCommonjsModule((function(t){function _construct(a,o,c){return Ko()?(t.exports=_construct=le,t.exports.default=t.exports,t.exports.__esModule=!0):(t.exports=_construct=function _construct(t,a,o){var c=[null];c.push.apply(c,a);var l=new(bind(Function).apply(t,c));return o&&Le(l,o.prototype),l},t.exports.default=t.exports,t.exports.__esModule=!0),_construct.apply(null,arguments)}t.exports=_construct,t.exports.default=t.exports,t.exports.__esModule=!0})),zo=createCommonjsModule((function(t){function _wrapNativeSuper(a){var o="function"==typeof qa?new qa:void 0;return t.exports=_wrapNativeSuper=function _wrapNativeSuper(t){if(null===t||!Wo(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==o){if(o.has(t))return o.get(t);o.set(t,Wrapper)}function Wrapper(){return Vo(t,arguments,Re(this).constructor)}return Wrapper.prototype=Be(t.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),Le(Wrapper,t)},t.exports.default=t.exports,t.exports.__esModule=!0,_wrapNativeSuper(a)}t.exports=_wrapNativeSuper,t.exports.default=t.exports,t.exports.__esModule=!0}));function _createSuper$a(t){var a=function _isNativeReflectConstruct$a(){if("undefined"==typeof Reflect||!le)return!1;if(le.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(le(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,c=qe(t);if(a){var l=qe(this).constructor;o=le(c,arguments,l)}else o=c.apply(this,arguments);return Kr(this,o)}}var Ho=function(t){Ne(CustomError,t);var a=_createSuper$a(CustomError);function CustomError(t){var o,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:400;return ue(this,CustomError),(o=a.call(this,t)).data=c,o.code=l,o.name="customError",o}return CustomError}(getDefaultExportFromCjs(zo)(Error)),Jo=function(t){Ne(ValidateError,t);var a=_createSuper$a(ValidateError);function ValidateError(t){var o,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;return ue(this,ValidateError),(o=a.call(this,t,c,414)).code=414,o.name="validateError",o.rules=l,o}return ValidateError}(Ho),Yo={200:null,406:null,808:null,810:null,201:"The client version is incorrect. You need to upgrade the SDK",302:"The user name or password is incorrect. Please check whether the appkey and token are valid and whether the account and token match",403:"Illegal operation or no permission",404:"Target object does not exist",405:"Parameter length too long",408:"Client request timed out",414:"Request parameter error",415:"Service unavailable",416:"Frequency control",417:"Repeat operation",422:"Account disabled",500:"Server internal error",503:"Server busy",508:"Expiration date",509:"Invalid",7101:"Be pulled black",700:"Partial failure of batch operation",801:"The number of people in the team has reached the upper limit",802:"No permission",803:"The team does not exist or has not changed",804:"The user is not in the team",805:"Team type mismatch",806:"The number of teams created has reached the limit",807:"Team member not valid",809:"Already in the team",811:"The number of accounts in the forced push list exceeds the limit",812:"The team is muted",813:"Due to the limited number of team, some pull people successfully",814:"Disable team message read service",815:"Maximum number of team administrators",816:"Batch operation partial failure",997:"The packet has expired",998:"Deserialize packet error",999:"Serialize packet error",9102:"Channel failure",9103:"This call has been answered / rejected at another end",13002:"Abnormal chatroom status",13003:"In the blacklist",13004:"In the mute list",13006:"All members are muted, and only the administrator can speak"},Xo=function(t){Ne(CmdError,t);var a=_createSuper$a(CmdError);function CmdError(t,o){var c,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(new Date).getTime(),d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return ue(this,CmdError),l=l||Yo[t],(c=a.call(this,l,d,t)).name="cmdError",c.cmd=o,c.timetag=p,c}return CmdError}(Ho);var Zo=function(t){Ne(FormatError,t);var a=_createSuper$a(FormatError);function FormatError(t,o,c){var l;return ue(this,FormatError),(l=a.call(this,t,{},412)).code=412,l.name="formatError",l.key=o,l.reason=c,l}return FormatError}(Ho),ei=function(t){Ne(UploadError,t);var a=_createSuper$a(UploadError);function UploadError(t,o,c,l,p){var d;return ue(this,UploadError),(d=a.call(this,t,{file:p},400)).name="uploadError",d.rawError=o,d.curProvider=c||1,d.mixStorePolicy=l,d}return UploadError}(Ho),ti=["error","warn","log","debug"],ri=function emptyFunc(){},ni=["off","error","warn","log","debug"],ai=function(){function Logger(t,a){ue(this,Logger),this.name=a,this.strategies={debug:console.log,log:console.log,warn:console.warn,error:console.error},this.debug=ri,this.log=ri,this.warn=ri,this.error=ri,this.name=a,Logger.instancesName.push(a),includes(ni).call(ni,t)||(t="off"),this.setLogFunc(t)}return he(Logger,[{key:"setLogFunc",value:function setLogFunc(t){var a=this,o=findIndex(ti).call(ti,(function(a){return a===t}));forEach(ti).call(ti,(function(t,c){c<=o&&(a[t]=function(){var a=slice(Array.prototype).call(arguments),o=this.formatArgs(a,t);this.strategies[t](o)})}))}},{key:"formatArgs",value:function formatArgs(t,a){var o,c,l,p,d,h,m,v=new Date,y=concat(o=concat(c=concat(l=concat(p=concat(d="".concat(v.getMonth()+1,"-")).call(d,v.getDate()," ")).call(p,v.getHours(),":")).call(l,v.getMinutes(),":")).call(c,v.getSeconds(),":")).call(o,v.getMilliseconds());return concat(h=concat(m="[NIM ".concat(a," ")).call(m,this.name," ")).call(h,y,"] ")+map(t).call(t,(function(t){var a,o;return t instanceof Ho?concat(a=concat(o="".concat(t.name,", ")).call(o,t.code,", ")).call(a,t.message):t instanceof Error?t&&t.message?t.message:t:"object"===Dr(t)?Da(t):t})).join(" ")}}]),Logger}();ai.instancesName=[];var oi={setLogger:function setLogger(t){throw new Error("Function not implemented.")},platform:"",WebSocket:function(){function AdapterSocket(t,a){throw ue(this,AdapterSocket),this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,new Error("Method not implemented.")}return he(AdapterSocket,[{key:"close",value:function close(t,a){throw new Error("Method not implemented.")}},{key:"send",value:function send(t){throw new Error("Method not implemented.")}},{key:"onclose",value:function onclose(t){throw new Error("Method not implemented.")}},{key:"onerror",value:function onerror(t){throw new Error("Method not implemented.")}},{key:"onmessage",value:function onmessage(t){throw new Error("Method not implemented.")}},{key:"onopen",value:function onopen(t){throw new Error("Method not implemented.")}}]),AdapterSocket}(),localStorage:{},request:function request(t,a){throw new Error("Function not implemented.")},uploadFile:function uploadFile(t){throw new Error("Function not implemented.")},getSystemInfo:function getSystemInfo(){throw new Error("Function not implemented.")}};var createMethod$1=function(t){return function(a,o,c,l){aFunction$1(o);var p=toObject(a),d=v(p),h=toLength(p.length),m=t?h-1:0,y=t?-1:1;if(c<2)for(;;){if(m in d){l=d[m],m+=y;break}if(m+=y,t?m<0:h<=m)throw TypeError("Reduce of empty array with no initial value")}for(;t?m>=0:h>m;m+=y)m in d&&(l=o(l,d[m],m,p));return l}},ii={left:createMethod$1(!1),right:createMethod$1(!0)}.left,si=arrayMethodIsStrict("reduce");_export({target:"Array",proto:!0,forced:!si||!$e&&Ke>79&&Ke<83},{reduce:function reduce(t){return ii(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}});var ci=entryVirtual("Array").reduce,li=Array.prototype,reduce=function(t){var a=t.reduce;return t===li||t instanceof Array&&a===li.reduce?ci:a},ui=fails((function(){D(1)}));_export({target:"Object",stat:!0,forced:ui},{keys:function keys(t){return D(toObject(t))}});var pi=R.Object.keys;var di=function isUndefined(t){return void 0===t},hi={},fi={};function parseCmd(t,a){var o,c,l;try{l=JSON.parse(t)}catch(o){throw a.error("Parse command error: ",t),o}var p=l.sid+"_"+l.cid,d=l.r;if(includes(o=["4_1","4_2","4_10","4_11"]).call(o,p)){var h,m=l.r[1].headerPacket;p=concat(h="".concat(m.sid,"_")).call(h,m.cid),d=l.r[1].body}var v,y=fi[p],g=hi[y],b=function genCmdError(t,a){var o=Yo[t];return null===o?null:new Xo(t,a,o,(new Date).getTime())}(l.code,y),C={cmd:y,raw:l,error:b,service:null==g?void 0:g.service,content:{}};if(C.error){if(C.error.cmd=y,C.error.callFunc="parseCmd",!(null===(c=null==g?void 0:g.ignoreErrCodes)||void 0===c?void 0:includes(c).call(c,l.code)))return C;a.warn("parseCmd:: ignore error ",C.error),C.error.ignore=!0}if(!y||!g)return C.notFound=!0,C;g.response&&forEach(v=g.response).call(v,(function(t,a){var o=d[a],c=t.type,l=t.name,p=t.reflectMapper;if(!di(o))switch(c){case"Property":C.content[l]=p?deserialize(o,p):o;break;case"PropertyArray":C.content[l]=map(o).call(o,(function(t){return p?deserialize(t,p):t}));break;case"long":case"Long":case"byte":case"Byte":case"Number":C.content[l]=+o;break;default:C.content[l]=o}}));return C}function serialize(t,a){var o={};for(var c in t)void 0!==a[c]&&(o[a[c]]=t[c]);return o}function deserialize(t,a){var o={};for(var c in t)void 0!==a[c]&&(o[a[c]]=t[c]);return o}function registerParser(t){hi=ma(hi,t.cmdConfig),fi=ma(fi,t.cmdMap)}function invertSerializeMap(t){var a;return reduce(a=pi(t)).call(a,(function(a,o){var c,l=t[o];return a[o]=reduce(c=pi(l)).call(c,(function(t,a){return t[l[a]]=a,t}),{}),a}),{})}_export({target:"Array",stat:!0},{isArray:Fe});var mi=R.Array.isArray,vi=createCommonjsModule((function(t){t.exports=function _arrayWithHoles(t){if(mi(t))return t},t.exports.default=t.exports,t.exports.__esModule=!0})),yi=wellKnownSymbol("iterator"),isIterable=function(t){var a=Object(t);return void 0!==a[yi]||"@@iterator"in a||Mr.hasOwnProperty(gt(a))},gi=getIterator$1,bi=createCommonjsModule((function(t){t.exports=function _iterableToArrayLimit(t,a){if(void 0!==yr&&isIterable(Object(t))){var o=[],c=!0,l=!1,p=void 0;try{for(var d,h=gi(t);!(c=(d=h.next()).done)&&(o.push(d.value),!a||o.length!==a);c=!0);}catch(t){l=!0,p=t}finally{try{c||null==h.return||h.return()}finally{if(l)throw p}}return o}},t.exports.default=t.exports,t.exports.__esModule=!0})),callWithSafeIterationClosing=function(t,a,o,c){try{return c?a(anObject(o)[0],o[1]):a(o)}catch(a){throw iteratorClose(t),a}},Ci=!checkCorrectnessOfIteration((function(t){Array.from(t)}));_export({target:"Array",stat:!0,forced:Ci},{from:function from(t){var a,o,c,l,p,d,h=toObject(t),m="function"==typeof this?this:Array,v=arguments.length,y=v>1?arguments[1]:void 0,g=void 0!==y,b=getIteratorMethod$1(h),C=0;if(g&&(y=functionBindContext(y,v>2?arguments[2]:void 0,2)),null==b||m==Array&&isArrayIteratorMethod(b))for(o=new m(a=toLength(h.length));a>C;C++)d=g?y(h[C],C):h[C],createProperty(o,C,d);else for(p=(l=b.call(h)).next,o=new m;!(c=p.call(l)).done;C++)d=g?callWithSafeIterationClosing(l,y,[c.value,C],!0):c.value,createProperty(o,C,d);return o.length=C,o}});var Si=R.Array.from,_i=createCommonjsModule((function(t){t.exports=function _arrayLikeToArray(t,a){(null==a||a>t.length)&&(a=t.length);for(var o=0,c=new Array(a);o<a;o++)c[o]=t[o];return c},t.exports.default=t.exports,t.exports.__esModule=!0})),Mi=createCommonjsModule((function(t){t.exports=function _unsupportedIterableToArray(t,a){var o;if(t){if("string"==typeof t)return _i(t,a);var c=slice(o=Object.prototype.toString.call(t)).call(o,8,-1);return"Object"===c&&t.constructor&&(c=t.constructor.name),"Map"===c||"Set"===c?Si(t):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_i(t,a):void 0}},t.exports.default=t.exports,t.exports.__esModule=!0})),wi=createCommonjsModule((function(t){t.exports=function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.default=t.exports,t.exports.__esModule=!0})),ki=getDefaultExportFromCjs(createCommonjsModule((function(t){t.exports=function _slicedToArray(t,a){return vi(t)||bi(t,a)||Mi(t,a)||wi()},t.exports.default=t.exports,t.exports.__esModule=!0})));_export({target:"Date",stat:!0},{now:function now(){return(new Date).getTime()}});var xi=R.Date.now;function _createSuper$9(t){var a=function _isNativeReflectConstruct$9(){if("undefined"==typeof Reflect||!le)return!1;if(le.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(le(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,c=qe(t);if(a){var l=qe(this).constructor;o=le(c,arguments,l)}else o=c.apply(this,arguments);return Kr(this,o)}}var Ii=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],Ti=["transport not supported","client not handshaken","unauthorized"],Ri=["reconnect"],qi=function(t){Ne(NIMWebsocket,t);var a=_createSuper$9(NIMWebsocket);function NIMWebsocket(t,o){var c;return ue(this,NIMWebsocket),(c=a.call(this)).url=t,c.logger=o,c.websocket=null,c.url=t,c.status="disconnected",c.logger=o,c.connect(),c}return he(NIMWebsocket,[{key:"connect",value:function connect(){var t=this;"connecting"!==this.status&&"connected"!==this.status?(this.status="connecting",oi.request("https://"+this.url+"/socket.io/1/?t="+xi(),{method:"GET",dataType:"text",timeout:8e3}).then((function(a){var o=a.data.split(":"),c=ki(o,2),l=c[0],p=c[1];return t.sessionId=l,t.closeTimeout=1e3*p,t._createWebsocket("wss://"+t.url+"/socket.io/1/websocket/"+l)})).catch((function(a){t.logger.error("imsocket::handshake fail. ",a&&a.message),t.status="disconnected",t.emit("handshakeFailed")}))):this.logger.warn("imsocket::socket is connecting or connected",this.status)}},{key:"close",value:function close(){var t;if(this.websocket){this.status="disconnected",this.websocket.onmessage=null,this.websocket.onopen=null,this.websocket.onerror=null;try{null===(t=this.websocket)||void 0===t||t.send(this.encodePacket({type:"disconnect"})),this.websocket.close()}catch(t){this.logger.warn("attempt to close websocket error",t)}this.websocket.onclose=null,this.websocket=null,this.emit("disconnect")}}},{key:"onConnect",value:function onConnect(){this.status="connected",this.resetCloseTimer(),this.emit("connect")}},{key:"_createWebsocket",value:function _createWebsocket(t){var a,o=this;this.websocket=new oi.WebSocket(t),this.websocket.onmessage=bind(a=this.onMessage).call(a,this),this.websocket.onclose=function(){o.logger.log("imsocket:: websocket onclose done"),"disconnected"!==o.status&&(o.logger.log("imsocket:: close()",o.status),o.close())},this.websocket.onerror=function(t){o.logger.error("imsocket:: onerror",t)}}},{key:"onMessage",value:function onMessage(t){var a;this.resetCloseTimer();var o=this.decodePacket(t.data);if(o)switch(o.type){case"connect":this.onConnect();break;case"disconnect":this.close();break;case"message":case"json":this.emit("message",o.data);break;case"event":o.name&&this.emit(o.name,o.args);break;case"error":"unauthorized"===o.reason?this.emit("connect_failed",o.reason):this.emit("error",o.reason);break;case"heartbeat":null===(a=this.websocket)||void 0===a||a.send(this.encodePacket({type:"heartbeat"}));break;default:this.logger.warn("imsocket::no handler type",o.type)}}},{key:"encodePacket",value:function encodePacket(t){var a,o,c=t.type,l=t.id,p=void 0===l?"":l,d=t.endpoint,h=void 0===d?"":d,m=t.ack,v=null;if(!c)return"";switch(c){case"error":a=t.reason?indexOf(Ti).call(Ti,t.reason):"",o=t.advice?indexOf(Ri).call(Ri,t.advice):"",""===a&&""===o||(v=a+(""!==o?"+"+o:""));break;case"message":""!==t.data&&(v=t.data);break;case"event":a={name:t.name},a=t.args&&t.args.length?{name:t.name,args:t.args}:{name:t.name},v=Da(a);break;case"json":v=Da(t.data);break;case"connect":t.qs&&(v=t.qs);break;case"ack":v=t.ackId+(t.args&&t.args.length?"+"+Da(t.args):"")}var y=[indexOf(Ii).call(Ii,c),p+("data"===m?"+":""),h];return null!=v&&y.push(v),y.join(":")}},{key:"decodePacket",value:function decodePacket(t){if(t)if("ï¿½"!=t.charAt(0)){var a=t.match(/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/);if(a){var o,c=ki(a,6),l=c[1],p=c[2],d=c[3],h=c[4],m=c[5],v={type:Ii[+l],endpoint:h};switch(p&&(v.id=p,v.ack=!d||"data"),v.type){case"error":o=m.split("+"),v.reason=Ti[+o[0]]||"";break;case"message":v.data=m||"";break;case"connect":v.qs=m||"";break;case"event":try{var y=JSON.parse(m);v.name=y.name,v.args=y.args}catch(t){this.logger.error("imsocket::parseData::type::event error",t)}v.args=v.args||[];break;case"json":try{v.data=JSON.parse(m)}catch(t){this.logger.error("imsocket::parseData::type::json error",t)}break;case"ack":if((o=m.match(/^([0-9]+)(\+)?(.*)/))&&(v.ackId=o[1],v.args=[],o[3]))try{v.args=o[3]?JSON.parse(o[3]):[]}catch(t){this.logger.error("imsocket::parseData::type::ack error",t)}}return v}}else this.logger.error("imsocket::unrecognize dataStr",slice(t).call(t,0,20))}},{key:"send",value:function send(t){var a,o={data:t,type:"message",endpoint:""};null===(a=this.websocket)||void 0===a||a.send(this.encodePacket(o))}},{key:"resetCloseTimer",value:function resetCloseTimer(){var t=this;this.closeTimeout&&(clearTimeout(this.closeTimer),this.closeTimer=Ba((function(){t.close()}),this.closeTimeout))}}]),NIMWebsocket}(Ja),Ei=createCommonjsModule((function(t){t.exports=function _arrayWithoutHoles(t){if(mi(t))return _i(t)},t.exports.default=t.exports,t.exports.__esModule=!0})),Pi=createCommonjsModule((function(t){t.exports=function _iterableToArray(t){if(void 0!==yr&&isIterable(Object(t)))return Si(t)},t.exports.default=t.exports,t.exports.__esModule=!0})),Ai=createCommonjsModule((function(t){t.exports=function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.default=t.exports,t.exports.__esModule=!0})),Oi=getDefaultExportFromCjs(createCommonjsModule((function(t){t.exports=function _toConsumableArray(t){return Ei(t)||Pi(t)||Mi(t)||Ai()},t.exports.default=t.exports,t.exports.__esModule=!0}))),ji=entryVirtual("Array").values,Ui=Array.prototype,Bi={DOMTokenList:!0,NodeList:!0},values=function(t){var a=t.values;return t===Ui||t instanceof Array&&a===Ui.values||Bi.hasOwnProperty(gt(t))?ji:a},Li=Bt.every,Ni=arrayMethodIsStrict("every");_export({target:"Array",proto:!0,forced:!Ni},{every:function every(t){return Li(this,t,arguments.length>1?arguments[1]:void 0)}});var Fi=entryVirtual("Array").every,$i=Array.prototype,every=function(t){var a=t.every;return t===$i||t instanceof Array&&a===$i.every?Fi:a};var Gi=function isObjectLike(t){return null!=t&&"object"==typeof t};var Qi=function baseIsRegExp(t){return Gi(t)&&"[object RegExp]"==uo(t)};var Di=function baseUnary(t){return function(a){return t(a)}},Wi=createCommonjsModule((function(t,a){var o=a&&!a.nodeType&&a,c=o&&t&&!t.nodeType&&t,l=c&&c.exports===o&&Xa.process,p=function(){try{var t=c&&c.require&&c.require("util").types;return t||l&&l.binding&&l.binding("util")}catch(t){}}();t.exports=p})),Ki=Wi&&Wi.isRegExp,Vi=Ki?Di(Ki):Qi,zi=eo["__core-js_shared__"],Hi=function(){var t=/[^.]+$/.exec(zi&&zi.keys&&zi.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();var Ji=function isMasked(t){return!!Hi&&Hi in t},Yi=Function.prototype.toString;var Xi=function toSource(t){if(null!=t){try{return Yi.call(t)}catch(t){}try{return t+""}catch(t){}}return""},Zi=/^\[object .+?Constructor\]$/,es=Function.prototype,ts=Object.prototype,rs=es.toString,ns=ts.hasOwnProperty,as=RegExp("^"+rs.call(ns).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var os=function baseIsNative(t){return!(!po(t)||Ji(t))&&(ho(t)?as:Zi).test(Xi(t))};var is=function getValue(t,a){return null==t?void 0:t[a]};var ss=function getNative(t,a){var o=is(t,a);return os(o)?o:void 0},cs=ss(Object,"create");var ls=function hashClear(){this.__data__=cs?cs(null):{},this.size=0};var us=function hashDelete(t){var a=this.has(t)&&delete this.__data__[t];return this.size-=a?1:0,a},ps=Object.prototype.hasOwnProperty;var ds=function hashGet(t){var a=this.__data__;if(cs){var o=a[t];return"__lodash_hash_undefined__"===o?void 0:o}return ps.call(a,t)?a[t]:void 0},hs=Object.prototype.hasOwnProperty;var fs=function hashHas(t){var a=this.__data__;return cs?void 0!==a[t]:hs.call(a,t)};var ms=function hashSet(t,a){var o=this.__data__;return this.size+=this.has(t)?0:1,o[t]=cs&&void 0===a?"__lodash_hash_undefined__":a,this};function Hash(t){var a=-1,o=null==t?0:t.length;for(this.clear();++a<o;){var c=t[a];this.set(c[0],c[1])}}Hash.prototype.clear=ls,Hash.prototype.delete=us,Hash.prototype.get=ds,Hash.prototype.has=fs,Hash.prototype.set=ms;var vs=Hash;var ys=function listCacheClear(){this.__data__=[],this.size=0};var gs=function eq(t,a){return t===a||t!=t&&a!=a};var bs=function assocIndexOf(t,a){for(var o=t.length;o--;)if(gs(t[o][0],a))return o;return-1},Cs=Array.prototype.splice;var Ss=function listCacheDelete(t){var a=this.__data__,o=bs(a,t);return!(o<0)&&(o==a.length-1?a.pop():Cs.call(a,o,1),--this.size,!0)};var _s=function listCacheGet(t){var a=this.__data__,o=bs(a,t);return o<0?void 0:a[o][1]};var Ms=function listCacheHas(t){return bs(this.__data__,t)>-1};var ws=function listCacheSet(t,a){var o=this.__data__,c=bs(o,t);return c<0?(++this.size,o.push([t,a])):o[c][1]=a,this};function ListCache(t){var a=-1,o=null==t?0:t.length;for(this.clear();++a<o;){var c=t[a];this.set(c[0],c[1])}}ListCache.prototype.clear=ys,ListCache.prototype.delete=Ss,ListCache.prototype.get=_s,ListCache.prototype.has=Ms,ListCache.prototype.set=ws;var ks=ListCache,xs=ss(eo,"Map");var Is=function mapCacheClear(){this.size=0,this.__data__={hash:new vs,map:new(xs||ks),string:new vs}};var Ts=function isKeyable(t){var a=typeof t;return"string"==a||"number"==a||"symbol"==a||"boolean"==a?"__proto__"!==t:null===t};var Rs=function getMapData(t,a){var o=t.__data__;return Ts(a)?o["string"==typeof a?"string":"hash"]:o.map};var qs=function mapCacheDelete(t){var a=Rs(this,t).delete(t);return this.size-=a?1:0,a};var Es=function mapCacheGet(t){return Rs(this,t).get(t)};var Ps=function mapCacheHas(t){return Rs(this,t).has(t)};var As=function mapCacheSet(t,a){var o=Rs(this,t),c=o.size;return o.set(t,a),this.size+=o.size==c?0:1,this};function MapCache(t){var a=-1,o=null==t?0:t.length;for(this.clear();++a<o;){var c=t[a];this.set(c[0],c[1])}}MapCache.prototype.clear=Is,MapCache.prototype.delete=qs,MapCache.prototype.get=Es,MapCache.prototype.has=Ps,MapCache.prototype.set=As;var Os=MapCache;var js=function setCacheAdd(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var Us=function setCacheHas(t){return this.__data__.has(t)};function SetCache(t){var a=-1,o=null==t?0:t.length;for(this.__data__=new Os;++a<o;)this.add(t[a])}SetCache.prototype.add=SetCache.prototype.push=js,SetCache.prototype.has=Us;var Bs=SetCache;var Ls=function baseFindIndex(t,a,o,c){for(var l=t.length,p=o+(c?1:-1);c?p--:++p<l;)if(a(t[p],p,t))return p;return-1};var Ns=function baseIsNaN(t){return t!=t};var Fs=function strictIndexOf(t,a,o){for(var c=o-1,l=t.length;++c<l;)if(t[c]===a)return c;return-1};var $s=function baseIndexOf(t,a,o){return a==a?Fs(t,a,o):Ls(t,Ns,o)};var Gs=function arrayIncludes(t,a){return!!(null==t?0:t.length)&&$s(t,a,0)>-1};var Qs=function arrayIncludesWith(t,a,o){for(var c=-1,l=null==t?0:t.length;++c<l;)if(o(a,t[c]))return!0;return!1};var Ds=function arrayMap(t,a){for(var o=-1,c=null==t?0:t.length,l=Array(c);++o<c;)l[o]=a(t[o],o,t);return l};var Ws=function cacheHas(t,a){return t.has(a)};var Ks=function baseDifference(t,a,o,c){var l=-1,p=Gs,d=!0,h=t.length,m=[],v=a.length;if(!h)return m;o&&(a=Ds(a,Di(o))),c?(p=Qs,d=!1):a.length>=200&&(p=Ws,d=!1,a=new Bs(a));e:for(;++l<h;){var y=t[l],g=null==o?y:o(y);if(y=c||0!==y?y:0,d&&g==g){for(var b=v;b--;)if(a[b]===g)continue e;m.push(y)}else p(a,g,c)||m.push(y)}return m};var Vs=function identity(t){return t};var zs=function apply(t,a,o){switch(o.length){case 0:return t.call(a);case 1:return t.call(a,o[0]);case 2:return t.call(a,o[0],o[1]);case 3:return t.call(a,o[0],o[1],o[2])}return t.apply(a,o)},Hs=Math.max;var Js=function overRest(t,a,o){return a=Hs(void 0===a?t.length-1:a,0),function(){for(var c=arguments,l=-1,p=Hs(c.length-a,0),d=Array(p);++l<p;)d[l]=c[a+l];l=-1;for(var h=Array(a+1);++l<a;)h[l]=c[l];return h[a]=o(d),zs(t,this,h)}};var Ys=function constant(t){return function(){return t}},Xs=function(){try{var t=ss(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),Zs=Xs?function(t,a){return Xs(t,"toString",{configurable:!0,enumerable:!1,value:Ys(a),writable:!0})}:Vs,ec=Date.now;var tc=function shortOut(t){var a=0,o=0;return function(){var c=ec(),l=16-(c-o);if(o=c,l>0){if(++a>=800)return arguments[0]}else a=0;return t.apply(void 0,arguments)}},rc=tc(Zs);var nc=function baseRest(t,a){return rc(Js(t,a,Vs),t+"")};var ac=function isLength(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991};var oc=function isArrayLike(t){return null!=t&&ac(t.length)&&!ho(t)};var ic=function isArrayLikeObject(t){return Gi(t)&&oc(t)},sc=nc((function(t,a){return ic(t)?Ks(t,a):[]})),cc=sc;function replacer(t,a){return a instanceof RegExp?"__REGEXP "+a.toString():a}function validate(t,a,o){var c,l={};return forEach(c=pi(t)).call(c,(function(c){var p=t[c].type,d=o?"In ".concat(o,", "):"";if(void 0===a[c]){if(!1===t[c].required)return void(l[c]=a[c]);var h;throw new Jo(concat(h="".concat(d,'param "')).call(h,c,'" is required'),{key:c},"required")}var m,v,y=lc[p];if(y&&!y(a,c,t[c]))throw new Jo(concat(m=concat(v="".concat(d,'param "')).call(v,c,'" expects ')).call(m,Da(t[c],replacer)),{key:c,value:a[c]},Da(t[c]));l[c]=a[c]})),l}var lc={string:function string(t,a,o){var c=o.allowEmpty,l=o.max,p=o.min,d=o.regExp,h=t[a];return"string"==typeof h&&((!1!==c||""!==h)&&(!("number"==typeof l&&h.length>l)&&(!("number"==typeof p&&h.length<p)&&!(Vi(d)&&!d.test(h)))))},number:function number(t,a,o){var c=o.min,l=o.max,p=t[a];return"number"==typeof p&&(!("number"==typeof c&&p<c)&&!("number"==typeof l&&p>l))},boolean:function boolean(t,a){return"boolean"==typeof t[a]},enum:function _enum(t,a,o){var c=values(o),l=t[a];return!c||indexOf(c).call(c,l)>-1},array:function array(t,a,o){var c,l=o.itemType,p=o.rules,d=o.min,h=o.max,m=values(o),v=t[a];return!!mi(v)&&(!("number"==typeof h&&v.length>h)&&(!("number"==typeof d&&v.length<d)&&(!(l&&"enum"!==l&&!every(v).call(v,(function(t){return Dr(t)===l})))&&(("enum"!==l||!m||!cc.apply(void 0,concat(c=[v]).call(c,Oi(m))).length)&&(p&&forEach(v).call(v,(function(t,o){var c;return validate(p,t,concat(c="".concat(a,"[")).call(c,o,"]"))})),!0)))))},object:function object(t,a,o){var c=o.rules,l=t[a];return c&&validate(c,l,a),!0}},uc=ss(eo,"Set");var pc=function noop(){};var dc=function setToArray(t){var a=-1,o=Array(t.size);return t.forEach((function(t){o[++a]=t})),o},hc=uc&&1/dc(new uc([,-0]))[1]==1/0?function(t){return new uc(t)}:pc,fc=hc;var mc=function baseUniq(t,a,o){var c=-1,l=Gs,p=t.length,d=!0,h=[],m=h;if(o)d=!1,l=Qs;else if(p>=200){var v=a?null:fc(t);if(v)return dc(v);d=!1,l=Ws,m=new Bs}else m=a?[]:h;e:for(;++c<p;){var y=t[c],g=a?a(y):y;if(y=o||0!==y?y:0,d&&g==g){for(var b=m.length;b--;)if(m[b]===g)continue e;a&&m.push(g),h.push(y)}else l(m,g,o)||(m!==h&&m.push(g),h.push(y))}return h};var vc=function uniq(t){return t&&t.length?mc(t):[]},yc=Bt.filter,gc=arrayMethodHasSpeciesSupport("filter");_export({target:"Array",proto:!0,forced:!gc},{filter:function filter(t){return yc(this,t,arguments.length>1?arguments[1]:void 0)}});var bc,Cc,Sc=entryVirtual("Array").filter,_c=Array.prototype,filter=function(t){var a=t.filter;return t===_c||t instanceof Array&&a===_c.filter?Sc:a},Mc=(bc=function _s4(){return(65536*(1+Math.random())|0).toString(16).substring(1)},function(){return bc()+bc()+bc()+bc()+bc()+bc()+bc()+bc()});function getEnumKeys(t){var a;return filter(a=pi(t)).call(a,(function(t){return!(+t>=0)}))}function getEnumKeyByEnumValue(t,a){var o,c=filter(o=pi(t)).call(o,(function(o){return t[o]==a}));return c.length>0?c[0]:void 0}function _createSuper$8(t){var a=function _isNativeReflectConstruct$8(){if("undefined"==typeof Reflect||!le)return!1;if(le.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(le(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,c=qe(t);if(a){var l=qe(this).constructor;o=le(c,arguments,l)}else o=c.apply(this,arguments);return Kr(this,o)}}!function(t){t[t.ACTIVE=1]="ACTIVE",t[t.KICKED=2]="KICKED",t[t.OFFLINE=3]="OFFLINE"}(Cc||(Cc={}));var wc=window&&ho(window.addEventListener)&&ho(window.removeEventListener),kc=function(t){Ne(Core,t);var a=_createSuper$8(Core);function Core(t,o){var c;ue(this,Core),(c=a.call(this)).status="unconnected",c.linkUrls=[],c.packetSer=1,c.retryCount=0,c.reconnectTimer=0,c.backoff=new Ya({max:8e3,min:1600,jitter:.01}),c.sendingCmdMap=new qa,c.pingTimer=0,c.config=fo,validate({linkUrls:{type:"array",itemType:"string",required:!1}},t),c.options=ma(ma({},mo),t);var l=oi.localStorage.getItem("__NIM_DEVC_ID__");return c.options.isFixedDeviceId?(l=oi.localStorage.getItem("__NIM_DEVC_ID__")||Mc(),oi.localStorage.setItem("__NIM_DEVC_ID__",l)):l=Mc(),c.config=ma(ma(ma({},fo),o),{deviceId:l}),c.logger=new ai(c.options.debugLevel,c.options.account),oi.setLogger(c.logger),c.logger.log("Core init, version ","0.8.0"," sdk version ",800," appkey ",t.appkey),c}return he(Core,[{key:"connect",value:function connect(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return __awaiter(this,void 0,void 0,zr.mark((function _callee(){var a,o,c,l;return zr.wrap((function _callee$(p){for(;;)switch(p.prev=p.next){case 0:if(validate({linkUrls:{type:"array",itemType:"string",required:!1}},t),/^(unconnected|waitReconnect)$/.test(this.status)){p.next=5;break}return a="Core socket status is ".concat(this.status,", and would not repeat connect"),this.logger.warn(a),p.abrupt("return",pa.reject(a));case 5:this.status="connecting",t.linkUrls&&t.linkUrls.length>0&&(this.linkUrls=concat(o=t.linkUrls).call(o,this.linkUrls),this.linkUrls=vc(this.linkUrls)),0===this.linkUrls.length&&this.linkUrls.push(vo),c=0;case 9:if(!(c<this.linkUrls.length)){p.next=25;break}return l=this.linkUrls[c],p.prev=11,p.next=14,this.doConnect(l);case 14:return this.status="connected",this.logger.log("core:: connect success with url: ".concat(l)),p.abrupt("return");case 19:p.prev=19,p.t0=p.catch(11),this.logger.warn("core:: connect failed with url: ".concat(l),p.t0);case 22:c++,p.next=9;break;case 25:throw 0===this.retryCount?this.doDisconnect(Cc.ACTIVE,"SocketHandshakeFailed"):this.doDisconnect(Cc.OFFLINE,"ReconnectHadRetryAllLinks"),new Error("core: socket handshake failed");case 27:case"end":return p.stop()}}),_callee,this,[[11,19]])})))}},{key:"doConnect",value:function doConnect(t){var a=this;return new pa((function(o,c){var l;a.socket=new qi(t,a.logger),a.socket.on("connect",(function(){a.logger.log("socket on connect",t),o()})),a.socket.on("message",bind(l=a.onMessage).call(l,a)),a.socket.on("disconnect",(function(t){a.logger.log("core:: socket on disconnect",t),a.doDisconnect(Cc.OFFLINE,"SocketOnDisconnect")})),a.socket.on("handshakeFailed",(function(){a.logger.warn("core:: socket handshake failed"),c(new Error("handshake failed"))}))}))}},{key:"resetConnectStatus",value:function resetConnectStatus(){clearTimeout(this.reconnectTimer),this.backoff.reset(),this.retryCount=0,this.initOnlineListener()}},{key:"doDisconnect",value:function doDisconnect(t,a){var o;if(this.logger.log(concat(o="doDisconnect: type ".concat(t,", description ")).call(o,a)),"unconnected"!==this.status){this.markAllCmdInvaild(),clearTimeout(this.pingTimer),this.socket&&("function"==typeof this.socket.removeAllListeners&&this.socket.removeAllListeners(),"function"==typeof this.socket.close&&this.socket.close(),this.socket=void 0);var c=!this.options.needReconnect||this.retryCount>=this.options.reconnectionAttempts;if(t===Cc.ACTIVE||c)this.logger.log("doDisconnect: emit disconnect, type "+t,c),this.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.emit("disconnect"),this.destroyOnlineListener();else if(t===Cc.KICKED){this.logger.log("doDisconnect: kicked"),this.status="unconnected",this.reconnectTimer&&clearTimeout(this.reconnectTimer);var l="string"==typeof a?{reason:"unknow",message:a}:a;this.emit("kicked",l),this.destroyOnlineListener()}else t===Cc.OFFLINE?(this.logger.log("doDisconnect: start to reconnect"),this.attempToReconnect()):this.logger.log("doDisconnect: nothing to do")}else this.logger.warn("doDisconnect: already unconnected")}},{key:"attempToReconnect",value:function attempToReconnect(){var t,a=this;if("waitReconnect"!==this.status){var o=this.backoff.duration();this.retryCount++,this.logger.log(concat(t="willReconnect ".concat(this.retryCount," ")).call(t,o)),this.emit("willReconnect",{retryCount:this.retryCount,duration:o}),this.status="waitReconnect",this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.reconnectTimer=Ba((function(){"waitReconnect"===a.status?a.connect({isAutoReconnect:!0}).catch((function(){a.logger.error("core::attempToReconnect failed ".concat(a.retryCount))})):a.logger.warn("doDisconnect: reconnectTimer status is ".concat(a.status,", would not go on reconnecting"))}),o)}else this.logger.warn("doDisconnect: already is waiting reconnect")}},{key:"sendCmd",value:function sendCmd(t,a,o){var c,l=this;if("logined"!==this.status&&"login"!==t&&"chatroomLogin"!==t&&"qchatLogin"!==t)return this.logger.warn(concat(c="nim status is ".concat(this.status,", so can not sendCmd ")).call(c,t)),pa.reject({cmd:t,error:{code:"No_connected",message:"Connection not established",timetag:(new Date).getTime()}});if(!this.socket||!this.socket.send)return pa.reject("No_socket");var p="heartbeat"!==t,d=p?this.packetSer++:0,h=function createCmd(t,a,o,c){var l=hi[t];if(!l)return o.error("createCmd:: can not find cmd config: ",t),null;var p,d={SER:a,SID:l.sid,CID:l.cid,Q:[]};return l.params&&c&&forEach(p=l.params).call(p,(function(t){var a=c[t.name];if(!di(a)){var o=t.type,l=t.reflectMapper;switch(t.type){case"PropertyArray":o="ArrayMable",a=map(a).call(a,(function(t){return{t:"Property",v:l?serialize(t,l):t}}));break;case"Property":a=l?serialize(a,l):a;break;case"Bool":case"bool":a=a?"true":"false"}d.Q.push({t:o,v:a})}})),d}(t,d,this.logger,a);if(!h){var m,v=concat(m="SendCmd ".concat(d," ")).call(m,t," error");return this.logger.error(v),pa.reject(v)}var y=Da(h);return p&&("debug"===this.options.debugLevel?this.logger.debug("core::sendCmd",t,"ser:".concat(d),y):this.logger.log("core::sendCmd",t,"ser:".concat(d))),new pa((function(c,p){l.sendingCmdMap.set(d,{cmd:t,params:a,callback:[c,p],timer:"sync"===t||"qchatSync"===t?null:Ba((function(){var a,o=new Xo(504,t,"Packet Timeout",(new Date).getTime(),{message:concat(a="ser ".concat(d," cmd ")).call(a,t," timeout")});o.callFunc="sendCmd",l.markCmdInvalid(d,o,t)}),o&&o.timeout?o.timeout:l.config.timeout)});try{l.socket.send(y)}catch(a){var h=new Xo(415,t,a&&a.message||"Unable to send packet",(new Date).getTime(),{message:"send json error",rawError:a});h.callFunc="sendCmd",l.markCmdInvalid(d,h,t),p(a)}}))}},{key:"onMessage",value:function onMessage(t){var a=parseCmd(t,this.logger);if(a){var o,c,l,p,d=a.raw.ser;if(a.error)this.logger.error("core:onMessage packet error",concat(o=concat(c="".concat(a.raw.sid,"_")).call(c,a.raw.cid,", ser:")).call(o,d,","),a.error);if(!a.notFound)return"heartbeat"!==a.cmd&&("debug"===this.options.debugLevel?this.logger.debug("imsocket::recvCmd ser:".concat(d),a.cmd,a.content):this.logger.log("imsocket::recvCmd ser:".concat(d),a.cmd)),a;this.logger.warn("core::onMessage packet not found",concat(l=concat(p="".concat(a.raw.sid,"_")).call(p,a.raw.cid,", ser:")).call(l,d))}}},{key:"markCmdInvalid",value:function markCmdInvalid(t,a,o){var c=this.sendingCmdMap.get(t);if(c){var l=c.callback,p=c.timer;p&&clearTimeout(p),this.sendingCmdMap.delete(t),"batchMarkRead"!==o&&(this.logger.warn("packet ".concat(t," is invalid:"),a),l[1](a))}}},{key:"markAllCmdInvaild",value:function markAllCmdInvaild(t){var a;this.logger.log("markAllCmdInvaild"),forEach(a=this.sendingCmdMap).call(a,(function(a){var o=a.callback,c=a.timer;c&&clearTimeout(c),o[1](t)})),this.sendingCmdMap.clear()}},{key:"ping",value:function ping(){return __awaiter(this,void 0,void 0,zr.mark((function _callee2(){var t=this;return zr.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return clearTimeout(this.pingTimer),a.prev=1,a.next=4,this.sendCmd("heartbeat");case 4:a.next=14;break;case 6:return a.prev=6,a.t0=a.catch(1),a.next=10,this.testHeartBeat5Timeout();case 10:if(!a.sent){a.next=14;break}return this.doDisconnect(Cc.OFFLINE,"PingError"),a.abrupt("return");case 14:this.pingTimer=Ba((function(){t.ping()}),3e4);case 15:case"end":return a.stop()}}),_callee2,this,[[1,6]])})))}},{key:"testHeartBeat5Timeout",value:function testHeartBeat5Timeout(){return __awaiter(this,void 0,void 0,zr.mark((function _callee3(){var t;return zr.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:clearTimeout(this.pingTimer),t=0;case 2:if(!(t<5)){a.next=15;break}return a.prev=3,a.next=6,this.sendCmd("heartbeat",{},{timeout:3e3});case 6:return a.abrupt("return",!1);case 9:a.prev=9,a.t0=a.catch(3),this.logger.debug("core:: test heartbeat ".concat(t," Timeout"));case 12:t++,a.next=2;break;case 15:return a.abrupt("return",!0);case 16:case"end":return a.stop()}}),_callee3,this,[[3,9]])})))}},{key:"initOnlineListener",value:function initOnlineListener(){var t,a;this.onlineListener||(wc?(this.onlineListener=bind(t=function _context16(){"logined"===this.status&&this.ping()}).call(t,this),this.offlineListener=bind(a=function _context17(){this.logger.log("offline"),this.doDisconnect(Cc.OFFLINE,"OfflineListener")}).call(a,this),window.addEventListener("online",this.onlineListener),window.addEventListener("offline",this.offlineListener)):this.logger.warn("initOnlineListener not support add listener"))}},{key:"destroyOnlineListener",value:function destroyOnlineListener(){this.onlineListener&&(window.removeEventListener("online",this.onlineListener),this.onlineListener=void 0),this.offlineListener&&(window.removeEventListener("offline",this.offlineListener),this.offlineListener=void 0)}},{key:"disconnect",value:function disconnect(){switch(this.status){case"connected":case"logined":case"connecting":case"waitReconnect":return this.doDisconnect(Cc.ACTIVE,"UserActiveDisconnect"),pa.resolve();case"unconnected":case"destroyed":return pa.resolve()}}},{key:"destroy",value:function destroy(){var t=this;return this.disconnect().then((function(){t.status="destroyed",t.removeAllListeners(),t.connect=function(){return pa.resolve()},t.disconnect=function(){return pa.resolve()},t.destroy=function(){return pa.resolve()}}))}}]),Core}(Ja);kc.setAdapters=function setAdapters(t){ma(oi,t)};var xc="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff",Ic="["+xc+"]",Tc=RegExp("^"+Ic+Ic+"*"),Rc=RegExp(Ic+Ic+"*$"),createMethod=function(t){return function(a){var o=String(requireObjectCoercible(a));return 1&t&&(o=o.replace(Tc,"")),2&t&&(o=o.replace(Rc,"")),o}},qc={start:createMethod(1),end:createMethod(2),trim:createMethod(3)}.trim,Ec=o.parseInt,Pc=/^[+-]?0[Xx]/,Ac=8!==Ec(xc+"08")||22!==Ec(xc+"0x16")?function parseInt(t,a){var o=qc(String(t));return Ec(o,a>>>0||(Pc.test(o)?16:10))}:Ec;_export({global:!0,forced:parseInt!=Ac},{parseInt:Ac});var Oc=R.parseInt,jc=Bt.some,Uc=arrayMethodIsStrict("some");_export({target:"Array",proto:!0,forced:!Uc},{some:function some(t){return jc(this,t,arguments.length>1?arguments[1]:void 0)}});var Bc=entryVirtual("Array").some,Lc=Array.prototype,some=function(t){var a=t.some;return t===Lc||t instanceof Array&&a===Lc.some?Bc:a};var Nc=function stackClear(){this.__data__=new ks,this.size=0};var Fc=function stackDelete(t){var a=this.__data__,o=a.delete(t);return this.size=a.size,o};var $c=function stackGet(t){return this.__data__.get(t)};var Gc=function stackHas(t){return this.__data__.has(t)};var Qc=function stackSet(t,a){var o=this.__data__;if(o instanceof ks){var c=o.__data__;if(!xs||c.length<199)return c.push([t,a]),this.size=++o.size,this;o=this.__data__=new Os(c)}return o.set(t,a),this.size=o.size,this};function Stack(t){var a=this.__data__=new ks(t);this.size=a.size}Stack.prototype.clear=Nc,Stack.prototype.delete=Fc,Stack.prototype.get=$c,Stack.prototype.has=Gc,Stack.prototype.set=Qc;var Dc=Stack;var Wc=function arraySome(t,a){for(var o=-1,c=null==t?0:t.length;++o<c;)if(a(t[o],o,t))return!0;return!1};var Kc=function equalArrays(t,a,o,c,l,p){var d=1&o,h=t.length,m=a.length;if(h!=m&&!(d&&m>h))return!1;var v=p.get(t),y=p.get(a);if(v&&y)return v==a&&y==t;var g=-1,b=!0,C=2&o?new Bs:void 0;for(p.set(t,a),p.set(a,t);++g<h;){var S=t[g],_=a[g];if(c)var M=d?c(_,S,g,a,t,p):c(S,_,g,t,a,p);if(void 0!==M){if(M)continue;b=!1;break}if(C){if(!Wc(a,(function(t,a){if(!Ws(C,a)&&(S===t||l(S,t,o,c,p)))return C.push(a)}))){b=!1;break}}else if(S!==_&&!l(S,_,o,c,p)){b=!1;break}}return p.delete(t),p.delete(a),b},Vc=eo.Uint8Array;var zc=function mapToArray(t){var a=-1,o=Array(t.size);return t.forEach((function(t,c){o[++a]=[c,t]})),o},Hc=to?to.prototype:void 0,Jc=Hc?Hc.valueOf:void 0;var Yc=function equalByTag(t,a,o,c,l,p,d){switch(o){case"[object DataView]":if(t.byteLength!=a.byteLength||t.byteOffset!=a.byteOffset)return!1;t=t.buffer,a=a.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=a.byteLength||!p(new Vc(t),new Vc(a)));case"[object Boolean]":case"[object Date]":case"[object Number]":return gs(+t,+a);case"[object Error]":return t.name==a.name&&t.message==a.message;case"[object RegExp]":case"[object String]":return t==a+"";case"[object Map]":var h=zc;case"[object Set]":var m=1&c;if(h||(h=dc),t.size!=a.size&&!m)return!1;var v=d.get(t);if(v)return v==a;c|=2,d.set(t,a);var y=Kc(h(t),h(a),c,l,p,d);return d.delete(t),y;case"[object Symbol]":if(Jc)return Jc.call(t)==Jc.call(a)}return!1};var Xc=function arrayPush(t,a){for(var o=-1,c=a.length,l=t.length;++o<c;)t[l+o]=a[o];return t},Zc=Array.isArray;var el=function baseGetAllKeys(t,a,o){var c=a(t);return Zc(t)?c:Xc(c,o(t))};var tl=function arrayFilter(t,a){for(var o=-1,c=null==t?0:t.length,l=0,p=[];++o<c;){var d=t[o];a(d,o,t)&&(p[l++]=d)}return p};var rl=function stubArray(){return[]},nl=Object.prototype.propertyIsEnumerable,al=Object.getOwnPropertySymbols,ol=al?function(t){return null==t?[]:(t=Object(t),tl(al(t),(function(a){return nl.call(t,a)})))}:rl,il=ol;var sl=function baseTimes(t,a){for(var o=-1,c=Array(t);++o<t;)c[o]=a(o);return c};var cl=function baseIsArguments(t){return Gi(t)&&"[object Arguments]"==uo(t)},ll=Object.prototype,ul=ll.hasOwnProperty,pl=ll.propertyIsEnumerable,dl=cl(function(){return arguments}())?cl:function(t){return Gi(t)&&ul.call(t,"callee")&&!pl.call(t,"callee")},hl=dl;var fl=function stubFalse(){return!1},ml=createCommonjsModule((function(t,a){var o=a&&!a.nodeType&&a,c=o&&t&&!t.nodeType&&t,l=c&&c.exports===o?eo.Buffer:void 0,p=(l?l.isBuffer:void 0)||fl;t.exports=p})),vl=/^(?:0|[1-9]\d*)$/;var yl=function isIndex(t,a){var o=typeof t;return!!(a=null==a?9007199254740991:a)&&("number"==o||"symbol"!=o&&vl.test(t))&&t>-1&&t%1==0&&t<a},gl={};gl["[object Float32Array]"]=gl["[object Float64Array]"]=gl["[object Int8Array]"]=gl["[object Int16Array]"]=gl["[object Int32Array]"]=gl["[object Uint8Array]"]=gl["[object Uint8ClampedArray]"]=gl["[object Uint16Array]"]=gl["[object Uint32Array]"]=!0,gl["[object Arguments]"]=gl["[object Array]"]=gl["[object ArrayBuffer]"]=gl["[object Boolean]"]=gl["[object DataView]"]=gl["[object Date]"]=gl["[object Error]"]=gl["[object Function]"]=gl["[object Map]"]=gl["[object Number]"]=gl["[object Object]"]=gl["[object RegExp]"]=gl["[object Set]"]=gl["[object String]"]=gl["[object WeakMap]"]=!1;var bl=function baseIsTypedArray(t){return Gi(t)&&ac(t.length)&&!!gl[uo(t)]},Cl=Wi&&Wi.isTypedArray,Sl=Cl?Di(Cl):bl,_l=Object.prototype.hasOwnProperty;var Ml=function arrayLikeKeys(t,a){var o=Zc(t),c=!o&&hl(t),l=!o&&!c&&ml(t),p=!o&&!c&&!l&&Sl(t),d=o||c||l||p,h=d?sl(t.length,String):[],m=h.length;for(var v in t)!a&&!_l.call(t,v)||d&&("length"==v||l&&("offset"==v||"parent"==v)||p&&("buffer"==v||"byteLength"==v||"byteOffset"==v)||yl(v,m))||h.push(v);return h},wl=Object.prototype;var kl=function isPrototype(t){var a=t&&t.constructor;return t===("function"==typeof a&&a.prototype||wl)};var xl=function overArg(t,a){return function(o){return t(a(o))}},Il=xl(Object.keys,Object),Tl=Object.prototype.hasOwnProperty;var Rl=function baseKeys(t){if(!kl(t))return Il(t);var a=[];for(var o in Object(t))Tl.call(t,o)&&"constructor"!=o&&a.push(o);return a};var ql=function keys(t){return oc(t)?Ml(t):Rl(t)};var El=function getAllKeys(t){return el(t,ql,il)},Pl=Object.prototype.hasOwnProperty;var Al=function equalObjects(t,a,o,c,l,p){var d=1&o,h=El(t),m=h.length;if(m!=El(a).length&&!d)return!1;for(var v=m;v--;){var y=h[v];if(!(d?y in a:Pl.call(a,y)))return!1}var g=p.get(t),b=p.get(a);if(g&&b)return g==a&&b==t;var C=!0;p.set(t,a),p.set(a,t);for(var S=d;++v<m;){var _=t[y=h[v]],M=a[y];if(c)var w=d?c(M,_,y,a,t,p):c(_,M,y,t,a,p);if(!(void 0===w?_===M||l(_,M,o,c,p):w)){C=!1;break}S||(S="constructor"==y)}if(C&&!S){var k=t.constructor,x=a.constructor;k==x||!("constructor"in t)||!("constructor"in a)||"function"==typeof k&&k instanceof k&&"function"==typeof x&&x instanceof x||(C=!1)}return p.delete(t),p.delete(a),C},Ol=ss(eo,"DataView"),jl=ss(eo,"Promise"),Ul=ss(eo,"WeakMap"),Bl="[object Map]",Ll="[object Promise]",Nl="[object Set]",Fl="[object WeakMap]",$l="[object DataView]",Gl=Xi(Ol),Ql=Xi(xs),Dl=Xi(jl),Wl=Xi(uc),Kl=Xi(Ul),Vl=uo;(Ol&&Vl(new Ol(new ArrayBuffer(1)))!=$l||xs&&Vl(new xs)!=Bl||jl&&Vl(jl.resolve())!=Ll||uc&&Vl(new uc)!=Nl||Ul&&Vl(new Ul)!=Fl)&&(Vl=function(t){var a=uo(t),o="[object Object]"==a?t.constructor:void 0,c=o?Xi(o):"";if(c)switch(c){case Gl:return $l;case Ql:return Bl;case Dl:return Ll;case Wl:return Nl;case Kl:return Fl}return a});var zl=Vl,Hl="[object Arguments]",Jl="[object Array]",Yl="[object Object]",Xl=Object.prototype.hasOwnProperty;var Zl=function baseIsEqualDeep(t,a,o,c,l,p){var d=Zc(t),h=Zc(a),m=d?Jl:zl(t),v=h?Jl:zl(a),y=(m=m==Hl?Yl:m)==Yl,g=(v=v==Hl?Yl:v)==Yl,b=m==v;if(b&&ml(t)){if(!ml(a))return!1;d=!0,y=!1}if(b&&!y)return p||(p=new Dc),d||Sl(t)?Kc(t,a,o,c,l,p):Yc(t,a,m,o,c,l,p);if(!(1&o)){var C=y&&Xl.call(t,"__wrapped__"),S=g&&Xl.call(a,"__wrapped__");if(C||S){var _=C?t.value():t,M=S?a.value():a;return p||(p=new Dc),l(_,M,o,c,p)}}return!!b&&(p||(p=new Dc),Al(t,a,o,c,l,p))};var eu=function baseIsEqual(t,a,o,c,l){return t===a||(null==t||null==a||!Gi(t)&&!Gi(a)?t!=t&&a!=a:Zl(t,a,o,c,baseIsEqual,l))};var tu=function baseIsMatch(t,a,o,c){var l=o.length,p=l,d=!c;if(null==t)return!p;for(t=Object(t);l--;){var h=o[l];if(d&&h[2]?h[1]!==t[h[0]]:!(h[0]in t))return!1}for(;++l<p;){var m=(h=o[l])[0],v=t[m],y=h[1];if(d&&h[2]){if(void 0===v&&!(m in t))return!1}else{var g=new Dc;if(c)var b=c(v,y,m,t,a,g);if(!(void 0===b?eu(y,v,3,c,g):b))return!1}}return!0};var ru=function isStrictComparable(t){return t==t&&!po(t)};var nu=function getMatchData(t){for(var a=ql(t),o=a.length;o--;){var c=a[o],l=t[c];a[o]=[c,l,ru(l)]}return a};var au=function matchesStrictComparable(t,a){return function(o){return null!=o&&(o[t]===a&&(void 0!==a||t in Object(o)))}};var ou=function baseMatches(t){var a=nu(t);return 1==a.length&&a[0][2]?au(a[0][0],a[0][1]):function(o){return o===t||tu(o,t,a)}};var iu=function isSymbol(t){return"symbol"==typeof t||Gi(t)&&"[object Symbol]"==uo(t)},su=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,cu=/^\w*$/;var lu=function isKey(t,a){if(Zc(t))return!1;var o=typeof t;return!("number"!=o&&"symbol"!=o&&"boolean"!=o&&null!=t&&!iu(t))||(cu.test(t)||!su.test(t)||null!=a&&t in Object(a))};function memoize(t,a){if("function"!=typeof t||null!=a&&"function"!=typeof a)throw new TypeError("Expected a function");var memoized=function(){var o=arguments,c=a?a.apply(this,o):o[0],l=memoized.cache;if(l.has(c))return l.get(c);var p=t.apply(this,o);return memoized.cache=l.set(c,p)||l,p};return memoized.cache=new(memoize.Cache||Os),memoized}memoize.Cache=Os;var uu=memoize;var pu=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,du=/\\(\\)?/g,hu=function memoizeCapped(t){var a=uu(t,(function(t){return 500===o.size&&o.clear(),t})),o=a.cache;return a}((function(t){var a=[];return 46===t.charCodeAt(0)&&a.push(""),t.replace(pu,(function(t,o,c,l){a.push(c?l.replace(du,"$1"):o||t)})),a})),fu=hu,mu=to?to.prototype:void 0,vu=mu?mu.toString:void 0;var yu=function baseToString(t){if("string"==typeof t)return t;if(Zc(t))return Ds(t,baseToString)+"";if(iu(t))return vu?vu.call(t):"";var a=t+"";return"0"==a&&1/t==-Infinity?"-0":a};var gu=function toString(t){return null==t?"":yu(t)};var bu=function castPath(t,a){return Zc(t)?t:lu(t,a)?[t]:fu(gu(t))};var Cu=function toKey(t){if("string"==typeof t||iu(t))return t;var a=t+"";return"0"==a&&1/t==-Infinity?"-0":a};var Su=function baseGet(t,a){for(var o=0,c=(a=bu(a,t)).length;null!=t&&o<c;)t=t[Cu(a[o++])];return o&&o==c?t:void 0};var _u=function get(t,a,o){var c=null==t?void 0:Su(t,a);return void 0===c?o:c};var Mu=function baseHasIn(t,a){return null!=t&&a in Object(t)};var wu=function hasPath(t,a,o){for(var c=-1,l=(a=bu(a,t)).length,p=!1;++c<l;){var d=Cu(a[c]);if(!(p=null!=t&&o(t,d)))break;t=t[d]}return p||++c!=l?p:!!(l=null==t?0:t.length)&&ac(l)&&yl(d,l)&&(Zc(t)||hl(t))};var ku=function hasIn(t,a){return null!=t&&wu(t,a,Mu)};var xu=function baseMatchesProperty(t,a){return lu(t)&&ru(a)?au(Cu(t),a):function(o){var c=_u(o,t);return void 0===c&&c===a?ku(o,t):eu(a,c,3)}};var Iu=function baseProperty(t){return function(a){return null==a?void 0:a[t]}};var Tu=function basePropertyDeep(t){return function(a){return Su(a,t)}};var Ru=function property(t){return lu(t)?Iu(Cu(t)):Tu(t)};var qu=function baseIteratee(t){return"function"==typeof t?t:null==t?Vs:"object"==typeof t?Zc(t)?xu(t[0],t[1]):ou(t):Ru(t)};var Eu=function baseAssignValue(t,a,o){"__proto__"==a&&Xs?Xs(t,a,{configurable:!0,enumerable:!0,value:o,writable:!0}):t[a]=o},Pu=Object.prototype.hasOwnProperty;var Au=function assignValue(t,a,o){var c=t[a];Pu.call(t,a)&&gs(c,o)&&(void 0!==o||a in t)||Eu(t,a,o)};var Ou=function baseSet(t,a,o,c){if(!po(t))return t;for(var l=-1,p=(a=bu(a,t)).length,d=p-1,h=t;null!=h&&++l<p;){var m=Cu(a[l]),v=o;if("__proto__"===m||"constructor"===m||"prototype"===m)return t;if(l!=d){var y=h[m];void 0===(v=c?c(y,m,h):void 0)&&(v=po(y)?y:yl(a[l+1])?[]:{})}Au(h,m,v),h=h[m]}return t};var ju=function basePickBy(t,a,o){for(var c=-1,l=a.length,p={};++c<l;){var d=a[c],h=Su(t,d);o(h,d)&&Ou(p,bu(d,t),h)}return p},Uu=xl(Object.getPrototypeOf,Object),Bu=Object.getOwnPropertySymbols?function(t){for(var a=[];t;)Xc(a,il(t)),t=Uu(t);return a}:rl;var Lu=function nativeKeysIn(t){var a=[];if(null!=t)for(var o in Object(t))a.push(o);return a},Nu=Object.prototype.hasOwnProperty;var Fu=function baseKeysIn(t){if(!po(t))return Lu(t);var a=kl(t),o=[];for(var c in t)("constructor"!=c||!a&&Nu.call(t,c))&&o.push(c);return o};var $u=function keysIn(t){return oc(t)?Ml(t,!0):Fu(t)};var Gu=function getAllKeysIn(t){return el(t,$u,Bu)};var Qu=function pickBy(t,a){if(null==t)return{};var o=Ds(Gu(t),(function(t){return[t]}));return a=qu(a),ju(t,o,(function(t,o){return a(t,o[0])}))},Du=arrayMethodHasSpeciesSupport("splice"),Wu=Math.max,Ku=Math.min,Vu=9007199254740991,zu="Maximum allowed length exceeded";_export({target:"Array",proto:!0,forced:!Du},{splice:function splice(t,a){var o,c,l,p,d,h,m=toObject(this),v=toLength(m.length),y=toAbsoluteIndex(t,v),g=arguments.length;if(0===g?o=c=0:1===g?(o=0,c=v-y):(o=g-2,c=Ku(Wu(toInteger$1(a),0),v-y)),v+o-c>Vu)throw TypeError(zu);for(l=arraySpeciesCreate(m,c),p=0;p<c;p++)(d=y+p)in m&&createProperty(l,p,m[d]);if(l.length=c,o<c){for(p=y;p<v-c;p++)h=p+o,(d=p+c)in m?m[h]=m[d]:delete m[h];for(p=v;p>v-c+o;p--)delete m[p-1]}else if(o>c)for(p=v-c;p>y;p--)h=p+o-1,(d=p+c-1)in m?m[h]=m[d]:delete m[h];for(p=0;p<o;p++)m[p+y]=arguments[p+2];return m.length=v-c+o,l}});var Hu=entryVirtual("Array").splice,Ju=Array.prototype,splice=function(t){var a=t.splice;return t===Ju||t instanceof Array&&a===Ju.splice?Hu:a},Yu=getIteratorMethod$1;function _createForOfIteratorHelper$1(t,a){var o;if(void 0===yr||null==Yu(t)){if(mi(t)||(o=function _unsupportedIterableToArray$1(t,a){var o;if(!t)return;if("string"==typeof t)return _arrayLikeToArray$1(t,a);var c=slice(o=Object.prototype.toString.call(t)).call(o,8,-1);"Object"===c&&t.constructor&&(c=t.constructor.name);if("Map"===c||"Set"===c)return Si(t);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return _arrayLikeToArray$1(t,a)}(t))||a&&t&&"number"==typeof t.length){o&&(t=o);var c=0,l=function F(){};return{s:l,n:function n(){return c>=t.length?{done:!0}:{done:!1,value:t[c++]}},e:function e(t){throw t},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var p,d=!0,h=!1;return{s:function s(){o=gi(t)},n:function n(){var t=o.next();return d=t.done,t},e:function e(t){h=!0,p=t},f:function f(){try{d||null==o.return||o.return()}finally{if(h)throw p}}}}function _arrayLikeToArray$1(t,a){(null==a||a>t.length)&&(a=t.length);for(var o=0,c=new Array(a);o<a;o++)c[o]=t[o];return c}var Xu={timerList:[],id:0,timer:null,timeour:0,addTimer:function addTimer(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,c=(new Date).getTime(),l=Xu.id;return Xu.timerList.push({id:l,loop:o,count:0,timeour:c+a,interval:a,callback:t}),Xu.id++,Xu.checkTimer(c),l},checkTimer:function checkTimer(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(new Date).getTime();if(Xu.removeFinished(),0!==Xu.timerList.length||null==Xu.timer){var a,o=0,c=_createForOfIteratorHelper$1(Xu.timerList);try{for(c.s();!(a=c.n()).done;){var l=a.value;(0===o||o>l.timeour)&&(o=l.timeour)}}catch(t){c.e(t)}finally{c.f()}(null===Xu.timer||o<Xu.timeour||Xu.timeour<t)&&(Xu.timer=Ba(Xu.nowTime,o-t),Xu.timeour=o)}},nowTime:function nowTime(){var t,nowTime=(new Date).getTime(),a=_createForOfIteratorHelper$1(Xu.timerList);try{for(a.s();!(t=a.n()).done;){var o=t.value;nowTime>=o.timeour&&(o.callback(),o.count++,o.timeour=nowTime+o.interval)}}catch(t){a.e(t)}finally{a.f()}Xu.clerTime(),Xu.checkTimer(nowTime)},clerTime:function clerTime(){null!==Xu.timer&&(clearTimeout(Xu.timer),Xu.timer=null)},deleteTimer:function deleteTimer(t){for(var a=Xu.timerList.length-1;a>=0;a--){var o;if(Xu.timerList[a].id===t)splice(o=Xu.timerList).call(o,a,1)}},removeFinished:function removeFinished(){for(var t=Xu.timerList.length-1;t>=0;t--){var a,o=Xu.timerList[t];if(o.loop>=0&&o.count>=o.loop)splice(a=Xu.timerList).call(a,t,1)}},destroy:function destroy(){Xu.clerTime(),Xu.timerList=[],Xu.id=0,Xu.timer=null}},Zu={"6_2":"getNosToken","6_22":"getOriginUrl","6_26":"getNosCdnHost","6_27":"getGrayscaleConfig","6_28":"getMixStorePolicy","6_29":"getMixStoreToken","6_30":"getFileAuthToken"},ep={nosToken:{objectName:1,token:2,bucket:3,expireTime:4,expireSec:7,tag:8,shortUrl:9},mixStoreTokenReqTag:{provider:0,tokenCount:1,fileExpireSec:2,tag:3,returnBody:4},nosConfigTag:{bucket:1,cdnDomain:2,expire:3,objectNamePrefix:4},grayConfigTag:{config:0,ttl:1},mixStorePolicyTag:{providers:0,ttl:1,mixEnable:2,nosPolicy:3,s3Policy:4},mixStoreTokenResTag:{provider:0,accessKeyId:1,secretAccessKey:2,sessionToken:3,token:4,expireTime:5,bucket:6,objectName:7,fileExpireSec:8,tag:9,shortUrl:10,region:11},nosSafeUrlTag:{safeUrl:0,originUrl:1},mixStoreAuthTokenReqTag:{type:1,urls:2},mixStoreAuthTokenResTag:{type:1,tokens:2,token:3,ttl:4}},tp=invertSerializeMap(ep),rp=ep,np={getNosToken:{sid:6,cid:2,service:"cloudStorage",response:[{type:"Property",name:"nosToken",reflectMapper:tp.nosToken}],params:[{type:"String",name:"responseBody"},{type:"Property",name:"nosToken",entity:"nosToken",reflectMapper:rp.nosToken}]},getOriginUrl:{sid:6,cid:22,service:"cloudStorage",response:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:tp.nosSafeUrlTag}],params:[{type:"Property",name:"nosSafeUrlTag",reflectMapper:rp.nosSafeUrlTag}]},getNosCdnHost:{sid:6,cid:26,service:"misc",response:[{type:"Property",name:"nosConfigTag",reflectMapper:tp.nosConfigTag}]},getGrayscaleConfig:{sid:6,cid:27,service:"cloudStorage",response:[{type:"Property",name:"grayConfigTag",reflectMapper:tp.grayConfigTag}],params:[{type:"Property",name:"config"}]},getMixStorePolicy:{sid:6,cid:28,service:"cloudStorage",params:[{type:"LongArray",name:"supportType"}],response:[{type:"Property",name:"mixStorePolicyTag",reflectMapper:tp.mixStorePolicyTag}]},getMixStoreToken:{sid:6,cid:29,service:"cloudStorage",params:[{type:"Property",name:"mixStoreTokenReqTag",reflectMapper:rp.mixStoreTokenReqTag}],response:[{type:"Property",name:"mixStoreTokenResTag",reflectMapper:tp.mixStoreTokenResTag}]},getFileAuthToken:{sid:6,cid:30,service:"cloudStorage",params:[{type:"Property",name:"mixStoreAuthTokenReqTag",reflectMapper:rp.mixStoreAuthTokenReqTag}],response:[{type:"Property",name:"mixStoreAuthTokenResTag",reflectMapper:tp.mixStoreAuthTokenResTag}]}};function _createSuper$7(t){var a=function _isNativeReflectConstruct$7(){if("undefined"==typeof Reflect||!le)return!1;if(le.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(le(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,c=qe(t);if(a){var l=qe(this).constructor;o=le(c,arguments,l)}else o=c.apply(this,arguments);return Kr(this,o)}}var ap,op,ip={file:{md5:"$(Etag)",size:"$(ObjectSize)"},image:{md5:"$(Etag)",size:"$(ObjectSize)",w:"$(ImageInfo.Width)",h:"$(ImageInfo.Height)",orientation:"$(ImageInfo.Orientation)"},audio:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Audio.Duration)"},video:{md5:"$(Etag)",size:"$(ObjectSize)",dur:"$(AVinfo.Video.Duration)",w:"$(AVinfo.Video.Width)",h:"$(AVinfo.Video.Height)"}};function getUploadResponseFormat(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"file",a=ip[t]||{};return Da(a).replace(/"/gi,'\\"')}!function(t){t[t.nos=1]="nos",t[t.s3=2]="s3"}(ap||(ap={})),function(t){t[t.dontNeed=-1]="dontNeed",t[t.time=2]="time",t[t.urls=3]="urls"}(op||(op={}));var sp=function(t){Ne(CloudStorageService,t);var a=_createSuper$7(CloudStorageService);function CloudStorageService(t,o){var c;return ue(this,CloudStorageService),(c=a.call(this)).GRAYKEY="AllGrayscaleConfig",c.MIXSTOREKEY="AllMixStorePolicy",c.nosCdnHostTimer=0,c.grayConfig={mixStoreEnable:!1,timeStamp:0,ttl:0},c.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},c.curProvider=ap.nos,c.s3=null,c.mixStoreToken={accessKeyId:"",secretAccessKey:"",sessionToken:"",region:"",maxRetries:0,bucket:"",objectName:"",token:"",shortUrl:""},c.mixStoreErrorCount=10,c.nosErrorCount=0,c.circuitTimer=0,c.name="cloudStorage",c.GRAYKEY=o+"-AllGrayscaleConfig",c.MIXSTOREKEY=o+"-AllMixStorePolicy",c.logger=t.logger,c.core=t,c.core.on("disconnect",(function(){Xu.destroy()})),c.core.on("willReconnect",(function(){Xu.destroy()})),c.core.on("kicked",(function(){Xu.destroy()})),registerParser({cmdMap:Zu,cmdConfig:np}),c}return he(CloudStorageService,[{key:"init",value:function init(){return __awaiter(this,void 0,void 0,zr.mark((function _callee(){return zr.wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:return this.grayConfig=null,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},this.curProvider=ap.nos,this.mixStoreErrorCount=10,t.next=6,this._getGrayscaleConfig(this.core.options.appkey);case 6:return t.next=8,this._getNosCdnHost();case 8:case"end":return t.stop()}}),_callee,this)})))}},{key:"uploadFile",value:function uploadFile(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee2(){var a,o;return zr.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:if(validate({maxSize:{type:"number",required:!1},type:{type:"enum",values:["file","image","audio","video"]}},t),t.fileInput||t.file||t.filePath){c.next=3;break}throw new Error("uploadFile needs target file object or a filePath");case 3:if(this.grayConfig&&this.grayConfig.mixStoreEnable&&this.mixStorePolicy.providers.length){c.next=6;break}return this.logger.log("uploadFile:: uploadFile begin, use old nos"),c.abrupt("return",this.nosUpload(t));case 6:return this.logger.log(concat(a="uploadFile:: uploadFile begin,Current settings grayConfig:".concat(this.grayConfig," mixStoreEnable:")).call(a,this.grayConfig.mixStoreEnable," curProvider:this.curProvider")),c.prev=7,c.next=10,this.core.sendCmd("getMixStoreToken",{mixStoreTokenReqTag:{provider:this.curProvider,tokenCount:1,tag:"qchat",returnBody:getUploadResponseFormat(t.type)}});case 10:o=c.sent,this.mixStoreToken=o.content.mixStoreTokenResTag,c.next=18;break;case 14:throw c.prev=14,c.t0=c.catch(7),this.core.logger.error("uploadFile:: getMixStoreToken error",c.t0),new ei("getMixStoreToken error",c.t0,this.curProvider,this.mixStorePolicy);case 18:return this.s3||(this.curProvider=ap.nos),c.abrupt("return",this.curProvider===ap.s3?this.s3Upload(t):this.nosUpload(t,this.mixStoreToken));case 20:case"end":return c.stop()}}),_callee2,this,[[7,14]])})))}},{key:"nosUpload",value:function nosUpload(t,a){var o,c;return __awaiter(this,void 0,void 0,zr.mark((function _callee3(){var l,p,d,h,m,v,y,g,b,C,S,_,M,w;return zr.wrap((function _callee3$(k){for(;;)switch(k.prev=k.next){case 0:if(l=_u(this.core,"config.cdn.bucket"),p={tag:t.nosScenes||l||"nim",expireSec:t.nosSurvivalTime},a){k.next=13;break}return k.prev=3,k.next=6,this.core.sendCmd("getNosToken",{responseBody:getUploadResponseFormat(t.type),nosToken:p});case 6:d=k.sent,k.next=13;break;case 9:throw k.prev=9,k.t0=k.catch(3),this.core.logger.error("uploadFile:: getNosToken error",k.t0),new ei("getNosToken error",k.t0,1);case 13:return k.prev=13,m=d?d.content.nosToken:a,this.core.logger.debug("uploadFile:: uploadFile params",{nosToken:m,chunkUploadHost:this.core.config.chunkUploadHost,commonUploadHost:this.core.config.commonUploadHost,platform:oi.platform}),k.next=18,oi.uploadFile(ma(ma({},t),{nosToken:m,chunkUploadHost:this.core.config.chunkUploadHost,commonUploadHost:this.core.config.commonUploadHost,maxSize:t.maxSize||this.core.config.chunkMaxSize}));case 18:h=k.sent,k.next=42;break;case 21:if(k.prev=21,k.t1=k.catch(13),this.core.logger.error("uploadFile::nos uploadFile error",k.t1),!a){k.next=41;break}if(0!==this.nosErrorCount){k.next=37;break}k.prev=26,this._addCircuitTimer(),k.next=33;break;case 30:throw k.prev=30,k.t2=k.catch(26),new ei("upload file error",k.t2,this.curProvider,this.mixStorePolicy,t.file||t.filePath);case 33:return this.nosErrorCount=null===(o=this.mixStorePolicy.nosPolicy)||void 0===o?void 0:o.uploadConfig.retryPolicy.retry,k.abrupt("return",this.uploadFile(t));case 37:return this.nosErrorCount--,k.abrupt("return",this.nosUpload(t,a));case 39:k.next=42;break;case 41:throw new ei("nos uploadFile error",k.t1,1);case 42:if(v=null==h?void 0:h.type,y=v&&indexOf(v).call(v,"/")>-1?slice(v).call(v,0,indexOf(v).call(v,"/")):"",g={image:"imageInfo",video:"vinfo",audio:"vinfo"},b=this.core.config.uploadReplaceFormat.replace("{host}",this.core.config.cdn.cdnDomain||this.core.config.cdn.defaultCdnDomain).replace("{object}",d?d.content.nosToken.objectName:null==a?void 0:a.objectName),a&&a.shortUrl&&(b=a.shortUrl),g[y]){k.next=49;break}return k.abrupt("return",ma({url:b},h));case 49:if(k.prev=49,!(indexOf(b).call(b,"_im_url=1")<0)){k.next=54;break}return k.next=53,oi.request(concat(S="".concat(b,"?")).call(S,g[y]),{method:"GET",dataType:"json",timeout:5e3});case 53:C=k.sent;case 54:k.next=60;break;case 56:return k.prev=56,k.t3=k.catch(49),this.core.logger.error("uploadFile:: fetch file info error",k.t3),k.abrupt("return",ma({url:b},h));case 60:if(!C){k.next=67;break}return _=C.data,M="imageInfo"===g[y]?_:null===(c=null==_?void 0:_.GetVideoInfo)||void 0===c?void 0:c.VideoInfo,w={url:b,name:h.name,size:h.size,ext:h.ext,w:M.Width,h:M.Height,orientation:M.Orientation,dur:M.Duration,audioCodec:M.AudioCodec,videoCodec:M.VideoCodec,container:M.Container},k.abrupt("return",Qu(w,(function(t,a){return void 0!==a})));case 67:return k.abrupt("return",ma({url:b},h));case 68:case"end":return k.stop()}}),_callee3,this,[[3,9],[13,21],[26,30],[49,56]])})))}},{key:"_getNosCdnHost",value:function _getNosCdnHost(){var t;return __awaiter(this,void 0,void 0,zr.mark((function _callee4(){var a,o,c,l=this;return zr.wrap((function _callee4$(p){for(;;)switch(p.prev=p.next){case 0:return p.prev=0,p.next=3,this.core.sendCmd("getNosCdnHost");case 3:a=p.sent,p.next=10;break;case 6:return p.prev=6,p.t0=p.catch(0),this.logger.error("getNosCdnHost::error",p.t0),p.abrupt("return");case 10:if(a){p.next=12;break}return p.abrupt("return");case 12:o=null===(t=null==a?void 0:a.content)||void 0===t?void 0:t.nosConfigTag,0!==(c=Oc(null==o?void 0:o.expire))&&o.cdnDomain?-1===c?(this.core.config.cdn.bucket=o.bucket,this.core.config.cdn.cdnDomain=o.cdnDomain,this.core.config.cdn.objectNamePrefix=o.objectNamePrefix):(this.core.config.cdn.bucket=o.bucket,this.core.config.cdn.cdnDomain=o.cdnDomain,this.core.config.cdn.objectNamePrefix=o.objectNamePrefix,this.nosCdnHostTimer=Xu.addTimer((function(){l._getNosCdnHost()}),1e3*c)):(this.core.config.cdn.bucket="",this.core.config.cdn.cdnDomain="",this.core.config.cdn.objectNamePrefix="");case 15:case"end":return p.stop()}}),_callee4,this,[[0,6]])})))}},{key:"_getGrayscaleConfig",value:function _getGrayscaleConfig(t){var a;return __awaiter(this,void 0,void 0,zr.mark((function _callee5(){var o,c;return zr.wrap((function _callee5$(l){for(;;)switch(l.prev=l.next){case 0:if(oi.localStorage)try{oi.localStorage.getItem&&oi.localStorage.getItem(this.GRAYKEY)&&(this.grayConfig=JSON.parse(oi.localStorage.getItem(this.GRAYKEY))[t])}catch(t){oi.localStorage.getItem(this.GRAYKEY)&&this.core.logger.error("uploadFile:: JSON.parse grayscaleConfig error ",t)}if(this.grayConfig&&!(this.grayConfig.timeStamp+1e3*this.grayConfig.ttl<(new Date).getTime())){l.next=17;break}return l.next=4,this.core.sendCmd("getGrayscaleConfig",{config:{}});case 4:if(!(o=l.sent).content||!o.content.grayConfigTag){l.next=16;break}this.logger.log("uploadFile::getAppGrayConfigRequest success ");try{this.grayConfig=JSON.parse(o.content.grayConfigTag.config),this.grayConfig.ttl=JSON.parse(o.content.grayConfigTag.ttl)}catch(t){this.logger.error("getGrayscaleConfig error",t)}if(this.grayConfig){l.next=10;break}return l.abrupt("return");case 10:c=oi.localStorage.getItem(this.GRAYKEY)?JSON.parse(oi.localStorage.getItem(this.GRAYKEY)):{},this.grayConfig.timeStamp=(new Date).getTime(),c[t]=this.grayConfig,oi.localStorage.setItem(this.GRAYKEY,Da(c)),l.next=17;break;case 16:this.logger.debug("uploadFile:: result grayConfig:",o.content);case 17:if(!(null===(a=this.grayConfig)||void 0===a?void 0:a.mixStoreEnable)){l.next=20;break}return l.next=20,this._getMixStorePolicy(t);case 20:case"end":return l.stop()}}),_callee5,this)})))}},{key:"_getMixStorePolicy",value:function _getMixStorePolicy(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee6(){var a,o,c,l,p,d,h;return zr.wrap((function _callee6$(m){for(;;)switch(m.prev=m.next){case 0:if(a=(new Date).getTime(),oi.localStorage)try{this.mixStorePolicy=JSON.parse(oi.localStorage.getItem(this.MIXSTOREKEY))[t],this.curProvider=Oc(this.mixStorePolicy.providers[0]),this.mixStorePolicy.timeStamp&&this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl>a&&(c=this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl-a,Xu.addTimer(bind(o=this._getMixStorePolicy).call(o,this,t),c))}catch(a){oi.localStorage.getItem(this.MIXSTOREKEY)&&JSON.parse(oi.localStorage.getItem(this.MIXSTOREKEY))[t]&&this.core.logger.error("uploadFile:: JSON.parse mixStorePolicy error ",a)}if(this.mixStorePolicy&&!(this.mixStorePolicy.timeStamp+1e3*this.mixStorePolicy.ttl<=a)){m.next=30;break}return m.prev=3,m.next=6,this.core.sendCmd("getMixStorePolicy",{supportType:this.s3?[1,2]:[1]});case 6:p=m.sent,d=p.content.mixStorePolicyTag,this.mixStorePolicy={providers:[],timeStamp:0,ttl:0,s3Policy:null,nosPolicy:null},this.mixStorePolicy.ttl=Number(d.ttl),this.mixStorePolicy.providers=d.providers.split(","),this.circuitTimer&&Xu.deleteTimer(this.circuitTimer),this.curProvider=Oc(this.mixStorePolicy.providers[0]),this.mixStorePolicy.nosPolicy=d.nosPolicy?JSON.parse(d.nosPolicy):null,this.mixStorePolicy.s3Policy=d.s3Policy?JSON.parse(d.s3Policy):null,null===this.mixStorePolicy.s3Policy?this.mixStorePolicy.providers=["1"]:null===this.mixStorePolicy.nosPolicy?this.mixStorePolicy.providers=["2"]:this.mixStorePolicy.providers=this.mixStorePolicy.s3Policy.priority<this.mixStorePolicy.nosPolicy.priority?["2","1"]:["1","2"],Xu.addTimer(bind(l=this._getMixStorePolicy).call(l,this,t),1e3*this.mixStorePolicy.ttl),h=oi.localStorage.getItem(this.MIXSTOREKEY)?JSON.parse(oi.localStorage.getItem(this.MIXSTOREKEY)):{},this.mixStorePolicy.timeStamp=(new Date).getTime(),h[t]=this.mixStorePolicy,oi.localStorage.setItem(this.MIXSTOREKEY,Da(h)),m.next=30;break;case 23:if(m.prev=23,m.t0=m.catch(3),this.logger.error("getMixStorePolicy error",m.t0),0!==this.mixStoreErrorCount){m.next=28;break}throw new Error("getMixStorePolicy all count error");case 28:this._getMixStorePolicy(t),this.mixStoreErrorCount--;case 30:this.mixStorePolicy.nosPolicy&&(this.nosErrorCount=this.mixStorePolicy.nosPolicy.uploadConfig.retryPolicy.retry);case 31:case"end":return m.stop()}}),_callee6,this,[[3,23]])})))}},{key:"s3Upload",value:function s3Upload(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee7(){var a,o,c,l,p,d,h,m,v,y,g=this;return zr.wrap((function _callee7$(b){for(;;)switch(b.prev=b.next){case 0:if(!t.file){b.next=4;break}a=t.file,b.next=19;break;case 4:if("string"!=typeof t.fileInput){b.next=14;break}if(this.logger.warn("fileInput will abandon,Please use file or filepath"),!((o=document.getElementById(t.fileInput))&&o.files&&o.files[0])){b.next=11;break}a=o.files[0],b.next=12;break;case 11:throw new Error("Can not get file from fileInput");case 12:b.next=19;break;case 14:if(!(t.fileInput&&t.fileInput.files&&t.fileInput.files[0])){b.next=18;break}a=t.fileInput.files[0],b.next=19;break;case 18:throw new Error("Can not get file from fileInput ".concat(t.fileInput));case 19:if(this.mixStorePolicy.s3Policy){b.next=21;break}throw new Error("dont get s3 policy");case 21:return c={accessKeyId:this.mixStoreToken.accessKeyId,secretAccessKey:this.mixStoreToken.secretAccessKey,sessionToken:this.mixStoreToken.sessionToken,region:this.mixStoreToken.region,maxRetries:this.mixStorePolicy.s3Policy.uploadConfig.retryPolicy.retry},l=this.s3,(p=new l).config.update(c),d=decodeURIComponent(this.mixStoreToken.bucket),h=decodeURIComponent(this.mixStoreToken.objectName),v={Bucket:d,Key:h,Body:m=a,Metadata:{token:this.mixStoreToken.token},ContentType:m.type||"application/octet-stream"},this.core.logger.debug("uploadFile:: s3 upload params:",v),y=p.upload(v),b.abrupt("return",new pa((function(a){y.send((function(o,c){if(o){g.logger.error("uploadFile:","api::s3:upload file failed",o);try{g._addCircuitTimer()}catch(o){throw new ei("upload file error",o,g.curProvider,g.mixStorePolicy,t.file||t.filePath)}a(g.uploadFile(t))}else{var l=g.mixStorePolicy.s3Policy.cdnSchema;l=(l=l.replace("{cdnDomain}",g.mixStorePolicy.s3Policy.dlcdn)).replace("{objectName}",c.Key),a({size:m.size,name:m.name,url:g.mixStoreToken.shortUrl?g.mixStoreToken.shortUrl:l,ext:m.name.split(".")[1]||"unknown"})}}))})));case 32:case"end":return b.stop()}}),_callee7,this)})))}},{key:"getPrivateUrl",value:function getPrivateUrl(t){var a;if(!new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- ./?%&=]*)?/).test(t))return this.logger.error("illegal file url:"+t),"";var o=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(t),c=ki(o,8);c[0];var l=c[1];c[2];var p=c[3];c[4];var d=c[5];if(c[6],c[7],null===(a=this.grayConfig)||void 0===a?void 0:a.mixStoreEnable){var h=this._getUrlType(t);return h===ap.s3&&this.mixStorePolicy.s3Policy&&(t=this.mixStorePolicy.s3Policy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.s3Policy.dlcdn).replace("{objectName}",d)),h===ap.nos&&this.mixStorePolicy.nosPolicy&&(t=this.mixStorePolicy.nosPolicy.cdnSchema.replace("{cdnDomain}",this.mixStorePolicy.nosPolicy.dlcdn).replace("{objectName}",d)),t}var m,v,y=this.core.config,g=y.downloadUrl,b=y.downloadHostList,C=y.nosCdnEnable,S=this.core.config.cdn.cdnDomain,_=this.core.config.cdn.objectNamePrefix?decodeURIComponent(this.core.config.cdn.objectNamePrefix):"",M=decodeURIComponent(d),w=indexOf(M).call(M,_);if(S&&w>-1&&C)return concat(m=concat(v="".concat(l)).call(v,S,"/")).call(m,slice(M).call(M,w));if(includes(b).call(b,p)&&includes(d).call(d,"/")){var k=indexOf(d).call(d,"/"),x=d.substring(0,k),I=d.substring(k+1);return g.replace("{bucket}",x).replace("{object}",I)}var T=filter(b).call(b,(function(t){return"string"==typeof p&&includes(p).call(p,t)}))[0],R=T?p.replace(T,"").replace(/\W/g,""):null;return R?g.replace("{bucket}",R).replace("{object}",d):t}},{key:"getOriginUrl",value:function getOriginUrl(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee8(){var a;return zr.wrap((function _callee8$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.core.sendCmd("getOriginUrl",{nosSafeUrlTag:{safeUrl:t}});case 2:return a=o.sent,o.abrupt("return",a.content.nosSafeUrlTag.originUrl);case 4:case"end":return o.stop()}}),_callee8,this)})))}},{key:"getFileToken",value:function getFileToken(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee9(){var a,o,c,l,p,d=this;return zr.wrap((function _callee9$(h){for(;;)switch(h.prev=h.next){case 0:if(validate({type:{type:"number",min:2,max:3},urls:{type:"array",required:!1,itemType:"string"}},t),a=this.mixStorePolicy.nosPolicy?this.mixStorePolicy.nosPolicy.authPolicy.policyType:null,o=this.mixStorePolicy.s3Policy?this.mixStorePolicy.s3Policy.authPolicy.policyType:null,a!==String(op.dontNeed)||o!==String(op.dontNeed)){h.next=8;break}throw this.logger.error("don't need token"),new Error("don't need token");case 8:if(t.type!==op.time){h.next=17;break}if(!(a&&indexOf(a).call(a,String(op.time))>=0||o&&indexOf(o).call(o,String(op.time))>0)){h.next=13;break}return h.abrupt("return",this.getFileAuthToken(t));case 13:throw this.logger.error("don't support time token "),new Error("don't support type time token ");case 15:h.next=33;break;case 17:if(t.urls&&t.urls.length){h.next=20;break}throw this.logger.error("urls is required when urls token"),new Error("urls is required when urls token");case 20:if(l=[],p=[],forEach(c=t.urls).call(c,(function(t){var a=d._getUrlType(t);a===ap.nos&&p.push(t),a===ap.s3&&l.push(t)})),(!o||0!==l.length&&indexOf(o).call(o,String(op.urls))<0)&&(this.logger.warn("s3 url don't support url token"),l=[]),(!a||0!==p.length&&indexOf(a).call(a,String(op.urls))<0)&&(this.logger.warn("nos url don't support url token"),p=[]),0!==l.length||0!==p.length){h.next=30;break}throw this.logger.error("not support urls"),new Error("not support urls");case 30:if(0!==l.length&&0!==p.length){h.next=33;break}return t.urls=Da(t.urls),h.abrupt("return",this.getFileAuthToken(t));case 33:case"end":return h.stop()}}),_callee9,this)})))}},{key:"getFileAuthToken",value:function getFileAuthToken(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee10(){var a;return zr.wrap((function _callee10$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.core.sendCmd("getFileAuthToken",{mixStoreAuthTokenReqTag:t});case 2:return a=o.sent,o.abrupt("return",a.content.mixStoreAuthTokenResTag);case 4:case"end":return o.stop()}}),_callee10,this)})))}},{key:"_getUrlType",value:function _getUrlType(t){var a,o;return this.mixStorePolicy.nosPolicy&&some(a=this.mixStorePolicy.nosPolicy.dlcdns).call(a,(function(a){return indexOf(t).call(t,a)>=0}))?ap.nos:this.mixStorePolicy.s3Policy&&some(o=this.mixStorePolicy.s3Policy.dlcdns).call(o,(function(a){return indexOf(t).call(t,a)>=0}))?ap.s3:null}},{key:"_addCircuitTimer",value:function _addCircuitTimer(){var t=this,a=this.mixStorePolicy.providers,o=a[(indexOf(a).call(a,String(this.curProvider))+1)%a.length];if(o===a[0])throw new Error("uploadFile all policy fail");var c,l=_u(this.mixStorePolicy,"s3Policy.uploadConfig.retryPolicy");if(l&&l.retryNext&&o&&(this.logger.log(concat(c="uploadFile:: upload policy will change,now policy:".concat(this.curProvider," nextProvider:")).call(c,o)),this.curProvider=Oc(o),this.mixStorePolicy.nosPolicy&&this.mixStorePolicy.s3Policy)){var p=this.mixStorePolicy[this.curProvider===ap.nos?"nosPolicy":"s3Policy"].uploadConfig.retryPolicy.circuit;if(!p||0===p)return;this.circuitTimer=Xu.addTimer((function(){var a;t.logger.log(concat(a="uploadFile:: upload policy will change,now policy:".concat(t.curProvider," nextProvider:")).call(a,Oc(t.mixStorePolicy.providers[0]))),t.curProvider=Oc(t.mixStorePolicy.providers[0]),Xu.deleteTimer(t.circuitTimer)}),1e3*p)}}},{key:"setS3",value:function setS3(t){this.s3=t}},{key:"process",value:function process(t){var a=this[t.cmd+"Handler"];return"function"==typeof a?(a.call(this,t),pa.resolve(t)):t.error&&!t.error.ignore?pa.reject(t.error):pa.resolve(t)}}]),CloudStorageService}(Ja),cp=[],lp=cp.sort,up=fails((function(){cp.sort(void 0)})),pp=fails((function(){cp.sort(null)})),dp=arrayMethodIsStrict("sort");_export({target:"Array",proto:!0,forced:up||!pp||!dp},{sort:function sort(t){return void 0===t?lp.call(toObject(this)):lp.call(toObject(this),aFunction$1(t))}});var hp=entryVirtual("Array").sort,fp=Array.prototype,sort=function(t){var a=t.sort;return t===fp||t instanceof Array&&a===fp.sort?hp:a},mp=[].reverse,vp=[1,2];_export({target:"Array",proto:!0,forced:String(vp)===String(vp.reverse())},{reverse:function reverse(){return Fe(this)&&(this.length=this.length),mp.call(this)}});var yp,gp,bp,Cp=entryVirtual("Array").reverse,Sp=Array.prototype,reverse=function(t){var a=t.reverse;return t===Sp||t instanceof Array&&a===Sp.reverse?Cp:a};!function(t){t[t.ASC=1]="ASC",t[t.DESC=2]="DESC"}(yp||(yp={})),function(t){t[t.reorderWeight=0]="reorderWeight",t[t.createTime=1]="createTime",t[t.totalMember=2]="totalMember"}(gp||(gp={})),function(t){t[t.square=1]="square",t[t.person=2]="person"}(bp||(bp={}));var _p=function(){function Service(t,a){ue(this,Service),this.name=t,this.core=a,this.name=t,this.logger=a.logger,this.core=a}return he(Service,[{key:"process",value:function process(t){var a=this[t.cmd+"Handler"];return"function"==typeof a?a.call(this,t):t.error&&!t.error.ignore?pa.reject(t.error):pa.resolve(t)}}]),Service}(),Mp={"24_15":"qchatSubscribe","24_27":"qchatGetUnreadInfo","24_48":"qchatCreateChannel","24_49":"qchatDeleteChannel","24_50":"qchatUpdateChannel","24_51":"qchatGetChannels","24_52":"qchatGetChannelsByPage","24_53":"qchatGetMembersByPage","24_54":"qchatUpdateWhiteBlackRole","24_55":"qchatGetWhiteBlackRolesPage","24_56":"qchatUpdateWhiteBlackMembers","24_57":"qchatGetWhiteBlackMembersPage","24_58":"qchatGetExistingWhiteBlackRoles","24_59":"qchatGetExistingWhiteBlackMembers","24_60":"qchatUpdateCategoryInfoOfChannel","24_109":"qchatCreateChannelCategory","24_110":"qchatRemoveChannelCategory","24_111":"qchatUpdateChannelCategory","24_112":"qchatGetChannelCategoriesByID","24_113":"qchatUpdateChannelCategoryWhiteBlackRole","24_114":"qchatGetChannelCategoryWhiteBlackRolesPage","24_115":"qchatUpdateChannelCategoryWhiteBlackMembers","24_116":"qchatGetChannelCategoryWhiteBlackMembersPage","24_117":"qchatGetChannelCategoryWhiteBlackRoles","24_118":"qchatGetChannelCategoryWhiteBlackMembers","24_119":"qchatGetChannelCategoriesPage","24_120":"qchatGetChannelCategoryChannelsPage","24_93":"qchatGetChannelSearchByPage"},wp={serverId:1,channelId:2,ackTimestamp:3,unreadCount:4,mentionedCount:5,maxCount:6,lastMsgTime:7},kp={channelInfo:{channelId:1,serverId:2,name:4,topic:5,ext:6,type:7,validFlag:8,createTime:9,updateTime:10,owner:11,viewMode:12,categoryId:13,syncMode:14,reorderWeight:15},antispamTag:{antiSpamBusinessId:1},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},serverRole:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,type:7,memberCount:8,priority:9,createTime:10,updateTime:11},qchatSubReqTag:{type:1,opeType:2},qchatChannelIdInfoTag:{serverId:1,channelId:2},unreadInfo:wp,qchatGetChannelListPageTag:{serverId:1,timetag:2,limit:3},qchatGetMembersByPageTag:{serverId:1,channelId:2,timetag:3,limit:4},qchatUpdateWhiteBlackRoleTag:{serverId:1,channelId:2,type:3,opeType:4,roleId:5},qchatGetWhiteBlackRolesPageTag:{serverId:1,channelId:2,type:3,timetag:4,limit:5},qchatUpdateWhiteBlackMembersTag:{serverId:1,channelId:2,type:3,opeType:4,toAccids:5},qchatGetWhiteBlackMembersPageTag:{serverId:1,channelId:2,type:3,timetag:4,limit:5},qchatGetExistingWhiteBlackRolesTag:{serverId:1,channelId:2,type:3,roleIds:4},qchatGetExistingWhiteBlackMembersTag:{serverId:1,channelId:2,type:3,accids:4},QChatChannelCategoryInfo:{categoryId:1,serverId:2,name:4,ext:5,owner:6,viewMode:7,validFlag:8,createTime:9,updateTime:10,channelNumber:11},qchatUpdateChannelCategoryWhiteBlackRoleTag:{serverId:1,categoryId:2,type:3,opeType:4,roleId:5},qchatGetChannelCategoryWhiteBlackRolesPageTag:{serverId:1,categoryId:2,type:3,timetag:4,limit:5},qchatUpdateChannelCategoryWhiteBlackMembersTag:{serverId:1,categoryId:2,type:3,opeType:4,toAccids:5},qchatGetChannelCategoryWhiteBlackMembersPageTag:{serverId:1,categoryId:2,type:3,timetag:4,limit:5},qchatGetChannelCategoryWhiteBlackRolesTag:{serverId:1,categoryId:2,type:3,roleIds:4},qchatGetChannelCategoryWhiteBlackMembersTag:{serverId:1,categoryId:2,type:3,accids:4},qchatGetChannelCategoriesPageTag:{serverId:1,timetag:2,limit:3},qchatGetChannelCategoryChannelsPageTag:{serverId:1,categoryId:2,timetag:3,limit:4},qchatGetChannelSearchByPageTag:{keyword:1,startTime:2,endTime:3,order:4,limit:5,serverId:6,sort:7,cursor:8},qchatUpdateChannelTag:{channelId:1,name:4,topic:5,ext:6,viewMode:12}},xp=invertSerializeMap(kp),Ip={qchatCreateChannel:{sid:24,cid:48,service:"qchatChannel",params:[{type:"Property",name:"channelInfo",reflectMapper:kp.channelInfo},{type:"Property",name:"antispamTag",reflectMapper:kp.antispamTag}],response:[{type:"Property",name:"channelInfo",reflectMapper:xp.channelInfo}]},qchatDeleteChannel:{sid:24,cid:49,service:"qchatChannel",params:[{type:"Long",name:"channelId"}]},qchatUpdateChannel:{sid:24,cid:50,service:"qchatChannel",params:[{type:"Property",name:"channelInfo",reflectMapper:kp.qchatUpdateChannelTag},{type:"Property",name:"antispamTag",reflectMapper:kp.antispamTag}],response:[{type:"Property",name:"channelInfo",reflectMapper:xp.channelInfo}]},qchatGetChannels:{sid:24,cid:51,service:"qchatChannel",params:[{type:"LongArray",name:"channelIds"}],response:[{type:"PropertyArray",name:"channelList",reflectMapper:xp.channelInfo}]},qchatGetChannelsByPage:{sid:24,cid:52,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelListPageTag",reflectMapper:kp.qchatGetChannelListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:xp.channelInfo}]},qchatGetMembersByPage:{sid:24,cid:53,service:"qchatChannel",params:[{type:"Property",name:"qchatGetMembersByPageTag",reflectMapper:kp.qchatGetMembersByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:xp.memberInfo}]},qchatUpdateWhiteBlackRole:{sid:24,cid:54,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateWhiteBlackRoleTag",reflectMapper:kp.qchatUpdateWhiteBlackRoleTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:xp.memberInfo}]},qchatGetWhiteBlackRolesPage:{sid:24,cid:55,service:"qchatChannel",params:[{type:"Property",name:"qchatGetWhiteBlackRolesPageTag",reflectMapper:kp.qchatGetWhiteBlackRolesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:xp.serverRole}]},qchatUpdateWhiteBlackMembers:{sid:24,cid:56,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateWhiteBlackMembersTag",reflectMapper:kp.qchatUpdateWhiteBlackMembersTag}]},qchatGetWhiteBlackMembersPage:{sid:24,cid:57,service:"qchatChannel",params:[{type:"Property",name:"qchatGetWhiteBlackMembersPageTag",reflectMapper:kp.qchatGetWhiteBlackMembersPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:xp.memberInfo}]},qchatGetExistingWhiteBlackRoles:{sid:24,cid:58,service:"qchatChannel",params:[{type:"Property",name:"qchatGetExistingWhiteBlackRolesTag",reflectMapper:kp.qchatGetExistingWhiteBlackRolesTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:xp.serverRole}]},qchatGetExistingWhiteBlackMembers:{sid:24,cid:59,service:"qchatChannel",params:[{type:"Property",name:"qchatGetExistingWhiteBlackMembersTag",reflectMapper:kp.qchatGetExistingWhiteBlackMembersTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:xp.memberInfo}]},qchatUpdateCategoryInfoOfChannel:{sid:24,cid:60,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateCategoryInfoOfChannelTag",reflectMapper:kp.channelInfo}],response:[{type:"Property",name:"channelInfo",reflectMapper:xp.channelInfo}]},qchatCreateChannelCategory:{sid:24,cid:109,service:"qchatChannel",params:[{type:"Property",name:"qchatCreateChannelCategoryTag",reflectMapper:kp.QChatChannelCategoryInfo}],response:[{type:"Property",name:"QChatChannelCategoryInfo",reflectMapper:xp.QChatChannelCategoryInfo}]},qchatRemoveChannelCategory:{sid:24,cid:110,service:"qchatChannel",params:[{type:"Long",name:"categoryId"}]},qchatUpdateChannelCategory:{sid:24,cid:111,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryTag",reflectMapper:kp.QChatChannelCategoryInfo}],response:[{type:"Property",name:"QChatChannelCategoryInfo",reflectMapper:xp.QChatChannelCategoryInfo}]},qchatGetChannelCategoriesByID:{sid:24,cid:112,service:"qchatChannel",params:[{type:"LongArray",name:"categoryIds"}],response:[{type:"PropertyArray",name:"channelCategoryList",reflectMapper:xp.QChatChannelCategoryInfo}]},qchatUpdateChannelCategoryWhiteBlackRole:{sid:24,cid:113,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryWhiteBlackRoleTag",reflectMapper:kp.qchatUpdateChannelCategoryWhiteBlackRoleTag}]},qchatGetChannelCategoryWhiteBlackRolesPage:{sid:24,cid:114,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackRolesPageTag",reflectMapper:kp.qchatGetChannelCategoryWhiteBlackRolesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:xp.serverRole}]},qchatUpdateChannelCategoryWhiteBlackMembers:{sid:24,cid:115,service:"qchatChannel",params:[{type:"Property",name:"qchatUpdateChannelCategoryWhiteBlackMembersTag",reflectMapper:kp.qchatUpdateChannelCategoryWhiteBlackMembersTag}]},qchatGetChannelCategoryWhiteBlackMembersPage:{sid:24,cid:116,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackMembersPageTag",reflectMapper:kp.qchatGetChannelCategoryWhiteBlackMembersPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:xp.memberInfo}]},qchatGetChannelCategoryWhiteBlackRoles:{sid:24,cid:117,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackRolesTag",reflectMapper:kp.qchatGetChannelCategoryWhiteBlackRolesTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:xp.serverRole}]},qchatGetChannelCategoryWhiteBlackMembers:{sid:24,cid:118,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryWhiteBlackMembersTag",reflectMapper:kp.qchatGetChannelCategoryWhiteBlackMembersTag}],response:[{type:"PropertyArray",name:"datas",reflectMapper:xp.memberInfo}]},qchatGetChannelCategoriesPage:{sid:24,cid:119,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoriesPageTag",reflectMapper:kp.qchatGetChannelCategoriesPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:xp.QChatChannelCategoryInfo}]},qchatGetChannelCategoryChannelsPage:{sid:24,cid:120,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelCategoryChannelsPageTag",reflectMapper:kp.qchatGetChannelCategoryChannelsPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:xp.channelInfo}]},qchatSubscribe:{sid:24,cid:15,service:"qchatChannel",params:[{type:"Property",name:"qchatSubReqTag",reflectMapper:kp.qchatSubReqTag},{type:"PropertyArray",name:"channels",reflectMapper:kp.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:xp.unreadInfo},{type:"PropertyArray",name:"failedChannels",reflectMapper:xp.qchatChannelIdInfoTag}]},qchatGetUnreadInfo:{sid:24,cid:27,service:"qchatChannel",params:[{type:"PropertyArray",name:"channels",reflectMapper:kp.qchatChannelIdInfoTag}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:xp.unreadInfo}]},qchatGetChannelSearchByPage:{sid:24,cid:93,service:"qchatChannel",params:[{type:"Property",name:"qchatGetChannelSearchByPageTag",reflectMapper:kp.qchatGetChannelSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag",3:"cursor"}},{type:"PropertyArray",name:"datas",reflectMapper:xp.channelInfo}]}},Tp={"24_31":"qchatCreateServer","24_32":"qchatDeleteServer","24_33":"qchatUpdateServer","24_34":"qchatGetServers","24_35":"qchatGetServersByPage","24_36":"qchatInviteServerMembers","24_37":"qchatAcceptServerInvite","24_38":"qchatRejectInviteServer","24_39":"qchatApplyServerJoin","24_40":"qchatAcceptServerApply","24_41":"qchatRejectServerApply","24_42":"qchatKickServerMembers","24_43":"qchatLeaveServer","24_44":"qchatUpdateMyMemberInfo","24_45":"qchatUpdateServerMemberInfo","24_46":"qchatGetServerMembers","24_47":"qchatGetServerMembersByPage","24_104":"qchatUpdateServerMemberBan","24_105":"qchatGetBannedMembersByPage","24_91":"qchatServerSearchByPage","24_92":"qchatServerMemberSearchByPage","24_122":"qchatGenerateInviteCode","24_123":"qchatJoinByInviteCode","24_124":"qchatGetInviteApplyRecordOfServer","24_125":"qchatGetInviteApplyRecordOfSelf","25_5":"qchatClearServersUnread","25_7":"qchatSubscribeChannelsByServers"},Rp={serverInfo:{serverId:1,name:3,icon:4,ext:5,owner:6,memberNumber:7,inviteMode:8,applyMode:9,validFlag:10,createTime:11,updateTime:12,channelNumber:13,searchType:15,searchEnable:16,reorderWeight:17},antispamTag:{antiSpamBusinessId:1},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},otherMemberInfo:{serverId:1,accid:3,nick:4,avatar:5,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},getServerListPageTag:{timestamp:1,limit:2},getServerMemberListPageTag:{serverId:1,timetag:2,limit:3},updateServerMemberBanTag:{serverId:1,opeType:2,accid:3,ext:4},getBannedMembersByPageTag:{serverId:1,timetag:2,limit:3},serverMemberBanInfo:{serverId:1,appid:2,accid:3,ext:4,banTime:5,validFlag:6,createTime:7,updateTime:8},serverSearchByPageTag:{keyword:1,startTime:2,endTime:3,order:4,limit:5,serverType:6,searchType:7,sort:8,cursor:9},serverMemberSearchByPageTag:{serverId:1,keyword:3,limit:4},inviteRespParamTag:{requestId:1},applyRespParamTag:{requestId:1,expireTime:2},inviteApplyRecord:{accid:1,type:2,serverId:3,status:4,requestId:5,createTime:6,updateTime:7,expireTime:8,data:9,recordId:10},clearServersUnreadTag:{successServerIds:1,failServerIds:2,ackTimestamp:3},unreadInfo:wp},qp=invertSerializeMap(Rp),Ep={qchatCreateServer:{sid:24,cid:31,service:"qchatServer",params:[{type:"Property",name:"serverInfo",reflectMapper:Rp.serverInfo},{type:"Property",name:"antispamTag",reflectMapper:Rp.antispamTag}],response:[{type:"Property",name:"serverInfo",reflectMapper:qp.serverInfo}]},qchatDeleteServer:{sid:24,cid:32,service:"qchatServer",params:[{type:"Long",name:"serverId"}]},qchatUpdateServer:{sid:24,cid:33,service:"qchatServer",params:[{type:"Property",name:"serverInfo",reflectMapper:Rp.serverInfo},{type:"Property",name:"antispamTag",reflectMapper:Rp.antispamTag}],response:[{type:"Property",name:"serverInfo",reflectMapper:qp.serverInfo}]},qchatGetServers:{sid:24,cid:34,service:"qchatServer",params:[{type:"LongArray",name:"serverIds"}],response:[{type:"PropertyArray",name:"serverList",reflectMapper:qp.serverInfo}]},qchatGetServersByPage:{sid:24,cid:35,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:Rp.getServerListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:qp.serverInfo}]},qchatInviteServerMembers:{sid:24,cid:36,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"StrArray",name:"accids"},{type:"String",name:"ps"},{type:"Property",name:"params",reflectMapper:{ttl:1}}],response:[{type:"StrArray",name:"failByOverAccids"},{type:"StrArray",name:"failByBanAccids"},{type:"Property",name:"record",reflectMapper:qp.applyRespParamTag}]},qchatAcceptServerInvite:{sid:24,cid:37,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"Property",name:"recordInfo",reflectMapper:Rp.inviteRespParamTag}]},qchatRejectInviteServer:{sid:24,cid:38,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"String",name:"ps"},{type:"Property",name:"recordInfo",reflectMapper:Rp.inviteRespParamTag}]},qchatApplyServerJoin:{sid:24,cid:39,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"ps"},{type:"Property",name:"params",reflectMapper:{ttl:1}}],response:[{type:"Property",name:"data",reflectMapper:qp.applyRespParamTag}]},qchatAcceptServerApply:{sid:24,cid:40,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"Property",name:"recordInfo",reflectMapper:Rp.applyRespParamTag}]},qchatRejectServerApply:{sid:24,cid:41,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"String",name:"accid"},{type:"String",name:"ps"},{type:"Property",name:"recordInfo",reflectMapper:Rp.applyRespParamTag}]},qchatKickServerMembers:{sid:24,cid:42,service:"qchatServer",params:[{type:"Long",name:"serverId"},{type:"StrArray",name:"accids"}]},qchatLeaveServer:{sid:24,cid:43,service:"qchatServer",params:[{type:"Long",name:"serverId"}]},qchatUpdateMyMemberInfo:{sid:24,cid:44,service:"qchatServer",params:[{type:"Property",name:"memberInfo",reflectMapper:Rp.memberInfo},{type:"Property",name:"antispamTag",reflectMapper:Rp.antispamTag}],response:[{type:"Property",name:"memberInfo",reflectMapper:qp.memberInfo}]},qchatUpdateServerMemberInfo:{sid:24,cid:45,service:"qchatServer",params:[{type:"Property",name:"memberInfo",reflectMapper:Rp.otherMemberInfo},{type:"Property",name:"antispamTag",reflectMapper:Rp.antispamTag}],response:[{type:"Property",name:"memberInfo",reflectMapper:qp.memberInfo}]},qchatGetServerMembers:{sid:24,cid:46,service:"qchatServer",params:[{type:"StrArray",name:"accids"}],response:[{type:"PropertyArray",name:"accidList",reflectMapper:qp.memberInfo}]},qchatGetServerMembersByPage:{sid:24,cid:47,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:Rp.getServerMemberListPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:qp.memberInfo}]},qchatUpdateServerMemberBan:{sid:24,cid:104,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:Rp.updateServerMemberBanTag}]},qchatGetBannedMembersByPage:{sid:24,cid:105,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:Rp.getBannedMembersByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag"}},{type:"PropertyArray",name:"datas",reflectMapper:qp.serverMemberBanInfo}]},qchatServerSearchByPage:{sid:24,cid:91,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:Rp.serverSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag",3:"cursor"}},{type:"PropertyArray",name:"datas",reflectMapper:qp.serverInfo}]},qchatServerMemberSearchByPage:{sid:24,cid:92,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:Rp.serverMemberSearchByPageTag}],response:[{type:"PropertyArray",name:"members",reflectMapper:qp.serverMemberBanInfo}]},qchatGenerateInviteCode:{sid:24,cid:122,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,ttl:2}}],response:[{type:"Property",name:"data",reflectMapper:{1:"serverId",2:"requestId",3:"inviteCode",4:"expireTime"}}]},qchatJoinByInviteCode:{sid:24,cid:123,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,inviteCode:2,ps:3}}]},qchatGetInviteApplyRecordOfServer:{sid:24,cid:124,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,fromTime:2,toTime:3,reverse:4,limit:5,cursor:6}}],response:[{type:"PropertyArray",name:"data",reflectMapper:qp.inviteApplyRecord}]},qchatGetInviteApplyRecordOfSelf:{sid:24,cid:125,service:"qchatServer",params:[{type:"Property",name:"tag",reflectMapper:{fromTime:1,toTime:2,reverse:3,limit:4,cursor:5}}],response:[{type:"PropertyArray",name:"data",reflectMapper:qp.inviteApplyRecord}]},qchatClearServersUnread:{sid:25,cid:5,service:"qchatServer",params:[{type:"LongArray",name:"serverIds"}],response:[{type:"Property",name:"clearServersUnreadTag",reflectMapper:qp.clearServersUnreadTag}]},qchatSubscribeChannelsByServers:{sid:25,cid:7,service:"qchatServer",params:[{type:"int",name:"type"},{type:"LongArray",name:"serverIds"}],response:[{type:"PropertyArray",name:"unreadInfos",reflectMapper:qp.unreadInfo},{type:"LongArray",name:"failServerIds"}]}},Pp=Function.prototype,Ap=Object.prototype,Op=Pp.toString,jp=Ap.hasOwnProperty,Up=Op.call(Object);var Bp=function isPlainObject(t){if(!Gi(t)||"[object Object]"!=uo(t))return!1;var a=Uu(t);if(null===a)return!0;var o=jp.call(a,"constructor")&&a.constructor;return"function"==typeof o&&o instanceof o&&Op.call(o)==Up};function format(t,a){if(!Bp(a))return{};var o=JSON.parse(Da(a)),c=doFormat(t,o);return JSON.parse(Da(ma(ma({},o),c)))}function doFormat(t,a){if(!Bp(a))return{};var o={},c=pi(t);return forEach(c).call(c,(function(c){var l=t[c].type;if("string"!=typeof l){var p=doFormat(t[c],a);pi(p).length>0&&(o[c]=p)}else{var d=t[c],h=d.rawKey||c,m=Lp[l](a,h,d);void 0!==m&&(a[h]=void 0,o[c]=m)}})),o}var Lp={number:function number(t,a){if(void 0!==t[a])return+t[a]},string:function string(t,a){if(void 0!==t[a])return t[a]},boolean:function boolean(t,a){return+t[a]>0||0!=+t[a]&&void 0},enum:function _enum(t,a,o){return values(o)[t[a]]},object:function object(t,a){if(void 0!==t[a])try{return JSON.parse(t[a])}catch(t){return{}}}};function formatReverse(t,a){if(!Bp(a))return{};var o=JSON.parse(Da(a)),c=doFormatReverse(t,o);return JSON.parse(Da(ma(ma({},o),c)))}function doFormatReverse(t,a){var o;if(!Bp(a))return reduce(o=pi(t)).call(o,(function(a,o){return a[t[o].rawKey||o]=void 0,a}),{});var c={},l=pi(t);return forEach(l).call(l,(function(o){var l=t[o].type;if("string"!=typeof l){var p=doFormatReverse(t[o],a[o]);return ma(c,p),void(a[o]=void 0)}var d=t[o],h=d.rawKey||o,m=Np[l](a,o,d);a[h]=void 0,c[h]=m})),c}var Np={number:function number(t,a){return t[a]},string:function string(t,a){return t[a]},boolean:function boolean(t,a){return!0===t[a]?1:!1===t[a]?0:void 0},enum:function _enum(t,a,o){return values(o)[t[a]]},object:function object(t,a){if(void 0!==t[a])try{return Da(t[a])}catch(t){return""}}},Fp=Np,$p={serverId:{type:"string"},name:{type:"string"},icon:{type:"string"},ext:{type:"string"},owner:{type:"string"},memberNumber:{type:"number"},inviteMode:{type:"number"},applyMode:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},channelNumber:{type:"number"},searchType:{type:"number"},searchEnable:{type:"boolean"},reorderWeight:{type:"string"}},Gp={serverId:{type:"string"},uid:{type:"string"},accid:{type:"string"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},type:{type:"number"},joinTime:{type:"number"},inviter:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}},Qp={serverId:{type:"string"},appid:{type:"string"},accid:{type:"string"},ext:{type:"string"},banTime:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}};function formatServer(t){return format($p,t)}function formatServers(t){return mi(t)&&t.length>0?map(t).call(t,(function(t){return formatServer(t)})):[]}function formatMember$1(t){return format(Gp,t)}function formatMembers$1(t){return mi(t)&&t.length>0?map(t).call(t,(function(t){return formatMember$1(t)})):[]}function formatServerMemberBanInfos(t){return mi(t)&&t.length>0?map(t).call(t,(function(t){return function formatServerMemberBanInfo(t){return format(Qp,t)}(t)})):[]}function generateAntispamTag(t){var a,o,c;if(!t.antispamTag)return{};var l=ma({},t.antispamTag);return(null===(a=t.antispamTag)||void 0===a?void 0:a.antiSpamBusinessId)&&"string"!=typeof(null===(o=t.antispamTag)||void 0===o?void 0:o.antiSpamBusinessId)&&(l.antiSpamBusinessId=Da(null===(c=t.antispamTag)||void 0===c?void 0:c.antiSpamBusinessId)),l}var Dp={accid:{type:"string"},type:{type:"number"},serverId:{type:"string"},status:{type:"number"},requestId:{type:"string"},createTime:{type:"number"},updateTime:{type:"number"},expireTime:{type:"number"},data:{type:"object"}};function formatInviteApplyRecord(t){return format(Dp,t)}function formatInviteApplyRecords(t){return mi(t)&&t.length>0?map(t).call(t,(function(t){return formatInviteApplyRecord(t)})):[]}var Wp,Kp,Vp,zp,Hp={successServerIds:{type:"object"},failServerIds:{type:"object"},ackTimestamp:{type:"number"}};function formatClearServersUnread(t){return format(Hp,t)}!function(t){t[t.reorderWeight=0]="reorderWeight",t[t.createTime=1]="createTime"}(Wp||(Wp={})),function(t){t[t.white=1]="white",t[t.black=2]="black"}(Kp||(Kp={})),function(t){t[t.add=1]="add",t[t.remove=2]="remove"}(Vp||(Vp={})),function(t){t[t.message=0]="message",t[t.media=1]="media",t[t.ext=100]="ext"}(zp||(zp={}));var Jp={channelId:{type:"string"},serverId:{type:"string"},name:{type:"string"},topic:{type:"string"},ext:{type:"string"},type:{type:"enum",values:zp},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},viewMode:{type:"number"},categoryId:{type:"string"},syncMode:{type:"number"},reorderWeight:{type:"string"}},Yp={serverId:{type:"string"},channelId:{type:"string"},ackTimestamp:{type:"number"},unreadCount:{type:"number"},mentionedCount:{type:"number"},maxCount:{type:"number"},lastMsgTime:{type:"number"}},Xp={serverId:{type:"string"},channelId:{type:"string"},type:{type:"enum",values:Kp},opeType:{type:"enum",values:Vp},toAccids:{type:"object"}},Zp={serverId:{type:"string"},channelId:{type:"string"},type:{type:"enum",values:Kp},opeType:{type:"enum",values:Vp},roleId:{type:"string"}},ed={categoryId:{type:"string"},serverId:{type:"string"},name:{type:"string"},ext:{type:"string"},owner:{type:"string"},viewMode:{type:"number"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},channelNumber:{type:"number"}};function formatUpdateWhiteBlackRole(t){return format(Zp,t)}function formatChannel(t){return format(Jp,t)}function formatChannels(t){return mi(t)&&t.length>0?map(t).call(t,(function(t){return formatChannel(t)})):[]}function formatUnreadInfo(t){return format(Yp,t)}function formatUnreadInfos(t){return mi(t)&&t.length>0?map(t).call(t,(function(t){return formatUnreadInfo(t)})):[]}function formatChannelCategory(t){return format(ed,t)}function formatChannelCategorys(t){return mi(t)&&t.length>0?map(t).call(t,(function(t){return formatChannelCategory(t)})):[]}var td=to?to.isConcatSpreadable:void 0;var rd=function isFlattenable(t){return Zc(t)||hl(t)||!!(td&&t&&t[td])};var nd=function baseFlatten(t,a,o,c,l){var p=-1,d=t.length;for(o||(o=rd),l||(l=[]);++p<d;){var h=t[p];a>0&&o(h)?a>1?baseFlatten(h,a-1,o,c,l):Xc(l,h):c||(l[l.length]=h)}return l},ad=nc((function(t,a){return ic(t)?Ks(t,nd(a,1,ic,!0)):[]})),od=ad;function _createForOfIteratorHelper(t,a){var o;if(void 0===yr||null==Yu(t)){if(mi(t)||(o=function _unsupportedIterableToArray(t,a){var o;if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,a);var c=slice(o=Object.prototype.toString.call(t)).call(o,8,-1);"Object"===c&&t.constructor&&(c=t.constructor.name);if("Map"===c||"Set"===c)return Si(t);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return _arrayLikeToArray(t,a)}(t))||a&&t&&"number"==typeof t.length){o&&(t=o);var c=0,l=function F(){};return{s:l,n:function n(){return c>=t.length?{done:!0}:{done:!1,value:t[c++]}},e:function e(t){throw t},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var p,d=!0,h=!1;return{s:function s(){o=gi(t)},n:function n(){var t=o.next();return d=t.done,t},e:function e(t){h=!0,p=t},f:function f(){try{d||null==o.return||o.return()}finally{if(h)throw p}}}}function _arrayLikeToArray(t,a){(null==a||a>t.length)&&(a=t.length);for(var o=0,c=new Array(a);o<a;o++)c[o]=t[o];return c}function _createSuper$6(t){var a=function _isNativeReflectConstruct$6(){if("undefined"==typeof Reflect||!le)return!1;if(le.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(le(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,c=qe(t);if(a){var l=qe(this).constructor;o=le(c,arguments,l)}else o=c.apply(this,arguments);return Kr(this,o)}}var id,sd,cd,ld,ud=function(t){Ne(QChatServerService,t);var a=_createSuper$6(QChatServerService);function QChatServerService(t){var o;return ue(this,QChatServerService),(o=a.call(this,"qchatServer",t)).core=t,registerParser({cmdMap:Tp,cmdConfig:Ep}),o}return he(QChatServerService,[{key:"createServer",value:function createServer(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee(){var a;return zr.wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return validate({icon:{type:"string",required:!1},name:{type:"string",required:!1},ext:{type:"string",required:!1},searchType:{type:"number",required:!1,min:0},searchEnable:{type:"boolean",required:!1},inviteMode:{type:"number",min:0,max:1,required:!1},applyMode:{type:"number",min:0,max:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatCreateServer",{serverInfo:ma(ma({},t),{searchEnable:!1===t.searchEnable?0:1}),antispamTag:generateAntispamTag(t)});case 3:return a=o.sent,o.abrupt("return",formatServer(a.content.serverInfo));case 5:case"end":return o.stop()}}),_callee,this)})))}},{key:"deleteServer",value:function deleteServer(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee2(){return zr.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatDeleteServer",t);case 3:case"end":return a.stop()}}),_callee2,this)})))}},{key:"updateServer",value:function updateServer(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee3(){var a;return zr.wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",min:1},icon:{type:"string",required:!1},name:{type:"string",required:!1},ext:{type:"string",required:!1},searchType:{type:"number",required:!1,min:0},searchEnable:{type:"boolean",required:!1},inviteMode:{type:"number",min:0,max:1,required:!1},applyMode:{type:"number",min:0,max:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatUpdateServer",{serverInfo:ma(ma({},t),{searchEnable:!1===t.searchEnable?0:1}),antispamTag:generateAntispamTag(t)});case 3:return a=o.sent,o.abrupt("return",formatServer(a.content.serverInfo));case 5:case"end":return o.stop()}}),_callee3,this)})))}},{key:"getServers",value:function getServers(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee4(){var a;return zr.wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverIds:{type:"array",itemType:"string",min:1}},t),o.next=3,this.core.sendCmd("qchatGetServers",t);case 3:return a=o.sent,o.abrupt("return",formatServers(a.content.serverList));case 5:case"end":return o.stop()}}),_callee4,this)})))}},{key:"getServersByPage",value:function getServersByPage(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee5(){var a,o,c,l;return zr.wrap((function _callee5$(p){for(;;)switch(p.prev=p.next){case 0:return validate({timestamp:{type:"number"},limit:{type:"number",min:1,required:!1}},t),p.next=3,this.core.sendCmd("qchatGetServersByPage",{tag:t});case 3:return a=p.sent,o=a.content,c=o.datas,l=o.listQueryTag,p.abrupt("return",{listQueryTag:{hasMore:1==+l.hasMore,nextTimetag:Oc(l.nextTimetag)},datas:formatServers(c)});case 6:case"end":return p.stop()}}),_callee5,this)})))}},{key:"inviteServerMembers",value:function inviteServerMembers(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee6(){var a,o;return zr.wrap((function _callee6$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",min:1},accids:{type:"array",itemType:"string",min:1},ps:{type:"string"},params:{type:"object",rules:{ttl:{type:"number"}},required:!1}},t),c.next=3,this.core.sendCmd("qchatInviteServerMembers",t);case 3:return a=c.sent,o=a.content.record||{},c.abrupt("return",{failByOverAccids:a.content.failByOverAccids,failByBanAccids:a.content.failByBanAccids,recordInfo:formatInviteApplyRecord(o)});case 6:case"end":return c.stop()}}),_callee6,this)})))}},{key:"acceptServerInvite",value:function acceptServerInvite(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee7(){return zr.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},t),a.next=3,this.core.sendCmd("qchatAcceptServerInvite",t);case 3:case"end":return a.stop()}}),_callee7,this)})))}},{key:"rejectInviteServer",value:function rejectInviteServer(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee8(){return zr.wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",min:1},ps:{type:"string"},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},t),a.next=3,this.core.sendCmd("qchatRejectInviteServer",t);case 3:case"end":return a.stop()}}),_callee8,this)})))}},{key:"applyServerJoin",value:function applyServerJoin(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee9(){var a;return zr.wrap((function _callee9$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",min:1},ps:{type:"string"},params:{type:"object",rules:{ttl:{type:"number"}},required:!1}},t),o.next=3,this.core.sendCmd("qchatApplyServerJoin",t);case 3:return a=o.sent,o.abrupt("return",formatInviteApplyRecord(a.content.data));case 5:case"end":return o.stop()}}),_callee9,this)})))}},{key:"acceptServerApply",value:function acceptServerApply(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee10(){return zr.wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",min:1},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},t),a.next=3,this.core.sendCmd("qchatAcceptServerApply",t);case 3:case"end":return a.stop()}}),_callee10,this)})))}},{key:"rejectServerApply",value:function rejectServerApply(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee11(){return zr.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",min:1},ps:{type:"string"},recordInfo:{type:"object",rules:{requestId:{type:"string",allowEmpty:!1}}}},t),a.next=3,this.core.sendCmd("qchatRejectServerApply",t);case 3:case"end":return a.stop()}}),_callee11,this)})))}},{key:"kickServerMembers",value:function kickServerMembers(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee12(){return zr.wrap((function _callee12$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},accids:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatKickServerMembers",t);case 3:case"end":return a.stop()}}),_callee12,this)})))}},{key:"leaveServer",value:function leaveServer(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee13(){return zr.wrap((function _callee13$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatLeaveServer",t);case 3:case"end":return a.stop()}}),_callee13,this)})))}},{key:"updateMyMemberInfo",value:function updateMyMemberInfo(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee14(){var a;return zr.wrap((function _callee14$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",required:!1},nick:{type:"string",required:!1},avatar:{type:"string",required:!1},ext:{type:"string",required:!1}},t),o.next=3,this.core.sendCmd("qchatUpdateMyMemberInfo",{memberInfo:t,antispamTag:generateAntispamTag(t)});case 3:return a=o.sent,o.abrupt("return",formatMember$1(a.content.memberInfo));case 5:case"end":return o.stop()}}),_callee14,this)})))}},{key:"updateServerMemberInfo",value:function updateServerMemberInfo(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee15(){var a;return zr.wrap((function _callee15$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",min:1},accid:{type:"string",min:1},nick:{type:"string",required:!1},avatar:{type:"string",required:!1}},t),o.next=3,this.core.sendCmd("qchatUpdateServerMemberInfo",{memberInfo:t,antispamTag:generateAntispamTag(t)});case 3:return a=o.sent,o.abrupt("return",formatMember$1(a.content.memberInfo));case 5:case"end":return o.stop()}}),_callee15,this)})))}},{key:"getServerMembers",value:function getServerMembers(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee16(){var a,o,c,l,p,d;return zr.wrap((function _callee16$(h){for(;;)switch(h.prev=h.next){case 0:if(validate({accids:{type:"array"}},t),a=[],t.accids.length){o=_createForOfIteratorHelper(t.accids);try{for(o.s();!(c=o.n()).done;)p=c.value,a.push(concat(l="".concat(p.serverId,"|")).call(l,p.accid))}catch(t){o.e(t)}finally{o.f()}}return h.next=5,this.core.sendCmd("qchatGetServerMembers",{accids:a});case 5:return d=h.sent,h.abrupt("return",formatMembers$1(d.content.accidList));case 7:case"end":return h.stop()}}),_callee16,this)})))}},{key:"getServerMembersByPage",value:function getServerMembersByPage(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee17(){var a,o,c,l;return zr.wrap((function _callee17$(p){for(;;)switch(p.prev=p.next){case 0:return validate({serverId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),p.next=3,this.core.sendCmd("qchatGetServerMembersByPage",{tag:t});case 3:return a=p.sent,o=a.content,c=o.datas,l=o.listQueryTag,p.abrupt("return",{listQueryTag:{hasMore:1==+l.hasMore,nextTimetag:Oc(l.nextTimetag)},datas:formatMembers$1(c)});case 6:case"end":return p.stop()}}),_callee17,this)})))}},{key:"subscribeServer",value:function subscribeServer(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee18(){var a,o,c,l;return zr.wrap((function _callee18$(p){for(;;)switch(p.prev=p.next){case 0:if(validate({type:{type:"number",min:4,max:4,required:!1},opeType:{type:"number",min:1,max:2}},t),t.type||(t.type=4),!t.servers.length){p.next=10;break}return o=ma(ma({},t),{channels:map(a=t.servers).call(a,(function(t){return{serverId:t.serverId,channelId:""}}))}),p.next=6,this.core.qchatChannel.subscribeModuleService.subscribe(o);case 6:return c=p.sent,l=c.failedChannels,this.core.qchatChannel.subscribeModuleService.cacheSubscribe(o),p.abrupt("return",{failedServers:l});case 10:case"end":return p.stop()}}),_callee18,this)})))}},{key:"banServerMember",value:function banServerMember(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee19(){return zr.wrap((function _callee19$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("qchatUpdateServerMemberBan",{tag:ma(ma({},t),{opeType:1})});case 3:case"end":return a.stop()}}),_callee19,this)})))}},{key:"unbanServerMember",value:function unbanServerMember(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee20(){return zr.wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("qchatUpdateServerMemberBan",{tag:ma(ma({},t),{opeType:2})});case 3:case"end":return a.stop()}}),_callee20,this)})))}},{key:"getBannedMembersByPage",value:function getBannedMembersByPage(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee21(){var a,o,c,l;return zr.wrap((function _callee21$(p){for(;;)switch(p.prev=p.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),p.next=3,this.core.sendCmd("qchatGetBannedMembersByPage",{tag:t});case 3:return a=p.sent,o=a.content,c=o.datas,l=o.listQueryTag,p.abrupt("return",{listQueryTag:{hasMore:1==+l.hasMore,nextTimetag:Oc(l.nextTimetag)},datas:formatServerMemberBanInfos(c)});case 6:case"end":return p.stop()}}),_callee21,this)})))}},{key:"serverSearchByPage",value:function serverSearchByPage(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee22(){var a,o,c,l;return zr.wrap((function _callee22$(p){for(;;)switch(p.prev=p.next){case 0:if(validate({keyword:{type:"string",allowEmpty:!1},startTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1},serverType:{type:"array",itemType:"number",min:0,required:!1},order:{type:"enum",values:getEnumKeys(yp),required:!1},searchType:{type:"enum",values:getEnumKeys(bp)},sort:{type:"enum",values:getEnumKeys(gp),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),!(t.startTime&&t.endTime&&t.startTime>=t.endTime)){p.next=3;break}throw new Jo("startTime more than endTime",t,"timeRule");case 3:return p.next=5,this.core.sendCmd("qchatServerSearchByPage",{tag:ma(ma({},t),{order:t.order&&yp[t.order],searchType:bp[t.searchType],sort:sort(t)&&gp[sort(t)],serverType:Da(t.serverType)})});case 5:return a=p.sent,o=a.content,c=o.datas,l=o.listQueryTag,p.abrupt("return",{listQueryTag:{hasMore:1==+l.hasMore,nextTimetag:Oc(l.nextTimetag),cursor:l.cursor},datas:formatServers(c)});case 8:case"end":return p.stop()}}),_callee22,this)})))}},{key:"serverMemberSearchByPage",value:function serverMemberSearchByPage(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee23(){var a;return zr.wrap((function _callee23$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},keyword:{type:"string",allowEmpty:!1},limit:{type:"number",min:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatServerMemberSearchByPage",{tag:t});case 3:return a=o.sent,o.abrupt("return",formatMembers$1(a.content.members));case 5:case"end":return o.stop()}}),_callee23,this)})))}},{key:"generateInviteCode",value:function generateInviteCode(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee24(){var a;return zr.wrap((function _callee24$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},ttl:{type:"number",min:0,required:!1}},t),o.next=3,this.core.sendCmd("qchatGenerateInviteCode",{tag:t});case 3:return a=o.sent,o.abrupt("return",format({expireTime:{type:"number"}},a.content.data));case 5:case"end":return o.stop()}}),_callee24,this)})))}},{key:"joinByInviteCode",value:function joinByInviteCode(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee25(){return zr.wrap((function _callee25$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},inviteCode:{type:"string",allowEmpty:!1},ps:{type:"string",required:!1}},t),a.next=3,this.core.sendCmd("qchatJoinByInviteCode",{tag:t});case 3:case"end":return a.stop()}}),_callee25,this)})))}},{key:"getInviteApplyRecordOfServer",value:function getInviteApplyRecordOfServer(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee26(){var a;return zr.wrap((function _callee26$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},fromTime:{type:"number",min:0},toTime:{type:"number",min:0},reverse:{type:"boolean",required:!1},limit:{type:"number",min:1,required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetInviteApplyRecordOfServer",{tag:ma(ma({},t),{reverse:reverse(t)?1:0})});case 3:return a=o.sent,o.abrupt("return",formatInviteApplyRecords(a.content.data));case 5:case"end":return o.stop()}}),_callee26,this)})))}},{key:"getInviteApplyRecordOfSelf",value:function getInviteApplyRecordOfSelf(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee27(){var a;return zr.wrap((function _callee27$(o){for(;;)switch(o.prev=o.next){case 0:return validate({fromTime:{type:"number",min:0},toTime:{type:"number",min:0},reverse:{type:"boolean",required:!1},limit:{type:"number",min:1,required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetInviteApplyRecordOfSelf",{tag:ma(ma({},t),{reverse:reverse(t)?1:0})});case 3:return a=o.sent,o.abrupt("return",formatInviteApplyRecords(a.content.data));case 5:case"end":return o.stop()}}),_callee27,this)})))}},{key:"markRead",value:function markRead(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee28(){var a,o,c,l;return zr.wrap((function _callee28$(p){for(;;)switch(p.prev=p.next){case 0:return validate({serverIds:{type:"array",itemType:"string",required:!0}},t),p.next=3,this.core.sendCmd("qchatClearServersUnread",t);case 3:return a=p.sent,o=formatClearServersUnread(a.content.clearServersUnreadTag),c=o.successServerIds,l=o.ackTimestamp,this.logger.log("qchatServer::clearServersUnread:: begin auto clear servers unreadInfo"),this.core.emit("_clearUnreadCountByServers",c,l),p.abrupt("return",o);case 9:case"end":return p.stop()}}),_callee28,this)})))}},{key:"subscribeAllChannel",value:function subscribeAllChannel(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee29(){var a,o,c,l,p=this;return zr.wrap((function _callee29$(d){for(;;)switch(d.prev=d.next){case 0:return validate({type:{type:"number",required:!0},serverIds:{type:"array",itemType:"string",required:!0,max:10}},t),d.next=3,this.core.sendCmd("qchatSubscribeChannelsByServers",t);case 3:(o=d.sent).content.unreadInfos=formatUnreadInfos(o.content.unreadInfos),this.core.emit("_cacheUnreadCount",o.content.unreadInfos),c={type:t.type,opeType:1,channels:map(a=o.content.unreadInfos).call(a,(function(t){return{serverId:t.serverId,channelId:t.channelId}}))},this.core.emit("_cacheSubscribe",c),this.core.emit("unreadInfos",o.content.unreadInfos);try{o.content.failServerIds=JSON.parse(o.content.failServerIds),forEach(l=od(t.serverIds,o.content.failServerIds)).call(l,(function(t){p.core.emit("serverUnreadInfo",p.core.qchatChannel.subscribeModuleService.getServerUnreadInfo(t))}))}catch(t){this.core.logger.error("qchatServer::subscribeAllChannel: JSON parse failServerIds error",t)}return d.abrupt("return",o.content);case 11:case"end":return d.stop()}}),_callee29,this)})))}}]),QChatServerService}(_p);!function(t){t[t.everyone=1]="everyone",t[t.custom=2]="custom"}(id||(id={})),function(t){t[t.normal=0]="normal",t[t.owner=1]="owner"}(sd||(sd={})),function(t){t[t.ignore=0]="ignore",t[t.deny=-1]="deny",t[t.allow=1]="allow"}(cd||(cd={})),function(t){t[t.manageServer=1]="manageServer",t[t.manageChannel=2]="manageChannel",t[t.manageRole=3]="manageRole",t[t.sendMsg=4]="sendMsg",t[t.accountInfoSelf=5]="accountInfoSelf",t[t.inviteServer=6]="inviteServer",t[t.kickServer=7]="kickServer",t[t.accountInfoOther=8]="accountInfoOther",t[t.recallMsg=9]="recallMsg",t[t.deleteMsg=10]="deleteMsg",t[t.remindOther=11]="remindOther",t[t.remindEveryone=12]="remindEveryone",t[t.manageBlackWhiteList=13]="manageBlackWhiteList",t[t.banServerMember=14]="banServerMember",t[t.RTCChannelConnect=15]="RTCChannelConnect",t[t.RTCChannelDisconnectOther=16]="RTCChannelDisconnectOther",t[t.RTCChannelOpenMicrophone=17]="RTCChannelOpenMicrophone",t[t.RTCChannelOpenCamera=18]="RTCChannelOpenCamera",t[t.RTCChannelOpenCloseOtherMicrophone=19]="RTCChannelOpenCloseOtherMicrophone",t[t.RTCChannelOpenCloseOtherCamera=20]="RTCChannelOpenCloseOtherCamera",t[t.RTCChannelOpenCloseEveryoneMicrophone=21]="RTCChannelOpenCloseEveryoneMicrophone",t[t.RTCChannelOpenCloseEveryoneCamera=22]="RTCChannelOpenCloseEveryoneCamera",t[t.RTCChannelOpenShareScreen=23]="RTCChannelOpenShareScreen",t[t.RTCChannelCloseOtherShareScreen=24]="RTCChannelCloseOtherShareScreen",t[t.manageInviteApply=25]="manageInviteApply",t[t.manageInviteApplyHistory=26]="manageInviteApplyHistory"}(ld||(ld={}));var pd,dd,hd,fd,md,vd,yd,gd={type:{type:"enum",values:id},memberType:{type:"enum",values:sd},createTime:{type:"number"},updateTime:{type:"number"},priority:{type:"number"},memberCount:{type:"number"},joinTime:{type:"number"}},bd={roleId:{type:"string"},categoryId:{type:"string"},serverId:{type:"string"},type:{type:"enum",values:id},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},name:{type:"string"},icon:{type:"string"},ext:{type:"string"}},Cd={id:{type:"string"},accid:{type:"string"},categoryId:{type:"string"},serverId:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},memberType:{type:"enum",values:sd},joinTime:{type:"number"},inviter:{type:"string"}};function generatorRoleForCmd(t){var a=ma({},t),o=formatReverse(gd,a);return o.auths&&(o.auths=function generateRoleAuthsForCmd(t){var a,o=reduce(a=pi(t)).call(a,(function(a,o){var c=ld[o];return c&&(a[c]=cd[t[o]]),a}),{});return Da(o)}(o.auths)),o}function formatRoleAuths(t){var a;return reduce(a=pi(t)).call(a,(function(a,o){var c=getEnumKeyByEnumValue(ld,o);return c&&(a[c]=cd[t[o]]),a}),{})}function formatRole(t){var a=format(gd,t);return t.auths&&(a.auths=formatRoleAuths(JSON.parse(a.auths))),a.isMember&&delete a.isMember,a}function formatRoles(t){return mi(t)&&t.length>0?map(t).call(t,(function(t){return formatRole(t)})):[]}function formatChannelCategoryRole(t){return t.auths&&(t.auths=formatRoleAuths(JSON.parse(t.auths))),format(bd,t)}function formatChannelCategoryMemberRole(t){return t.auths&&(t.auths=formatRoleAuths(JSON.parse(t.auths))),format(Cd,t)}!function(t){t[t.sendTime=1]="sendTime"}(pd||(pd={})),function(t){t[t.text=0]="text",t[t.image=1]="image",t[t.audio=2]="audio",t[t.video=3]="video",t[t.geo=4]="geo",t[t.notification=5]="notification",t[t.file=6]="file",t[t.tip=10]="tip",t[t.robot=11]="robot",t[t.g2=12]="g2",t[t.custom=100]="custom"}(dd||(dd={})),function(t){t[t.sending=1]="sending",t[t.success=2]="success",t[t.failed=3]="failed"}(hd||(hd={})),function(t){t[t.notifyAll=1]="notifyAll",t[t.notifySubscribe=2]="notifySubscribe"}(fd||(fd={})),function(t){t[t.server=1]="server",t[t.channel=2]="channel",t[t.serverAccids=3]="serverAccids",t[t.channelAccids=4]="channelAccids"}(md||(md={})),function(t){t[t.serverMemberInvite=1]="serverMemberInvite",t[t.serverMemberInviteReject=2]="serverMemberInviteReject",t[t.serverMemberApply=3]="serverMemberApply",t[t.serverMemberApplyReject=4]="serverMemberApplyReject",t[t.serverCreate=5]="serverCreate",t[t.serverRemove=6]="serverRemove",t[t.serverUpdate=7]="serverUpdate",t[t.serverMemberInviteDone=8]="serverMemberInviteDone",t[t.serverMemberInviteAccept=9]="serverMemberInviteAccept",t[t.serverMemberApplyDone=10]="serverMemberApplyDone",t[t.serverMemberApplyAccept=11]="serverMemberApplyAccept",t[t.serverMemberKick=12]="serverMemberKick",t[t.serverMemberLeave=13]="serverMemberLeave",t[t.serverMemberUpdate=14]="serverMemberUpdate",t[t.channelCreate=15]="channelCreate",t[t.channelRemove=16]="channelRemove",t[t.channelUpdate=17]="channelUpdate",t[t.channelUpdateWhiteBlackIdentify=18]="channelUpdateWhiteBlackIdentify",t[t.channelUpdateWhiteBlackIdentifyUser=19]="channelUpdateWhiteBlackIdentifyUser",t[t.updateQuickComment=20]="updateQuickComment",t[t.channelCategoryCreate=21]="channelCategoryCreate",t[t.channelCategoryRemove=22]="channelCategoryRemove",t[t.channelCategoryUpdate=23]="channelCategoryUpdate",t[t.channelCategoryUpdateWhiteBlackIdentify=24]="channelCategoryUpdateWhiteBlackIdentify",t[t.channelCategoryUpdateWhiteBlackIdentifyUser=25]="channelCategoryUpdateWhiteBlackIdentifyUser",t[t.serverIdentifyAdd=26]="serverIdentifyAdd",t[t.serverIdentifyRemove=27]="serverIdentifyRemove",t[t.serverIdentifyUpdate=28]="serverIdentifyUpdate",t[t.channelIdentifyUpdate=29]="channelIdentifyUpdate",t[t.userIdentifyUpdate=30]="userIdentifyUpdate",t[t.channelVisibilityUpdate=31]="channelVisibilityUpdate",t[t.serverEnterLeave=32]="serverEnterLeave",t[t.serverMemberJoinByInviteCode=33]="serverMemberJoinByInviteCode",t[t.custom=100]="custom",t[t.msgTyping=101]="msgTyping"}(vd||(vd={})),function(t){t[t.reply=1]="reply",t[t.thread=2]="thread",t[t.all=3]="all"}(yd||(yd={}));var now_1=function(){return eo.Date.now()},Sd=/\s/;var _d=function trimmedEndIndex(t){for(var a=t.length;a--&&Sd.test(t.charAt(a)););return a},Md=/^\s+/;var wd=function baseTrim(t){return t?t.slice(0,_d(t)+1).replace(Md,""):t},kd=/^[-+]0x[0-9a-f]+$/i,xd=/^0b[01]+$/i,Id=/^0o[0-7]+$/i,Td=parseInt;var Rd=function toNumber(t){if("number"==typeof t)return t;if(iu(t))return NaN;if(po(t)){var a="function"==typeof t.valueOf?t.valueOf():t;t=po(a)?a+"":a}if("string"!=typeof t)return 0===t?t:+t;t=wd(t);var o=xd.test(t);return o||Id.test(t)?Td(t.slice(2),o?2:8):kd.test(t)?NaN:+t},qd=Math.max,Ed=Math.min;var Pd=function debounce(t,a,o){var c,l,p,d,h,m,v=0,y=!1,g=!1,b=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function invokeFunc(a){var o=c,p=l;return c=l=void 0,v=a,d=t.apply(p,o)}function leadingEdge(t){return v=t,h=setTimeout(timerExpired,a),y?invokeFunc(t):d}function shouldInvoke(t){var o=t-m;return void 0===m||o>=a||o<0||g&&t-v>=p}function timerExpired(){var t=now_1();if(shouldInvoke(t))return trailingEdge(t);h=setTimeout(timerExpired,function remainingWait(t){var o=a-(t-m);return g?Ed(o,p-(t-v)):o}(t))}function trailingEdge(t){return h=void 0,b&&c?invokeFunc(t):(c=l=void 0,d)}function debounced(){var t=now_1(),o=shouldInvoke(t);if(c=arguments,l=this,m=t,o){if(void 0===h)return leadingEdge(m);if(g)return clearTimeout(h),h=setTimeout(timerExpired,a),invokeFunc(m)}return void 0===h&&(h=setTimeout(timerExpired,a)),d}return a=Rd(a)||0,po(o)&&(y=!!o.leading,p=(g="maxWait"in o)?qd(Rd(o.maxWait)||0,a):p,b="trailing"in o?!!o.trailing:b),debounced.cancel=function cancel(){void 0!==h&&clearTimeout(h),v=0,c=m=l=h=void 0},debounced.flush=function flush(){return void 0===h?d:trailingEdge(now_1())},debounced};var Ad=function throttle(t,a,o){var c=!0,l=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return po(o)&&(c="leading"in o?!!o.leading:c,l="trailing"in o?!!o.trailing:l),Pd(t,a,{leading:c,maxWait:a,trailing:l})},Od=Math.min;var jd=function baseIntersection(t,a,o){for(var c=o?Qs:Gs,l=t[0].length,p=t.length,d=p,h=Array(p),m=1/0,v=[];d--;){var y=t[d];d&&a&&(y=Ds(y,Di(a))),m=Od(y.length,m),h[d]=!o&&(a||l>=120&&y.length>=120)?new Bs(d&&y):void 0}y=t[0];var g=-1,b=h[0];e:for(;++g<l&&v.length<m;){var C=y[g],S=a?a(C):C;if(C=o||0!==C?C:0,!(b?Ws(b,S):c(v,S,o))){for(d=p;--d;){var _=h[d];if(!(_?Ws(_,S):c(t[d],S,o)))continue e}b&&b.push(S),v.push(C)}}return v};var Ud=function castArrayLikeObject(t){return ic(t)?t:[]},Bd=nc((function(t){var a=Ds(t,Ud);return a.length&&a[0]===t[0]?jd(a):[]}));var Ld=function baseSlice(t,a,o){var c=-1,l=t.length;a<0&&(a=-a>l?0:l+a),(o=o>l?l:o)<0&&(o+=l),l=a>o?0:o-a>>>0,a>>>=0;for(var p=Array(l);++c<l;)p[c]=t[c+a];return p};var Nd=function isIterateeCall(t,a,o){if(!po(o))return!1;var c=typeof a;return!!("number"==c?oc(o)&&yl(a,o.length):"string"==c&&a in o)&&gs(o[a],t)},Fd=1/0;var $d=function toFinite(t){return t?(t=Rd(t))===Fd||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0};var Gd=function toInteger(t){var a=$d(t),o=a%1;return a==a?o?a-o:a:0},Qd=Math.ceil,Dd=Math.max;var Wd,Kd=function chunk(t,a,o){a=(o?Nd(t,a,o):void 0===a)?1:Dd(Gd(a),0);var c=null==t?0:t.length;if(!c||a<1)return[];for(var l=0,p=0,d=Array(Qd(c/a));l<c;)d[p++]=Ld(t,l,l+=a);return d};!function(t){t[t.sub=1]="sub",t[t.unSub=2]="unSub"}(Wd||(Wd={}));var Vd,zd=function(){function UnreadInfoModuleService(t){var a=this;ue(this,UnreadInfoModuleService),this.unreadCount={},this.autoSubscribeUnreadMap={},this.autoSubscribeServerMap={},this.autoSubscribeTypingMap={},this.unreadServerCount={},this._serverUnreadInfo=Ad((function(t){a.core.emit("serverUnreadInfo",a.getServerUnreadInfo(t))}),100),this.core=t}return he(UnreadInfoModuleService,[{key:"_unSubscribeChannel",value:function _unSubscribeChannel(t,a){return __awaiter(this,void 0,void 0,zr.mark((function _callee(){var o,c,l;return zr.wrap((function _callee$(p){for(;;)switch(p.prev=p.next){case 0:if(c=concat(o="".concat(t,"_")).call(o,a),l=this.autoSubscribeUnreadMap[c]){p.next=4;break}return p.abrupt("return");case 4:this.subscribe({opeType:Wd.unSub,type:l,channels:[{serverId:t,channelId:a}]}),this.autoSubscribeUnreadMap[c]=void 0;case 6:case"end":return p.stop()}}),_callee,this)})))}},{key:"subscribe",value:function subscribe(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee2(){var a;return zr.wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:return validate({type:{type:"number",min:1,max:5},opeType:{type:"number",min:1,max:2}},t),o.next=3,this.core.sendCmd("qchatSubscribe",{qchatSubReqTag:{type:t.type,opeType:t.opeType},channels:t.channels});case 3:return a=o.sent,o.abrupt("return",a.content);case 5:case"end":return o.stop()}}),_callee2,this)})))}},{key:"resumeSubscribe",value:function resumeSubscribe(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee5(){var a,o,c,l,p,d,h,m=this;return zr.wrap((function _callee5$(v){for(;;)switch(v.prev=v.next){case 0:if(p=100,this.unreadCount={},t.isAutoReconnect){v.next=4;break}return v.abrupt("return");case 4:return d={},forEach(a=pi(this.autoSubscribeUnreadMap)).call(a,(function(t){var a=m.autoSubscribeUnreadMap[t];if(a){var o=t.split("_"),c=ki(o,2),l={serverId:c[0],channelId:c[1]};d[a]=d[a]||[],d[a].push(l)}})),d[5]=[],forEach(o=pi(this.autoSubscribeTypingMap)).call(o,(function(t){return __awaiter(m,void 0,void 0,zr.mark((function _callee3(){var a,o,c,l,p;return zr.wrap((function _callee3$(h){for(;;)switch(h.prev=h.next){case 0:this.autoSubscribeTypingMap[t]&&(a=t.split("_"),o=ki(a,2),c=o[0],l=o[1],p={serverId:c,channelId:l},d[5].push(p));case 2:case"end":return h.stop()}}),_callee3,this)})))})),d[4]=[],forEach(c=pi(this.autoSubscribeServerMap)).call(c,(function(t){return __awaiter(m,void 0,void 0,zr.mark((function _callee4(){var a;return zr.wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:this.autoSubscribeServerMap[t]&&(a={serverId:t},d[4].push(a));case 2:case"end":return o.stop()}}),_callee4,this)})))})),h=[],forEach(l=pi(d)).call(l,(function(t){var a=d[t];if(a&&0===a.length)return pa.resolve();if(a.length>p){var o=Kd(a,100);return forEach(o).call(o,(function(a){h.push(m.createSubscribePromise(a,t))}))}h.push(m.createSubscribePromise(a,t))})),v.next=14,pa.all(h);case 14:case"end":return v.stop()}}),_callee5,this)})))}},{key:"createSubscribePromise",value:function createSubscribePromise(t,a){var o=this,c={type:Oc(a),opeType:1,channels:t};return this.core.logger.debug("qchatChannel:: autoSubscribeUnread params",c),this.subscribe(c).then((function(t){var a=t.unreadInfos;a&&a.length>0&&(a=formatUnreadInfos(a),o.cacheUnreadCount(a))})).catch((function(t){o.core.logger.error("qchatChannel:: autoSubscribeUnread error ",t)}))}},{key:"cacheSubscribe",value:function cacheSubscribe(t){var a,o=this;forEach(a=t.channels).call(a,(function(a){var c,l=a.channelId?concat(c="".concat(a.serverId,"_")).call(c,a.channelId):"".concat(a.serverId),p=5===t.type?o.autoSubscribeTypingMap:4===t.type?o.autoSubscribeServerMap:o.autoSubscribeUnreadMap;t.opeType===Wd.sub?p[l]=t.type:t.opeType===Wd.unSub&&(p[l]=void 0)}))}},{key:"cacheUnreadCount",value:function cacheUnreadCount(t){var a=this;forEach(t).call(t,(function(t){var o,c=concat(o="".concat(t.serverId,"_")).call(o,t.channelId);a.unreadCount[c]=ma({},t),a.unreadServerCount[t.serverId]||(a.unreadServerCount[t.serverId]={}),a.unreadServerCount[t.serverId][t.channelId]=!0}))}},{key:"getServerUnreadInfo",value:function getServerUnreadInfo(t){var a,o=this,c={serverId:t,unreadCount:0,mentionedCount:0,maxCount:0};return forEach(a=pi(this.unreadServerCount[t])).call(a,(function(a){var l,p=concat(l="".concat(t,"_")).call(l,a),d=o.unreadCount[p];c.unreadCount+=d.unreadCount,c.mentionedCount+=d.mentionedCount,void 0!==d.maxCount&&(c.maxCount=d.maxCount)})),c.unreadCount=c.unreadCount>c.maxCount?c.maxCount:c.unreadCount,c.mentionedCount=c.mentionedCount>c.maxCount?c.maxCount:c.mentionedCount,c}},{key:"getUnreadInfo",value:function getUnreadInfo(t){var a;validate({serverId:{type:"string"},channelId:{type:"string"}},t);var o=concat(a="".concat(t.serverId,"_")).call(a,t.channelId);return this.unreadCount[o]?this.unreadCount[o]:null}},{key:"shouldChangeUnread",value:function shouldChangeUnread(t,a){if(!1===t.historyEnable)return!1;if(!1===t.needBadge)return!1;if(t.fromAccount===this.core.account)return!1;if(a&&1===(null==t?void 0:t.status))return!1;if(t.notifyReason&&t.notifyReason===getEnumKeyByEnumValue(fd,fd.notifySubscribe)){if(!t.serverId||!t.channelId)return!1;var o=this.getUnreadInfo({serverId:t.serverId,channelId:t.channelId}),c=a?"ackTimestamp":"lastMsgTime";if(!o)return!1;if(t.time&&o[c]&&o[c]>t.time)return!1}return!0}},{key:"changeUnread",value:function changeUnread(t,a){return __awaiter(this,void 0,void 0,zr.mark((function _callee6(){var o,c,l,p,d,h,m,v,y,g,b;return zr.wrap((function _callee6$(C){for(;;)switch(C.prev=C.next){case 0:if(l=t.serverId,p=t.channelId,d=concat(o="".concat(l,"_")).call(o,p),this.unreadCount[d]){C.next=7;break}return C.next=6,this.core.qchatChannel.getChannelUnreadInfos({channels:[{serverId:l,channelId:p}]});case 6:return C.abrupt("return");case 7:if(this.shouldChangeUnread(t,a)){C.next=10;break}return this.core.logger.debug("changeUnread: ".concat(d," does not need to update unreadInfo")),C.abrupt("return");case 10:if(h=this.unreadCount[d],m=2===(null==t?void 0:t.status),v=t.mentionAll||t.mentionAccids&&includes(c=t.mentionAccids).call(c,this.core.account),m?(h.unreadCount=h.unreadCount?h.unreadCount-1:0,v&&(h.mentionedCount=h.mentionedCount?h.mentionedCount-1:0),this.core.logger.debug("changeUnread: ".concat(d," unread reduce "),h)):(h.unreadCount=h.unreadCount?h.unreadCount+1:1,v&&(h.mentionedCount=h.mentionedCount?h.mentionedCount+1:1),this.core.logger.debug("changeUnread: ".concat(d," unread add "),h)),delete h.lastMsgTime,y=h.maxCount,g=h.mentionedCount,b=h.unreadCount,"number"!=typeof y){C.next=24;break}if(g=g>y?y:g,!((b=b>y?y:b)>y)){C.next=24;break}return this.core.logger.debug("QChatChannel::subscribe::tempUnreadCount more than maxCount"),C.abrupt("return");case 24:this.core.logger.warn("unreadInfo event will abandon,please use unreadInfos"),this.core.emit("unreadInfo",ma(ma({},h),{mentionedCount:g,unreadCount:b})),this.core.emit("unreadInfos",[ma(ma({},h),{mentionedCount:g,unreadCount:b})]),this._serverUnreadInfo(l);case 28:case"end":return C.stop()}}),_callee6,this)})))}},{key:"updateUnread",value:function updateUnread(t){var a,o=t.serverId,c=t.channelId,l=concat(a="".concat(o,"_")).call(a,c),p=this.unreadCount[l];p&&p.ackTimestamp&&t&&t.ackTimestamp&&p.ackTimestamp>t.ackTimestamp?this.core.logger.debug("qchat channel updateUnread exist: ",null==p?void 0:p.ackTimestamp,null==t?void 0:t.ackTimestamp):(this.core.logger.debug("qchat channel updateUnread: ",t),this.unreadCount[l]=t,this.unreadServerCount[o]||(this.unreadServerCount[o]={}),this.unreadServerCount[o][c]=!0,this.core.logger.warn("unreadInfo event will abandon,please use unreadInfos"),this.core.emit("unreadInfo",this.unreadCount[l]),this.core.emit("unreadInfos",[this.unreadCount[l]]),this._serverUnreadInfo(o))}},{key:"clearUnreadCountByServers",value:function clearUnreadCountByServers(t,a){var o,c=this,l=[];forEach(t).call(t,(function(t){var a;c.unreadServerCount[t]&&forEach(a=pi(c.unreadServerCount[t])).call(a,(function(a){var o;l.push(concat(o="".concat(t,"_")).call(o,a))}))})),forEach(l).call(l,(function(t){c.unreadCount[t].unreadCount=c.unreadCount[t].mentionedCount=0,c.unreadCount[t].ackTimestamp=a})),this.core.emit("unreadInfos",map(l).call(l,(function(t){return c.unreadCount[t]}))),forEach(o=Bd(t,pi(this.unreadServerCount))).call(o,(function(t){c.core.emit("serverUnreadInfo",c.getServerUnreadInfo(t))}))}}]),UnreadInfoModuleService}();function _createSuper$5(t){var a=function _isNativeReflectConstruct$5(){if("undefined"==typeof Reflect||!le)return!1;if(le.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(le(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,c=qe(t);if(a){var l=qe(this).constructor;o=le(c,arguments,l)}else o=c.apply(this,arguments);return Kr(this,o)}}!function(t){t[t.sub=1]="sub",t[t.unSub=2]="unSub"}(Vd||(Vd={}));var Hd=function(t){Ne(QChatChannelService,t);var a=_createSuper$5(QChatChannelService);function QChatChannelService(t){var o,c,l,p,d,h,m;return ue(this,QChatChannelService),(m=a.call(this,"qchatChannel",t)).core=t,registerParser({cmdMap:Mp,cmdConfig:Ip}),m.subscribeModuleService=new zd(t),m.core.on("_changeUnread",bind(o=m.subscribeModuleService.changeUnread).call(o,m.subscribeModuleService)),m.core.on("_updateUnread",bind(c=m.subscribeModuleService.updateUnread).call(c,m.subscribeModuleService)),m.core.on("_cacheUnreadCount",bind(l=m.subscribeModuleService.cacheUnreadCount).call(l,m.subscribeModuleService)),m.core.on("_cacheSubscribe",bind(p=m.subscribeModuleService.cacheSubscribe).call(p,m.subscribeModuleService)),m.core.on("_clearUnreadCountByServers",bind(d=m.subscribeModuleService.clearUnreadCountByServers).call(d,m.subscribeModuleService)),m.core.on("_subscribeServer",(function(t){return __awaiter(me(m),void 0,void 0,zr.mark((function _callee(){return zr.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.subscribeModuleService.subscribe(t);case 2:this.subscribeModuleService.cacheSubscribe(t);case 3:case"end":return a.stop()}}),_callee,this)})))})),m.core.on("logined",bind(h=m.subscribeModuleService.resumeSubscribe).call(h,m.subscribeModuleService)),m.core.on("_serverChannelLeave",(function(t){var a,o;if(m.logger.log("QChatChannel::enter autoUnSubscribe sysMsg is",t),t.type===vd[vd.channelVisibilityUpdate])m.logger.log("QChatChannel::begin autoUnSubscribe channel key is",concat(a="".concat(t.serverId,"_")).call(a,t.channelId)),m.subscribeModuleService._unSubscribeChannel(t.serverId,t.channelId),m.logger.log("QChatChannel::autoUnSubscribe channel done key is",concat(o="".concat(t.serverId,"_")).call(o,t.channelId));else if(t.type===vd[vd.serverEnterLeave]){var c;m.subscribeModuleService.autoSubscribeServerMap[t.serverId]&&(m.logger.log("QChatChannel::begin autoUnSubscribe server key is",t.serverId),m.subscribeModuleService.subscribe({type:4,opeType:Vd.unSub,channels:[{serverId:t.serverId,channelId:""}]}),m.logger.log("QChatChannel::autoUnSubscribe server done key is",t.serverId));var l=m.subscribeModuleService.unreadServerCount[t.serverId];if(!l)return;m.logger.log("QChatChannel::begin autoUnSubscribe channels key is",pi(l)),forEach(c=pi(l)).call(c,(function(a){m.subscribeModuleService._unSubscribeChannel(t.serverId,a)})),m.logger.log("QChatChannel::autoUnSubscribe channels done key is",pi(l))}})),m}return he(QChatChannelService,[{key:"createChannel",value:function createChannel(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee2(){var a;return zr.wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(zp)},name:{type:"string",required:!1},topic:{type:"string",required:!1},ext:{type:"string",required:!1}},t),o.next=3,this.core.sendCmd("qchatCreateChannel",{channelInfo:ma(ma({},t),{type:zp[t.type]}),antispamTag:generateAntispamTag(t)});case 3:return a=o.sent,o.abrupt("return",formatChannel(a.content.channelInfo));case 5:case"end":return o.stop()}}),_callee2,this)})))}},{key:"deleteChannel",value:function deleteChannel(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee3(){return zr.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return validate({channelId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatDeleteChannel",t);case 3:case"end":return a.stop()}}),_callee3,this)})))}},{key:"updateChannel",value:function updateChannel(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee4(){var a;return zr.wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return validate({channelId:{type:"string",min:1},serverId:{type:"string",required:!1},type:{type:"enum",values:getEnumKeys(zp),required:!1},name:{type:"string",required:!1},topic:{type:"string",required:!1},ext:{type:"string",required:!1}},t),o.next=3,this.core.sendCmd("qchatUpdateChannel",{channelInfo:ma(ma({},t),{type:zp[t.type]}),antispamTag:generateAntispamTag(t)});case 3:return a=o.sent,o.abrupt("return",formatChannel(a.content.channelInfo));case 5:case"end":return o.stop()}}),_callee4,this)})))}},{key:"getChannels",value:function getChannels(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee5(){var a;return zr.wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return validate({channelIds:{type:"array",itemType:"string",min:1}},t),o.next=3,this.core.sendCmd("qchatGetChannels",t);case 3:return a=o.sent,o.abrupt("return",formatChannels(a.content.channelList));case 5:case"end":return o.stop()}}),_callee5,this)})))}},{key:"getChannelsByPage",value:function getChannelsByPage(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee6(){var a,o,c,l;return zr.wrap((function _callee6$(p){for(;;)switch(p.prev=p.next){case 0:return validate({serverId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),p.next=3,this.core.sendCmd("qchatGetChannelsByPage",{qchatGetChannelListPageTag:t});case 3:return a=p.sent,o=a.content,c=o.datas,l=o.listQueryTag,p.abrupt("return",{listQueryTag:{hasMore:1==+l.hasMore,nextTimetag:Oc(l.nextTimetag)},datas:formatChannels(c)});case 6:case"end":return p.stop()}}),_callee6,this)})))}},{key:"getMembersByPage",value:function getMembersByPage(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee7(){var a,o,c,l;return zr.wrap((function _callee7$(p){for(;;)switch(p.prev=p.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),p.next=3,this.core.sendCmd("qchatGetMembersByPage",{qchatGetMembersByPageTag:t});case 3:return a=p.sent,o=a.content,c=o.datas,l=o.listQueryTag,p.abrupt("return",{listQueryTag:{hasMore:1==+l.hasMore,nextTimetag:Oc(l.nextTimetag)},datas:formatMembers$1(c)});case 6:case"end":return p.stop()}}),_callee7,this)})))}},{key:"updateWhiteBlackRole",value:function updateWhiteBlackRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee8(){return zr.wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},roleId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Kp)},opeType:{type:"enum",values:getEnumKeys(Vp)}},t),a.next=3,this.core.sendCmd("qchatUpdateWhiteBlackRole",{qchatUpdateWhiteBlackRoleTag:ma(ma({},t),{type:Kp[t.type],opeType:Vp[t.opeType]})});case 3:case"end":return a.stop()}}),_callee8,this)})))}},{key:"getWhiteBlackRolesPage",value:function getWhiteBlackRolesPage(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee9(){var a,o,c,l;return zr.wrap((function _callee9$(p){for(;;)switch(p.prev=p.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Kp)},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),p.next=3,this.core.sendCmd("qchatGetWhiteBlackRolesPage",{qchatGetWhiteBlackRolesPageTag:ma(ma({},t),{type:Kp[t.type]})});case 3:return a=p.sent,o=a.content,c=o.datas,l=o.listQueryTag,p.abrupt("return",{listQueryTag:{hasMore:1==+l.hasMore,nextTimetag:Oc(l.nextTimetag)},datas:formatRoles(c)});case 6:case"end":return p.stop()}}),_callee9,this)})))}},{key:"updateWhiteBlackMembers",value:function updateWhiteBlackMembers(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee10(){return zr.wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Kp)},opeType:{type:"enum",values:getEnumKeys(Vp)},toAccids:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatUpdateWhiteBlackMembers",{qchatUpdateWhiteBlackMembersTag:ma(ma({},t),{type:Kp[t.type],opeType:Vp[t.opeType],toAccids:Da(t.toAccids)})});case 3:case"end":return a.stop()}}),_callee10,this)})))}},{key:"getWhiteBlackMembersPage",value:function getWhiteBlackMembersPage(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee11(){var a,o,c,l;return zr.wrap((function _callee11$(p){for(;;)switch(p.prev=p.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Kp)},timetag:{type:"number"},limit:{type:"number",min:1,required:!1}},t),p.next=3,this.core.sendCmd("qchatGetWhiteBlackMembersPage",{qchatGetWhiteBlackMembersPageTag:ma(ma({},t),{type:Kp[t.type]})});case 3:return a=p.sent,o=a.content,c=o.datas,l=o.listQueryTag,p.abrupt("return",{listQueryTag:{hasMore:1==+l.hasMore,nextTimetag:Oc(l.nextTimetag)},datas:formatMembers$1(c)});case 6:case"end":return p.stop()}}),_callee11,this)})))}},{key:"getExistingWhiteBlackRoles",value:function getExistingWhiteBlackRoles(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee12(){var a,o;return zr.wrap((function _callee12$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Kp)},roleIds:{type:"array",itemType:"string",min:1}},t),c.next=3,this.core.sendCmd("qchatGetExistingWhiteBlackRoles",{qchatGetExistingWhiteBlackRolesTag:ma(ma({},t),{type:Kp[t.type],roleIds:Da(t.roleIds)})});case 3:return a=c.sent,o=a.content.datas,c.abrupt("return",{datas:formatRoles(o)});case 6:case"end":return c.stop()}}),_callee12,this)})))}},{key:"getExistingWhiteBlackMembers",value:function getExistingWhiteBlackMembers(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee13(){var a,o;return zr.wrap((function _callee13$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",min:1},channelId:{type:"string",min:1},type:{type:"enum",values:getEnumKeys(Kp)},accids:{type:"array",itemType:"string",min:1}},t),c.next=3,this.core.sendCmd("qchatGetExistingWhiteBlackMembers",{qchatGetExistingWhiteBlackMembersTag:ma(ma({},t),{type:Kp[t.type],accids:Da(t.accids)})});case 3:return a=c.sent,o=a.content.datas,c.abrupt("return",{datas:formatMembers$1(o)});case 6:case"end":return c.stop()}}),_callee13,this)})))}},{key:"updateCategoryInfoOfChannel",value:function updateCategoryInfoOfChannel(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee14(){var a;return zr.wrap((function _callee14$(o){for(;;)switch(o.prev=o.next){case 0:return validate({channelId:{type:"string",min:1},categoryId:{type:"string",allowEmpty:!1,required:!1},syncMode:{type:"number",min:0,max:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatUpdateCategoryInfoOfChannel",{qchatUpdateCategoryInfoOfChannelTag:t});case 3:return a=o.sent,o.abrupt("return",formatChannel(a.content.channelInfo));case 5:case"end":return o.stop()}}),_callee14,this)})))}},{key:"createChannelCategory",value:function createChannelCategory(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee15(){var a;return zr.wrap((function _callee15$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",required:!1},viewMode:{type:"number",min:0,max:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatCreateChannelCategory",{qchatCreateChannelCategoryTag:t});case 3:return a=o.sent,o.abrupt("return",formatChannelCategory(a.content.QChatChannelCategoryInfo));case 5:case"end":return o.stop()}}),_callee15,this)})))}},{key:"removeChannelCategory",value:function removeChannelCategory(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee16(){return zr.wrap((function _callee16$(a){for(;;)switch(a.prev=a.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveChannelCategory",t);case 3:case"end":return a.stop()}}),_callee16,this)})))}},{key:"updateChannelCategory",value:function updateChannelCategory(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee17(){var a;return zr.wrap((function _callee17$(o){for(;;)switch(o.prev=o.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1,required:!1},ext:{type:"string",required:!1},viewMode:{type:"number",min:0,max:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatUpdateChannelCategory",{qchatUpdateChannelCategoryTag:t});case 3:return a=o.sent,o.abrupt("return",formatChannelCategory(a.content.QChatChannelCategoryInfo));case 5:case"end":return o.stop()}}),_callee17,this)})))}},{key:"getChannelCategoriesByID",value:function getChannelCategoriesByID(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee18(){var a;return zr.wrap((function _callee18$(o){for(;;)switch(o.prev=o.next){case 0:return validate({categoryIds:{type:"array",itemType:"string",min:1}},t),o.next=3,this.core.sendCmd("qchatGetChannelCategoriesByID",t);case 3:return a=o.sent,o.abrupt("return",formatChannelCategorys(a.content.channelCategoryList));case 5:case"end":return o.stop()}}),_callee18,this)})))}},{key:"updateChannelCategoryWhiteBlackRole",value:function updateChannelCategoryWhiteBlackRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee19(){return zr.wrap((function _callee19$(a){for(;;)switch(a.prev=a.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Kp)},opeType:{type:"enum",values:getEnumKeys(Vp)},roleId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatUpdateChannelCategoryWhiteBlackRole",{qchatUpdateChannelCategoryWhiteBlackRoleTag:ma(ma({},t),{type:Kp[t.type],opeType:Vp[t.opeType]})});case 3:case"end":return a.stop()}}),_callee19,this)})))}},{key:"getChannelCategoryWhiteBlackRolesPage",value:function getChannelCategoryWhiteBlackRolesPage(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee20(){var a,o,c,l;return zr.wrap((function _callee20$(p){for(;;)switch(p.prev=p.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Kp)},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),p.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackRolesPage",{qchatGetChannelCategoryWhiteBlackRolesPageTag:ma(ma({},t),{type:Kp[t.type]})});case 3:return a=p.sent,o=a.content,c=o.datas,l=o.listQueryTag,p.abrupt("return",{listQueryTag:{hasMore:1==+l.hasMore,nextTimetag:Oc(l.nextTimetag)},datas:formatRoles(c)});case 6:case"end":return p.stop()}}),_callee20,this)})))}},{key:"updateChannelCategoryWhiteBlackMembers",value:function updateChannelCategoryWhiteBlackMembers(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee21(){return zr.wrap((function _callee21$(a){for(;;)switch(a.prev=a.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Kp)},opeType:{type:"enum",values:getEnumKeys(Vp)},toAccids:{type:"array",itemType:"string",min:1}},t),a.next=3,this.core.sendCmd("qchatUpdateChannelCategoryWhiteBlackMembers",{qchatUpdateChannelCategoryWhiteBlackMembersTag:ma(ma({},t),{type:Kp[t.type],opeType:Vp[t.opeType],toAccids:Da(t.toAccids)})});case 3:case"end":return a.stop()}}),_callee21,this)})))}},{key:"getChannelCategoryWhiteBlackMembersPage",value:function getChannelCategoryWhiteBlackMembersPage(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee22(){var a,o,c,l;return zr.wrap((function _callee22$(p){for(;;)switch(p.prev=p.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Kp)},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),p.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackMembersPage",{qchatGetChannelCategoryWhiteBlackMembersPageTag:ma(ma({},t),{type:Kp[t.type]})});case 3:return a=p.sent,o=a.content,c=o.datas,l=o.listQueryTag,p.abrupt("return",{listQueryTag:{hasMore:1==+l.hasMore,nextTimetag:Oc(l.nextTimetag)},datas:formatMembers$1(c)});case 6:case"end":return p.stop()}}),_callee22,this)})))}},{key:"getChannelCategoryWhiteBlackRoles",value:function getChannelCategoryWhiteBlackRoles(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee23(){var a,o;return zr.wrap((function _callee23$(c){for(;;)switch(c.prev=c.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Kp)},roleIds:{type:"array",itemType:"string",min:1}},t),c.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackRoles",{qchatGetChannelCategoryWhiteBlackRolesTag:ma(ma({},t),{type:Kp[t.type],roleIds:Da(t.roleIds)})});case 3:return a=c.sent,o=a.content.datas,c.abrupt("return",formatRoles(o));case 6:case"end":return c.stop()}}),_callee23,this)})))}},{key:"getChannelCategoryWhiteBlackMembers",value:function getChannelCategoryWhiteBlackMembers(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee24(){var a,o;return zr.wrap((function _callee24$(c){for(;;)switch(c.prev=c.next){case 0:return validate({categoryId:{type:"string",allowEmpty:!1},serverId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(Kp)},accids:{type:"array",itemType:"string",min:1}},t),c.next=3,this.core.sendCmd("qchatGetChannelCategoryWhiteBlackMembers",{qchatGetChannelCategoryWhiteBlackMembersTag:ma(ma({},t),{type:Kp[t.type],accids:Da(t.accids)})});case 3:return a=c.sent,o=a.content.datas,c.abrupt("return",formatMembers$1(o));case 6:case"end":return c.stop()}}),_callee24,this)})))}},{key:"getChannelCategoriesPage",value:function getChannelCategoriesPage(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee25(){var a,o,c,l;return zr.wrap((function _callee25$(p){for(;;)switch(p.prev=p.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),p.next=3,this.core.sendCmd("qchatGetChannelCategoriesPage",{qchatGetChannelCategoriesPageTag:t});case 3:return a=p.sent,o=a.content,c=o.datas,l=o.listQueryTag,p.abrupt("return",{listQueryTag:{hasMore:1==+l.hasMore,nextTimetag:Oc(l.nextTimetag)},datas:formatChannelCategorys(c)});case 6:case"end":return p.stop()}}),_callee25,this)})))}},{key:"getChannelCategoryChannelsPage",value:function getChannelCategoryChannelsPage(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee26(){var a,o,c,l;return zr.wrap((function _callee26$(p){for(;;)switch(p.prev=p.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0},limit:{type:"number",min:1,required:!1}},t),p.next=3,this.core.sendCmd("qchatGetChannelCategoryChannelsPage",{qchatGetChannelCategoryChannelsPageTag:t});case 3:return a=p.sent,o=a.content,c=o.datas,l=o.listQueryTag,p.abrupt("return",{listQueryTag:{hasMore:1==+l.hasMore,nextTimetag:Oc(l.nextTimetag)},datas:formatChannels(c)});case 6:case"end":return p.stop()}}),_callee26,this)})))}},{key:"subscribeChannel",value:function subscribeChannel(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee27(){var a,o;return zr.wrap((function _callee27$(c){for(;;)switch(c.prev=c.next){case 0:return validate({type:{type:"number",min:1,max:5},opeType:{type:"number",min:1,max:2}},t),c.next=3,this.subscribeModuleService.subscribe(t);case 3:if((o=c.sent).unreadInfos=formatUnreadInfos(o.unreadInfos),t.channels=map(a=o.unreadInfos).call(a,(function(t){return{serverId:t.serverId,channelId:t.channelId}})),this.logger.debug("QChatChannel::subscribeChannel:: cacheSubscribe ",t),this.subscribeModuleService.cacheSubscribe(t),5!==t.type){c.next=10;break}return c.abrupt("return");case 10:return this.subscribeModuleService.cacheUnreadCount(o.unreadInfos),c.abrupt("return",o);case 12:case"end":return c.stop()}}),_callee27,this)})))}},{key:"getChannelUnreadInfos",value:function getChannelUnreadInfos(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee28(){var a,o,c=this;return zr.wrap((function _callee28$(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.core.sendCmd("qchatGetUnreadInfo",t);case 2:return a=l.sent,o=formatUnreadInfos(a.content.unreadInfos),forEach(o).call(o,(function(t){return c.subscribeModuleService.updateUnread(t)})),l.abrupt("return",o);case 6:case"end":return l.stop()}}),_callee28,this)})))}},{key:"getChannelSearchByPage",value:function getChannelSearchByPage(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee29(){var a,o,c,l;return zr.wrap((function _callee29$(p){for(;;)switch(p.prev=p.next){case 0:if(validate({keyword:{type:"string",allowEmpty:!1},startTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:1,required:!1},order:{type:"enum",values:getEnumKeys(yp),required:!1},limit:{type:"number",min:1,required:!1},serverId:{type:"string",required:!1},sort:{type:"enum",values:getEnumKeys(Wp),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),!(t.startTime&&t.endTime&&t.startTime>=t.endTime)){p.next=3;break}throw new Jo("startTime more than endTime",t,"timeRule");case 3:return p.next=5,this.core.sendCmd("qchatGetChannelSearchByPage",{qchatGetChannelSearchByPageTag:ma(ma({},t),{order:t.order&&yp[t.order],sort:sort(t)&&Wp[sort(t)]})});case 5:return a=p.sent,o=a.content,c=o.datas,l=o.listQueryTag,p.abrupt("return",{listQueryTag:{hasMore:1==+l.hasMore,nextTimetag:Oc(l.nextTimetag),cursor:l.cursor},datas:formatChannels(c)});case 8:case"end":return p.stop()}}),_callee29,this)})))}}]),QChatChannelService}(_p),Jd={"24_61":"qchatCreateServerRole","24_62":"qchatDeleteServerRole","24_63":"qchatUpdateServerRole","24_64":"qchatGetServerRoles","24_65":"qchatAddChannelRole","24_66":"qchatRemoveChannelRole","24_67":"qchatUpdateChannelRole","24_68":"qchatGetChannelRoles","24_69":"qchatAddMemberRole","24_70":"qchatRemoveMemberRole","24_71":"qchatUpdateMemberRole","24_72":"qchatGetMemberRoles","24_73":"qchatAddMembersToServerRole","24_74":"qchatRemoveMembersFromServerRole","24_75":"qchatGetMembersFromServerRole","24_76":"qchatGetServerRolesByAccid","24_77":"qchatGetExistingServerRolesByAccids","24_78":"qchatGetExistingChannelRolesByServerRoleIds","24_79":"qchatGetExistingAccidsOfMemberRoles","24_80":"qchatUpdateServerRolePriorities","24_81":"qchatGetExistingAccidsInServerRole","24_82":"qchatCheckPermission","24_83":"qchatAddChannelCategoryRole","24_84":"qchatRemoveChannelCategoryRole","24_85":"qchatUpdateChannelCategoryRole","24_86":"qchatGetChannelCategoryRole","24_87":"qchatAddChannelCategoryMemberRole","24_88":"qchatRemoveChannelCategoryMemberRole","24_89":"qchatUpdateChannelCategoryMemberRole","24_90":"qchatGetChannelCategoryMemberRole","24_126":"qchatCheckPermissions"},Yd={channelRole:{serverId:1,roleId:2,parentRoleId:3,channelId:4,name:5,icon:6,ext:7,auths:8,type:9,createTime:10,updateTime:11},memberRole:{serverId:1,id:2,accid:3,channelId:4,auths:5,createTime:6,updateTime:7,nick:8,avatar:9,ext:10,memberType:11,joinTime:12,inviter:13},antispamTag:{antiSpamBusinessId:1},serverRole:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,type:7,memberCount:8,priority:9,createTime:10,updateTime:11,isMember:12},getRoleByPagesTag:{serverId:1,channelId:2,time:3,limit:4},checkPermissionTag:{serverId:1,channelId:2,auth:3},member:{serverId:1,roleId:2,accid:3,createTime:4,updateTime:5,nick:6,avatar:7,ext:8,type:9,joinTime:10,inviter:11},qchatAddChannelCategoryRoleTag:{categoryId:3,serverId:4,parentRoleId:5},channelCategoryRole:{roleId:1,categoryId:3,serverId:4,parentRoleId:5,type:6,validFlag:7,createTime:8,updateTime:9,auths:10,name:11,icon:12,ext:13},qchatGetChannelCategoryRoleTag:{serverId:1,categoryId:2,timetag:3,limit:4},channelCategoryMemberRole:{id:1,accid:3,categoryId:4,serverId:5,validFlag:6,createTime:7,updateTime:8,auths:9,nick:10,avatar:11,ext:12,memberType:13,joinTime:14,inviter:15},qchatGetChannelCategoryMemberRoleTag:{serverId:1,categoryId:2,timetag:3,limit:4},checkPermissionsTag:{serverId:1,channelId:2,auths:3}},Xd=invertSerializeMap(Yd),Zd={qchatCreateServerRole:{service:"qchatRole",sid:24,cid:61,params:[{type:"Property",name:"serverRole",reflectMapper:Yd.serverRole},{type:"Property",name:"antispamTag",reflectMapper:Yd.antispamTag}],response:[{type:"Property",name:"serverRole",reflectMapper:Xd.serverRole}]},qchatDeleteServerRole:{service:"qchatRole",sid:24,cid:62,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"}]},qchatUpdateServerRole:{service:"qchatRole",sid:24,cid:63,params:[{type:"Property",name:"updateServerRoleTag",reflectMapper:{serverId:1,roleId:2,name:3,icon:4,ext:5,auths:6,priority:7}},{type:"Property",name:"antispamTag",reflectMapper:Yd.antispamTag}],response:[{type:"Property",name:"serverRole",reflectMapper:Xd.serverRole}]},qchatGetServerRoles:{service:"qchatRole",sid:24,cid:64,params:[{type:"Property",name:"getServerRolesTag",reflectMapper:{serverId:1,timetag:2,limit:3,priority:4,channelId:5,categoryId:6}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:Xd.serverRole}]},qchatAddChannelRole:{service:"qchatRole",sid:24,cid:65,params:[{type:"Property",name:"channelRole",reflectMapper:Yd.channelRole}],response:[{type:"Property",name:"channelRole",reflectMapper:Xd.channelRole}]},qchatRemoveChannelRole:{service:"qchatRole",sid:24,cid:66,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"Long",name:"roleId"}]},qchatUpdateChannelRole:{service:"qchatRole",sid:24,cid:67,params:[{type:"Property",name:"updateChannelRoleTag",reflectMapper:{serverId:1,roleId:2,channelId:3,auths:4}}],response:[{type:"Property",name:"channelRole",reflectMapper:Xd.channelRole}]},qchatGetChannelRoles:{service:"qchatRole",sid:24,cid:68,params:[{type:"Property",name:"getChannelRolesTag",reflectMapper:{serverId:1,channelId:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"channelRoles",reflectMapper:Xd.channelRole}]},qchatAddMemberRole:{service:"qchatRole",sid:24,cid:69,params:[{type:"Property",name:"memberRole",reflectMapper:Yd.memberRole}],response:[{type:"Property",name:"memberRole",reflectMapper:Xd.memberRole}]},qchatRemoveMemberRole:{service:"qchatRole",sid:24,cid:70,params:[{type:"Property",name:"memberRole",reflectMapper:Yd.memberRole}]},qchatUpdateMemberRole:{service:"qchatRole",sid:24,cid:71,params:[{type:"Property",name:"updateMemberRoleTag",reflectMapper:{serverId:1,accid:2,channelId:3,auths:4}}],response:[{type:"Property",name:"memberRole",reflectMapper:Xd.memberRole}]},qchatGetMemberRoles:{service:"qchatRole",sid:24,cid:72,params:[{type:"Property",name:"getMemberRolesTag",reflectMapper:{serverId:1,channelId:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"memberRoles",reflectMapper:Xd.memberRole}]},qchatAddMembersToServerRole:{service:"qchatRole",sid:24,cid:73,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"Property",name:"accids",reflectMapper:{1:"successAccids",2:"failedAccids"}}]},qchatRemoveMembersFromServerRole:{service:"qchatRole",sid:24,cid:74,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"Property",name:"accids",reflectMapper:{1:"successAccids",2:"failedAccids"}}]},qchatGetMembersFromServerRole:{service:"qchatRole",sid:24,cid:75,params:[{type:"Property",name:"getMembersFromServerRoleTag",reflectMapper:{serverId:1,roleId:2,timetag:3,accid:4,limit:5}}],response:[{type:"PropertyArray",name:"members",reflectMapper:Xd.member}]},qchatGetServerRolesByAccid:{service:"qchatRole",sid:24,cid:76,params:[{type:"Property",name:"getServerRolesByAccidTag",reflectMapper:{serverId:1,accid:2,timetag:3,limit:4}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:Xd.serverRole}]},qchatGetExistingServerRolesByAccids:{service:"qchatRole",sid:24,cid:77,params:[{type:"Long",name:"serverId"},{type:"String",name:"accids"}],response:[{type:"String",name:"serverRoles"}]},qchatGetExistingChannelRolesByServerRoleIds:{service:"qchatRole",sid:24,cid:78,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"String",name:"roleIds"}],response:[{type:"PropertyArray",name:"channelRoles",reflectMapper:Xd.channelRole}]},qchatGetExistingAccidsOfMemberRoles:{service:"qchatRole",sid:24,cid:79,params:[{type:"Long",name:"serverId"},{type:"Long",name:"channelId"},{type:"String",name:"accids"}],response:[{type:"PropertyArray",name:"memberRoles",reflectMapper:Xd.memberRole}]},qchatUpdateServerRolePriorities:{service:"qchatRole",sid:24,cid:80,params:[{type:"Long",name:"serverId"},{type:"PropertyArray",name:"serverRoles",reflectMapper:{serverId:1,roleId:2,priority:7}}],response:[{type:"PropertyArray",name:"serverRoles",reflectMapper:Xd.serverRole}]},qchatGetExistingAccidsInServerRole:{service:"qchatRole",sid:24,cid:81,params:[{type:"Long",name:"serverId"},{type:"Long",name:"roleId"},{type:"String",name:"accids"}],response:[{type:"PropertyArray",name:"members",reflectMapper:Xd.member}]},qchatCheckPermission:{service:"qchatRole",sid:24,cid:82,params:[{type:"Property",name:"checkPermissionTag",reflectMapper:Yd.checkPermissionTag}],response:[{type:"Boolean",name:"checked"}]},qchatAddChannelCategoryRole:{service:"qchatRole",sid:24,cid:83,params:[{type:"Property",name:"qchatAddChannelCategoryRoleTag",reflectMapper:Yd.channelCategoryRole}],response:[{type:"Property",name:"channelCategoryRole",reflectMapper:Xd.channelCategoryRole}]},qchatRemoveChannelCategoryRole:{service:"qchatRole",sid:24,cid:84,params:[{type:"Long",name:"serverId"},{type:"Long",name:"categoryId"},{type:"Long",name:"roleId"}]},qchatUpdateChannelCategoryRole:{service:"qchatRole",sid:24,cid:85,params:[{type:"Property",name:"qchatUpdateChannelCategoryRoleTag",reflectMapper:Yd.channelCategoryRole}],response:[{type:"Property",name:"channelCategoryRole",reflectMapper:Xd.channelCategoryRole}]},qchatGetChannelCategoryRole:{service:"qchatRole",sid:24,cid:86,params:[{type:"Property",name:"qchatGetChannelCategoryRoleTag",reflectMapper:Yd.qchatGetChannelCategoryRoleTag}],response:[{type:"PropertyArray",name:"list",reflectMapper:Xd.channelCategoryRole}]},qchatAddChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:87,params:[{type:"Property",name:"qchatAddChannelCategoryMemberRoleTag",reflectMapper:Yd.channelCategoryMemberRole}],response:[{type:"Property",name:"channelCategoryMemberRole",reflectMapper:Xd.channelCategoryMemberRole}]},qchatRemoveChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:88,params:[{type:"Long",name:"serverId"},{type:"Long",name:"categoryId"},{type:"String",name:"accid"}]},qchatUpdateChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:89,params:[{type:"Property",name:"qchatUpdateChannelCategoryMemberRoleTag",reflectMapper:Yd.channelCategoryMemberRole}],response:[{type:"Property",name:"channelCategoryMemberRole",reflectMapper:Xd.channelCategoryMemberRole}]},qchatGetChannelCategoryMemberRole:{service:"qchatRole",sid:24,cid:90,params:[{type:"Property",name:"qchatGetChannelCategoryMemberRoleTag",reflectMapper:Yd.qchatGetChannelCategoryMemberRoleTag}],response:[{type:"PropertyArray",name:"list",reflectMapper:Xd.channelCategoryMemberRole}]},qchatCheckPermissions:{service:"qchatRole",sid:24,cid:126,params:[{type:"Property",name:"checkPermissionsTag",reflectMapper:Yd.checkPermissionsTag}],response:[{type:"PropertyArray",name:"checkPermissionsResult",reflectMapper:{1:"auth",2:"isAllow"}}]}},eh=function(){function CategoryModuleService(t){ue(this,CategoryModuleService),this.core=t}return he(CategoryModuleService,[{key:"addChannelCategoryRole",value:function addChannelCategoryRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee(){var a;return zr.wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},parentRoleId:{type:"string",allowEmpty:!1}},t),o.next=3,this.core.sendCmd("qchatAddChannelCategoryRole",{qchatAddChannelCategoryRoleTag:t});case 3:return a=o.sent,o.abrupt("return",formatChannelCategoryRole(a.content.channelCategoryRole));case 5:case"end":return o.stop()}}),_callee,this)})))}},{key:"removeChannelCategoryRole",value:function removeChannelCategoryRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee2(){return zr.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveChannelCategoryRole",t);case 3:case"end":return a.stop()}}),_callee2,this)})))}},{key:"updateChannelCategoryRole",value:function updateChannelCategoryRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee3(){var a;return zr.wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},auths:{type:"object"}},t),o.next=3,this.core.sendCmd("qchatUpdateChannelCategoryRole",{qchatUpdateChannelCategoryRoleTag:generatorRoleForCmd(t)});case 3:if(406!==(a=o.sent).raw.code){o.next=6;break}throw new Ho("No update required",{},406);case 6:return o.abrupt("return",formatChannelCategoryRole(a.content.channelCategoryRole));case 7:case"end":return o.stop()}}),_callee3,this)})))}},{key:"getChannelCategoryRole",value:function getChannelCategoryRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee4(){var a;return zr.wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetChannelCategoryRole",{qchatGetChannelCategoryRoleTag:t});case 3:return a=o.sent,o.abrupt("return",(c=a.content.list,mi(c)&&c.length>0?map(c).call(c,(function(t){return formatChannelCategoryRole(t)})):[]));case 5:case"end":return o.stop()}var c}),_callee4,this)})))}},{key:"addChannelCategoryMemberRole",value:function addChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee5(){var a;return zr.wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),o.next=3,this.core.sendCmd("qchatAddChannelCategoryMemberRole",{qchatAddChannelCategoryMemberRoleTag:t});case 3:return a=o.sent,o.abrupt("return",formatChannelCategoryMemberRole(a.content.channelCategoryMemberRole));case 5:case"end":return o.stop()}}),_callee5,this)})))}},{key:"removeChannelCategoryMemberRole",value:function removeChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee6(){return zr.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveChannelCategoryMemberRole",t);case 3:case"end":return a.stop()}}),_callee6,this)})))}},{key:"updateChannelCategoryMemberRole",value:function updateChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee7(){var a;return zr.wrap((function _callee7$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},auths:{type:"object"}},t),o.next=3,this.core.sendCmd("qchatUpdateChannelCategoryMemberRole",{qchatUpdateChannelCategoryMemberRoleTag:generatorRoleForCmd(t)});case 3:if(406!==(a=o.sent).raw.code){o.next=6;break}throw new Ho("No update required",{},406);case 6:return o.abrupt("return",formatChannelCategoryMemberRole(a.content.channelCategoryMemberRole));case 7:case"end":return o.stop()}}),_callee7,this)})))}},{key:"getChannelCategoryMemberRole",value:function getChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee8(){var a;return zr.wrap((function _callee8$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},categoryId:{type:"string",allowEmpty:!1},timetag:{type:"number",min:0,required:!1},limit:{type:"number",min:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetChannelCategoryMemberRole",{qchatGetChannelCategoryMemberRoleTag:t});case 3:return a=o.sent,o.abrupt("return",(c=a.content.list,mi(c)&&c.length>0?map(c).call(c,(function(t){return formatChannelCategoryMemberRole(t)})):[]));case 5:case"end":return o.stop()}var c}),_callee8,this)})))}}]),CategoryModuleService}();function _createSuper$4(t){var a=function _isNativeReflectConstruct$4(){if("undefined"==typeof Reflect||!le)return!1;if(le.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(le(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,c=qe(t);if(a){var l=qe(this).constructor;o=le(c,arguments,l)}else o=c.apply(this,arguments);return Kr(this,o)}}var th=function(t){Ne(QChatRoleService,t);var a=_createSuper$4(QChatRoleService);function QChatRoleService(t){var o;return ue(this,QChatRoleService),(o=a.call(this,"qchatRole",t)).core=t,registerParser({cmdMap:Jd,cmdConfig:Zd}),o.category=new eh(t),o}return he(QChatRoleService,[{key:"createServerRole",value:function createServerRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee(){var a;return zr.wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},name:{type:"string",allowEmpty:!1},priority:{type:"number",min:1},icon:{type:"string",required:!1},ext:{type:"string",required:!1}},t),o.next=3,this.core.sendCmd("qchatCreateServerRole",{serverRole:ma(ma({},generatorRoleForCmd(t)),{type:id.custom}),antispamTag:generateAntispamTag(t)});case 3:return a=o.sent,o.abrupt("return",formatRole(a.content.serverRole));case 5:case"end":return o.stop()}}),_callee,this)})))}},{key:"updateServerRole",value:function updateServerRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee2(){var a;return zr.wrap((function _callee2$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},name:{type:"string",required:!1},icon:{type:"string",required:!1},ext:{type:"string",required:!1},priority:{type:"number",required:!1},auths:{type:"object",required:!1}},t),o.next=3,this.core.sendCmd("qchatUpdateServerRole",{updateServerRoleTag:generatorRoleForCmd(t),antispamTag:generateAntispamTag(t)});case 3:return a=o.sent,o.abrupt("return",formatRole(a.content.serverRole));case 5:case"end":return o.stop()}}),_callee2,this)})))}},{key:"deleteServerRole",value:function deleteServerRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee3(){return zr.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatDeleteServerRole",t);case 3:case"end":return a.stop()}}),_callee3,this)})))}},{key:"getServerRoles",value:function getServerRoles(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee4(){var a,o,c;return zr.wrap((function _callee4$(l){for(;;)switch(l.prev=l.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},categoryId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1},priority:{type:"number",required:!1}},t),l.next=3,this.core.sendCmd("qchatGetServerRoles",{getServerRolesTag:generatorRoleForCmd(t)});case 3:return o=l.sent,c=filter(a=o.content.serverRoles).call(a,(function(t){return 1===Oc(t.isMember)})),c=map(c).call(c,(function(t){return t.roleId})),l.abrupt("return",{roles:formatRoles(o.content.serverRoles),isMemberRoles:c});case 7:case"end":return l.stop()}}),_callee4,this)})))}},{key:"addChannelRole",value:function addChannelRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee5(){var a;return zr.wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},parentRoleId:{type:"string",allowEmpty:!1}},t),o.next=3,this.core.sendCmd("qchatAddChannelRole",{channelRole:generatorRoleForCmd(t)});case 3:return a=o.sent,o.abrupt("return",formatRole(a.content.channelRole));case 5:case"end":return o.stop()}}),_callee5,this)})))}},{key:"getChannelRoles",value:function getChannelRoles(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee6(){var a;return zr.wrap((function _callee6$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetChannelRoles",{getChannelRolesTag:t});case 3:return a=o.sent,o.abrupt("return",formatRoles(a.content.channelRoles));case 5:case"end":return o.stop()}}),_callee6,this)})))}},{key:"removeChannelRole",value:function removeChannelRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee7(){return zr.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveChannelRole",t);case 3:case"end":return a.stop()}}),_callee7,this)})))}},{key:"updateChannelRole",value:function updateChannelRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee8(){var a;return zr.wrap((function _callee8$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},auths:{type:"object",required:!1}},t),o.next=3,this.core.sendCmd("qchatUpdateChannelRole",{updateChannelRoleTag:generatorRoleForCmd(t)});case 3:if(406!==(a=o.sent).raw.code){o.next=6;break}throw new Ho("No update required",{},406);case 6:return o.abrupt("return",formatRole(a.content.channelRole));case 7:case"end":return o.stop()}}),_callee8,this)})))}},{key:"addMemberRole",value:function addMemberRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee9(){var a;return zr.wrap((function _callee9$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),o.next=3,this.core.sendCmd("qchatAddMemberRole",{memberRole:t});case 3:return a=o.sent,o.abrupt("return",formatRole(a.content.memberRole));case 5:case"end":return o.stop()}}),_callee9,this)})))}},{key:"getMemberRoles",value:function getMemberRoles(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee10(){var a;return zr.wrap((function _callee10$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetMemberRoles",{getMemberRolesTag:t});case 3:return a=o.sent,o.abrupt("return",formatRoles(a.content.memberRoles));case 5:case"end":return o.stop()}}),_callee10,this)})))}},{key:"removeMemberRole",value:function removeMemberRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee11(){return zr.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatRemoveMemberRole",{memberRole:t});case 3:case"end":return a.stop()}}),_callee11,this)})))}},{key:"updateMemberRole",value:function updateMemberRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee12(){var a;return zr.wrap((function _callee12$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},auths:{type:"object",required:!1}},t),o.next=3,this.core.sendCmd("qchatUpdateMemberRole",{updateMemberRoleTag:generatorRoleForCmd(t)});case 3:if(406!==(a=o.sent).raw.code){o.next=6;break}throw new Ho("No update required",{},406);case 6:return o.abrupt("return",formatRole(a.content.memberRole));case 7:case"end":return o.stop()}}),_callee12,this)})))}},{key:"addMembersToServerRole",value:function addMembersToServerRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee13(){var a,o,c;return zr.wrap((function _callee13$(l){for(;;)switch(l.prev=l.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string",min:1}},t),l.next=3,this.core.sendCmd("qchatAddMembersToServerRole",ma(ma({},t),{accids:Da(t.accids)}));case 3:return a=l.sent,o=_u(a,"content.accids.successAccids"),c=_u(a,"content.accids.failedAccids"),l.abrupt("return",{successAccids:o?JSON.parse(o):[],failedAccids:c?JSON.parse(c):[]});case 7:case"end":return l.stop()}}),_callee13,this)})))}},{key:"removeMembersFromServerRole",value:function removeMembersFromServerRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee14(){var a,o,c;return zr.wrap((function _callee14$(l){for(;;)switch(l.prev=l.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string",min:1}},t),l.next=3,this.core.sendCmd("qchatRemoveMembersFromServerRole",ma(ma({},t),{accids:Da(t.accids)}));case 3:return a=l.sent,o=_u(a,"content.accids.successAccids"),c=_u(a,"content.accids.failedAccids"),l.abrupt("return",{successAccids:o?JSON.parse(o):[],failedAccids:c?JSON.parse(c):[]});case 7:case"end":return l.stop()}}),_callee14,this)})))}},{key:"getMembersFromServerRole",value:function getMembersFromServerRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee15(){var a;return zr.wrap((function _callee15$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},accid:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetMembersFromServerRole",{getMembersFromServerRoleTag:t});case 3:return a=o.sent,o.abrupt("return",formatRoles(a.content.members));case 5:case"end":return o.stop()}}),_callee15,this)})))}},{key:"getServerRolesByAccid",value:function getServerRolesByAccid(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee16(){var a;return zr.wrap((function _callee16$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accid:{type:"string",allowEmpty:!1},timetag:{type:"number",required:!1},limit:{type:"number",min:1,required:!1}},t),o.next=3,this.core.sendCmd("qchatGetServerRolesByAccid",{getServerRolesByAccidTag:t});case 3:return a=o.sent,o.abrupt("return",formatRoles(a.content.serverRoles));case 5:case"end":return o.stop()}}),_callee16,this)})))}},{key:"getExistingServerRolesByAccids",value:function getExistingServerRolesByAccids(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee17(){var a,o,c,l;return zr.wrap((function _callee17$(p){for(;;)switch(p.prev=p.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},t),p.next=3,this.core.sendCmd("qchatGetExistingServerRolesByAccids",{serverId:t.serverId,accids:Da(t.accids)});case 3:return a=p.sent,p.prev=4,c=JSON.parse(a.content.serverRoles),forEach(o=pi(c)).call(o,(function(t){var a;forEach(a=c[t]).call(a,(function(a,o){c[t][o]=deserialize(a,Xd.serverRole)})),c[t]=formatRoles(c[t])})),p.abrupt("return",c);case 10:throw p.prev=10,p.t0=p.catch(4),this.logger.error(concat(l="can not parse serverRolesGroupByAccid from ".concat(t.serverId," and ")).call(l,t.accids),a.content.serverRoles),p.t0;case 14:case"end":return p.stop()}}),_callee17,this,[[4,10]])})))}},{key:"getExistingChannelRolesByServerRoleIds",value:function getExistingChannelRolesByServerRoleIds(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee18(){var a;return zr.wrap((function _callee18$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},roleIds:{type:"array",itemType:"string"}},t),o.next=3,this.core.sendCmd("qchatGetExistingChannelRolesByServerRoleIds",{serverId:t.serverId,channelId:t.channelId,roleIds:Da(t.roleIds)});case 3:return a=o.sent,o.abrupt("return",formatRoles(a.content.channelRoles));case 5:case"end":return o.stop()}}),_callee18,this)})))}},{key:"getExistingAccidsOfMemberRoles",value:function getExistingAccidsOfMemberRoles(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee19(){var a,o;return zr.wrap((function _callee19$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},t),c.next=3,this.core.sendCmd("qchatGetExistingAccidsOfMemberRoles",{serverId:t.serverId,channelId:t.channelId,accids:Da(t.accids)});case 3:return a=c.sent,o=a.content.memberRoles,c.abrupt("return",o&&o.length>0?map(o).call(o,(function(t){return t.accid})):[]);case 6:case"end":return c.stop()}}),_callee19,this)})))}},{key:"getExistingAccidsInServerRole",value:function getExistingAccidsInServerRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee20(){var a,o;return zr.wrap((function _callee20$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},roleId:{type:"string",allowEmpty:!1},accids:{type:"array",itemType:"string"}},t),c.next=3,this.core.sendCmd("qchatGetExistingAccidsInServerRole",{serverId:t.serverId,roleId:t.roleId,accids:Da(t.accids)});case 3:return a=c.sent,o=a.content.members,c.abrupt("return",o&&o.length>0?map(o).call(o,(function(t){return t.accid})):[]);case 6:case"end":return c.stop()}}),_callee20,this)})))}},{key:"updateServerRolePriorities",value:function updateServerRolePriorities(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee21(){var a,o;return zr.wrap((function _callee21$(c){for(;;)switch(c.prev=c.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},serverRoles:{type:"array"}},t),c.next=3,this.core.sendCmd("qchatUpdateServerRolePriorities",{serverId:t.serverId,serverRoles:map(a=t.serverRoles).call(a,(function(t){return{serverId:t.serverId,roleId:t.roleId,priority:t.priority}}))});case 3:return o=c.sent,c.abrupt("return",formatRoles(o.content.serverRoles));case 5:case"end":return c.stop()}}),_callee21,this)})))}},{key:"checkPermission",value:function checkPermission(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee22(){var a;return zr.wrap((function _callee22$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},auth:{type:"enum",values:getEnumKeys(ld)}},t),o.next=3,this.core.sendCmd("qchatCheckPermission",{checkPermissionTag:ma(ma({},t),{auth:ld[t.auth]})});case 3:return a=o.sent,o.abrupt("return",a.content.checked);case 5:case"end":return o.stop()}}),_callee22,this)})))}},{key:"addChannelCategoryRole",value:function addChannelCategoryRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee23(){return zr.wrap((function _callee23$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.addChannelCategoryRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee23,this)})))}},{key:"removeChannelCategoryRole",value:function removeChannelCategoryRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee24(){return zr.wrap((function _callee24$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.removeChannelCategoryRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee24,this)})))}},{key:"updateChannelCategoryRole",value:function updateChannelCategoryRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee25(){return zr.wrap((function _callee25$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.updateChannelCategoryRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee25,this)})))}},{key:"getChannelCategoryRole",value:function getChannelCategoryRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee26(){return zr.wrap((function _callee26$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.getChannelCategoryRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee26,this)})))}},{key:"addChannelCategoryMemberRole",value:function addChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee27(){return zr.wrap((function _callee27$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.addChannelCategoryMemberRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee27,this)})))}},{key:"removeChannelCategoryMemberRole",value:function removeChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee28(){return zr.wrap((function _callee28$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.removeChannelCategoryMemberRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee28,this)})))}},{key:"updateChannelCategoryMemberRole",value:function updateChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee29(){return zr.wrap((function _callee29$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.updateChannelCategoryMemberRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee29,this)})))}},{key:"getChannelCategoryMemberRole",value:function getChannelCategoryMemberRole(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee30(){return zr.wrap((function _callee30$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.category.getChannelCategoryMemberRole(t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),_callee30,this)})))}},{key:"checkPermissions",value:function checkPermissions(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee31(){var a,o,c,l;return zr.wrap((function _callee31$(p){for(;;)switch(p.prev=p.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},auths:{type:"array",itemType:"enum",values:getEnumKeys(ld)}},t),this.core.logger.log("qchatRole::checkPermission options is",t),p.next=4,this.core.sendCmd("qchatCheckPermissions",{checkPermissionsTag:ma(ma({},t),{auths:Da(map(a=t.auths).call(a,(function(t){return ld[t]})))})});case 4:return c=p.sent,this.core.logger.log("qchatRole::checkPermission result is",c.content),l={},forEach(o=c.content.checkPermissionsResult).call(o,(function(t){l[t.auth]=t.isAllow})),this.core.logger.log("qchatRole::checkPermission auths is",l),p.abrupt("return",formatRoleAuths(l));case 10:case"end":return p.stop()}}),_callee31,this)})))}}]),QChatRoleService}(_p);var rh=function basePick(t,a){return ju(t,a,(function(a,o){return ku(t,o)}))};var nh=function flatten(t){return(null==t?0:t.length)?nd(t,1):[]};var ah,oh=function flatRest(t){return rc(Js(t,void 0,nh),t+"")}((function(t,a){return null==t?{}:rh(t,a)})),ih={"24_10":"qchatSendMsg","24_11":"qchatOnMsg","24_12":"qchatOnRecvUnreadInfo","24_13":"qchatSendCustomSysMsg","24_14":"qchatOnSysMsg","24_16":"qchatGetHistoryMsg","24_17":"qchatMarkMessageRead","24_18":"qchatMultiSyncMessageRead","24_22":"qchatUpdateSystemNotification","24_23":"qchatMultiSyncSystemNotificationUpdate","24_24":"qchatSyncSystemNotification","24_25":"qchatUpdateMessage","24_26":"qchatRecvMessageUpdate","24_28":"qchatMarkSysMsgRead","24_94":"qchatMessageSearchByPage","24_100":"qchatGetMessageHistoryByIds","24_101":"qchatGetThreadMessages","24_102":"qchatUpdateQuickComment","24_103":"qchatGetQuickComments","24_108":"qchatGetThreadRootMessagesMeta","24_121":"qchatGetLastMessageOfChannels","25_6":"qchatMultiSyncServersMessageRead"},sh={getHistoryMsgTag:{serverId:1,channelId:2,beginTime:3,endTime:4,excludeMsgId:5,limit:6,reverse:7},getThreadHistoryMsgTag:{beginTime:1,endTime:2,excludeMsgId:3,limit:4,reverse:5},qchatMsgTag:{serverId:1,channelId:2,fromAccount:3,fromClientType:4,fromDeviceId:5,fromNick:6,time:7,updateTime:8,type:9,body:10,attach:11,ext:12,msgIdClient:13,msgIdServer:14,resendFlag:15,status:16,pushPayload:17,pushContent:18,mentionAccids:19,mentionAll:20,env:21,callbackExt:22,replyMsgFromAccount:23,replyMsgTime:24,replyMsgIdServer:25,replyMsgIdClient:26,threadMsgFromAccount:27,threadMsgTime:28,threadMsgIdServer:29,threadMsgIdClient:30,useCustomContent:31,antiSpamContent:32,antiSpamBusinessId:33,antiSpamUsingYidun:34,yidunCallback:35,yidunAntiCheating:36,yidunAntiSpamExt:37,yidunAntiSpamRes:38,updateContent:39,updateOperatorInfo:40,subType:61,historyEnable:100,pushEnable:101,needBadge:102,needPushNick:103,notifyReason:104,routeEnable:105,isAntispam:106},sysMsg:{toType:1,serverId:2,channelId:3,toAccids:4,fromAccount:5,fromClientType:6,fromDeviceId:7,fromNick:8,time:9,updateTime:10,type:11,msgIdClient:12,msgIdServer:13,body:14,attach:15,ext:16,resendFlag:17,status:18,pushPayload:19,pushContent:20,env:21,callbackExt:22,persistEnable:100,pushEnable:101,needBadge:102,needPushNick:103,routeEnable:104},qchatMsgUpdateTag:{operatorAccount:1,operatorClientType:2,ps:3,ext:4,pushContent:5,pushPayload:6,env:7,routeEnable:100},markMsgReadTag:{serverId:1,channelId:2,time:3},qchatQuickCommentRequestTag:{serverId:1,channelId:2,fromAccount:3,msgIdServer:4,time:5,type:6,opeType:7,opeAccid:8},qchatQuickCommentQueryTag:{serverId:1,channelId:2,msgIdServerList:3},qchatGetLastMessageOfChannelsTag:{serverId:1,channelIdList:2},qchatMultiSyncServersMessageReadTag:{successServerIds:1,failServerIds:2,ackTimestamp:3},qchatMessageSearchByPageTag:{keyword:1,serverId:2,channelId:3,fromAccid:4,fromTime:5,toTime:6,msgTypes:7,subTypes:8,includeSelf:9,order:10,limit:11,sort:12,cursor:13},unreadInfo:wp},ch=invertSerializeMap(sh),lh={qchatSendMsg:{service:"qchatMsg",sid:24,cid:10,params:[{type:"Property",name:"qchatMsg",reflectMapper:sh.qchatMsgTag}],response:[{type:"Property",name:"qchatMsg",reflectMapper:ch.qchatMsgTag}]},qchatOnMsg:{service:"qchatMsg",sid:24,cid:11,response:[{type:"Property",name:"qchatMsg",reflectMapper:ch.qchatMsgTag}]},qchatOnRecvUnreadInfo:{service:"qchatMsg",sid:24,cid:12,response:[{type:"Property",name:"qchatMsg",reflectMapper:ch.qchatMsgTag}]},qchatSendCustomSysMsg:{service:"qchatMsg",sid:24,cid:13,params:[{type:"Property",name:"sysMsg",reflectMapper:sh.sysMsg}],response:[{type:"Property",name:"sysMsg",reflectMapper:ch.sysMsg}]},qchatOnSysMsg:{service:"qchatMsg",sid:24,cid:14,response:[{type:"Property",name:"sysMsg",reflectMapper:ch.sysMsg}]},qchatGetHistoryMsg:{service:"qchatMsg",sid:24,cid:16,params:[{type:"Property",name:"getHistoryMsgTag",reflectMapper:sh.getHistoryMsgTag}],response:[{type:"PropertyArray",name:"qchatMsgs",reflectMapper:ch.qchatMsgTag}]},qchatUpdateMessage:{service:"qchatMsg",sid:24,cid:25,params:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:sh.qchatMsgUpdateTag},{type:"Property",name:"qchatMsg",reflectMapper:sh.qchatMsgTag}],response:[{type:"Property",name:"qchatMsg",reflectMapper:ch.qchatMsgTag}]},qchatRecvMessageUpdate:{service:"qchatMsg",sid:24,cid:26,response:[{type:"Property",name:"qchatMsgUpdateInfo",reflectMapper:ch.qchatMsgUpdateTag},{type:"Property",name:"qchatMsg",reflectMapper:ch.qchatMsgTag}]},qchatMarkMessageRead:{sid:24,cid:17,service:"qchatMsg",params:[{type:"Property",name:"markMsgReadTag",reflectMapper:sh.markMsgReadTag}],response:[{type:"Property",name:"unreadInfo",reflectMapper:ch.unreadInfo}]},qchatMultiSyncMessageRead:{sid:24,cid:18,service:"qchatMsg",response:[{type:"Property",name:"unreadInfo",reflectMapper:ch.unreadInfo}]},qchatUpdateSystemNotification:{service:"qchatMsg",sid:24,cid:22,params:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:sh.qchatMsgUpdateTag},{type:"Property",name:"sysMsg",reflectMapper:sh.sysMsg}],response:[{type:"Property",name:"sysMsg",reflectMapper:ch.sysMsg}]},qchatMultiSyncSystemNotificationUpdate:{service:"qchatMsg",sid:24,cid:23,response:[{type:"Property",name:"qchatMsgUpdateTag",reflectMapper:ch.qchatMsgUpdateTag},{type:"Property",name:"sysMsg",reflectMapper:ch.sysMsg}]},qchatSyncSystemNotification:{service:"qchatMsg",sid:24,cid:24,response:[{type:"PropertyArray",name:"systemNotifications",reflectMapper:ch.sysMsg}]},qchatMarkSysMsgRead:{service:"qchatMsg",sid:24,cid:28,params:[{type:"PropertyArray",name:"sysMsgs",reflectMapper:sh.sysMsg}]},qchatMessageSearchByPage:{service:"qchatMsg",sid:24,cid:94,params:[{type:"Property",name:"qchatMessageSearchByPageTag",reflectMapper:sh.qchatMessageSearchByPageTag}],response:[{type:"Property",name:"listQueryTag",reflectMapper:{1:"hasMore",2:"nextTimetag",3:"cursor"}},{type:"PropertyArray",name:"datas",reflectMapper:ch.qchatMsgTag}]},qchatGetMessageHistoryByIds:{service:"qchatMsg",sid:24,cid:100,params:[{type:"Property",name:"channelInfo",reflectMapper:{serverId:1,channelId:2}},{type:"PropertyArray",name:"messageReferList",reflectMapper:{msgIdServer:1,time:2}}],response:[{type:"PropertyArray",name:"qchatMsgs",reflectMapper:ch.qchatMsgTag}]},qchatGetThreadMessages:{service:"qchatMsg",sid:24,cid:101,params:[{type:"Property",name:"qchatMsg",reflectMapper:sh.qchatMsgTag},{type:"Property",name:"getThreadHistoryMsgTag",reflectMapper:sh.getThreadHistoryMsgTag}],response:[{type:"Property",name:"thread",reflectMapper:ch.qchatMsgTag},{type:"Property",name:"threadInfo",reflectMapper:{1:"messageCount",2:"lastMessageTimestamp"}},{type:"PropertyArray",name:"qchatMsgs",reflectMapper:ch.qchatMsgTag}]},qchatUpdateQuickComment:{service:"qchatMsg",sid:24,cid:102,params:[{type:"Property",name:"tag",reflectMapper:sh.qchatQuickCommentRequestTag}]},qchatGetQuickComments:{service:"qchatMsg",sid:24,cid:103,params:[{type:"Property",name:"tag",reflectMapper:sh.qchatQuickCommentQueryTag}],response:[{type:"PropertyArray",name:"quickCommentResponse",reflectMapper:{1:"serverId",2:"channelId",3:"msgIdServer",4:"totalCount",5:"lastUpdateTime",6:"details"}}]},qchatGetThreadRootMessagesMeta:{service:"qchatMsg",sid:24,cid:108,params:[{type:"Property",name:"tag",reflectMapper:{serverId:1,channelId:2}},{type:"PropertyArray",name:"qchatMsgs",reflectMapper:{time:7,msgIdServer:14}}],response:[{type:"PropertyArray",name:"metas",reflectMapper:{1:"total",2:"timestamp",3:"msgIdServer",4:"msgTime"}}]},qchatGetLastMessageOfChannels:{service:"qchatMsg",sid:24,cid:121,params:[{type:"Property",name:"tag",reflectMapper:sh.qchatGetLastMessageOfChannelsTag}],response:[{type:"PropertyArray",name:"msgs",reflectMapper:ch.qchatMsgTag}]},qchatMultiSyncServersMessageRead:{service:"qchatMsg",sid:25,cid:6,response:[{type:"Property",name:"qchatMultiSyncServersMessageReadTag",reflectMapper:ch.qchatMultiSyncServersMessageReadTag}]}};!function(t){t[t.Android=1]="Android",t[t.iOS=2]="iOS",t[t.PC=4]="PC",t[t.WindowsPhone=8]="WindowsPhone",t[t.Web=16]="Web",t[t.Server=32]="Server",t[t.Mac=64]="Mac"}(ah||(ah={}));var uh=["image","audio","video","file"],ph={time:{type:"number"},updateTime:{type:"number"},resendFlag:{type:"boolean"},persistEnable:{type:"boolean"},routeEnable:{type:"boolean"},pushEnable:{type:"boolean"},needBadge:{type:"boolean"},needPushNick:{type:"boolean"},type:{type:"enum",values:vd},fromClientType:{type:"enum",values:ah},status:{type:"number"},toAccids:{type:"object"},toType:{type:"number"},attach:{type:"object"},pushPayload:{type:"object"}};function generatorSysMsgForCmd(t,a){var o=ma({},t),c=ma({type:a||vd.custom},formatReverse(ph,o));return c.serverId&&c.channelId&&c.toAccids?c.toType=4:c.serverId&&c.toAccids?c.toType=3:c.serverId&&c.channelId?c.toType=2:c.serverId&&(c.toType=1),c}function generatorSysMsgMarkersForCmd(t){var a=oh(t,["msgIdServer","type"]);return formatReverse(ph,a)}function formatSystemNotification(t,a){var o=format(ph,t);if(!o.attach)return o;if(o.attach.serverInfo&&(o.attach.serverInfo=formatServer(deserialize(o.attach.serverInfo,qp.serverInfo))),o.attach.channelInfo&&(o.attach.channelInfo=formatChannel(deserialize(o.attach.channelInfo,xp.channelInfo))),o.attach.serverMember&&(o.attach.serverMember=formatChannel(deserialize(o.attach.serverMember,qp.memberInfo))),o.attach.type===vd.channelUpdateWhiteBlackIdentify?o.attach.notify=formatUpdateWhiteBlackRole(deserialize(o.attach.notify,xp.qchatUpdateWhiteBlackRoleTag)):o.attach.type===vd.channelUpdateWhiteBlackIdentifyUser?o.attach.notify=function formatUpdateWhiteBlackMembers(t){return format(Xp,t)}(deserialize(o.attach.notify,xp.qchatUpdateWhiteBlackMembersTag)):o.attach.type===vd.updateQuickComment?o.attach.notify=function formatQuickCommentRequest(t){return format(fh,t)}(deserialize(o.attach.notify,ch.qchatQuickCommentRequestTag)):o.attach.type===vd.channelCategoryCreate||o.attach.type===vd.channelCategoryUpdate?o.attach.categoryInfo=formatChannelCategory(deserialize(o.attach.categoryInfo,xp.QChatChannelCategoryInfo)):o.attach.type===vd.channelCategoryUpdateWhiteBlackIdentify?o.attach.notify=formatUpdateWhiteBlackRole(deserialize(o.attach.notify,xp.qchatUpdateChannelCategoryWhiteBlackRoleTag)):o.attach.type===vd.channelCategoryUpdateWhiteBlackIdentifyUser?o.attach.notify=formatUpdateWhiteBlackRole(deserialize(o.attach.notify,xp.qchatUpdateChannelCategoryWhiteBlackMembersTag)):o.attach.type===vd.serverIdentifyAdd||o.attach.type===vd.serverIdentifyRemove||o.attach.type===vd.serverIdentifyUpdate?o.attach.serverIdentifyInfo=formatRole(deserialize(o.attach.serverIdentifyInfo,Xd.serverRole)):o.attach.type===vd.channelIdentifyUpdate?o.attach.channelIdentifyInfo=formatRole(deserialize(o.attach.channelIdentifyInfo,Xd.channelRole)):o.attach.type===vd.userIdentifyUpdate&&(o.attach.userIdentifyInfo=formatRole(deserialize(o.attach.userIdentifyInfo,Xd.memberRole))),o.attach.updateAuths)try{o.attach.updateAuths=formatRoleAuths(JSON.parse(o.attach.updateAuths))}catch(t){a.error("formatSystemNotification:JSON parse updateAuths error: ",t)}return o.attach.type&&(o.attach.rawType=o.attach.type,o.attach.type=vd[o.attach.type]),o}var dh={type:{type:"enum",values:dd},fromClientType:{type:"enum",values:ah},status:{type:"number"},resendFlag:{type:"boolean"},mentionAll:{type:"boolean"},notifyReason:{type:"enum",values:fd},pushEnable:{type:"boolean"},historyEnable:{type:"boolean"},needBadge:{type:"boolean"},needPushNick:{type:"boolean"},routeEnable:{type:"boolean"},time:{type:"number"},updateTime:{type:"number"},mentionAccids:{type:"object"},attach:{type:"object"},pushPayload:{type:"object"},isAntispam:{type:"boolean"},antiSpamInfo:{useCustomContent:{type:"boolean"},antiSpamContent:{type:"string"},antiSpamBusinessId:{type:"string"},antiSpamUsingYidun:{type:"boolean"},yidunCallback:{type:"string"},yidunAntiCheating:{type:"object"},yidunAntiSpamExt:{type:"object"},yidunAntiSpamRes:{type:"string"}},replyRefer:{fromAccount:{type:"string",rawKey:"replyMsgFromAccount"},time:{type:"number",rawKey:"replyMsgTime"},msgIdServer:{type:"string",rawKey:"replyMsgIdServer"},msgIdClient:{type:"string",rawKey:"replyMsgIdClient"}},threadRefer:{fromAccount:{type:"string",rawKey:"threadMsgFromAccount"},time:{type:"number",rawKey:"threadMsgTime"},msgIdServer:{type:"string",rawKey:"threadMsgIdServer"},msgIdClient:{type:"string",rawKey:"threadMsgIdClient"}}};function generatorMsgForCmd(t){t.onSendBefore,t.onUploadStart,t.onUploadDone,t.onUploadProgress;var a=__rest(t,["onSendBefore","onUploadStart","onUploadDone","onUploadProgress"]),o=formatReverse(dh,a);if(o.msgIdClient=t.resendFlag?t.msgIdClient:Mc(),!o.msgIdClient)throw new Zo("msgIdClient is required for resend a message","msgIdClient","required");return t.replyMessage&&t.replyMessage.msgIdServer&&(o.replyMsgFromAccount=t.replyMessage.fromAccount,o.replyMsgTime=+t.replyMessage.time,o.replyMsgIdServer=t.replyMessage.msgIdServer,o.replyMsgIdClient=t.replyMessage.msgIdClient,t.replyMessage.threadRefer&&t.replyMessage.threadRefer.msgIdServer?(o.threadMsgFromAccount=t.replyMessage.threadRefer.fromAccount,o.threadMsgTime=+t.replyMessage.threadRefer.time,o.threadMsgIdServer=t.replyMessage.threadRefer.msgIdServer,o.threadMsgIdClient=t.replyMessage.threadRefer.msgIdClient):(o.threadMsgFromAccount=t.replyMessage.fromAccount,o.threadMsgTime=+t.replyMessage.time,o.threadMsgIdServer=t.replyMessage.msgIdServer,o.threadMsgIdClient=t.replyMessage.msgIdClient),delete o.replyMessage),o}function formatMsgOperatorInfo(t){return format({operatorClientType:{type:"enum",values:ah},pushPayload:{type:"object"}},t)}function formatMsg(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;return __awaiter(this,void 0,void 0,zr.mark((function _callee(){var c,l,p;return zr.wrap((function _callee$(d){for(;;)switch(d.prev=d.next){case 0:return(c=format(dh,t)).deliveryStatus=a.deliveryStatus?hd[a.deliveryStatus]:hd[hd.success],a.time&&(c.time=a.time),c.updateContent&&(l=format({status:{type:"number"}},l=deserialize(l=JSON.parse(c.updateContent),ch.qchatMsgTag)),c.updateContent=l),c.updateOperatorInfo&&(p=formatMsgOperatorInfo(deserialize(p=JSON.parse(c.updateOperatorInfo),ch.qchatMsgUpdateTag)),c.updateOperatorInfo=p),c.attach&&a.attachUrl&&(c.attach.url=a.attachUrl),d.next=8,formatMsgAttach(c,o);case 8:return d.abrupt("return",d.sent);case 9:case"end":return d.stop()}}),_callee)})))}function formatMsgAttach(t,a){return __awaiter(this,void 0,void 0,zr.mark((function _callee2(){var o;return zr.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:if(includes(uh).call(uh,t.type)&&t.attach&&t.attach.url){c.next=2;break}return c.abrupt("return",t);case 2:if(a&&a.cloudStorage&&"function"==typeof a.cloudStorage.getPrivateUrl&&"function"==typeof a.cloudStorage.getOriginUrl){c.next=4;break}return c.abrupt("return",t);case 4:if(!(indexOf(o=t.attach.url).call(o,"_im_url=1")<0)){c.next=7;break}return t.attach.url=a.cloudStorage.getPrivateUrl(t.attach.url),c.abrupt("return",t);case 7:return c.prev=7,c.next=10,a.cloudStorage.getOriginUrl(t.attach.url);case 10:t.attach.url=c.sent,c.next=16;break;case 13:throw c.prev=13,c.t0=c.catch(7),new Zo('url "'.concat(t.attach.url,'" parse error'),"message.attach.url","parse error");case 16:return c.abrupt("return",t);case 17:case"end":return c.stop()}}),_callee2,null,[[7,13]])})))}function formatMsgs(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;return __awaiter(this,void 0,void 0,zr.mark((function _callee3(){var c;return zr.wrap((function _callee3$(l){for(;;)switch(l.prev=l.next){case 0:if(mi(t)&&t.length>0){l.next=2;break}return l.abrupt("return",[]);case 2:return c=map(t).call(t,(function(t){return formatMsg(t,a,o)})),l.next=5,pa.all(c);case 5:return l.abrupt("return",l.sent);case 6:case"end":return l.stop()}}),_callee3)})))}var hh={totalCount:{type:"number"},lastUpdateTime:{type:"number"},details:{type:"object"}};function formatQuickComments(t){var a=map(t).call(t,(function(t){var a,o=format(hh,t);return o.details=map(a=o.details).call(a,(function(t){return{count:t.count,hasSelf:t.self,severalAccids:t.topN,type:t.type}})),o})),o={};return forEach(a).call(a,(function(t){return o[t.msgIdServer]=t})),o}var fh={type:{type:"number"},time:{type:"number"},opeType:{type:"number"}};var mh={includeSelf:{type:"number"},order:{type:"enum",values:yp},sort:{type:"enum",values:pd},msgTypes:{type:"object"},subTypes:{type:"object"}};var vh=function(){function NotificationModuleService(t){ue(this,NotificationModuleService),this.core=t,this.logger=t.logger}return he(NotificationModuleService,[{key:"sendSystemNotification",value:function sendSystemNotification(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee(){var a,o;return zr.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.sendCmd("qchatSendCustomSysMsg",{sysMsg:generatorSysMsgForCmd(t)});case 2:return a=c.sent,o=formatSystemNotification(a.content.sysMsg,this.logger),"debug"===this.core.options.debugLevel?this.logger.debug("sendCustomSysMsg success",o):this.logger.log("sendCustomSysMsg success",o.serverId,o.channelId,o.msgIdServer),c.abrupt("return",o);case 6:case"end":return c.stop()}}),_callee,this)})))}},{key:"updateSystemNotification",value:function updateSystemNotification(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee2(){var a,o,c,l,p;return zr.wrap((function _callee2$(d){for(;;)switch(d.prev=d.next){case 0:return a=t.systemNotification,o=__rest(t,["systemNotification"]),c=oh(a,["msgIdServer","type","body","ext","status"]),l=generatorSysMsgForCmd(c),d.next=5,this.core.sendCmd("qchatUpdateSystemNotification",{sysMsg:l,qchatMsgUpdateTag:ma(ma({},o),{operatorAccount:this.core.account,operatorClientType:ah.Web,pushPayload:Da(t.pushPayload),routeEnable:Fp.boolean(t,"routeEnable")})});case 5:return p=d.sent,d.abrupt("return",formatSystemNotification(p.content.sysMsg,this.logger));case 7:case"end":return d.stop()}}),_callee2,this)})))}},{key:"markSystemNotificationsRead",value:function markSystemNotificationsRead(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee3(){var a;return zr.wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.core.sendCmd("qchatMarkSysMsgRead",{sysMsgs:map(a=t.systemNotifications).call(a,(function(t){return generatorSysMsgMarkersForCmd(t)}))});case 2:case"end":return o.stop()}}),_callee3,this)})))}},{key:"onSysMsg",value:function onSysMsg(t){var a=t.content.sysMsg;if(a){var o=formatSystemNotification(a,this.core.logger);if(o.type===vd[vd.msgTyping]){var c=oh(o,["serverId","channelId","ext","fromAccount","fromNick","time"]);return this.logger.log("qchat on recvTypingEvent: ",c),void this.core.emit("recvTypingEvent",c)}o.type!==vd[vd.channelVisibilityUpdate]&&o.type!==vd[vd.serverEnterLeave]||2!==o.attach.event||this.core.emit("_serverChannelLeave",o);var l={feature:"default",systemNotifications:[o]};this.logger.log("qchat on systemNotification: ",l),this.core.emit("systemNotification",l)}else this.core.logger.warn("No sysMsg in onSysMsg packet")}},{key:"onMultiSysMsg",value:function onMultiSysMsg(t){var a=t.content.sysMsg;if(a){var o=formatSystemNotification(a,this.logger);this.core.emit("systemNotificationUpdate",o)}}},{key:"onSyncSysMsg",value:function onSyncSysMsg(t){var a=this,o=t.content.systemNotifications;if(o&&o.length>0){var c=map(o).call(o,(function(t){return formatSystemNotification(t,a.logger)}));this.core.emit("systemNotification",{feature:"sync",systemNotifications:c})}else this.logger.warn("sync system notification not exist")}}]),NotificationModuleService}(),yh=["image","audio","video","file"],gh=function(){function MessageModuleService(t){var a=this;ue(this,MessageModuleService),this.markMessageRead=Ad((function(t){return __awaiter(a,void 0,void 0,zr.mark((function _callee(){var a,o;return zr.wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.sendCmd("qchatMarkMessageRead",{markMsgReadTag:t});case 2:a=c.sent,o=formatUnreadInfo(a.content.unreadInfo),this.core.emit("_updateUnread",o);case 5:case"end":return c.stop()}}),_callee,this)})))}),200),this.core=t,this.logger=t.logger}return he(MessageModuleService,[{key:"sendMessage",value:function sendMessage(t){var a,o,c,l;return __awaiter(this,void 0,void 0,zr.mark((function _callee2(){var p,d,h,m,v,y;return zr.wrap((function _callee2$(g){for(;;)switch(g.prev=g.next){case 0:if(!(indexOf(yh).call(yh,t.type)>-1)){g.next=4;break}return g.next=3,this.doSendFile(t);case 3:t.attach=g.sent;case 4:return p=generatorMsgForCmd(ma({fromAccount:this.core.account},t)),g.next=7,formatMsg(p,{time:(new Date).getTime(),deliveryStatus:hd.sending},this.core);case 7:d=g.sent;try{t.onSendBefore&&t.onSendBefore(d)}catch(t){this.logger.error("sendMsg: options.onSendBefore error",t)}return g.prev=9,g.next=12,this.core.sendCmd("qchatSendMsg",{qchatMsg:p});case 12:h=g.sent,g.next=22;break;case 15:return g.prev=15,g.t0=g.catch(9),g.next=19,formatMsg(p,{time:(new Date).getTime(),deliveryStatus:hd.failed,attachUrl:null===(a=d.attach)||void 0===a?void 0:a.url},this.core);case 19:throw m=g.sent,g.t0.msg=m,g.t0;case 22:return v=h.content,g.next=25,formatMsg(ma({},v.qchatMsg),{deliveryStatus:hd.success,attachUrl:null===(o=d.attach)||void 0===o?void 0:o.url},this.core);case 25:if(!(y=g.sent).isAntispam){g.next=29;break}throw{code:10403,msg:y,message:(null===(c=null==y?void 0:y.antiSpamInfo)||void 0===c?void 0:c.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(l=null==y?void 0:y.antiSpamInfo)||void 0===l?void 0:l.yidunAntiSpamRes)||""};case 29:return g.abrupt("return",y);case 30:case"end":return g.stop()}}),_callee2,this,[[9,15]])})))}},{key:"doSendFile",value:function doSendFile(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee3(){var a;return zr.wrap((function _callee3$(o){for(;;)switch(o.prev=o.next){case 0:if(validate({type:{type:"enum",values:["image","audio","video","file"]},attach:{type:"object",rules:{url:{type:"string",allowEmpty:!1}},required:!1},maxSize:{type:"number",min:1,required:!1}},t),a=t.attach){o.next=23;break}if(this.core.cloudStorage&&this.core.cloudStorage.uploadFile){o.next=5;break}throw new Error('Service "cloudStorage" does not exist');case 5:return o.prev=5,o.next=8,this.core.cloudStorage.uploadFile(t);case 8:a=o.sent,o.next=15;break;case 11:throw o.prev=11,o.t0=o.catch(5),this.logger.error("sendFile:: upload File error or abort",o.t0),o.t0;case 15:o.prev=15,t.onUploadDone&&t.onUploadDone(a),o.next=23;break;case 19:throw o.prev=19,o.t1=o.catch(15),this.logger.error("sendFile options.onUploadDone err",o.t1),o.t1;case 23:return o.abrupt("return",a);case 24:case"end":return o.stop()}}),_callee3,this,[[5,11],[15,19]])})))}},{key:"resendMessage",value:function resendMessage(t){var a,o;return __awaiter(this,void 0,void 0,zr.mark((function _callee4(){var c,l,p,d,h;return zr.wrap((function _callee4$(m){for(;;)switch(m.prev=m.next){case 0:return(c=generatorMsgForCmd(ma(ma({},t),{resendFlag:!0}))).deliveryStatus=hd.sending,m.prev=2,m.next=5,this.core.sendCmd("qchatSendMsg",{qchatMsg:c});case 5:l=m.sent,m.next=15;break;case 8:return m.prev=8,m.t0=m.catch(2),m.next=12,formatMsg(c,{time:(new Date).getTime(),deliveryStatus:hd.failed},this.core);case 12:throw p=m.sent,m.t0.msg=p,m.t0;case 15:return d=l.content,m.next=18,formatMsg(ma({},d.qchatMsg),{deliveryStatus:hd.success},this.core);case 18:if(!(h=m.sent).isAntispam){m.next=22;break}throw{code:10403,msg:h,message:(null===(a=null==h?void 0:h.antiSpamInfo)||void 0===a?void 0:a.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(o=null==h?void 0:h.antiSpamInfo)||void 0===o?void 0:o.yidunAntiSpamRes)||""};case 22:return m.abrupt("return",h);case 23:case"end":return m.stop()}}),_callee4,this,[[2,8]])})))}},{key:"doUpdateMessage",value:function doUpdateMessage(t){var a,o;return __awaiter(this,void 0,void 0,zr.mark((function _callee5(){var c,l,p,d;return zr.wrap((function _callee5$(h){for(;;)switch(h.prev=h.next){case 0:return c=t.message,l=__rest(t,["message"]),(p=generatorMsgForCmd(c)).msgIdClient=void 0,p.time=c.time,h.next=6,this.core.sendCmd("qchatUpdateMessage",{qchatMsg:p,qchatMsgUpdateTag:ma(ma({},l),{operatorAccount:this.core.account,operatorClientType:ah.Web,pushPayload:Da(t.pushPayload),routeEnable:Fp.boolean(t,"routeEnable")})});case 6:if(d=h.sent,this.core.emit("_changeUnread",p,!0),!d.content.qchatMsg.isAntispam){h.next=11;break}throw{code:10403,msg:p,message:(null===(a=d.content.qchatMsg)||void 0===a?void 0:a.yidunAntiSpamRes)||"message has be antispam",isAntispam:!0,yidunAntiSpamRes:(null===(o=d.content.qchatMsg)||void 0===o?void 0:o.yidunAntiSpamRes)||""};case 11:return h.next=13,formatMsg(d.content.qchatMsg,{},this.core);case 13:return h.abrupt("return",h.sent);case 14:case"end":return h.stop()}}),_callee5,this)})))}},{key:"getHistoryMessage",value:function getHistoryMessage(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee6(){var a,o,c,l=this;return zr.wrap((function _callee6$(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.core.sendCmd("qchatGetHistoryMsg",{getHistoryMsgTag:ma(ma({},t),{reverse:reverse(t)?1:0})});case 2:return o=p.sent,c=o.content,p.next=6,pa.all(map(a=c.qchatMsgs).call(a,(function(t){return formatMsg(t,{},l.core)})));case 6:return p.abrupt("return",p.sent);case 7:case"end":return p.stop()}}),_callee6,this)})))}},{key:"getLastMessageOfChannels",value:function getLastMessageOfChannels(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee7(){var a,o,c;return zr.wrap((function _callee7$(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.core.sendCmd("qchatGetLastMessageOfChannels",{tag:t});case 2:return a=l.sent,o=a.content.msgs,l.next=6,formatMsgs(o,{},this.core);case 6:return c=l.sent,l.abrupt("return",reduce(c).call(c,(function(t,a){return t[a.channelId]=a,t}),{}));case 8:case"end":return l.stop()}}),_callee7,this)})))}},{key:"messageSearchByPage",value:function messageSearchByPage(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee8(){var a,o,c,l,p;return zr.wrap((function _callee8$(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this.core.sendCmd("qchatMessageSearchByPage",{qchatMessageSearchByPageTag:ma(ma({},(h=t,formatReverse(mh,h))),{includeSelf:t.includeSelf?1:""})});case 2:return a=d.sent,o=a.content,c=o.datas,l=o.listQueryTag,d.next=6,formatMsgs(c,{},this.core);case 6:return p=d.sent,d.abrupt("return",{listQueryTag:{hasMore:1==+l.hasMore,nextTimetag:l.nextTimetag?Oc(l.nextTimetag):0,cursor:l.cursor},datas:p});case 8:case"end":return d.stop()}var h}),_callee8,this)})))}},{key:"onMsg",value:function onMsg(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee9(){var a,o;return zr.wrap((function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:if(a=t.content.qchatMsg){c.next=4;break}return this.logger.warn("No qchatMsg in qchatMsg packet"),c.abrupt("return");case 4:return c.next=6,formatMsg(a,{},this.core);case 6:o=c.sent,this.core.emit("_changeUnread",o,!1),this.core.emit("message",o);case 9:case"end":return c.stop()}}),_callee9,this)})))}},{key:"onRecvUnreadInfo",value:function onRecvUnreadInfo(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee10(){var a,o;return zr.wrap((function _callee10$(c){for(;;)switch(c.prev=c.next){case 0:if(a=t.content.qchatMsg){c.next=3;break}return c.abrupt("return");case 3:return c.next=5,formatMsg(a);case 5:o=c.sent,this.core.emit("_changeUnread",o,!1);case 7:case"end":return c.stop()}}),_callee10,this)})))}},{key:"onMultiSyncRead",value:function onMultiSyncRead(t){var a=t.content.unreadInfo;if(a){var o=formatUnreadInfo(a);this.core.emit("_updateUnread",o)}}},{key:"onMultiSyncServersRead",value:function onMultiSyncServersRead(t){var a=t.content.qchatMultiSyncServersMessageReadTag;if(a){var o=formatClearServersUnread(a),c=o.successServerIds,l=o.ackTimestamp;this.core.emit("_clearUnreadCountByServers",c,l)}}},{key:"onRecvMsgUpdate",value:function onRecvMsgUpdate(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee11(){var a,o,c,l;return zr.wrap((function _callee11$(p){for(;;)switch(p.prev=p.next){case 0:if(a=t.content.qchatMsg,o=t.content.qchatMsgUpdateInfo,a){p.next=4;break}return p.abrupt("return");case 4:return p.next=6,formatMsg(a,{},this.core);case 6:c=p.sent,l=formatMsgOperatorInfo(o),this.core.emit("_changeUnread",c,!0),this.core.emit("messageUpdate",c,l);case 10:case"end":return p.stop()}}),_callee11,this)})))}}]),MessageModuleService}(),bh=function(){function ExtendModuleService(t){var a=this;ue(this,ExtendModuleService),this._sendTypingEvent=Ad((function(t){return __awaiter(a,void 0,void 0,zr.mark((function _callee(){return zr.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.core.sendCmd("qchatSendCustomSysMsg",{sysMsg:generatorSysMsgForCmd(ma(ma({},t),{resendFlag:!1,persistEnable:!1,routeEnable:!1,pushEnable:!1,needBadge:!1,needPushNick:!1}),vd.msgTyping)});case 2:case"end":return a.stop()}}),_callee,this)})))}),3e3),this.core=t,this.logger=t.logger,this.lastChannelIdInTyping=""}return he(ExtendModuleService,[{key:"getMessageHistoryByIds",value:function getMessageHistoryByIds(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee2(){var a,o;return zr.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.sendCmd("qchatGetMessageHistoryByIds",{channelInfo:{serverId:t.serverId,channelId:t.channelId},messageReferList:t.messageReferList});case 2:return o=c.sent,c.abrupt("return",pa.all(map(a=o.content.qchatMsgs).call(a,(function(t){return formatMsg(t)}))));case 4:case"end":return c.stop()}}),_callee2,this)})))}},{key:"getReferMessages",value:function getReferMessages(t){var a,o;return __awaiter(this,void 0,void 0,zr.mark((function _callee3(){var c;return zr.wrap((function _callee3$(l){for(;;)switch(l.prev=l.next){case 0:if((null===(a=t.message.replyRefer)||void 0===a?void 0:a.msgIdServer)&&(null===(o=t.message.threadRefer)||void 0===o?void 0:o.msgIdServer)){l.next=2;break}throw new Error("Message has no reply");case 2:return l.next=4,this.getMessageHistoryByIds({serverId:t.message.serverId,channelId:t.message.channelId,messageReferList:[t.message.replyRefer,t.message.threadRefer]});case 4:if(c=l.sent,t.referType!==yd[yd.all]){l.next=9;break}return l.abrupt("return",{replyMessage:c[0],threadMessage:c[1]});case 9:if(t.referType!==yd[yd.reply]){l.next=13;break}return l.abrupt("return",{replyMessage:c[0]});case 13:if(t.referType!==yd[yd.thread]){l.next=15;break}return l.abrupt("return",{threadMessage:c[1]});case 15:return l.abrupt("return",{replyMessage:c[0],threadMessage:c[1]});case 16:case"end":return l.stop()}}),_callee3,this)})))}},{key:"getThreadMessages",value:function getThreadMessages(t){var a;return __awaiter(this,void 0,void 0,zr.mark((function _callee4(){var o,c,l,p,d;return zr.wrap((function _callee4$(h){for(;;)switch(h.prev=h.next){case 0:return c=(null===(a=t.message.threadRefer)||void 0===a?void 0:a.msgIdServer)?ma({serverId:t.message.serverId,channelId:t.message.channelId},t.message.threadRefer):t.message,h.next=3,this.core.sendCmd("qchatGetThreadMessages",{qchatMsg:c,getThreadHistoryMsgTag:ma(ma({},t.messageQueryOption),{reverse:Fp.boolean(t.messageQueryOption,"reverse")})});case 3:return l=h.sent,h.next=6,formatMsg(l.content.thread);case 6:return p=h.sent,h.next=9,pa.all(map(o=l.content.qchatMsgs).call(o,(function(t){return formatMsg(t)})));case 9:return d=h.sent,h.abrupt("return",{thread:p,threadInfo:{messageCount:+l.content.threadInfo.messageCount,lastMessageTimestamp:+l.content.threadInfo.lastMessageTimestamp},messages:d});case 11:case"end":return h.stop()}}),_callee4,this)})))}},{key:"getThreadRootMessagesMeta",value:function getThreadRootMessagesMeta(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee5(){var a,o,c,l;return zr.wrap((function _callee5$(p){for(;;)switch(p.prev=p.next){case 0:return a=t.threadRootMessages,o=__rest(t,["threadRootMessages"]),p.next=3,this.core.sendCmd("qchatGetThreadRootMessagesMeta",{qchatMsgs:a,tag:o});case 3:if(c=p.sent,!((l=c.content.metas)&&l.length>0)){p.next=7;break}return p.abrupt("return",map(l).call(l,(function(t){return ma(ma({},t),{total:Oc(t.total),timestamp:Oc(t.timestamp),msgTime:Oc(t.msgTime)})})));case 7:return p.abrupt("return",[]);case 8:case"end":return p.stop()}}),_callee5,this)})))}},{key:"getQuickComments",value:function getQuickComments(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee6(){var a,o,c;return zr.wrap((function _callee6$(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.core.sendCmd("qchatGetQuickComments",{tag:{serverId:t.serverId,channelId:t.channelId,msgIdServerList:Da(map(a=t.msgList).call(a,(function(t){return t.msgIdServer})))}});case 2:return o=l.sent,c=o.content.quickCommentResponse,l.abrupt("return",formatQuickComments(c));case 5:case"end":return l.stop()}}),_callee6,this)})))}},{key:"updateQuickComment",value:function updateQuickComment(t,a){return __awaiter(this,void 0,void 0,zr.mark((function _callee7(){var o,c,l,p,d,h;return zr.wrap((function _callee7$(m){for(;;)switch(m.prev=m.next){case 0:return validate({type:{type:"number"},commentMessage:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1}}}},t),o=t.commentMessage,c=o.serverId,l=o.channelId,p=o.fromAccount,d=o.msgIdServer,h=o.time,m.next=4,this.core.sendCmd("qchatUpdateQuickComment",{tag:{serverId:c,channelId:l,fromAccount:p,msgIdServer:d,time:h,type:t.type,opeType:a,opeAccid:this.core.account}});case 4:case"end":return m.stop()}}),_callee7,this)})))}},{key:"sendTypingEvent",value:function sendTypingEvent(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee8(){return zr.wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:if(t.channelId!==this.lastChannelIdInTyping){a.next=4;break}return this.logger.log("qchatMsg sendTypingEvent throttle"),this._sendTypingEvent(t),a.abrupt("return");case 4:this.lastChannelIdInTyping=t.channelId,this._sendTypingEvent.flush(),this._sendTypingEvent(t);case 7:case"end":return a.stop()}}),_callee8,this)})))}}]),ExtendModuleService}();function _createSuper$3(t){var a=function _isNativeReflectConstruct$3(){if("undefined"==typeof Reflect||!le)return!1;if(le.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(le(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,c=qe(t);if(a){var l=qe(this).constructor;o=le(c,arguments,l)}else o=c.apply(this,arguments);return Kr(this,o)}}var Ch=function(t){Ne(QChatMsgService,t);var a=_createSuper$3(QChatMsgService);function QChatMsgService(t){var o;return ue(this,QChatMsgService),(o=a.call(this,"qchatMsg",t)).core=t,o.lastChannelIdInMark="",registerParser({cmdMap:ih,cmdConfig:lh}),o.notificationModuleService=new vh(t),o.messageModuleService=new gh(t),o.extendModuleService=new bh(t),o}return he(QChatMsgService,[{key:"sendMessage",value:function sendMessage(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee(){return zr.wrap((function _callee$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(dd)},ext:{type:"string",required:!1},mentionAll:{type:"boolean",required:!1},mentionAccids:{type:"array",itemType:"string",required:!1},historyEnable:{type:"boolean",required:!1},pushEnable:{type:"boolean",required:!1}},t),a.next=3,this.messageModuleService.sendMessage(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee,this)})))}},{key:"updateMessage",value:function updateMessage(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee2(){return zr.wrap((function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:if(validate({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0},body:{type:"string",required:!1},ext:{type:"string",required:!1}}}},t),!("number"==typeof t.message.status&&t.message.status<1e4)){a.next=3;break}throw new Ho("Status should be greater than or equal to 10000");case 3:return a.next=5,this.messageModuleService.doUpdateMessage(t);case 5:return a.abrupt("return",a.sent);case 6:case"end":return a.stop()}}),_callee2,this)})))}},{key:"resendMessage",value:function resendMessage(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee3(){return zr.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdClient:{type:"string",allowEmpty:!1}},t),a.next=3,this.messageModuleService.resendMessage(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee3,this)})))}},{key:"deleteMessage",value:function deleteMessage(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee4(){var a;return zr.wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return validate({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0}}}},t),(a=JSON.parse(Da(t))).message.status=2,o.next=5,this.messageModuleService.doUpdateMessage(a);case 5:return o.abrupt("return",o.sent);case 6:case"end":return o.stop()}}),_callee4,this)})))}},{key:"revokeMessage",value:function revokeMessage(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee5(){var a;return zr.wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return validate({message:{type:"object",rules:{serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number",min:0}}}},t),(a=JSON.parse(Da(t))).message=oh(a.message,["serverId","channelId","msgIdServer","time"]),a.message.status=1,o.next=6,this.messageModuleService.doUpdateMessage(a);case 6:return o.abrupt("return",o.sent);case 7:case"end":return o.stop()}}),_callee5,this)})))}},{key:"markMessageRead",value:function markMessageRead(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee6(){return zr.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:validate({serverId:{type:"string"},channelId:{type:"string"},time:{type:"number",min:0}},t),t.channelId!==this.lastChannelIdInMark&&this.messageModuleService.markMessageRead.flush(),this.lastChannelIdInMark=t.channelId,this.messageModuleService.markMessageRead(t);case 4:case"end":return a.stop()}}),_callee6,this)})))}},{key:"replyMessage",value:function replyMessage(t){validate({replyMessage:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1}}}},t);var replyMessage=t.replyMessage;if(t.serverId!==replyMessage.serverId||t.channelId!==replyMessage.channelId)throw new Ho("Forbid replying to message from other server, channel");return this.sendMessage(t)}},{key:"getMessageHistoryByIds",value:function getMessageHistoryByIds(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee7(){return zr.wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},messageReferList:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}}},t),a.next=3,this.extendModuleService.getMessageHistoryByIds(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee7,this)})))}},{key:"getReferMessages",value:function getReferMessages(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee8(){return zr.wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:return validate({message:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}},referType:{type:"enum",values:getEnumKeys(yd),required:!1}},t),a.next=3,this.extendModuleService.getReferMessages(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee8,this)})))}},{key:"getThreadMessages",value:function getThreadMessages(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee9(){return zr.wrap((function _callee9$(a){for(;;)switch(a.prev=a.next){case 0:return validate({message:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}},messageQueryOption:{type:"object",rules:{beginTime:{type:"number",required:!1},endTime:{type:"number",required:!1},excludeMsgId:{type:"string",required:!1},limit:{type:"number",required:!1},reverse:{type:"boolean",required:!1}}}},t),a.next=3,this.extendModuleService.getThreadMessages(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee9,this)})))}},{key:"getThreadRootMessagesMeta",value:function getThreadRootMessagesMeta(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee10(){return zr.wrap((function _callee10$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},threadRootMessages:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},time:{type:"number"}}}},t),a.next=3,this.extendModuleService.getThreadRootMessagesMeta(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee10,this)})))}},{key:"sendSystemNotification",value:function sendSystemNotification(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee11(){return zr.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1,required:!1},attach:{type:"object",required:!1}},t),a.next=3,this.notificationModuleService.sendSystemNotification(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee11,this)})))}},{key:"updateSystemNotification",value:function updateSystemNotification(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee12(){return zr.wrap((function _callee12$(a){for(;;)switch(a.prev=a.next){case 0:return validate({systemNotification:{type:"object",rules:{msgIdServer:{type:"string",allowEmpty:!1},type:{type:"enum",values:getEnumKeys(vd)},body:{type:"string",required:!1},ext:{type:"string",required:!1},status:{type:"number",required:!1}}}},t),a.next=3,this.notificationModuleService.updateSystemNotification(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee12,this)})))}},{key:"markSystemNotificationsRead",value:function markSystemNotificationsRead(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee13(){return zr.wrap((function _callee13$(a){for(;;)switch(a.prev=a.next){case 0:return validate({systemNotifications:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1},type:{type:"string",allowEmpty:!1}},min:1}},t),a.next=3,this.notificationModuleService.markSystemNotificationsRead(t);case 3:case"end":return a.stop()}}),_callee13,this)})))}},{key:"getHistoryMessage",value:function getHistoryMessage(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee14(){return zr.wrap((function _callee14$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},beginTime:{type:"number",min:0,required:!1},endTime:{type:"number",min:0,required:!1},excludeMsgId:{type:"string",allowEmpty:!1,required:!1},limit:{type:"number",min:1,required:!1},reverse:{type:"boolean",required:!1}},t),a.next=3,this.messageModuleService.getHistoryMessage(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee14,this)})))}},{key:"addQuickComment",value:function addQuickComment(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee15(){return zr.wrap((function _callee15$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.extendModuleService.updateQuickComment(t,1);case 2:case"end":return a.stop()}}),_callee15,this)})))}},{key:"removeQuickComment",value:function removeQuickComment(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee16(){return zr.wrap((function _callee16$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.extendModuleService.updateQuickComment(t,2);case 2:case"end":return a.stop()}}),_callee16,this)})))}},{key:"getQuickComments",value:function getQuickComments(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee17(){return zr.wrap((function _callee17$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},msgList:{type:"array",rules:{msgIdServer:{type:"string",allowEmpty:!1}},min:1}},t),a.next=3,this.extendModuleService.getQuickComments(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee17,this)})))}},{key:"sendTypingEvent",value:function sendTypingEvent(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee18(){return zr.wrap((function _callee18$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},ext:{type:"string",required:!1}},t),a.next=3,this.extendModuleService.sendTypingEvent(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee18,this)})))}},{key:"getLastMessageOfChannels",value:function getLastMessageOfChannels(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee19(){return zr.wrap((function _callee19$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelIdList:{type:"array",itemType:"string"}},t),a.next=3,this.messageModuleService.getLastMessageOfChannels(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee19,this)})))}},{key:"qchatOnMsgHandler",value:function qchatOnMsgHandler(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee20(){return zr.wrap((function _callee20$(a){for(;;)switch(a.prev=a.next){case 0:this.messageModuleService.onMsg(t);case 1:case"end":return a.stop()}}),_callee20,this)})))}},{key:"qchatOnRecvUnreadInfoHandler",value:function qchatOnRecvUnreadInfoHandler(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee21(){return zr.wrap((function _callee21$(a){for(;;)switch(a.prev=a.next){case 0:this.messageModuleService.onRecvUnreadInfo(t);case 1:case"end":return a.stop()}}),_callee21,this)})))}},{key:"qchatOnSysMsgHandler",value:function qchatOnSysMsgHandler(t){this.notificationModuleService.onSysMsg(t)}},{key:"qchatMultiSyncMessageReadHandler",value:function qchatMultiSyncMessageReadHandler(t){this.messageModuleService.onMultiSyncRead(t)}},{key:"qchatMultiSyncSystemNotificationUpdateHandler",value:function qchatMultiSyncSystemNotificationUpdateHandler(t){this.notificationModuleService.onMultiSysMsg(t)}},{key:"qchatSyncSystemNotificationHandler",value:function qchatSyncSystemNotificationHandler(t){this.notificationModuleService.onSyncSysMsg(t)}},{key:"qchatRecvMessageUpdateHandler",value:function qchatRecvMessageUpdateHandler(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee22(){return zr.wrap((function _callee22$(a){for(;;)switch(a.prev=a.next){case 0:this.messageModuleService.onRecvMsgUpdate(t);case 1:case"end":return a.stop()}}),_callee22,this)})))}},{key:"searchMsgByPage",value:function searchMsgByPage(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee23(){return zr.wrap((function _callee23$(a){for(;;)switch(a.prev=a.next){case 0:return validate({keyword:{type:"string",allowEmpty:!1,required:!1},serverId:{type:"string",allowEmpty:!1,required:!0},channelId:{type:"string",allowEmpty:!1,required:!1},fromAccid:{type:"string",allowEmpty:!1,required:!1},fromTime:{type:"number",allowEmpty:!1,required:!1},toTime:{type:"number",allowEmpty:!1,required:!1},msgTypes:{type:"array",itemType:"string",allowEmpty:!1,required:!0},subTypes:{type:"array",itemType:"string",allowEmpty:!1,required:!1},includeSelf:{type:"boolean",allowEmpty:!1,required:!1},order:{type:"enum",values:getEnumKeys(yp),required:!1},limit:{type:"number",min:0,required:!1},sort:{type:"enum",values:getEnumKeys(pd),required:!1},cursor:{type:"string",allowEmpty:!1,required:!1}},t),a.next=3,this.messageModuleService.messageSearchByPage(t);case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop()}}),_callee23,this)})))}},{key:"qchatMultiSyncServersMessageReadHandler",value:function qchatMultiSyncServersMessageReadHandler(t){this.messageModuleService.onMultiSyncServersRead(t)}}]),QChatMsgService}(_p);function formatLoginInfo(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o={clientPort:{type:"number"},clientType:{type:"enum",values:ah},customClientType:{type:"number"},loginTime:{type:"number"},hasTokenPreviously:{type:"boolean"},pushType:{type:"number"}},c=format(o,t);return ma(ma({},c),{account:c.account,connectionId:c.connectionId,deviceId:c.deviceId,ip:c.ip,mac:c.ip,os:c.os,clientType:c.clientType,time:c.time,online:2!==a})}var Sh={1:{reason:"samePlatformKick",message:"The same account is not allowed to multiple login at the same time"},2:{reason:"serverKick",message:"Kicked out by IM server"},3:{reason:"otherPlatformKick",message:"Kicked out by other client of your account"},4:{reason:"silentlyKick",message:"Quietly kicked"}};function _createSuper$2(t){var a=function _isNativeReflectConstruct$2(){if("undefined"==typeof Reflect||!le)return!1;if(le.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(le(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,c=qe(t);if(a){var l=qe(this).constructor;o=le(c,arguments,l)}else o=c.apply(this,arguments);return Kr(this,o)}}var _h,Mh,wh={BROWSER:0,RN:2,UNIAPP:3,WECHAT:6},kh=function(t){Ne(QChatAuthService,t);var a=_createSuper$2(QChatAuthService);function QChatAuthService(t){var o;return ue(this,QChatAuthService),(o=a.call(this,"qchatAuth",t)).syncTimeTag=0,o}return he(QChatAuthService,[{key:"doLogin",value:function doLogin(){var t,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return __awaiter(this,void 0,void 0,zr.mark((function _callee(){var o,c,l,p,d,h,m;return zr.wrap((function _callee$(v){for(;;)switch(v.prev=v.next){case 0:return o=this.core.options,c=oi.getSystemInfo(),l=ma(ma({},o),{appLogin:a?0:1,clientType:16,clientSession:null===(t=this.core.socket)||void 0===t?void 0:t.sessionId,deviceId:this.core.config.deviceId,sdkVersion:800,sdkType:wh[oi.platform]||0,userAgent:"Native/0.8.0",sdkHumanVersion:"0.8.0",os:c.os,browser:c.browser}),v.next=5,this.core.sendCmd("qchatLogin",{qchatLoginReqTag:l});case 5:if(!(p=v.sent).error){v.next=8;break}throw p.error;case 8:return d=p.content,h=d.qchatLoginResTag,m=d.qchatMultiLoginResult,h.isAutoReconnect=a,v.abrupt("return",{loginResult:formatLoginInfo(h),multiLoginResults:map(m).call(m,(function(t){return formatLoginInfo(t)}))});case 11:case"end":return v.stop()}}),_callee,this)})))}},{key:"kick",value:function kick(t){var a;return __awaiter(this,void 0,void 0,zr.mark((function _callee2(){var o;return zr.wrap((function _callee2$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.core.sendCmd("qchatKick",t);case 2:return o=c.sent,c.abrupt("return",null===(a=o.content)||void 0===a?void 0:a.deviceIds);case 4:case"end":return c.stop()}}),_callee2,this)})))}},{key:"sync",value:function sync(){return __awaiter(this,void 0,void 0,zr.mark((function _callee3(){return zr.wrap((function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.core.sendCmd("qchatSync",{qchatSyncTag:{systemNotification:this.syncTimeTag||0}});case 2:case"end":return t.stop()}}),_callee3,this)})))}},{key:"qchatSyncHandler",value:function qchatSyncHandler(t){var a,o;this.logger.log("sync: emit syncdone",null===(a=t.content)||void 0===a?void 0:a.timetag),this.core.emit("syncdone"),this.syncTimeTag=(null===(o=t.content)||void 0===o?void 0:o.timetag)||0}},{key:"qchatMultiSpotLoginHandler",value:function qchatMultiSpotLoginHandler(t){if(t.error)this.logger.error("qchatMultiPortLoginHandler:: error, ",t.error);else{var a=t.content,o=formatLoginInfo(a.qchatLoginResTag,a.state);this.core.emit("multiSpotLogin",[o])}}},{key:"qchatBeKickedHandler",value:function qchatBeKickedHandler(t){if(t.error)this.logger.error("qchatBeKickedHandler error, ",t.error);else{var a=function formatBeKickedTag(t){var a=format({clientType:{type:"enum",values:ah},customClientType:{type:"number"}},t),o=Sh[a.reason];return ma(a,o=o||{reason:"unknow",message:"Unknown reason"})}(t.content.beKickedTag);this.logger.warn("bekicked::",a),this.core.doDisconnect(Cc.KICKED,a)}}}]),QChatAuthService}(_p);!function(t){t.UNKNOWN="UNKNOWN",t.LOGIN_STATE_ERROR="LOGIN_STATE_ERROR",t.CLOSE_BY_BACKEND="CLOSE_BY_BACKEND",t.ALL_MEMBERS_OUT="ALL_MEMBERS_OUT",t.END_OF_LIFE="END_OF_LIFE",t.CLOSE_BY_MEMBER="CLOSE_BY_MEMBER",t.KICK_OUT="KICK_OUT",t.SYNC_DATA_ERROR="SYNC_DATA_ERROR",t.LEAVE_BY_SELF="LEAVE_BY_SELF",t.kICK_BY_SELF="kICK_BY_SELF"}(_h||(_h={})),function(t){t.offNotAllowSelfOn="offNotAllowSelfOn",t.offAllowSelfOn="offAllowSelfOn",t.disable="disable"}(Mh||(Mh={}));var xh={serverId:{type:"string"},uid:{type:"string"},accid:{type:"string"},nick:{type:"string"},avatar:{type:"string"},ext:{type:"string"},type:{type:"number"},joinTime:{type:"number"},inviter:{type:"string"},validFlag:{type:"boolean"},createTime:{type:"number"},updateTime:{type:"number"}},Ih={limit:{type:"number"}};function formatMembers(t){return mi(t)&&t.length>0?map(t).call(t,(function(t){return function formatMember(t){return format(xh,t)}(t)})):[]}function formatRTCChannelConfig(t){try{t.audio&&(t.audio=JSON.parse(t.audio))}catch(t){throw new Jo('result "audio" JSON parse error',{key:"audio"},"JSON parse error")}try{t.video&&(t.video=JSON.parse(t.video))}catch(t){throw new Jo('result "video" JSON parse error',{key:"video"},"JSON parse error")}return format(Ih,t)}var Th={"25_1":"qchatGetNeroomToken","25_2":"qchatUpdateRTCChannelConfig","25_3":"qchatGetRTCChannelConfig","25_4":"qchatGetRTCChannelMembers"},Rh={QChatRTCChannelConfigTag:{serverId:1,channelId:2,limit:3,audio:4,video:5},QChatRTCChannelConfigResultTag:{limit:1,audio:2,video:3},QChatGetRTCParams:{serverId:1,channelId:2},qchatGetRTCChannelMembersTag:{serverId:1,channelId:2},memberInfo:{serverId:1,accid:3,nick:4,avatar:5,ext:6,type:7,joinTime:8,inviter:9,validFlag:10,createTime:11,updateTime:12},QChatGetNeroomTokenResultTag:{token:1,expire:2},QChatGetNeroomTokenParams:{neroomDeviceId:1}},qh=invertSerializeMap(Rh),Eh={qchatGetNeroomToken:{sid:25,cid:1,service:"qchatMedia",params:[{type:"Property",name:"qchatGetNeroomTokenTag",reflectMapper:Rh.QChatGetNeroomTokenParams}],response:[{type:"Property",name:"neroomToken",reflectMapper:qh.QChatGetNeroomTokenResultTag}]},qchatUpdateRTCChannelConfig:{sid:25,cid:2,service:"qchatMedia",params:[{type:"Property",name:"RTCChannelConfig",reflectMapper:Rh.QChatRTCChannelConfigTag}]},qchatGetRTCChannelConfig:{sid:25,cid:3,service:"qchatMedia",params:[{type:"Property",name:"qchatGetRTCChannelConfigTag",reflectMapper:Rh.QChatGetRTCParams}],response:[{type:"Property",name:"RTCChannelConfig",reflectMapper:qh.QChatRTCChannelConfigResultTag}]},qchatGetRTCChannelMembers:{sid:25,cid:4,service:"qchatMedia",params:[{type:"Property",name:"qchatGetRTCChannelMembersTag",reflectMapper:Rh.QChatGetRTCParams}],response:[{type:"PropertyArray",name:"memberList",reflectMapper:qh.memberInfo}]}};function _createSuper$1(t){var a=function _isNativeReflectConstruct$1(){if("undefined"==typeof Reflect||!le)return!1;if(le.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(le(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,c=qe(t);if(a){var l=qe(this).constructor;o=le(c,arguments,l)}else o=c.apply(this,arguments);return Kr(this,o)}}var Ph=function(t){Ne(QChatMediaService,t);var a=_createSuper$1(QChatMediaService);function QChatMediaService(t){var o;return ue(this,QChatMediaService),(o=a.call(this,"qchatMedia",t)).core=t,registerParser({cmdMap:Th,cmdConfig:Eh}),o.core.on("disconnect",(function(){return __awaiter(me(o),void 0,void 0,zr.mark((function _callee(){return zr.wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:if(!this.roomContext){t.next=3;break}return t.next=3,this.disconnectChannel();case 3:this.tokenTimer&&(Xu.deleteTimer(this.tokenTimer),this.tokenTimer=void 0);case 4:case"end":return t.stop()}}),_callee,this)})))})),o.core.on("kicked",(function(){return __awaiter(me(o),void 0,void 0,zr.mark((function _callee2(){return zr.wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:if(!this.roomContext){t.next=3;break}return t.next=3,this.disconnectChannel();case 3:this.tokenTimer&&(Xu.deleteTimer(this.tokenTimer),this.tokenTimer=void 0);case 4:case"end":return t.stop()}}),_callee2,this)})))})),o.core.on("_serverChannelLeave",(function(t){return __awaiter(me(o),void 0,void 0,zr.mark((function _callee3(){return zr.wrap((function _callee3$(a){for(;;)switch(a.prev=a.next){case 0:if(!(t.type===vd[vd.channelVisibilityUpdate]&&t.channelId===this.channelId||t.type===vd[vd.serverEnterLeave]&&t.serverId===this.serverId)){a.next=4;break}if(!this.roomContext||!this.roomContext.roomUuid){a.next=4;break}return a.next=4,this.disconnectChannel();case 4:case"end":return a.stop()}}),_callee3,this)})))})),o.tokenExpireTime=24e4,o.channelId="",o.serverId="",o}return he(QChatMediaService,[{key:"setNeroom",value:function setNeroom(t){this.neroom=new t}},{key:"_checkPermission",value:function _checkPermission(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee4(){var a;return zr.wrap((function _callee4$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.core.qchatRole.checkPermission(t);case 2:return a=o.sent,o.abrupt("return",a);case 4:case"end":return o.stop()}}),_callee4,this)})))}},{key:"_checkConnectState",value:function _checkConnectState(){if("connect"!==this.state)throw new Ho("QChatMedia::you should connect first")}},{key:"kickMemberOut",value:function kickMemberOut(t){var a;return __awaiter(this,void 0,void 0,zr.mark((function _callee5(){return zr.wrap((function _callee5$(o){for(;;)switch(o.prev=o.next){case 0:return this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),o.prev=2,o.next=5,null===(a=this.roomContext)||void 0===a?void 0:a.kickMemberOut(t.accid);case 5:o.next=11;break;case 7:throw o.prev=7,o.t0=o.catch(2),this.logger.error("QChatMedia::kickMemberOut error params is "+Da(t),o.t0),new Ho("QChatMedia::kickMemberOut error",o.t0);case 11:case"end":return o.stop()}}),_callee5,this,[[2,7]])})))}},{key:"disconnectChannel",value:function disconnectChannel(){var t;return __awaiter(this,void 0,void 0,zr.mark((function _callee6(){return zr.wrap((function _callee6$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),this.logger.debug("QChatMedia::disconnect begin disconnect"),a.prev=2,a.next=5,null===(t=this.roomContext)||void 0===t?void 0:t.leaveRoom();case 5:a.next=10;break;case 7:a.prev=7,a.t0=a.catch(2),this.logger.error("QChatMedia::disconnect error",a.t0);case 10:if(!this.authService){a.next=13;break}return a.next=13,this.authService.logout();case 13:this._setStateInit(),this.core.emit("qchatMediaDisconnect");case 15:case"end":return a.stop()}}),_callee6,this,[[2,7]])})))}},{key:"_setStateInit",value:function _setStateInit(){this.logger.debug("QChatMedia::disconnect end"),this.roomContext=void 0,this.rtcController=void 0,this.state="init",this.tokenTimer&&(Xu.deleteTimer(this.tokenTimer),this.tokenTimer=void 0),this.channelId="",this.serverId=""}},{key:"muteAudio",value:function muteAudio(t){var a,o,c,l,p;return __awaiter(this,void 0,void 0,zr.mark((function _callee7(){var d;return zr.wrap((function _callee7$(h){for(;;)switch(h.prev=h.next){case 0:if(this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),(null===(a=this.roomContext)||void 0===a?void 0:a.localMember.uuid)!==t.accid){h.next=14;break}return h.prev=3,h.next=6,null===(o=this.rtcController)||void 0===o?void 0:o.muteMyAudio();case 6:h.next=12;break;case 8:throw h.prev=8,h.t0=h.catch(3),this.logger.error("QChatMedia::muteAudio error",h.t0),new Ho("QChatMedia::muteAudio error",h.t0);case 12:case 25:h.next=31;break;case 14:if(h.prev=14,!(d=null===(c=this.roomContext)||void 0===c?void 0:c.roomProperties.audioOff)||(null===(l=d.value)||void 0===l?void 0:l.split("_")[0])!==Mh.offNotAllowSelfOn){h.next=23;break}return h.next=19,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 19:if(h.sent){h.next=23;break}return this.logger.error("QChatMedia::unMuteAudio not allow open auido"),h.abrupt("return");case 23:return h.next=25,null===(p=this.rtcController)||void 0===p?void 0:p.muteMemberAudio(t.accid);case 27:throw h.prev=27,h.t1=h.catch(14),this.logger.error("QChatMedia::muteAudio error params is "+Da(t),h.t1),new Ho("QChatMedia::muteAudio error",h.t1);case 31:case"end":return h.stop()}}),_callee7,this,[[3,8],[14,27]])})))}},{key:"unMuteAudio",value:function unMuteAudio(t){var a,o,c,l,p;return __awaiter(this,void 0,void 0,zr.mark((function _callee8(){var d;return zr.wrap((function _callee8$(h){for(;;)switch(h.prev=h.next){case 0:if(this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),!(d=null===(a=this.roomContext)||void 0===a?void 0:a.roomProperties.audioOff)||(null===(o=d.value)||void 0===o?void 0:o.split("_")[0])!==Mh.offNotAllowSelfOn){h.next=10;break}return h.next=6,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 6:if(h.sent){h.next=10;break}return this.logger.error("QChatMedia::unMuteAudio not allow open auido"),h.abrupt("return");case 10:if((null===(c=this.roomContext)||void 0===c?void 0:c.localMember.uuid)!==t.accid){h.next=22;break}return h.prev=11,h.next=14,null===(l=this.rtcController)||void 0===l?void 0:l.unmuteMyAudio();case 14:h.next=20;break;case 16:throw h.prev=16,h.t0=h.catch(11),this.logger.error("QChatMedia::unMuteAudio error",h.t0),new Ho("QChatMedia::unMuteAudio error",h.t0);case 20:case 25:h.next=31;break;case 22:return h.prev=22,h.next=25,null===(p=this.rtcController)||void 0===p?void 0:p.unmuteMemberAudio(t.accid);case 27:throw h.prev=27,h.t1=h.catch(22),this.logger.error("QChatMedia::unMuteAudio error params is "+Da(t),h.t1),new Ho("QChatMedia::unMuteAudio error",h.t1);case 31:case"end":return h.stop()}}),_callee8,this,[[11,16],[22,27]])})))}},{key:"muteVideo",value:function muteVideo(t){var a,o,c,l,p;return __awaiter(this,void 0,void 0,zr.mark((function _callee9(){var d;return zr.wrap((function _callee9$(h){for(;;)switch(h.prev=h.next){case 0:if(this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),(null===(a=this.roomContext)||void 0===a?void 0:a.localMember.uuid)!==t.accid){h.next=14;break}return h.prev=3,h.next=6,null===(o=this.rtcController)||void 0===o?void 0:o.muteMyVideo();case 6:h.next=12;break;case 8:throw h.prev=8,h.t0=h.catch(3),this.logger.error("QChatMedia::muteVideo error",h.t0),new Ho("QChatMedia::muteVideo error",h.t0);case 12:case 25:h.next=31;break;case 14:if(h.prev=14,!(d=null===(c=this.roomContext)||void 0===c?void 0:c.roomProperties.videoOff)||(null===(l=d.value)||void 0===l?void 0:l.split("_")[0])!==Mh.offNotAllowSelfOn){h.next=23;break}return h.next=19,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 19:if(h.sent){h.next=23;break}return this.logger.error("QChatMedia::unMuteVideo not allow open video"),h.abrupt("return");case 23:return h.next=25,null===(p=this.rtcController)||void 0===p?void 0:p.muteMemberVideo(t.accid);case 27:throw h.prev=27,h.t1=h.catch(14),this.logger.error("QChatMedia::muteVideo error params is "+Da(t),h.t1),new Ho("QChatMedia::muteVideo error",h.t1);case 31:case"end":return h.stop()}}),_callee9,this,[[3,8],[14,27]])})))}},{key:"unMuteVideo",value:function unMuteVideo(t){var a,o,c,l,p;return __awaiter(this,void 0,void 0,zr.mark((function _callee10(){var d;return zr.wrap((function _callee10$(h){for(;;)switch(h.prev=h.next){case 0:if(this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),!(d=null===(a=this.roomContext)||void 0===a?void 0:a.roomProperties.videoOff)||(null===(o=d.value)||void 0===o?void 0:o.split("_")[0])!==Mh.offNotAllowSelfOn){h.next=10;break}return h.next=6,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 6:if(h.sent){h.next=10;break}return this.logger.error("QChatMedia::unMuteVideo not allow open video"),h.abrupt("return");case 10:if((null===(c=this.roomContext)||void 0===c?void 0:c.localMember.uuid)!==t.accid){h.next=22;break}return h.prev=11,h.next=14,null===(l=this.rtcController)||void 0===l?void 0:l.unmuteMyVideo();case 14:h.next=20;break;case 16:throw h.prev=16,h.t0=h.catch(11),this.logger.error("QChatMedia::unMuteVideo error",h.t0),new Ho("QChatMedia::unMuteVideo error",h.t0);case 20:h.next=30;break;case 22:h.prev=22,null===(p=this.rtcController)||void 0===p||p.unmuteMemberVideo(t.accid),h.next=30;break;case 26:throw h.prev=26,h.t1=h.catch(22),this.logger.error("QChatMedia::unMuteVideo error",h.t1),new Ho("QChatMedia::unMuteVideo error",h.t1);case 30:case"end":return h.stop()}}),_callee10,this,[[11,16],[22,26]])})))}},{key:"startScreenShare",value:function startScreenShare(){var t;return __awaiter(this,void 0,void 0,zr.mark((function _callee11(){return zr.wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:this._checkConnectState(),a.prev=1,null===(t=this.rtcController)||void 0===t||t.startScreenShare(),a.next=9;break;case 5:throw a.prev=5,a.t0=a.catch(1),this.logger.error("QChatMedia::startScreenShare error",a.t0),new Ho("QChatMedia::startScreenShare error",a.t0);case 9:case"end":return a.stop()}}),_callee11,this,[[1,5]])})))}},{key:"stopScreenShare",value:function stopScreenShare(){var t;return __awaiter(this,void 0,void 0,zr.mark((function _callee12(){return zr.wrap((function _callee12$(a){for(;;)switch(a.prev=a.next){case 0:this._checkConnectState(),a.prev=1,null===(t=this.rtcController)||void 0===t||t.stopScreenShare(),a.next=9;break;case 5:throw a.prev=5,a.t0=a.catch(1),this.logger.error("QChatMedia::stopScreenShare error",a.t0),new Ho("QChatMedia::stopScreenShare error",a.t0);case 9:case"end":return a.stop()}}),_callee12,this,[[1,5]])})))}},{key:"stopMemberScreenShare",value:function stopMemberScreenShare(t){var a;return __awaiter(this,void 0,void 0,zr.mark((function _callee13(){return zr.wrap((function _callee13$(o){for(;;)switch(o.prev=o.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),o.prev=2,null===(a=this.rtcController)||void 0===a||a.stopMemberScreenShare(t.accid),o.next=10;break;case 6:throw o.prev=6,o.t0=o.catch(2),this.logger.error("QChatMedia::stopMemberScreenShare error",o.t0),new Ho("QChatMedia::stopMemberScreenShare error",o.t0);case 10:case"end":return o.stop()}}),_callee13,this,[[2,6]])})))}},{key:"subscribeRemoteVideoStream",value:function subscribeRemoteVideoStream(t){var a;return __awaiter(this,void 0,void 0,zr.mark((function _callee14(){return zr.wrap((function _callee14$(o){for(;;)switch(o.prev=o.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1},streamType:{type:"number",allowEmpty:!1,min:0,max:1}},t),o.prev=2,null===(a=this.rtcController)||void 0===a||a.subscribeRemoteVideoStream(t.accid,t.streamType),o.next=10;break;case 6:throw o.prev=6,o.t0=o.catch(2),this.logger.error("QChatMedia::subscribeRemoteVideoStream error",o.t0),new Ho("QChatMedia::subscribeRemoteVideoStream error",o.t0);case 10:case"end":return o.stop()}}),_callee14,this,[[2,6]])})))}},{key:"unSubscribeRemoteVideoStream",value:function unSubscribeRemoteVideoStream(t){var a;return __awaiter(this,void 0,void 0,zr.mark((function _callee15(){return zr.wrap((function _callee15$(o){for(;;)switch(o.prev=o.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1},streamType:{type:"number",allowEmpty:!1,min:0,max:1}},t),o.prev=2,null===(a=this.rtcController)||void 0===a||a.unsubscribeRemoteVideoStream(t.accid,t.streamType),o.next=10;break;case 6:throw o.prev=6,o.t0=o.catch(2),this.logger.error("QChatMedia::unSubscribeRemoteVideoStream error",o.t0),new Ho("QChatMedia::unSubscribeRemoteVideoStream error",o.t0);case 10:case"end":return o.stop()}}),_callee15,this,[[2,6]])})))}},{key:"setupVideoCanvas",value:function setupVideoCanvas(t){var a;if(this._checkConnectState(),(null===(a=this.roomContext)||void 0===a?void 0:a.localMember.uuid)===t.accid)try{return this.rtcController.setupLocalVideoCanvas(t.videoView)}catch(t){throw this.logger.error("QChatMedia::setupVideoCanvas error",t),new Ho("QChatMedia::setupVideoCanvas error",t)}else try{return this.rtcController.setupRemoteVideoCanvas(t.videoView,t.accid)}catch(t){throw this.logger.error("QChatMedia::setupVideoCanvas error",t),new Ho("QChatMedia::setupVideoCanvas error",t)}}},{key:"setupRemoteVideoSubStreamCanvas",value:function setupRemoteVideoSubStreamCanvas(t){this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t);try{return this.rtcController.setupRemoteVideoSubStreamCanvas(t.videoView,t.accid)}catch(t){throw this.logger.error("QChatMedia::setupRemoteVideoSubStreamCanvas error",t),new Ho("QChatMedia::setupRemoteVideoSubStreamCanvas error",t)}}},{key:"getScreenSharingUserUuid",value:function getScreenSharingUserUuid(){this._checkConnectState();try{return this.rtcController.getScreenSharingUserUuid()}catch(t){throw this.logger.error("QChatMedia::getScreenSharingUserUuid error",t),new Ho("QChatMedia::getScreenSharingUserUuid error",t)}}},{key:"initQChatMedia",value:function initQChatMedia(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee16(){return zr.wrap((function _callee16$(a){for(;;)switch(a.prev=a.next){case 0:if(this.neroom){a.next=3;break}return this.logger.warn("QChatMedia::init::you should import neroom SDK"),a.abrupt("return");case 3:if(void 0===this.state){a.next=6;break}return this.logger.error("QChatMedia::init::you already init QChatMedia"),a.abrupt("return");case 6:a.prev=6,this.neroom.initialize({appKey:this.core.options.appkey,serverConfig:t.serverConfig}),a.next=14;break;case 10:throw a.prev=10,a.t0=a.catch(6),this.logger.error("QChatMedia::initQChatMedia error",a.t0),new Ho("QChatMedia::initQChatMedia error",a.t0);case 14:this.authService=this.neroom.authService,this.roomService=this.neroom.roomService,this.messageChannelService=this.neroom.messageChannelService,this.state="init";case 18:case"end":return a.stop()}}),_callee16,this,[[6,10]])})))}},{key:"loginByIM",value:function loginByIM(){var t;return __awaiter(this,void 0,void 0,zr.mark((function _callee17(){var a,o;return zr.wrap((function _callee17$(c){for(;;)switch(c.prev=c.next){case 0:if("init"===this.state){c.next=3;break}return this.logger.error("QChatMedia::connect::you should init before login"),c.abrupt("return");case 3:return a=this.core.options,c.next=6,this._getToken();case 6:return o=c.sent,c.prev=7,c.next=10,null===(t=this.authService)||void 0===t?void 0:t.loginByIM(a.account,o,a.token);case 10:c.next=16;break;case 12:throw c.prev=12,c.t0=c.catch(7),this.logger.error("QChatMedia::loginByIM error",c.t0),new Ho("QChatMedia::loginByIM error",c.t0);case 16:this.state="login";case 17:case"end":return c.stop()}}),_callee17,this,[[7,12]])})))}},{key:"_getToken",value:function _getToken(){var t;return __awaiter(this,void 0,void 0,zr.mark((function _callee19(){var a,o,c,l,p,d=this;return zr.wrap((function _callee19$(h){for(;;)switch(h.prev=h.next){case 0:return this.logger.log("QChatMedia::getToken begin getToken"),h.next=3,this.core.sendCmd("qchatGetNeroomToken",{qchatGetNeroomTokenTag:{neroomDeviceId:null===(t=this.neroom)||void 0===t?void 0:t.deviceId}});case 3:return o=h.sent,c=o.content.neroomToken,l=c.token,p=c.expire,this.logger.log(concat(a="QChatMedia::getToken success token is ".concat(l,",expire is ")).call(a,p," ")),this.tokenTimer||(this.logger.debug("QChatMedia::getToken set token timer,expire is ".concat(1e3*p-this.tokenExpireTime," ")),this.tokenTimer=Xu.addTimer((function(){return __awaiter(d,void 0,void 0,zr.mark((function _callee18(){var t;return zr.wrap((function _callee18$(a){for(;;)switch(a.prev=a.next){case 0:return Xu.deleteTimer(this.tokenTimer),this.tokenTimer=void 0,a.next=4,this._getToken();case 4:t=a.sent,this.authService&&this.authService.renewToken(t);case 6:case"end":return a.stop()}}),_callee18,this)})))}),1e3*p-this.tokenExpireTime)),h.abrupt("return",l);case 8:case"end":return h.stop()}}),_callee19,this)})))}},{key:"connectChannel",value:function connectChannel(t){var a,o;return __awaiter(this,void 0,void 0,zr.mark((function _callee20(){var c;return zr.wrap((function _callee20$(l){for(;;)switch(l.prev=l.next){case 0:if(void 0!==this.state){l.next=3;break}return this.logger.error("QChatMedia::connect::you should init before login"),l.abrupt("return");case 3:if("init"!==this.state){l.next=6;break}return l.next=6,this.loginByIM();case 6:return this.serverId=t.serverId,this.channelId=t.channelId,l.prev=8,l.next=11,null===(a=this.roomService)||void 0===a?void 0:a.joinRoom({roomUuid:t.channelId,role:"qchatAudience",userName:this.core.options.account,initialProperties:{}},{});case 11:l.next=17;break;case 13:throw l.prev=13,l.t0=l.catch(8),this.logger.error("QChatMedia::connectChannel error",l.t0),new Ho("QChatMedia::connectChannel error",l.t0);case 17:if(!(c=null===(o=this.roomService)||void 0===o?void 0:o.getRoomContext(t.channelId))){l.next=27;break}return this.roomContext=c,this.rtcController=this.roomContext.rtcController,this.state="connect",l.next=24,this.rtcController.joinRtcChannel();case 24:this.core.emit("connectChannel"),l.next=28;break;case 27:this.logger.error("QChatMedia::connect room not exited");case 28:case"end":return l.stop()}}),_callee20,this,[[8,13]])})))}},{key:"updateRTCChannelInfo",value:function updateRTCChannelInfo(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee21(){return zr.wrap((function _callee21$(a){for(;;)switch(a.prev=a.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1},limit:{type:"number",allowEmpty:!1}},t),a.next=3,this.core.sendCmd("qchatUpdateRTCChannelConfig",{RTCChannelConfig:ma(ma({},t),{audio:Da(t.audio),video:Da(t.video)})});case 3:case"end":return a.stop()}}),_callee21,this)})))}},{key:"getRTCChannelInfo",value:function getRTCChannelInfo(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee22(){var a;return zr.wrap((function _callee22$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},t),o.next=3,this.core.sendCmd("qchatGetRTCChannelConfig",{qchatGetRTCChannelConfigTag:t});case 3:return a=o.sent,o.abrupt("return",formatRTCChannelConfig(a.content.RTCChannelConfig));case 5:case"end":return o.stop()}}),_callee22,this)})))}},{key:"getRTCChannelOnlineMembers",value:function getRTCChannelOnlineMembers(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee23(){var a;return zr.wrap((function _callee23$(o){for(;;)switch(o.prev=o.next){case 0:return validate({serverId:{type:"string",allowEmpty:!1},channelId:{type:"string",allowEmpty:!1}},t),o.next=3,this.core.sendCmd("qchatGetRTCChannelMembers",{qchatGetRTCChannelMembersTag:t});case 3:return a=o.sent,o.abrupt("return",formatMembers(a.content.memberList));case 5:case"end":return o.stop()}}),_callee23,this)})))}},{key:"addRTCChannelListener",value:function addRTCChannelListener(){var t,a,o=this;this._checkConnectState();try{null===(t=this.authService)||void 0===t||t.addAuthListener({onAuthEvent:function onAuthEvent(t){return __awaiter(o,void 0,void 0,zr.mark((function _callee24(){var a;return zr.wrap((function _callee24$(o){for(;;)switch(o.prev=o.next){case 0:if(1026!==t||this.getTokenState){o.next=10;break}return this.logger.log("QChatMedia::loginByIM token expire,begin get new token "),this.getTokenState=!0,o.next=5,this._getToken();case 5:if(a=o.sent,!this.authService){o.next=9;break}return o.next=9,this.authService.renewToken(a);case 9:this.getTokenState=!1;case 10:case"end":return o.stop()}}),_callee24,this)})))}})}catch(t){throw this.getTokenState=!1,this.logger.error("QChatMedia::loginByIM addAuthListener error",t),new Ho("QChatMedia::loginByIM addAuthListener error",t)}null===(a=this.roomContext)||void 0===a||a.addRoomListener({onRoomPropertiesChanged:function onRoomPropertiesChanged(t){var a,c,l,p,d,h;if(o.logger.log("QChatMedia::addRTCChannelListener::onRoomPropertiesChanged",t),t.audioOff){var m=null===(a=t.audioOff.value)||void 0===a?void 0:a.split("_")[0];m!==Mh.offNotAllowSelfOn&&m!==Mh.offAllowSelfOn||(null===(c=o.roomContext)||void 0===c?void 0:c.localMember.isAudioOn)&&(null===(l=o.rtcController)||void 0===l||l.muteMyAudio())}else if(t.videoOff){var v=null===(p=t.videoOff.value)||void 0===p?void 0:p.split("_")[0];v!==Mh.offNotAllowSelfOn&&v!==Mh.offAllowSelfOn||(null===(d=o.roomContext)||void 0===d?void 0:d.localMember.isVideoOn)&&(null===(h=o.rtcController)||void 0===h||h.muteMyVideo())}},onRoomPropertiesDeleted:function onRoomPropertiesDeleted(t){o.logger.log("QChatMedia::addRTCChannelListener::onRoomPropertiesDeleted",t)},onMemberJoinRtcChannel:function onMemberJoinRtcChannel(t){o.logger.log("QChatMedia::addRTCChannelListener::onMemberJoinRTCChannel",t);var a=map(t).call(t,(function(t){return t.uuid}));o.core.emit("memberJoinRTCChannel",a)},onMemberLeaveRoom:function onMemberLeaveRoom(t){o.logger.log("QChatMedia::addRTCChannelListener::onMemberLeaveRoom",t);var a=map(t).call(t,(function(t){return t.uuid}));o.core.emit("memberLeaveRTCChannel",a)},onRoomEnded:function onRoomEnded(t){o.authService&&o.authService.logout(),o._setStateInit(),o.logger.log("QChatMedia::addRTCChannelListener::onRoomEnded",t),o.core.emit("RTCChannelEnded",t)},onRtcChannelError:function onRtcChannelError(t){o.logger.log("QChatMedia::addRTCChannelListener::onRtcChannelError",t),"SOCKET_ERROR"===t&&o.disconnectChannel(),o.core.emit("RTCChannelError",t)},onRtcAudioVolumeIndication:function onRtcAudioVolumeIndication(t){o.logger.log("QChatMedia::addRTCChannelListener::onRtcAudioVolumeIndication",t),o.core.emit("onRtcAudioVolumeIndication",t)},onMemberAudioMuteChanged:function onMemberAudioMuteChanged(t,a,c){o.logger.log("QChatMedia::addRTCChannelListener::onMemberAudioMuteChanged",t,a),o.core.emit("memberAudioMuteChanged",{memberAccId:t.uuid,mute:a,operateByAccId:c.uuid})},onMemberScreenShareStateChanged:function onMemberScreenShareStateChanged(t,a,c){o.logger.log("QChatMedia::addRTCChannelListener::onMemberScreenShareStateChanged",t,a),o.core.emit("memberScreenShareStateChanged",{memberAccId:t.uuid,isSharing:a,operateByAccId:c.uuid})},onMemberVideoMuteChanged:function onMemberVideoMuteChanged(t,a,c){o.logger.log("QChatMedia::addRTCChannelListener::onMemberVideoMuteChanged",t,a),o.core.emit("memberVideoMuteChanged",{memberAccId:t.uuid,mute:a,operateByAccId:c.uuid})}})}},{key:"enumCameraDevices",value:function enumCameraDevices(){var t=this;return this._checkConnectState(),this.rtcController.enumCameraDevices().then((function(t){return t.data}),(function(a){throw t.logger.error("QChatMedia::enumCameraDevices error",a),new Ho("QChatMedia::enumCameraDevices error",a)}))}},{key:"enumPlayoutDevices",value:function enumPlayoutDevices(){var t=this;return this._checkConnectState(),this.rtcController.enumPlayoutDevices().then((function(t){return t.data}),(function(a){throw t.logger.error("QChatMedia::enumPlayoutDevices error",a),new Ho("QChatMedia::enumPlayoutDevices error",a)}))}},{key:"enumRecordDevices",value:function enumRecordDevices(){var t=this;return this._checkConnectState(),this.rtcController.enumRecordDevices().then((function(t){return t.data}),(function(a){throw t.logger.error("QChatMedia::enumRecordDevices error",a),new Ho("QChatMedia::enumRecordDevices error",a)}))}},{key:"removeRTCChannelListener",value:function removeRTCChannelListener(){var t,a;this._checkConnectState(),null===(t=this.roomContext)||void 0===t||t.removeRoomListener({}),null===(a=this.authService)||void 0===a||a.removeAuthListener({})}},{key:"setSelectedCameraDevice",value:function setSelectedCameraDevice(t){var a=this;return this._checkConnectState(),validate({deviceId:{type:"string",allowEmpty:!1}},t),this.rtcController.setSelectedCameraDevice(t.deviceId).then((function(t){return t.data}),(function(t){throw a.logger.error("QChatMedia::setSelectedCameraDevice error",t),new Ho("QChatMedia::setSelectedCameraDevice error",t)}))}},{key:"setSelectedPlayoutDevice",value:function setSelectedPlayoutDevice(t){var a=this;return this._checkConnectState(),validate({deviceId:{type:"string",allowEmpty:!1}},t),this.rtcController.setSelectedPlayoutDevice(t.deviceId).then((function(t){return t.data}),(function(t){throw a.logger.error("QChatMedia::setSelectedPlayoutDevice error",t),new Ho("QChatMedia::setSelectedPlayoutDevice error",t)}))}},{key:"setSelectedRecordDevice",value:function setSelectedRecordDevice(t){var a=this;return this._checkConnectState(),validate({deviceId:{type:"string",allowEmpty:!1}},t),this.rtcController.setSelectedRecordDevice(t.deviceId).then((function(t){return t.data}),(function(t){throw a.logger.error("QChatMedia::setSelectedRecordDevice error",t),new Ho("QChatMedia::setSelectedRecordDevice error",t)}))}},{key:"getRTCMembers",value:function getRTCMembers(){var t,a;return this._checkConnectState(),map(t=filter(a=this.roomContext.remoteMembers).call(a,(function(t){return t.isInRtcChannel}))).call(t,(function(t){return{accid:t.uuid,isAudioOn:!!t.isAudioOn,isVideoOn:!!t.isVideoOn,isSharingScreen:!!t.isSharingScreen,properties:t.properties}}))}},{key:"subscribeRemoteVideoSubStream",value:function subscribeRemoteVideoSubStream(t){var a;return __awaiter(this,void 0,void 0,zr.mark((function _callee25(){return zr.wrap((function _callee25$(o){for(;;)switch(o.prev=o.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),o.prev=2,null===(a=this.rtcController)||void 0===a||a.subscribeRemoteVideoSubStream(t.accid),o.next=10;break;case 6:throw o.prev=6,o.t0=o.catch(2),this.logger.error("QChatMedia::subscribeRemoteVideoSubStream error",o.t0),new Ho("QChatMedia::subscribeRemoteVideoSubStream error",o.t0);case 10:case"end":return o.stop()}}),_callee25,this,[[2,6]])})))}},{key:"unsubscribeRemoteVideoSubStream",value:function unsubscribeRemoteVideoSubStream(t){var a;return __awaiter(this,void 0,void 0,zr.mark((function _callee26(){return zr.wrap((function _callee26$(o){for(;;)switch(o.prev=o.next){case 0:this._checkConnectState(),validate({accid:{type:"string",allowEmpty:!1}},t),o.prev=2,null===(a=this.rtcController)||void 0===a||a.unsubscribeRemoteVideoSubStream(t.accid),o.next=10;break;case 6:throw o.prev=6,o.t0=o.catch(2),this.logger.error("QChatMedia::unsubscribeRemoteVideoSubStream error",o.t0),new Ho("QChatMedia::unsubscribeRemoteVideoSubStream error",o.t0);case 10:case"end":return o.stop()}}),_callee26,this,[[2,6]])})))}},{key:"muteAllAudio",value:function muteAllAudio(){var t;return __awaiter(this,void 0,void 0,zr.mark((function _callee27(){return zr.wrap((function _callee27$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),a.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 3:if(a.sent){a.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneMicrophone auth"),a.abrupt("return");case 7:a.prev=7,null===(t=this.roomContext)||void 0===t||t.updateRoomProperty("audioOff",Da({value:Mh.offNotAllowSelfOn+"_".concat((new Date).getTime())})),a.next=15;break;case 11:throw a.prev=11,a.t0=a.catch(7),this.logger.error("QChatMedia::muteAllAudio error",a.t0),new Ho("QChatMedia::muteAllAudio error",a.t0);case 15:case"end":return a.stop()}}),_callee27,this,[[7,11]])})))}},{key:"muteAllVideo",value:function muteAllVideo(){var t;return __awaiter(this,void 0,void 0,zr.mark((function _callee28(){return zr.wrap((function _callee28$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),a.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 3:if(a.sent){a.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneCamera auth"),a.abrupt("return");case 7:a.prev=7,null===(t=this.roomContext)||void 0===t||t.updateRoomProperty("videoOff",Da({value:Mh.offNotAllowSelfOn+"_".concat((new Date).getTime())})),a.next=15;break;case 11:throw a.prev=11,a.t0=a.catch(7),this.logger.error("QChatMedia::muteAllVideo error",a.t0),new Ho("QChatMedia::muteAllVideo error",a.t0);case 15:case"end":return a.stop()}}),_callee28,this,[[7,11]])})))}},{key:"unMuteAllAudio",value:function unMuteAllAudio(){var t;return __awaiter(this,void 0,void 0,zr.mark((function _callee29(){return zr.wrap((function _callee29$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),a.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneMicrophone"});case 3:if(a.sent){a.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneMicrophone auth"),a.abrupt("return");case 7:a.prev=7,null===(t=this.roomContext)||void 0===t||t.updateRoomProperty("audioOff",Da({value:Mh.disable+"_".concat((new Date).getTime())})),a.next=15;break;case 11:throw a.prev=11,a.t0=a.catch(7),this.logger.error("QChatMedia::unMuteAllAudio error",a.t0),new Ho("QChatMedia::unMuteAllAudio error",a.t0);case 15:case"end":return a.stop()}}),_callee29,this,[[7,11]])})))}},{key:"unMuteAllVideo",value:function unMuteAllVideo(){var t;return __awaiter(this,void 0,void 0,zr.mark((function _callee30(){return zr.wrap((function _callee30$(a){for(;;)switch(a.prev=a.next){case 0:return this._checkConnectState(),a.next=3,this._checkPermission({serverId:this.serverId,channelId:this.channelId,auth:"RTCChannelOpenCloseEveryoneCamera"});case 3:if(a.sent){a.next=7;break}return this.logger.error("QChatMedia::connect::auth your have not RTCChannelOpenCloseEveryoneCamera auth"),a.abrupt("return");case 7:a.prev=7,null===(t=this.roomContext)||void 0===t||t.updateRoomProperty("videoOff",Da({value:Mh.disable+"_".concat((new Date).getTime())})),a.next=15;break;case 11:throw a.prev=11,a.t0=a.catch(7),this.logger.error("QChatMedia::unMuteAllVideo error",a.t0),new Ho("QChatMedia::unMuteAllVideo error",a.t0);case 15:case"end":return a.stop()}}),_callee30,this,[[7,11]])})))}}]),QChatMediaService}(_p),Ah={"1_2":"heartbeat","24_2":"qchatLogin","24_4":"qchatExit","24_5":"qchatBeKicked","24_8":"qchatMultiSpotLogin","24_9":"qchatKick","24_19":"qchatSync"},Oh={qchatLoginTag:{appkey:1,account:2,authType:3,token:4,loginExt:5,clientType:6,clientSession:7,deviceId:8,sdkVersion:9,sdkType:10,userAgent:11,customTag:12,customClientType:13,sdkHumanVersion:14,pushTokenName:20,pushToken:21,pushkitTokenName:22,pushkitToken:23,deviceInfo:24,customPushContentType:25,os:30,mac:31,bundleId:32,simCarrierCode:33,simCountryCode:34,networkCode:35,browser:36,deviceModel:37,androidid:38,imei:39,idfv:40,openuuid:41,pushType:100,hasTokenPreviously:101,consid:102,clientIP:103,clientPort:104,loginTime:105}},jh=invertSerializeMap(Oh),Uh={heartbeat:{sid:1,cid:2,service:"qchatAuth"},qchatLogin:{sid:24,cid:2,service:"qchatAuth",params:[{type:"Property",name:"qchatLoginReqTag",reflectMapper:Oh.qchatLoginTag}],response:[{type:"Property",name:"qchatLoginResTag",reflectMapper:jh.qchatLoginTag},{type:"PropertyArray",name:"qchatMultiLoginResult",reflectMapper:jh.qchatLoginTag}]},qchatExit:{sid:24,cid:4,service:"qchatAuth"},qchatBeKicked:{sid:24,cid:5,service:"qchatAuth",response:[{type:"Property",name:"beKickedTag",reflectMapper:{1:"clientType",2:"reason",3:"ext",4:"customClientType"}}]},qchatMultiSpotLogin:{sid:24,cid:8,service:"qchatAuth",response:[{type:"Number",name:"state"},{type:"Property",name:"qchatLoginResTag",reflectMapper:jh.qchatLoginTag}]},qchatKick:{sid:24,cid:9,service:"qchatAuth",params:[{type:"StrArray",name:"deviceIds"}],response:[{type:"StrArray",name:"deviceIds"}]},qchatSync:{sid:24,cid:19,service:"qchatAuth",params:[{type:"Property",name:"qchatSyncTag",reflectMapper:{systemNotification:1,pushConfig:2}}],response:[{type:"Number",name:"timetag"}]}};function _createSuper(t){var a=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!le)return!1;if(le.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(le(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,c=qe(t);if(a){var l=qe(this).constructor;o=le(c,arguments,l)}else o=c.apply(this,arguments);return Kr(this,o)}}var Bh={debugLevel:"off",needReconnect:!0,reconnectionAttempts:Hr},Lh=function(t){Ne(QChat,t);var a=_createSuper(QChat);function QChat(t){var o,c,l,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{cloudStorageConfig:{}};return ue(this,QChat),(o=a.call(this,t)).instanceName="QChat",o.account="",o.options={},o.qchatAuth={},o.qchatServer={},o.qchatChannel={},o.qchatMsg={},o.qchatRole={},o.qchatMedia={},o.cloudStorage={},o.setOptions(t),registerParser({cmdMap:Ah,cmdConfig:Uh}),registerParser({cmdMap:Zu,cmdConfig:np}),o.qchatAuth=new kh(me(o)),o.qchatServer=new ud(me(o)),o.qchatChannel=new Hd(me(o)),o.qchatMsg=new Ch(me(o)),o.qchatRole=new th(me(o)),o.qchatMedia=new Ph(me(o)),o.cloudStorage=new sp(me(o),o.instanceName),(null===(c=null==p?void 0:p.cloudStorageConfig)||void 0===c?void 0:c.s3)&&o.cloudStorage.setS3(p.cloudStorageConfig.s3),(null===(l=null==p?void 0:p.QChatMedia)||void 0===l?void 0:l.neroom)&&o.qchatMedia.setNeroom(p.QChatMedia.neroom),o}return he(QChat,[{key:"connect",value:function connect(){var t=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=Be(null,{connect:{get:function get(){return Ae(qe(QChat.prototype),"connect",t)}}});return __awaiter(this,void 0,void 0,zr.mark((function _callee(){var t,c,l;return zr.wrap((function _callee$(p){for(;;)switch(p.prev=p.next){case 0:if(/^(unconnected|waitReconnect)$/.test(this.status)){p.next=4;break}return t="QChat status is ".concat(this.status,", and would not repeat connect"),this.logger.warn(t),p.abrupt("return",pa.reject(t));case 4:return c=a.isAutoReconnect||!1,p.next=7,o.connect.call(this,{linkUrls:this.options.linkAddresses,isAutoReconnect:c});case 7:return p.prev=7,p.next=10,this.qchatAuth.doLogin(c);case 10:l=p.sent,p.next=21;break;case 13:if(p.prev=13,p.t0=p.catch(7),this.logger.warn("qchat connect:: login failed",p.t0),0!==this.retryCount){p.next=19;break}throw this.doDisconnect(Cc.ACTIVE,"FailedToInitializeLogin"),p.t0;case 19:return this.doDisconnect(Cc.OFFLINE,"ReconnectLoginFailed"),p.abrupt("return");case 21:return this.status="logined",l.loginResult.appkey=this.options.appkey,this.emit("logined",l.loginResult),l.multiLoginResults&&l.multiLoginResults.length>0&&this.emit("multiSpotLogin",l.multiLoginResults),this.resetConnectStatus(),this.ping(),p.prev=27,p.next=30,this.cloudStorage.init();case 30:p.next=35;break;case 32:p.prev=32,p.t1=p.catch(27),this.logger.error("NIM:login cloudStorage init failed ",p.t1);case 35:return p.next=37,this.qchatAuth.sync();case 37:case"end":return p.stop()}}),_callee,this,[[7,13],[27,32]])})))}},{key:"login",value:function login(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.connect(t)}},{key:"setOptions",value:function setOptions(t){validate({account:{type:"string"},appkey:{type:"string"},token:{type:"string"},linkAddresses:{type:"array",itemType:"string"},needReconnect:{type:"boolean",required:!1},reconnectionAttempts:{type:"number",required:!1},debugLevel:{type:"enum",values:ni,required:!1}},t),this.logger.log("QChat::setOptions options is",t),this.account=t.account,this.options=ma(ma({},Bh),t)}},{key:"onMessage",value:function onMessage(t){var a,o,c=Ae(qe(QChat.prototype),"onMessage",this).call(this,t);if(c){var l=c.raw.ser,p=this.sendingCmdMap.get(l);if(p&&p.cmd===c.cmd){var d=p.callback,h=p.timer,m=p.params;if(clearTimeout(h),c.params=m,this.sendingCmdMap.delete(l),"heartbeat"===c.cmd)return void d[0]();var v=null===(a=this[c.service])||void 0===a?void 0:a.process(c);v&&"function"==typeof v.then?v.then((function(t){d[0](t)})).catch((function(t){d[1](t)})):(this.logger.log("imsocket:: handlerFn without promise",c.service,c.cmd),d[0]())}else null===(o=this[c.service])||void 0===o||o.process(c)}}},{key:"disconnect",value:function disconnect(){var t=this;switch(this.status){case"connected":case"logined":return this.sendCmd("qchatExit").then((function(){Ae(qe(QChat.prototype),"doDisconnect",t).call(t,Cc.ACTIVE,"UserActiveDisconnect")}));case"connecting":case"waitReconnect":return Ae(qe(QChat.prototype),"doDisconnect",this).call(this,Cc.ACTIVE,"UserActiveDisconnect"),pa.resolve();case"unconnected":case"destroyed":return pa.resolve()}}},{key:"logout",value:function logout(){return this.disconnect()}},{key:"destroy",value:function destroy(){return Ae(qe(QChat.prototype),"destroy",this).call(this)}},{key:"kickOtherClients",value:function kickOtherClients(t){return validate({deviceIds:{type:"array",itemType:"string"}},t),this.qchatAuth.kick(t)}}]),QChat}(kc),Nh=Math.min,Fh=[].lastIndexOf,$h=!!Fh&&1/[1].lastIndexOf(1,-0)<0,Gh=arrayMethodIsStrict("lastIndexOf"),Qh=$h||!Gh?function lastIndexOf(t){if($h)return Fh.apply(this,arguments)||0;var a=toIndexedObject(this),o=toLength(a.length),c=o-1;for(arguments.length>1&&(c=Nh(c,toInteger$1(arguments[1]))),c<0&&(c=o+c);c>=0;c--)if(c in a&&a[c]===t)return c||0;return-1}:Fh;_export({target:"Array",proto:!0,forced:Qh!==[].lastIndexOf},{lastIndexOf:Qh});var Dh=entryVirtual("Array").lastIndexOf,Wh=Array.prototype,lastIndexOf=function(t){var a=t.lastIndexOf;return t===Wh||t instanceof Array&&a===Wh.lastIndexOf?Dh:a},Kh=createCommonjsModule((function(a,o){(function(){var c={function:!0,object:!0},l=c[typeof window]&&window||this,p=c.object&&o,d=c.object&&a&&!a.nodeType&&a,h=p&&d&&"object"==typeof t&&t;!h||h.global!==h&&h.window!==h&&h.self!==h||(l=h);var m=Math.pow(2,53)-1,v=/\bOpera/,y=Object.prototype,g=y.hasOwnProperty,b=y.toString;function capitalize(t){return(t=String(t)).charAt(0).toUpperCase()+t.slice(1)}function format(t){return t=trim(t),/^(?:webOS|i(?:OS|P))/.test(t)?t:capitalize(t)}function forOwn(t,a){for(var o in t)g.call(t,o)&&a(t[o],o,t)}function getClassOf(t){return null==t?capitalize(t):b.call(t).slice(8,-1)}function qualify(t){return String(t).replace(/([ -])(?!$)/g,"$1?")}function reduce(t,a){var o=null;return function each(t,a){var o=-1,c=t?t.length:0;if("number"==typeof c&&c>-1&&c<=m)for(;++o<c;)a(t[o],o,t);else forOwn(t,a)}(t,(function(c,l){o=a(o,c,l,t)})),o}function trim(t){return String(t).replace(/^ +| +$/g,"")}var C=function parse(t){var a=l,o=t&&"object"==typeof t&&"String"!=getClassOf(t);o&&(a=t,t=null);var c=a.navigator||{},p=c.userAgent||"";t||(t=p);var d,h,m=o?!!c.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(b.toString()),y="Object",g=o?y:"ScriptBridgingProxyObject",C=o?y:"Environment",S=o&&a.java?"JavaPackage":getClassOf(a.java),_=o?y:"RuntimeObject",M=/\bJava/.test(S)&&a.java,w=M&&getClassOf(a.environment)==C,k=M?"a":"Î±",x=M?"b":"Î²",I=a.document||{},T=a.operamini||a.opera,R=v.test(R=o&&T?T["[[Class]]"]:getClassOf(T))?R:T=null,q=t,E=[],P=null,A=t==p,O=A&&T&&"function"==typeof T.version&&T.version(),j=function getLayout(a){return reduce(a,(function(a,o){return a||RegExp("\\b"+(o.pattern||qualify(o))+"\\b","i").exec(t)&&(o.label||o)}))}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),U=function getName(a){return reduce(a,(function(a,o){return a||RegExp("\\b"+(o.pattern||qualify(o))+"\\b","i").exec(t)&&(o.label||o)}))}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),B=getProduct([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),L=function getManufacturer(a){return reduce(a,(function(a,o,c){return a||(o[B]||o[/^[a-z]+(?: +[a-z]+\b)*/i.exec(B)]||RegExp("\\b"+qualify(c)+"(?:\\b|\\w*\\d)","i").exec(t))&&c}))}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),N=function getOS(a){return reduce(a,(function(a,o){var c=o.pattern||qualify(o);return!a&&(a=RegExp("\\b"+c+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(a=function cleanupOS(t,a,o){var c={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return a&&o&&/^Win/i.test(t)&&!/^Windows Phone /i.test(t)&&(c=c[/[\d.]+$/.exec(t)])&&(t="Windows "+c),t=String(t),a&&o&&(t=t.replace(RegExp(a,"i"),o)),format(t.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(a,c,o.label||o)),a}))}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function getProduct(a){return reduce(a,(function(a,o){var c=o.pattern||qualify(o);return!a&&(a=RegExp("\\b"+c+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+c+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+c+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((a=String(o.label&&!RegExp(c,"i").test(o.label)?o.label:a).split("/"))[1]&&!/[\d.]+/.test(a[0])&&(a[0]+=" "+a[1]),o=o.label||o,a=format(a[0].replace(RegExp(c,"i"),o).replace(RegExp("; *(?:"+o+"[_-])?","i")," ").replace(RegExp("("+o+")[-_.]?(\\w)","i"),"$1 $2"))),a}))}function getVersion(a){return reduce(a,(function(a,o){return a||(RegExp(o+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}if(j&&(j=[j]),/\bAndroid\b/.test(N)&&!B&&(d=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(B=trim(d[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),L&&!B?B=getProduct([L]):L&&B&&(B=B.replace(RegExp("^("+qualify(L)+")[-_.\\s]","i"),L+" ").replace(RegExp("^("+qualify(L)+")[-_.]?(\\w)","i"),L+" $2")),(d=/\bGoogle TV\b/.exec(B))&&(B=d[0]),/\bSimulator\b/i.test(t)&&(B=(B?B+" ":"")+"Simulator"),"Opera Mini"==U&&/\bOPiOS\b/.test(t)&&E.push("running in Turbo/Uncompressed mode"),"IE"==U&&/\blike iPhone OS\b/.test(t)?(L=(d=parse(t.replace(/like iPhone OS/,""))).manufacturer,B=d.product):/^iP/.test(B)?(U||(U="Safari"),N="iOS"+((d=/ OS ([\d_]+)/i.exec(t))?" "+d[1].replace(/_/g,"."):"")):"Konqueror"==U&&/^Linux\b/i.test(N)?N="Kubuntu":L&&"Google"!=L&&(/Chrome/.test(U)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(B))||/\bAndroid\b/.test(N)&&/^Chrome/.test(U)&&/\bVersion\//i.test(t)?(U="Android Browser",N=/\bAndroid\b/.test(N)?N:"Android"):"Silk"==U?(/\bMobi/i.test(t)||(N="Android",E.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&E.unshift("accelerated")):"UC Browser"==U&&/\bUCWEB\b/.test(t)?E.push("speed mode"):"PaleMoon"==U&&(d=/\bFirefox\/([\d.]+)\b/.exec(t))?E.push("identifying as Firefox "+d[1]):"Firefox"==U&&(d=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(N||(N="Firefox OS"),B||(B=d[1])):!U||(d=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(U))?(U&&!B&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(d+"/")+8))&&(U=null),(d=B||L||N)&&(B||L||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(N))&&(U=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(N)?N:d)+" Browser")):"Electron"==U&&(d=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&E.push("Chromium "+d),O||(O=getVersion(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",qualify(U),"(?:Firefox|Minefield|NetFront)"])),(d=("iCab"==j&&parseFloat(O)>3?"WebKit":/\bOpera\b/.test(U)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(j)&&"WebKit"||!j&&/\bMSIE\b/i.test(t)&&("Mac OS"==N?"Tasman":"Trident")||"WebKit"==j&&/\bPlayStation\b(?! Vita\b)/i.test(U)&&"NetFront")&&(j=[d]),"IE"==U&&(d=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(U+=" Mobile",N="Windows Phone "+(/\+$/.test(d)?d:d+".x"),E.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(U="IE Mobile",N="Windows Phone 8.x",E.unshift("desktop mode"),O||(O=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=U&&"Trident"==j&&(d=/\brv:([\d.]+)/.exec(t))&&(U&&E.push("identifying as "+U+(O?" "+O:"")),U="IE",O=d[1]),A){if(function isHostType(t,a){var o=null!=t?typeof t[a]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(o)||"object"==o&&!t[a])}(a,"global"))if(M&&(q=(d=M.lang.System).getProperty("os.arch"),N=N||d.getProperty("os.name")+" "+d.getProperty("os.version")),w){try{O=a.require("ringo/engine").version.join("."),U="RingoJS"}catch(t){(d=a.system)&&d.global.system==a.system&&(U="Narwhal",N||(N=d[0].os||null))}U||(U="Rhino")}else"object"==typeof a.process&&!a.process.browser&&(d=a.process)&&("object"==typeof d.versions&&("string"==typeof d.versions.electron?(E.push("Node "+d.versions.node),U="Electron",O=d.versions.electron):"string"==typeof d.versions.nw&&(E.push("Chromium "+O,"Node "+d.versions.node),U="NW.js",O=d.versions.nw)),U||(U="Node.js",q=d.arch,N=d.platform,O=(O=/[\d.]+/.exec(d.version))?O[0]:null));else getClassOf(d=a.runtime)==g?(U="Adobe AIR",N=d.flash.system.Capabilities.os):getClassOf(d=a.phantom)==_?(U="PhantomJS",O=(d=d.version||null)&&d.major+"."+d.minor+"."+d.patch):"number"==typeof I.documentMode&&(d=/\bTrident\/(\d+)/i.exec(t))?(O=[O,I.documentMode],(d=+d[1]+4)!=O[1]&&(E.push("IE "+O[1]+" mode"),j&&(j[1]=""),O[1]=d),O="IE"==U?String(O[1].toFixed(1)):O[0]):"number"==typeof I.documentMode&&/^(?:Chrome|Firefox)\b/.test(U)&&(E.push("masking as "+U+" "+O),U="IE",O="11.0",j=["Trident"],N="Windows");N=N&&format(N)}if(O&&(d=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(O)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(A&&c.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(P=/b/i.test(d)?"beta":"alpha",O=O.replace(RegExp(d+"\\+?$"),"")+("beta"==P?x:k)+(/\d+\+?/.exec(d)||"")),"Fennec"==U||"Firefox"==U&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(N))U="Firefox Mobile";else if("Maxthon"==U&&O)O=O.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(B))"Xbox 360"==B&&(N=null),"Xbox 360"==B&&/\bIEMobile\b/.test(t)&&E.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(U)&&(!U||B||/Browser|Mobi/.test(U))||"Windows CE"!=N&&!/Mobi/i.test(t))if("IE"==U&&A)try{null===a.external&&E.unshift("platform preview")}catch(t){E.unshift("embedded")}else(/\bBlackBerry\b/.test(B)||/\bBB10\b/.test(t))&&(d=(RegExp(B.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||O)?(N=((d=[d,/BB10/.test(t)])[1]?(B=null,L="BlackBerry"):"Device Software")+" "+d[0],O=null):this!=forOwn&&"Wii"!=B&&(A&&T||/Opera/.test(U)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==U&&/\bOS X (?:\d+\.){2,}/.test(N)||"IE"==U&&(N&&!/^Win/.test(N)&&O>5.5||/\bWindows XP\b/.test(N)&&O>8||8==O&&!/\bTrident\b/.test(t)))&&!v.test(d=parse.call(forOwn,t.replace(v,"")+";"))&&d.name&&(d="ing as "+d.name+((d=d.version)?" "+d:""),v.test(U)?(/\bIE\b/.test(d)&&"Mac OS"==N&&(N=null),d="identify"+d):(d="mask"+d,U=R?format(R.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(d)&&(N=null),A||(O=null)),j=["Presto"],E.push(d));else U+=" Mobile";(d=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(d=[parseFloat(d.replace(/\.(\d)$/,".0$1")),d],"Safari"==U&&"+"==d[1].slice(-1)?(U="WebKit Nightly",P="alpha",O=d[1].slice(0,-1)):O!=d[1]&&O!=(d[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(O=null),d[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==d[0]&&537.36==d[2]&&parseFloat(d[1])>=28&&"WebKit"==j&&(j=["Blink"]),A&&(m||d[1])?(j&&(j[1]="like Chrome"),d=d[1]||((d=d[0])<530?1:d<532?2:d<532.05?3:d<533?4:d<534.03?5:d<534.07?6:d<534.1?7:d<534.13?8:d<534.16?9:d<534.24?10:d<534.3?11:d<535.01?12:d<535.02?"13+":d<535.07?15:d<535.11?16:d<535.19?17:d<536.05?18:d<536.1?19:d<537.01?20:d<537.11?"21+":d<537.13?23:d<537.18?24:d<537.24?25:d<537.36?26:"Blink"!=j?"27":"28")):(j&&(j[1]="like Safari"),d=(d=d[0])<400?1:d<500?2:d<526?3:d<533?4:d<534?"4+":d<535?5:d<537?6:d<538?7:d<601?8:d<602?9:d<604?10:d<606?11:d<608?12:"12"),j&&(j[1]+=" "+(d+="number"==typeof d?".x":/[.+]/.test(d)?"":"+")),"Safari"==U&&(!O||parseInt(O)>45)?O=d:"Chrome"==U&&/\bHeadlessChrome/i.test(t)&&E.unshift("headless")),"Opera"==U&&(d=/\bzbov|zvav$/.exec(N))?(U+=" ",E.unshift("desktop mode"),"zvav"==d?(U+="Mini",O=null):U+="Mobile",N=N.replace(RegExp(" *"+d+"$"),"")):"Safari"==U&&/\bChrome\b/.exec(j&&j[1])?(E.unshift("desktop mode"),U="Chrome Mobile",O=null,/\bOS X\b/.test(N)?(L="Apple",N="iOS 4.3+"):N=null):/\bSRWare Iron\b/.test(U)&&!O&&(O=getVersion("Chrome")),O&&0==O.indexOf(d=/[\d.]+$/.exec(N))&&t.indexOf("/"+d+"-")>-1&&(N=trim(N.replace(d,""))),N&&-1!=N.indexOf(U)&&!RegExp(U+" OS").test(N)&&(N=N.replace(RegExp(" *"+qualify(U)+" *"),"")),j&&!/\b(?:Avant|Nook)\b/.test(U)&&(/Browser|Lunascape|Maxthon/.test(U)||"Safari"!=U&&/^iOS/.test(N)&&/\bSafari\b/.test(j[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(U)&&j[1])&&(d=j[j.length-1])&&E.push(d),E.length&&(E=["("+E.join("; ")+")"]),L&&B&&B.indexOf(L)<0&&E.push("on "+L),B&&E.push((/^on /.test(E[E.length-1])?"":"on ")+B),N&&(d=/ ([\d.+]+)$/.exec(N),h=d&&"/"==N.charAt(N.length-d[0].length-1),N={architecture:32,family:d&&!h?N.replace(d[0],""):N,version:d?d[1]:null,toString:function(){var t=this.version;return this.family+(t&&!h?" "+t:"")+(64==this.architecture?" 64-bit":"")}}),(d=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(q))&&!/\bi686\b/i.test(q)?(N&&(N.architecture=64,N.family=N.family.replace(RegExp(" *"+d),"")),U&&(/\bWOW64\b/i.test(t)||A&&/\w(?:86|32)$/.test(c.cpuClass||c.platform)&&!/\bWin64; x64\b/i.test(t))&&E.unshift("32-bit")):N&&/^OS X/.test(N.family)&&"Chrome"==U&&parseFloat(O)>=39&&(N.architecture=64),t||(t=null);var $={};return $.description=t,$.layout=j&&j[0],$.manufacturer=L,$.name=U,$.prerelease=P,$.product=B,$.ua=t,$.version=U&&O,$.os=N||{architecture:null,family:null,version:null,toString:function(){return"null"}},$.parse=parse,$.toString=function toStringPlatform(){return this.description||""},$.version&&E.unshift(O),$.name&&E.unshift(U),N&&U&&(N!=String(N).split(" ")[0]||N!=U.split(" ")[0]&&!B)&&E.push(B?"("+N+")":"on "+N),E.length&&($.description=E.join(" ")),$}();p&&d?forOwn(C,(function(t,a){p[a]=t})):l.platform=C}).call(t)})),Vh=createCommonjsModule((function(t,a){self,t.exports=function(){var t={d:function(a,o){for(var c in o)t.o(o,c)&&!t.o(a,c)&&Object.defineProperty(a,c,{enumerable:!0,get:o[c]})},o:function(t,a){return Object.prototype.hasOwnProperty.call(t,a)}},a={};t.d(a,{default:function(){return y}});var o=function e(t){for(var a in function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,e),this.directUploadAddr="https://wanproxy-web.127.net",this.retryCount=2,this.trunkSize=4194304,this.trunkUploadTimeout=5e4,this.getOffsetTimeout=1e4,this.version="1.0",this.onError=function(t){},this.onProgress=function(t){},this.onComplete=function(t){},t)this[a]=t[a]};function n(t,a){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function(t,a){if(t){if("string"==typeof t)return r(t,a);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?r(t,a):void 0}}(t))||a&&t&&"number"==typeof t.length){o&&(t=o);var c=0,i=function(){};return{s:i,n:function(){return c>=t.length?{done:!0}:{done:!1,value:t[c++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,p=!0,d=!1;return{s:function(){o=o.call(t)},n:function(){var t=o.next();return p=t.done,t},e:function(t){d=!0,l=t},f:function(){try{p||null==o.return||o.return()}finally{if(d)throw l}}}}function r(t,a){(null==a||a>t.length)&&(a=t.length);for(var o=0,c=new Array(a);o<a;o++)c[o]=t[o];return c}var c=window.localStorage;window.localStorage&&"function"==typeof window.localStorage.getItem&&"function"==typeof window.localStorage.setItem&&"function"==typeof window.localStorage.removeItem||(c={privateObj:{},setItem:function(t,a){c.privateObj[t]=a},getItem:function(t){return c.privateObj[t]},removeItem:function(t){delete c.privateObj[t]},getKeys:function(){return Object.keys(c.privateObj)}});var l={getFileKey:function(t){var a=t.size.toString(),o=t.lastModified.toString();return t.name+a.slice(a.length-5)+o.slice(o.length-5)},getFileInfo:function(t){var a=c.getItem(t);if(!a)return null;try{return JSON.parse(a)}catch(t){return null}},initFile:function(t,a){l.clearExpiredInfo();var o=this.getFileKey(a),p={ctx:void 0!==t.ctx?t.ctx:"",bucket:t.bucketName,obj:t.objectName,token:t.token,modifyAt:Date.now(),end:!1};return t.payload&&(p.payload=t.payload),c.setItem(o,JSON.stringify(p)),o},setUploadContext:function(t,a){var o=this.getFileInfo(t);o&&(o.ctx=a,c.setItem(t,JSON.stringify(o)))},setComplete:function(t){var a=this.getFileInfo(t);a&&(a.modifyAt=Date.now(),a.end=!0,c.setItem(t,JSON.stringify(a)))},getUploadContext:function(t){var a=this.getFileInfo(t);return a?a.ctx:""},removeFileInfo:function(t){c.removeItem(t)},clearExpiredInfo:function(){var t,a="function"==typeof c.getKeys?c.getKeys():Object.keys(c),o=Date.now(),p=[],d=n(a);try{for(d.s();!(t=d.n()).done;){var h=t.value,m=l.getFileInfo(h);null===m||o-m.modifyAt>y.expireTime?c.removeItem(h):p.push({fileInfo:m,key:h})}}catch(t){d.e(t)}finally{d.f()}if(p.length>y.maxFileCache){var v,g=n(p.sort((function(t,a){return a.fileInfo.modifyAt-t.fileInfo.modifyAt})).slice(y.maxFileCache));try{for(g.s();!(v=g.n()).done;){var b=v.value;c.removeItem(b.key)}}catch(t){g.e(t)}finally{g.f()}}}},p=l,d=function e(t,a,o){if("uploading"===t.uploadState){var c=t.config,l=t.param,d=p.getUploadContext(t.fileKey);if(!d)return o(0);var h=new XMLHttpRequest;h.onreadystatechange=function(){if("abort"!==t.uploadState&&4===h.readyState){var l;try{l=JSON.parse(h.responseText)}catch(t){l={errMsg:"JsonParseError in getOffset",errCode:500}}200===h.status?l.errCode?t.config.onError({errCode:l.errCode,errMsg:l.errMsg}):o(l.offset):h.status.toString().match(/^5/)?e(t,a-1,o):(c.onError(h.statusText),404===h.status&&p.removeFileInfo(t.fileKey))}};var m=c.directUploadAddr+"/".concat(l.bucketName)+"/".concat(encodeURIComponent(l.objectName))+"?uploadContext"+"&context=".concat(d)+"&version=".concat(c.version);h.open("get",m),h.setRequestHeader("x-nos-token",l.token),h.timeout=c.getOffsetTimeout,h.send()}},h=function e(t,a,o,c){if("uploading"===t.uploadState){var l=t.param,d=t.config,h=File.prototype.slice,m=void 0!==l.ctx?l.ctx:"",v=a+d.trunkSize>t.file.size,y=v?t.file.size:a+d.trunkSize,g=new XMLHttpRequest;if(g.upload.onprogress=function(o){var c=0;o.lengthComputable?(c=(a+o.loaded)/t.file.size,d.onProgress(c)):d.onError({errMsg:"browser does not support query upload progress"})},g.onreadystatechange=function(){if("abort"!==t.uploadState&&4===g.readyState){var l;try{l=JSON.parse(g.responseText)}catch(t){console.error("JsonParseError in uploadTrunk",t),l={errMsg:"JsonParseError in uploadTrunk"}}200===g.status?(t.setContext(l.context),v?(c(),t.setComplete()):e(t,l.offset,d.retryCount,c)):g.status.toString().match(/^5/)?o>0?e(t,a,o-1,c):(p.removeFileInfo(t.fileKey),d.onError({errCode:l.errCode,errMsg:l.errMsg})):g.status?(p.removeFileInfo(t.fileKey),d.onError({errCode:l.errCode,errMsg:l.errMsg})):(console.log("upload is paused",g),d.onError({errMsg:l.errMsg}))}},g.open("post",d.directUploadAddr+"/".concat(l.bucketName)+"/".concat(encodeURIComponent(l.objectName))+"?offset=".concat(a)+"&complete=".concat(v)+"&context=".concat(m)+"&version=".concat(d.version)),g.setRequestHeader("x-nos-token",l.token),t.file.type&&g.setRequestHeader("content-type",t.file.type),g.timeout=d.trunkUploadTimeout,"undefined"!=typeof FileReader){var b=new FileReader;b.readAsArrayBuffer(h.call(t.file,a,y)),b.onload=function(t){var a;if(!(null===(a=null==t?void 0:t.target)||void 0===a?void 0:a.result))throw new Error("Read ArrayBuffer failed");g.send(t.target.result)}}else g.send(h.call(t.file,a,y))}};function u(t,a){for(var o=0;o<a.length;o++){var c=a[o];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,c.key,c)}}var m=function(){function e(t,a,o){!function(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this,e),this.uploadState="paused",this.config=o,this.file=t,this.param=a,this.fileKey=p.initFile(a,t),this.resume()}var t;return(t=[{key:"resume",value:function(){var t=this;if("uploading"!==this.uploadState){this.setUploadState("uploading");var a=this.config;d(this,a.retryCount,(function(o){h(t,o,a.retryCount,(function(){t.setUploadState("ended"),"function"==typeof a.onComplete&&a.onComplete(t.param)}))}))}}},{key:"pause",value:function(){this.setUploadState("paused")}},{key:"abort",value:function(){this.setUploadState("abort"),p.removeFileInfo(this.fileKey)}},{key:"setUploadState",value:function(t){t!==this.uploadState&&(this.uploadState=t)}},{key:"setContext",value:function(t){p.setUploadContext(this.fileKey,t),this.param.ctx=t}},{key:"setComplete",value:function(){p.setComplete(this.fileKey),this.setUploadState("ended")}}])&&u(e.prototype,t),e}(),v={maxFileCache:100,expireTime:31536e6,getFileUploadInformation:function(t){var a=p.getFileKey(t),o=p.getFileInfo(a);return null===o?null:Date.now()-o.modifyAt>v.expireTime?(p.removeFileInfo(a),null):{uploadInfo:Object.assign({bucketName:o.bucket,objectName:o.obj,token:o.token,ctx:o.ctx},o.payload?{payload:o.payload}:{}),complete:o.end}},setMaxFileCache:function(t){v.maxFileCache=t},setExpireTime:function(t){v.expireTime=t},printCaches:function(){for(var t=0,a=Object.keys(localStorage);t<a.length;t++){var o=a[t],c=p.getFileInfo(o);c&&console.log(c,"modifiedAt",new Date(c.modifyAt).toTimeString())}},createConfig:function(t){return new o(t)},createTask:function(t,a,o){return new m(t,a,o)}},y=v;return a.default}()})),zh=createCommonjsModule((function(t,a){t.exports=function(){const t=5e3;function object2String(t){if(t){let a="";return Object.entries(t).forEach((([t,o],c)=>{a+=0===c?"?":"&",a+=`${t}=${o}`})),a}return""}function timeoutPromise(a,o){return new Promise(((c,l)=>{setTimeout((()=>{l({message:"request timeout",params:o})}),a||t)}))}function request(a,o={dataType:"json",method:"GET",timeout:t}){const c="text"===o.dataType?"text/plain; charset=UTF-8":"application/json; charset=UTF-8";let l="get"===o.method?object2String(o.params):"";return Promise.race([timeoutPromise(o.timeout,{url:a,params:o}),new Promise((function(t,p){if(window.fetch&&"function"==typeof window.fetch)try{let d={method:o.method,headers:{"Content-Type":c}};"POST"===o.method&&(d.body=JSON.stringify(o)),fetch(`${a}${l}`,d).then((a=>{"text"!==o.dataType?a.json().then((o=>{a.data=o,t(a)}),p):a.text().then((o=>{a.data=o,t(a)}),p)}),p)}catch(t){p(t)}else if(window.XMLHttpRequest){const d=new XMLHttpRequest;let h;d.onreadystatechange=function(){if(4===d.readyState)if(200===d.status){try{h=JSON.parse(d.response||"{}")}catch(t){h=d.response}t({status:d.status,data:h})}else p(d.status)},d.open(o.method,a),d.setRequestHeader("Content-Type",c),d.send(l?JSON.stringify(o.params):"")}else p("request no suppout")}))])}return request}()})),Hh=console;var Jh={setLogger:function setLogger(t){Hh=t},platform:"BROWSER",localStorage:window.localStorage,request:zh,WebSocket:window.WebSocket,uploadFile:function uploadFile(t){return __awaiter(this,void 0,void 0,zr.mark((function _callee(){var a,o,c,l,p,d,h;return zr.wrap((function _callee$(m){for(;;)switch(m.prev=m.next){case 0:if(t.fileInput||t.file){m.next=2;break}throw new Error("File not exist");case 2:if(!t.file){m.next=6;break}l=t.file,m.next=20;break;case 6:if("string"!=typeof t.fileInput){m.next=15;break}if(!((p=document.getElementById(t.fileInput))&&p.files&&p.files[0])){m.next=12;break}l=p.files[0],m.next=13;break;case 12:throw new Error("Can not get file from fileInput");case 13:m.next=20;break;case 15:if(!(t.fileInput&&t.fileInput.files&&t.fileInput.files[0])){m.next=19;break}l=t.fileInput.files[0],m.next=20;break;case 19:throw new Error("Can not get file from fileInput ".concat(t.fileInput));case 20:if(!(t.maxSize&&l.size>t.maxSize)){m.next=22;break}throw new Error(concat(d="The file exceeds maxSize limit. maxSize: ".concat(t.maxSize,", get ")).call(d,l.size));case 22:return m.next=24,new pa((function(a,o){var c=Vh.createConfig({directUploadAddr:t.chunkUploadHost,onError:function onError(t){o(t)},onProgress:t.onUploadProgress||function(){},onComplete:function onComplete(t){a(t)}}),p=Vh.createTask(l,{bucketName:t.nosToken.bucket,objectName:decodeURIComponent(t.nosToken.objectName),token:t.nosToken.token},c);try{t.onUploadStart&&t.onUploadStart(p)}catch(t){Hh.error("Adapter uploadFile: options.onUploadStart error",t&&t.message),p.abort(),o(t)}}));case 24:return(h=m.sent).name=l.name,h.size=l.size,h.type=l.type,h.ext=lastIndexOf(a=h.name).call(a,".")>-1?slice(o=h.name).call(o,lastIndexOf(c=h.name).call(c,".")+1).toLowerCase():"",m.abrupt("return",h);case 30:case"end":return m.stop()}}),_callee)})))},getSystemInfo:function getSystemInfo(){return{os:Kh.os?Kh.os.toString():"",browser:Kh.name+" "+Kh.version}}};return Lh.setAdapters(Jh),Lh}));
